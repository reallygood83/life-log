/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var K=Object.defineProperty;var Jt=Object.getOwnPropertyDescriptor;var Qt=Object.getOwnPropertyNames;var Xt=Object.prototype.hasOwnProperty;var Zt=(i,t)=>{for(var e in t)K(i,e,{get:t[e],enumerable:!0})},te=(i,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Qt(t))!Xt.call(i,r)&&r!==e&&K(i,r,{get:()=>t[r],enumerable:!(n=Jt(t,r))||n.enumerable});return i};var ee=i=>te(K({},"__esModule",{value:!0}),i);var ze={};Zt(ze,{default:()=>U});module.exports=ee(ze);var G=require("obsidian");var ne=/^-\s*\[(.)\]\s*(.+)$/,re={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},se={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function J(i,t){var p,m,h,g;let e=i.match(ne);if(!e)return null;let n=(p=e[1])!=null?p:" ",r=(m=e[2])!=null?m:"",a=(h=re[n])!=null?h:"pending",s=r.split("|").map(k=>k.trim()),o=(g=s[0])!=null?g:"",c=s.slice(1),d=[],l,u;for(let k of c){let f=ae(k);f&&(d.push(f),f.key.toLowerCase()==="duration"&&(f.editable?l=w(f.value):u=f.value+(f.unit?` ${f.unit}`:"")))}return{state:a,name:o,params:d,targetDuration:l,recordedDuration:u,lineIndex:t}}function ae(i){var c,d,l;let t=i.indexOf(":");if(t===-1)return null;let e=i.substring(0,t).trim(),n=i.substring(t+1).trim(),r=n.match(/^\[([^\]]*)\](.*)$/);if(r){let u=(c=r[1])!=null?c:"",p=((d=r[2])!=null?d:"").trim();return{key:e,value:u,editable:!0,unit:p||void 0}}let a=n.split(/\s+/),s=(l=a[0])!=null?l:"",o=a.slice(1).join(" ")||void 0;return{key:e,value:s,editable:!1,unit:o}}function w(i){var s,o,c,d,l,u;let t=i.trim(),e=t.match(/^(\d+)s$/);if(e)return parseInt((s=e[1])!=null?s:"0",10);let n=t.match(/^(\d+):(\d{2})$/);if(n){let p=parseInt((o=n[1])!=null?o:"0",10),m=parseInt((c=n[2])!=null?c:"0",10);return p*60+m}let r=t.match(/^(\d+)m\s*(\d+)?s?$/);if(r){let p=parseInt((d=r[1])!=null?d:"0",10),m=parseInt((l=r[2])!=null?l:"0",10);return p*60+m}let a=t.match(/^(\d+)$/);return a?parseInt((u=a[1])!=null?u:"0",10):0}function v(i){let t=Math.floor(i/60),e=i%60;return`${t}:${e.toString().padStart(2,"0")}`}function T(i){let t=Math.floor(i/60),e=i%60;return t===0?`${e}s`:e===0?`${t}m`:`${t}m ${e}s`}function Lt(i){return se[i]}function Q(i){let e=`- [${Lt(i.state)}] ${i.name}`;for(let n of i.params)e+=" | ",e+=`${n.key}: `,n.editable?e+=`[${n.value}]`:e+=n.value,n.unit&&(e+=` ${n.unit}`);return e}var ie=["planned","started","completed"];function X(i){let t={state:"planned"};for(let e of i){let n=e.indexOf(":");if(n===-1)continue;let r=e.substring(0,n).trim().toLowerCase(),a=e.substring(n+1).trim();switch(r){case"title":a&&(t.title=a);break;case"state":ie.includes(a)&&(t.state=a);break;case"startdate":a&&(t.startDate=a);break;case"duration":a&&(t.duration=a);break;case"restduration":if(a){let s=w(a);s>0&&(t.restDuration=s)}break}}return t}function Z(i){let t=[];return i.title!==void 0&&t.push(`title: ${i.title}`),t.push(`state: ${i.state}`),i.startDate!==void 0&&t.push(`startDate: ${i.startDate}`),i.duration!==void 0&&t.push(`duration: ${i.duration}`),i.restDuration!==void 0&&t.push(`restDuration: ${T(i.restDuration)}`),t}function Dt(i){var c;let t=i.split(`
`),e=-1;for(let d=0;d<t.length;d++)if(((c=t[d])==null?void 0:c.trim())==="---"){e=d;break}let n=e>0?t.slice(0,e):[],r=X(n),a=e>=0?e+1:0,s=t.slice(a),o=[];for(let d=0;d<s.length;d++){let l=s[d];if(!l)continue;let u=J(l,d);u&&o.push(u)}return{metadata:r,exercises:o,rawLines:t,metadataEndIndex:e>=0?e:-1}}function tt(i){let t=[],e=Z(i.metadata);t.push(...e),t.push("---");for(let n of i.exercises)t.push(Q(n));return t.join(`
`)}function Ct(i,t,e,n){let r=structuredClone(i),a=r.exercises[t];if(!a)return i;let s=a.params.find(o=>o.key===e);return s&&(s.value=n),r}function L(i,t,e){let n=structuredClone(i),r=n.exercises[t];return r?(r.state=e,n):i}function I(i){let t=structuredClone(i);for(let e of t.exercises)for(let n of e.params)n.editable=!1;return t}function Mt(i,t,e){let n=structuredClone(i),r=n.exercises[t];if(!r)return i;let a={state:"pending",name:"Rest",params:[{key:"Duration",value:`${e}s`,editable:!0}],targetDuration:e,lineIndex:r.lineIndex+1};n.exercises.splice(t+1,0,a);for(let s=t+2;s<n.exercises.length;s++){let o=n.exercises[s];o&&o.lineIndex++}return n}function Pt(i,t){let e=structuredClone(i),n=e.exercises[t];if(!n)return i;let r={...structuredClone(n),state:"pending",recordedDuration:void 0,lineIndex:n.lineIndex+1};for(let a of r.params)a.key.toLowerCase()==="duration"&&!a.editable&&(a.editable=n.targetDuration!==void 0);e.exercises.splice(t+1,0,r);for(let a=t+2;a<e.exercises.length;a++){let s=e.exercises[a];s&&s.lineIndex++}return e}function W(i,t,e){let n=structuredClone(i),r=n.exercises[t];if(!r)return i;let a=r.params.find(s=>s.key.toLowerCase()==="duration");return a?(a.value=e,a.editable=!1):r.params.push({key:"Duration",value:e,editable:!1}),r.recordedDuration=e,n}function Wt(){return{metadata:{title:"Sample Workout",state:"planned",restDuration:60},exercises:[{state:"pending",name:"Squats",params:[{key:"Weight",value:"60",editable:!0,unit:"kg"},{key:"Reps",value:"12",editable:!0}],lineIndex:0},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:1},{state:"pending",name:"Push-ups",params:[{key:"Reps",value:"15",editable:!0}],lineIndex:2},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:3},{state:"pending",name:"Dumbbell Rows",params:[{key:"Weight",value:"20",editable:!0,unit:"kg"},{key:"Reps",value:"10",editable:!0,unit:"/arm"}],lineIndex:4},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:5},{state:"pending",name:"Plank Hold",params:[{key:"Duration",value:"45s",editable:!0}],targetDuration:45,lineIndex:6},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:7},{state:"pending",name:"Lunges",params:[{key:"Reps",value:"10",editable:!0,unit:"/leg"}],lineIndex:8}],rawLines:[],metadataEndIndex:-1}}function $t(i){let t=[];i.metadata.title&&t.push(`title: ${i.metadata.title}`),t.push("state: planned"),t.push("startDate:"),t.push("duration:"),t.push("---");let e=new Set,n=[];for(let r of i.exercises)e.has(r.name)||(e.add(r.name),n.push(r));for(let r of n){let a=`- [ ] ${r.name}`;for(let s of r.params)if(a+=" | ",a+=`${s.key}: `,!(s.key.toLowerCase()==="duration"&&!r.targetDuration)){if(s.key.toLowerCase()==="duration"&&r.targetDuration){let o=Math.floor(r.targetDuration/60),c=r.targetDuration%60,d=o>0?`${o}m ${c}s`:`${c}s`;a+=`[${d}]`}else a+=`[${s.value}]`;s.unit&&(a+=` ${s.unit}`)}t.push(a)}return t.join(`
`)}function et(i,t,e,n){let r=i.createDiv({cls:"workout-header"}),a=r.createDiv({cls:"workout-title"});if(a.textContent=t.title||"Workout",t.restDuration){let c=r.createDiv({cls:"workout-rest-duration"}),d=T(t.restDuration);c.setText(`Rest: ${d}`)}let o=r.createDiv({cls:"workout-header-timer"}).createSpan({cls:"workout-timer"});return t.state==="completed"&&t.duration?(o.textContent=t.duration,o.createSpan({cls:"workout-timer-indicator recorded",text:" \u2713"})):n&&e?(o.textContent=`Total: ${v(e.workoutElapsed)}`,o.createSpan({cls:"workout-timer-indicator count-up",text:" \u25B2"})):(t.state,o.textContent="--:--"),{titleEl:a,timerEl:o}}function nt(i,t){i.empty(),i.textContent=`Total: ${v(t.workoutElapsed)}`,i.createSpan({cls:"workout-timer-indicator count-up",text:" \u25B2"})}var oe={pending:"\u25CB",inProgress:"\u25D0",completed:"\u2713",skipped:"\u2014"};function ce(i){let t=5381;for(let r=0;r<i.length;r++)t=(t<<5)+t^i.charCodeAt(r);let e=.618033988749895,n=Math.abs(t)%1e3/1e3;return Math.floor(n*e%1*360)}function It(i){return i.params.some(t=>t.key.toLowerCase()!=="duration")}function rt(i,t,e,n,r,a,s,o){let c=!It(t),d=i.createDiv({cls:`workout-exercise state-${t.state}${n?" active":""}${c?" simple":""}`}),l=ce(t.name);d.style.setProperty("--exercise-color",`hsl(${l}, 65%, 55%)`);let u=new Map,p=d.createDiv({cls:"workout-exercise-main"}),m=p.createSpan({cls:"workout-exercise-icon"});m.textContent=oe[t.state];let h=p.createSpan({cls:"workout-exercise-name"});if(h.textContent=t.name,It(t)){let k=p.createSpan({cls:"workout-exercise-params"});for(let f of t.params){if(f.key.toLowerCase()==="duration")continue;let S=k.createSpan({cls:"workout-param"});if(f.unit||S.createSpan({cls:"workout-param-prefix",text:"\xD7"}),f.editable&&s!=="completed"){let x=S.createEl("input",{cls:"workout-param-input",type:"text",value:f.value});x.addEventListener("input",()=>{a.onParamChange(e,f.key,x.value)}),x.addEventListener("keydown",y=>{y.key==="Enter"&&x.blur()}),u.set(f.key,x)}else S.createSpan({cls:"workout-param-value",text:f.value});f.unit&&S.createSpan({cls:"workout-param-unit",text:` ${f.unit}`})}}let g=p.createSpan({cls:"workout-exercise-timer"});return t.state==="completed"&&t.recordedDuration?(g.textContent=t.recordedDuration,g.createSpan({cls:"timer-indicator recorded",text:" \u2713"})):n&&r?H(g,r,t.targetDuration):t.targetDuration?(g.textContent=v(t.targetDuration),g.createSpan({cls:"timer-indicator count-down",text:" \u25BC"})):t.state==="pending"&&(g.textContent="--"),n&&s==="started"&&le(d,e,a,o),{container:d,timerEl:g,inputs:u}}function le(i,t,e,n){let r=i.createDiv({cls:"workout-exercise-controls"}),a=r.createEl("button",{cls:"workout-btn",text:"Pause"});a.addEventListener("click",()=>{a.textContent==="Pause"?(e.onPauseExercise(),a.textContent="Resume"):(e.onResumeExercise(),a.textContent="Pause")}),r.createEl("button",{cls:"workout-btn",text:"Skip"}).addEventListener("click",()=>{e.onExerciseSkip(t)});let o=r.createDiv({cls:"workout-btn-group"});o.createEl("button",{cls:"workout-btn",text:"+ Set"}).addEventListener("click",()=>{e.onExerciseAddSet(t)}),n!==void 0&&o.createEl("button",{cls:"workout-btn",text:"+ Rest"}).addEventListener("click",()=>{e.onExerciseAddRest(t)}),o.createEl("button",{cls:"workout-btn",text:"Next"}).addEventListener("click",()=>{e.onExerciseFinish(t)})}function H(i,t,e){if(i.empty(),e!==void 0){let n=e-t.exerciseElapsed;n>0?(i.textContent=v(n),i.createSpan({cls:"timer-indicator count-down",text:" \u25BC"})):(i.textContent=v(Math.abs(n)),i.addClass("overtime"),i.createSpan({cls:"timer-indicator overtime",text:" \u26A0"}))}else i.textContent=v(t.exerciseElapsed),i.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}function st(i,t,e,n){let r=i.createDiv({cls:"workout-controls"});if(t==="planned"){let a=r.createEl("button",{cls:"workout-btn workout-btn-primary workout-btn-large"});a.createSpan({cls:"workout-btn-icon",text:"\u25B6"}),a.createSpan({text:"Start Workout"}),a.addEventListener("click",()=>{e.onStartWorkout()})}else if(t==="completed"){let a=r.createSpan({cls:"workout-completed-label"});a.createSpan({cls:"workout-btn-icon",text:"\u2713"}),a.createSpan({text:"Completed"});let s=r.createEl("button",{cls:"workout-btn"});s.createSpan({cls:"workout-btn-icon",text:"\u{1F4CB}"}),s.createSpan({text:"Copy as Template"}),s.addEventListener("click",async()=>{let o=$t(n);await navigator.clipboard.writeText("```workout\n"+o+"\n```");let c=s.querySelector("span:last-child");if(c){let d=c.textContent;c.textContent="Copied!",setTimeout(()=>{c.textContent=d},1500)}})}return r}function Ht(i,t){let e=i.createDiv({cls:"workout-empty-state"});e.createDiv({cls:"workout-empty-message"}).createSpan({text:"This workout is empty"});let a=e.createDiv({cls:"workout-empty-action"}).createEl("button",{cls:"workout-btn workout-btn-primary workout-btn-large"});return a.createSpan({cls:"workout-btn-icon",text:"\u2728"}),a.createSpan({text:"Add Sample Workout"}),a.addEventListener("click",async()=>{await t()}),e}function At(i){let{el:t,parsed:e,callbacks:n,workoutId:r,timerManager:a}=i;t.empty();let s=t.createDiv({cls:`workout-container state-${e.metadata.state}`}),o=a.isTimerRunning(r),c=a.getTimerState(r),d=o?a.getActiveExerciseIndex(r):-1,{timerEl:l}=et(s,e.metadata,c,o);if(e.exercises.length===0&&e.metadata.state==="planned"){Ht(s,n.onAddSample);return}let u=[],p=s.createDiv({cls:"workout-exercises"}),m=Math.max(...e.exercises.map(h=>h.name.length));p.style.setProperty("--max-name-chars",String(m));for(let h=0;h<e.exercises.length;h++){let g=e.exercises[h];if(!g)continue;let k=h===d,f=rt(p,g,h,k,k?c:null,n,e.metadata.state,e.metadata.restDuration);u.push(f)}if(st(s,e.metadata.state,n,e),s.addEventListener("focusout",h=>{let g=h.relatedTarget;(!g||!s.contains(g))&&n.onFlushChanges()}),o){let h=d,g=!1;a.subscribe(r,k=>{nt(l,k);let f=a.getActiveExerciseIndex(r);if(f!==h)return;let S=u[f],x=e.exercises[f];S!=null&&S.timerEl&&x&&(H(S.timerEl,k,x.targetDuration),!g&&x.targetDuration!==void 0&&k.exerciseElapsed>=x.targetDuration&&(g=!0,n.onExerciseFinish(f)))})}}var A=class{constructor(){this.timers=new Map;this.intervalId=null;this.onAutoAdvance=null}setAutoAdvanceCallback(t){this.onAutoAdvance=t}startWorkoutTimer(t,e=0){let n=Date.now(),r=this.timers.get(t);r?(r.exerciseStartTime=n,r.exercisePausedTime=0,r.isPaused=!1,r.activeExerciseIndex=e):this.timers.set(t,{workoutId:t,workoutStartTime:n,exerciseStartTime:n,exercisePausedTime:0,isPaused:!1,activeExerciseIndex:e,callbacks:new Set}),this.ensureInterval()}advanceExercise(t,e){let n=this.timers.get(t);n&&(n.exerciseStartTime=Date.now(),n.exercisePausedTime=0,n.isPaused=!1,n.activeExerciseIndex=e)}pauseExercise(t){let e=this.timers.get(t);if(!e||e.isPaused)return;e.isPaused=!0;let n=Date.now();e.exercisePausedTime+=n-e.exerciseStartTime}resumeExercise(t){let e=this.timers.get(t);!e||!e.isPaused||(e.isPaused=!1,e.exerciseStartTime=Date.now())}stopWorkoutTimer(t){this.timers.delete(t),this.timers.size===0&&this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)}subscribe(t,e){let n=this.timers.get(t);if(!n)return()=>{};n.callbacks.add(e);let r=this.getTimerState(t);return r&&e(r),()=>{n.callbacks.delete(e)}}getTimerState(t){let e=this.timers.get(t);if(!e)return null;let n=Date.now(),r=Math.floor((n-e.workoutStartTime)/1e3),a;if(e.isPaused)a=Math.floor(e.exercisePausedTime/1e3);else{let s=n-e.exerciseStartTime;a=Math.floor((e.exercisePausedTime+s)/1e3)}return{workoutElapsed:r,exerciseElapsed:a,isOvertime:!1}}getActiveExerciseIndex(t){var n;let e=this.timers.get(t);return(n=e==null?void 0:e.activeExerciseIndex)!=null?n:0}setActiveExerciseIndex(t,e){let n=this.timers.get(t);n&&n.activeExerciseIndex!==e&&(n.activeExerciseIndex=e,n.exerciseStartTime=Date.now(),n.exercisePausedTime=0,n.isPaused=!1)}isTimerRunning(t){return this.timers.has(t)}isPaused(t){var n;let e=this.timers.get(t);return(n=e==null?void 0:e.isPaused)!=null?n:!1}ensureInterval(){this.intervalId===null&&(this.intervalId=window.setInterval(()=>{this.tick()},1e3))}tick(){for(let[t,e]of this.timers){let n=this.getTimerState(t);if(n)for(let r of e.callbacks)r(n)}}checkAutoAdvance(t,e){if(e===void 0)return;let n=this.getTimerState(t);n&&n.exerciseElapsed>=e&&this.onAutoAdvance&&this.onAutoAdvance(t)}destroy(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timers.clear()}};var at=require("obsidian"),B=class{constructor(t){this.app=t;this.updateLocks=new Map}async withLock(t,e){let n=this.updateLocks.get(t);n&&await n;let r,a=new Promise(s=>{r=s});this.updateLocks.set(t,a);try{return await e()}finally{r(),this.updateLocks.get(t)===a&&this.updateLocks.delete(t)}}async updateCodeBlock(t,e,n,r){let a=this.app.vault.getAbstractFileByPath(t);if(!(a instanceof at.TFile)){console.error("File not found:",t);return}if(!e){console.error("No section info available");return}await this.withLock(t,async()=>{await this.app.vault.process(a,s=>{var k;let o=s.split(`
`),c=o[e.lineStart],d=c==null?void 0:c.trim().startsWith("```life-log"),l=c==null?void 0:c.trim().startsWith("```study-log");if(!c||!d&&!l)return console.error("Stale sectionInfo: expected ```life-log or ```study-log at line",e.lineStart),s;if(r){let S=o.slice(e.lineStart+1,e.lineEnd).join(`
`).match(/^title:\s*(.+)$/m),x=(k=S==null?void 0:S[1])==null?void 0:k.trim();if(x&&x!==r)return console.error("Title mismatch: expected",r,"but found",x),s}let u=e.lineStart,p=e.lineEnd,m=o.slice(0,u+1),h=o.slice(p);return[...m,n,...h].join(`
`)})})}async insertLineAfter(t,e,n,r){let a=this.app.vault.getAbstractFileByPath(t);if(!(a instanceof at.TFile)){console.error("File not found:",t);return}if(!e){console.error("No section info available");return}await this.app.vault.process(a,s=>{let o=s.split(`
`),c=e.lineStart+1+n;return o.splice(c+1,0,r),o.join(`
`)})}};var C=require("obsidian"),$=class{constructor(t,e){this.app=t;this.settings=e}async createLogFile(t,e){let n=new Date,r=this.buildFolderPath(n),a=this.buildFileName(n,t),s=(0,C.normalizePath)(`${r}/${a}`);await this.ensureFolderExists(r);let o=this.app.vault.getAbstractFileByPath(s);return o instanceof C.TFile?this.appendToExistingFile(o,t,e):this.createNewFile(s,t,n,e)}buildFolderPath(t){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return(0,C.normalizePath)(`${this.settings.logFolder}/${e}/${n}`)}buildFileName(t,e){return`${this.formatDate(t)}-${e}.md`}formatDate(t){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");switch(this.settings.dateFormat){case"YYYY/MM/DD":return`${e}/${n}/${r}`;case"DD-MM-YYYY":return`${r}-${n}-${e}`;default:return`${e}-${n}-${r}`}}async ensureFolderExists(t){if(this.app.vault.getAbstractFileByPath(t)instanceof C.TFolder)return;let n=t.split("/"),r="";for(let a of n)r=r?`${r}/${a}`:a,this.app.vault.getAbstractFileByPath(r)||await this.app.vault.createFolder(r)}async appendToExistingFile(t,e,n){let r=this.getBlockType(e),a=this.buildNewSection(e,n,r);return await this.app.vault.process(t,s=>s+`

---

`+a),t}getBlockType(t){switch(t){case"study":return"study-log";case"work":return"work-log";case"workout":return"life-log"}}async createNewFile(t,e,n,r){let a=this.getBlockType(e),s=this.buildFrontmatter(e,n),o=this.buildHeading(e,n),c=this.buildNewSection(e,r,a),d=`${s}

${o}

${c}`;return await this.app.vault.create(t,d)}buildFrontmatter(t,e){let n=this.formatDate(e),r=e.toISOString();return["---",`type: ${t}-log`,`date: ${n}`,`created: ${r}`,"---"].join(`
`)}buildHeading(t,e){let n=this.formatDate(e),r={study:"\u{1F4DA}",work:"\u{1F4BC}",workout:"\u{1F3CB}\uFE0F"},a={study:"\uD559\uC2B5",work:"\uC5C5\uBB34",workout:"\uC6B4\uB3D9"};return`# ${r[t]} ${n} ${a[t]} \uAE30\uB85D`}buildNewSection(t,e,n){let a=new Date().getHours();return[`## ${a<12?"\uC624\uC804":a<18?"\uC624\uD6C4":"\uC800\uB141"} ${{study:"\uD559\uC2B5",work:"\uC5C5\uBB34",workout:"\uC6B4\uB3D9"}[t]} \uC138\uC158`,"",`\`\`\`${n}`,e,"```"].join(`
`)}formatDateTime(t){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return`${e}-${n}-${r} ${a}:${s}`}};var ue=["planned","started","completed"];function it(i){let t={title:"",subject:"",state:"planned"};for(let e of i){let n=e.indexOf(":");if(n===-1)continue;let r=e.substring(0,n).trim().toLowerCase(),a=e.substring(n+1).trim();switch(r){case"title":t.title=a;break;case"subject":t.subject=a;break;case"state":ue.includes(a)&&(t.state=a);break;case"startdate":a&&(t.startDate=a);break;case"enddate":a&&(t.endDate=a);break;case"totalduration":a&&(t.totalDuration=a);break;case"focusscore":let s=parseInt(a);s>=1&&s<=5&&(t.focusScore=s);break;case"comprehensionscore":let o=parseInt(a);o>=1&&o<=5&&(t.comprehensionScore=o);break;case"tags":a&&(t.tags=a.split(",").map(c=>c.trim()).filter(c=>c));break}}return t}function ot(i){let t=[];return i.title&&t.push(`title: ${i.title}`),i.subject&&t.push(`subject: ${i.subject}`),t.push(`state: ${i.state}`),i.startDate&&t.push(`startDate: ${i.startDate}`),i.endDate&&t.push(`endDate: ${i.endDate}`),i.totalDuration&&t.push(`totalDuration: ${i.totalDuration}`),i.focusScore&&t.push(`focusScore: ${i.focusScore}`),i.comprehensionScore&&t.push(`comprehensionScore: ${i.comprehensionScore}`),i.tags&&i.tags.length>0&&t.push(`tags: ${i.tags.join(", ")}`),t}var de=/^-\s*\[(.)\]\s*(.+)$/,pe={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},me={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function ct(i,t){var u,p,m,h,g;let e=i.match(de);if(!e)return null;let n=(u=e[1])!=null?u:" ",r=(p=e[2])!=null?p:"",a=(m=pe[n])!=null?m:"pending",s=r.split("|").map(k=>k.trim()),o=(h=s[0])!=null?h:"",c,d,l;for(let k=1;k<s.length;k++){let f=s[k];if(!f)continue;let S=f.indexOf(":");if(S===-1){l=f;continue}let x=f.substring(0,S).trim().toLowerCase(),y=f.substring(S+1).trim();if(x==="duration"){let E=y.match(/^\[([^\]]*)\]$/);E?c=w((g=E[1])!=null?g:"0"):d=y}else l?l+=" | "+f:l=f}return{state:a,name:o,targetDuration:c,recordedDuration:d,notes:l,lineIndex:t}}function Bt(i){return me[i]}function lt(i){let e=`- [${Bt(i.state)}] ${i.name}`;return i.targetDuration!==void 0&&i.state==="pending"?e+=` | Duration: [${ge(i.targetDuration)}]`:i.recordedDuration&&(e+=` | Duration: ${i.recordedDuration}`),i.notes&&(e+=` | ${i.notes}`),e}function ge(i){let t=Math.floor(i/60),e=i%60;return t===0?`${e}s`:e===0?`${t}m`:`${t}m ${e}s`}function Rt(i){var c;let t=i.split(`
`),e=-1;for(let d=0;d<t.length;d++)if(((c=t[d])==null?void 0:c.trim())==="---"){e=d;break}let n=e>0?t.slice(0,e):[],r=it(n),a=e>=0?e+1:0,s=t.slice(a),o=[];for(let d=0;d<s.length;d++){let l=s[d];if(!l)continue;let u=ct(l,d);u&&o.push(u)}return{metadata:r,tasks:o,rawLines:t,metadataEndIndex:e>=0?e:-1}}function Ft(i){let t=[],e=ot(i.metadata);t.push(...e),t.push("---");for(let n of i.tasks)t.push(lt(n));return t.join(`
`)}function M(i,t,e){let n=structuredClone(i),r=n.tasks[t];return r?(r.state=e,n):i}function R(i,t,e){let n=structuredClone(i),r=n.tasks[t];return r?(r.recordedDuration=e,r.targetDuration=void 0,n):i}function jt(i,t,e){let n=structuredClone(i);return n.metadata.focusScore=t,n.metadata.comprehensionScore=e,n}function ut(i,t,e,n){let r=i.createDiv({cls:"study-header"}),a=r.createDiv({cls:"study-header-top"}),s=a.createDiv({cls:"study-title"}),o=ke(t.subject);s.createSpan({cls:"study-subject-icon",text:o}),s.createSpan({cls:"study-subject-name",text:t.subject||"\uD559\uC2B5"}),t.title&&s.createSpan({cls:"study-title-text",text:` - ${t.title}`});let c=a.createDiv({cls:"study-timer"});fe(c,t,e,n);let d=r.createDiv({cls:"study-scores"});if(t.state==="completed"&&he(d,t.focusScore,t.comprehensionScore),t.tags&&t.tags.length>0){let l=r.createDiv({cls:"study-tags"});for(let u of t.tags)l.createSpan({cls:"study-tag",text:u})}return{titleEl:s,timerEl:c,scoresEl:d}}function fe(i,t,e,n){t.state==="completed"&&t.totalDuration?(i.createSpan({cls:"study-timer-value",text:t.totalDuration}),i.createSpan({cls:"study-timer-indicator recorded",text:" \u2713"})):n&&e?(i.createSpan({cls:"study-timer-value",text:v(e.workoutElapsed)}),i.createSpan({cls:"study-timer-indicator count-up",text:" \u25B2"})):i.createSpan({cls:"study-timer-value",text:"--:--"})}function he(i,t,e){if(t){let n=i.createDiv({cls:"study-score-item"});n.createSpan({cls:"study-score-label",text:"\uC9D1\uC911\uB3C4: "}),Nt(n,t)}if(e){let n=i.createDiv({cls:"study-score-item"});n.createSpan({cls:"study-score-label",text:"\uC774\uD574\uB3C4: "}),Nt(n,e)}}function Nt(i,t){let e=i.createSpan({cls:`study-stars score-${t}`});for(let n=1;n<=5;n++)e.createSpan({cls:`study-star ${n<=t?"filled":"empty"}`,text:n<=t?"\u2605":"\u2606"})}function ke(i){return{\uC218\uD559:"\u{1F4D0}",\uC601\uC5B4:"\u{1F524}",\uD504\uB85C\uADF8\uB798\uBC0D:"\u{1F4BB}",\uB3C5\uC11C:"\u{1F4D6}",\uAE30\uD0C0:"\u{1F4DD}"}[i]||"\u{1F4DA}"}function dt(i,t){i.empty(),i.createSpan({cls:"study-timer-value",text:v(t.workoutElapsed)}),i.createSpan({cls:"study-timer-indicator count-up",text:" \u25B2"})}function pt(i,t,e,n,r,a,s){let o=i.createDiv({cls:`study-task state-${t.state} ${n?"active":""}`}),c=o.createDiv({cls:"study-task-main"}),d=c.createSpan({cls:"study-task-icon"});d.textContent=xe(t.state);let l=c.createSpan({cls:"study-task-name"});l.textContent=t.name;let u=null;if(t.notes){let p=c.createSpan({cls:"study-task-notes"});p.textContent=t.notes}if(u=c.createSpan({cls:"study-task-timer"}),t.state==="completed"&&t.recordedDuration)u.textContent=t.recordedDuration,u.createSpan({cls:"timer-indicator recorded",text:" \u2713"});else if(n&&r)F(u,r,t.targetDuration);else if(t.targetDuration){let p=Math.floor(t.targetDuration/60),m=t.targetDuration%60;u.textContent=`[${p}m ${m>0?m+"s":""}]`,u.classList.add("target")}return n&&s==="started"&&Se(o,e,a),{taskEl:o,timerEl:u}}function Se(i,t,e){let n=i.createDiv({cls:"study-task-controls"});n.createEl("button",{cls:"study-btn",text:"\u2713 \uC644\uB8CC"}).addEventListener("click",()=>e.onTaskFinish(t)),n.createEl("button",{cls:"study-btn",text:"\u23ED \uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>e.onTaskSkip(t))}function xe(i){switch(i){case"completed":return"\u2713";case"inProgress":return"\u25B6";case"skipped":return"\u2013";default:return"\u25CB"}}function F(i,t,e){if(i.empty(),i.classList.remove("overtime"),e!==void 0){let n=e-t.exerciseElapsed;n<0?(i.classList.add("overtime"),i.textContent=`+${v(Math.abs(n))}`,i.createSpan({cls:"timer-indicator overtime",text:" !"})):(i.textContent=v(n),i.createSpan({cls:"timer-indicator count-down",text:" \u25BC"}))}else i.textContent=v(t.exerciseElapsed),i.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}function mt(i,t,e,n){let r=i.createDiv({cls:"study-controls"});if(t==="planned"){let a=r.createEl("button",{cls:"study-btn study-btn-primary study-btn-large"});a.createSpan({cls:"study-btn-icon",text:"\u25B6"}),a.createSpan({text:"\uD559\uC2B5 \uC2DC\uC791"}),a.addEventListener("click",()=>e.onStartStudy())}else if(t==="started"){let a=r.createEl("button",{cls:"study-btn study-btn-primary"});a.createSpan({cls:"study-btn-icon",text:"\u2713"}),a.createSpan({text:"\uD559\uC2B5 \uC644\uB8CC"}),a.addEventListener("click",()=>e.onOpenSelfEval())}else if(t==="completed"){let a=r.createSpan({cls:"study-completed-label"});a.createSpan({cls:"study-btn-icon",text:"\u2713"}),a.createSpan({text:"\uC644\uB8CC\uB428"});let s=r.createEl("button",{cls:"study-btn"});s.createSpan({cls:"study-btn-icon",text:"\u{1F4CB}"}),s.createSpan({text:"\uD15C\uD50C\uB9BF \uBCF5\uC0AC"}),s.addEventListener("click",async()=>{let o=ve(n);await navigator.clipboard.writeText("```study-log\n"+o+"\n```");let c=s.querySelector("span:last-child");if(c){let d=c.textContent;c.textContent="Copied!",setTimeout(()=>{c.textContent=d},1500)}})}return r}function ve(i){let t=[];i.metadata.subject&&t.push(`subject: ${i.metadata.subject}`),t.push("state: planned"),t.push("---");let e=new Set;for(let n of i.tasks)if(!e.has(n.name)){e.add(n.name);let r=`- [ ] ${n.name}`;if(n.targetDuration){let a=Math.floor(n.targetDuration/60),s=n.targetDuration%60;r+=` | Duration: [${a}m${s>0?" "+s+"s":""}]`}t.push(r)}return t.join(`
`)}var Ot=0,Te=3e3;function Yt(i,t){let e=Date.now();e-Ot<Te||(Ot=e,i.enableSound&&be(),i.enableNotification&&ye(t))}function be(){try{let i=new(window.AudioContext||window.webkitAudioContext),t=i.createOscillator(),e=i.createGain();t.connect(e),e.connect(i.destination),t.frequency.value=800,t.type="sine",e.gain.setValueAtTime(.3,i.currentTime),e.gain.exponentialRampToValueAtTime(.01,i.currentTime+.5),t.start(i.currentTime),t.stop(i.currentTime+.5),setTimeout(()=>{let n=i.createOscillator(),r=i.createGain();n.connect(r),r.connect(i.destination),n.frequency.value=1e3,n.type="sine",r.gain.setValueAtTime(.3,i.currentTime),r.gain.exponentialRampToValueAtTime(.01,i.currentTime+.5),n.start(i.currentTime),n.stop(i.currentTime+.5)},200)}catch(i){console.warn("[Life Log] Could not play notification sound:",i)}}function ye(i){"Notification"in window&&(Notification.permission==="granted"?new Notification("Life Log",{body:i?`"${i}" \uC2DC\uAC04\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!`:"\uD0C0\uC774\uBA38\uAC00 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!",icon:void 0,silent:!0}):Notification.permission!=="denied"&&Notification.requestPermission())}function zt(i){let{el:t,parsed:e,callbacks:n,studyId:r,timerManager:a,enableTimerSound:s=!0,enableNotification:o=!1}=i;t.empty();let c=t.createDiv({cls:`study-container state-${e.metadata.state}`}),d=a.isTimerRunning(r),l=a.getTimerState(r),u=d?a.getActiveExerciseIndex(r):-1,p=ut(c,e.metadata,l,d);if(e.tasks.length===0&&e.metadata.state==="planned"){Ee(c);return}let m=[],h=c.createDiv({cls:"study-tasks"});for(let g=0;g<e.tasks.length;g++){let k=e.tasks[g];if(!k)continue;let f=g===u,S=pt(h,k,g,f,f?l:null,n,e.metadata.state);m.push(S)}if(mt(c,e.metadata.state,n,e),c.addEventListener("focusout",g=>{let k=g.relatedTarget;(!k||!c.contains(k))&&n.onFlushChanges()}),d){let g=u,k=!1;a.subscribe(r,f=>{dt(p.timerEl,f);let S=a.getActiveExerciseIndex(r);if(S!==g)return;let x=m[S],y=e.tasks[S];x!=null&&x.timerEl&&y&&(F(x.timerEl,f,y.targetDuration),!k&&y.targetDuration!==void 0&&f.exerciseElapsed>=y.targetDuration&&(k=!0,Yt({enableSound:s,enableNotification:o},y.name),n.onTaskFinish(S)))})}}function Ee(i){i.createDiv({cls:"study-empty-state"}).createDiv({cls:"study-empty-message",text:"\uD559\uC2B5 \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uCF54\uB4DC\uBE14\uB85D\uC5D0 \uD56D\uBAA9\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}var we=["planned","started","completed"];function gt(i){let t={title:"",state:"planned"};for(let e of i){let n=e.indexOf(":");if(n===-1)continue;let r=e.substring(0,n).trim().toLowerCase(),a=e.substring(n+1).trim();switch(r){case"title":t.title=a;break;case"state":we.includes(a)&&(t.state=a);break;case"startdate":a&&(t.startDate=a);break;case"enddate":a&&(t.endDate=a);break;case"totalduration":a&&(t.totalDuration=a);break;case"tags":a&&(t.tags=a.split(",").map(s=>s.trim()).filter(s=>s));break}}return t}function ft(i){let t=[];return i.title&&t.push(`title: ${i.title}`),t.push(`state: ${i.state}`),i.startDate&&t.push(`startDate: ${i.startDate}`),i.endDate&&t.push(`endDate: ${i.endDate}`),i.totalDuration&&t.push(`totalDuration: ${i.totalDuration}`),i.tags&&i.tags.length>0&&t.push(`tags: ${i.tags.join(", ")}`),t}var Le=/^-\s*\[(.)\]\s*(.+)$/,De={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},Ce={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function ht(i,t){var p,m,h,g,k;let e=i.match(Le);if(!e)return null;let n=(p=e[1])!=null?p:" ",r=(m=e[2])!=null?m:"",a=(h=De[n])!=null?h:"pending",s=r.split("|").map(f=>f.trim()),o=(g=s[0])!=null?g:"",c="medium",d,l,u;for(let f=1;f<s.length;f++){let S=s[f];if(!S)continue;let x=S.indexOf(":");if(x===-1){u=u?u+" | "+S:S;continue}let y=S.substring(0,x).trim().toLowerCase(),E=S.substring(x+1).trim();if(y==="priority")["high","medium","low"].includes(E.toLowerCase())&&(c=E.toLowerCase());else if(y==="expected"){let wt=E.match(/^\[([^\]]*)\]$/);wt?d=w((k=wt[1])!=null?k:"0"):d=w(E)}else y==="actual"?E&&E!==""&&(l=E):u=u?u+" | "+S:S}return{state:a,name:o,priority:c,expectedDuration:d,actualDuration:l,notes:u,lineIndex:t}}function _t(i){return Ce[i]}function kt(i){let e=`- [${_t(i.state)}] ${i.name}`;return e+=` | Priority: ${i.priority}`,i.expectedDuration!==void 0&&(e+=` | Expected: [${Me(i.expectedDuration)}]`),i.actualDuration&&(e+=` | Actual: ${i.actualDuration}`),i.notes&&(e+=` | ${i.notes}`),e}function Me(i){let t=Math.floor(i/3600),e=Math.floor(i%3600/60),n=i%60;return t>0?e===0&&n===0?`${t}h`:n===0?`${t}h ${e}m`:`${t}h ${e}m ${n}s`:e===0?`${n}s`:n===0?`${e}m`:`${e}m ${n}s`}function qt(i){var c;let t=i.split(`
`),e=-1;for(let d=0;d<t.length;d++)if(((c=t[d])==null?void 0:c.trim())==="---"){e=d;break}let n=e>0?t.slice(0,e):[],r=gt(n),a=e>=0?e+1:0,s=t.slice(a),o=[];for(let d=0;d<s.length;d++){let l=s[d];if(!l)continue;let u=ht(l,d);u&&o.push(u)}return{metadata:r,tasks:o,rawLines:t,metadataEndIndex:e>=0?e:-1}}function Vt(i){let t=[],e=ft(i.metadata);t.push(...e),t.push("---");for(let n of i.tasks)t.push(kt(n));return t.join(`
`)}function P(i,t,e){let n=structuredClone(i),r=n.tasks[t];return r?(r.state=e,n):i}function j(i,t,e){let n=structuredClone(i),r=n.tasks[t];return r?(r.actualDuration=e,n):i}function St(i,t,e,n){let r=i.createDiv({cls:"work-header"}),a=r.createDiv({cls:"work-header-top"}),s=a.createDiv({cls:"work-title"});s.createSpan({cls:"work-icon",text:"\u{1F4BC}"}),s.createSpan({cls:"work-title-text",text:t.title||"\uC5C5\uBB34"});let o=a.createDiv({cls:"work-timer"});if(Pe(o,t,e,n),t.tags&&t.tags.length>0){let c=r.createDiv({cls:"work-tags"});for(let d of t.tags)c.createSpan({cls:"work-tag",text:d})}return{titleEl:s,timerEl:o}}function Pe(i,t,e,n){t.state==="completed"&&t.totalDuration?(i.createSpan({cls:"work-timer-value",text:t.totalDuration}),i.createSpan({cls:"work-timer-indicator recorded",text:" \u2713"})):n&&e?(i.createSpan({cls:"work-timer-value",text:v(e.workoutElapsed)}),i.createSpan({cls:"work-timer-indicator count-up",text:" \u25B2"})):i.createSpan({cls:"work-timer-value",text:"--:--"})}function xt(i,t){i.empty(),i.createSpan({cls:"work-timer-value",text:v(t.workoutElapsed)}),i.createSpan({cls:"work-timer-indicator count-up",text:" \u25B2"})}var We={high:"#E74C3C",medium:"#F39C12",low:"#3498DB"},$e={high:"\uB192\uC74C",medium:"\uBCF4\uD1B5",low:"\uB0AE\uC74C"};function vt(i,t,e,n,r,a,s){let o=i.createDiv({cls:`work-task state-${t.state} priority-${t.priority} ${n?"active":""}`}),c=o.createDiv({cls:"work-task-main"}),d=c.createSpan({cls:"work-task-icon"});d.textContent=Be(t.state);let l=c.createSpan({cls:"work-task-priority"});l.style.backgroundColor=We[t.priority],l.setAttribute("title",$e[t.priority]);let u=c.createSpan({cls:"work-task-name"});u.textContent=t.name;let p=null;if(t.notes){let m=c.createSpan({cls:"work-task-notes"});m.textContent=t.notes}return p=c.createDiv({cls:"work-task-timer-group"}),t.state==="completed"&&t.actualDuration?Ie(p,t):n&&r?N(p,r,t.expectedDuration):t.expectedDuration&&He(p,t.expectedDuration),n&&s==="started"&&Ae(o,e,a),{taskEl:o,timerEl:p}}function Ie(i,t){if(t.expectedDuration){let n=i.createSpan({cls:"work-timer-expected"});n.textContent=`\uC608\uC0C1: ${Tt(t.expectedDuration)}`}let e=i.createSpan({cls:"work-timer-actual"});e.textContent=`\uC2E4\uC81C: ${t.actualDuration}`,e.createSpan({cls:"timer-indicator recorded",text:" \u2713"})}function He(i,t){let e=i.createSpan({cls:"work-timer-expected target"});e.textContent=`\uC608\uC0C1: [${Tt(t)}]`}function Ae(i,t,e){let n=i.createDiv({cls:"work-task-controls"});n.createEl("button",{cls:"work-btn",text:"\u2713 \uC644\uB8CC"}).addEventListener("click",()=>e.onTaskFinish(t)),n.createEl("button",{cls:"work-btn",text:"\u23ED \uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>e.onTaskSkip(t))}function Be(i){switch(i){case"completed":return"\u2713";case"inProgress":return"\u25B6";case"skipped":return"\u2013";default:return"\u25CB"}}function N(i,t,e){if(i.empty(),i.classList.remove("overtime"),e!==void 0){let n=i.createSpan({cls:"work-timer-expected"});n.textContent=`\uC608\uC0C1: ${Tt(e)}`;let r=i.createSpan({cls:"work-timer-actual"});t.exerciseElapsed>e?(i.classList.add("overtime"),r.textContent=`\uC2E4\uC81C: ${v(t.exerciseElapsed)}`,r.createSpan({cls:"timer-indicator overtime",text:" !"})):(r.textContent=`\uC2E4\uC81C: ${v(t.exerciseElapsed)}`,r.createSpan({cls:"timer-indicator count-up",text:" \u25B2"}))}else{let n=i.createSpan({cls:"work-timer-actual"});n.textContent=v(t.exerciseElapsed),n.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}}function Tt(i){let t=Math.floor(i/3600),e=Math.floor(i%3600/60),n=i%60;return t>0?e===0&&n===0?`${t}h`:n===0?`${t}h ${e}m`:`${t}h ${e}m`:e===0?`${n}s`:n===0?`${e}m`:`${e}m ${n}s`}function bt(i,t,e,n){let r=i.createDiv({cls:"work-controls"});if(t==="planned"){let a=r.createEl("button",{cls:"work-btn work-btn-primary work-btn-large"});a.createSpan({cls:"work-btn-icon",text:"\u25B6"}),a.createSpan({text:"\uC5C5\uBB34 \uC2DC\uC791"}),a.addEventListener("click",()=>e.onStartWork())}else if(t==="started"){let a=r.createEl("button",{cls:"work-btn work-btn-primary"});a.createSpan({cls:"work-btn-icon",text:"\u2713"}),a.createSpan({text:"\uC5C5\uBB34 \uC644\uB8CC"}),a.addEventListener("click",()=>e.onFinishWork())}else if(t==="completed"){let a=r.createSpan({cls:"work-completed-label"});a.createSpan({cls:"work-btn-icon",text:"\u2713"}),a.createSpan({text:"\uC644\uB8CC\uB428"}),Re(r,n);let s=r.createEl("button",{cls:"work-btn"});s.createSpan({cls:"work-btn-icon",text:"\u{1F4CB}"}),s.createSpan({text:"\uD15C\uD50C\uB9BF \uBCF5\uC0AC"}),s.addEventListener("click",async()=>{let o=Fe(n);await navigator.clipboard.writeText("```work-log\n"+o+"\n```");let c=s.querySelector("span:last-child");if(c){let d=c.textContent;c.textContent="Copied!",setTimeout(()=>{c.textContent=d},1500)}})}return r}function Re(i,t){let e=i.createDiv({cls:"work-stats"}),n=t.tasks.filter(o=>o.state==="completed").length,r=t.tasks.length;e.createSpan({cls:"work-stat",text:`\uC644\uB8CC: ${n}/${r}`});let a=t.tasks.filter(o=>o.priority==="high"&&o.state==="completed").length,s=t.tasks.filter(o=>o.priority==="high").length;if(s>0){let o=e.createSpan({cls:"work-stat high-priority"});o.createSpan({cls:"priority-dot high"}),o.createSpan({text:` \uC911\uC694: ${a}/${s}`})}}function Fe(i){let t=[];t.push("state: planned"),t.push("---");let e=new Set;for(let n of i.tasks)if(!e.has(n.name)){e.add(n.name);let r=`- [ ] ${n.name} | Priority: ${n.priority}`;n.expectedDuration&&(r+=` | Expected: [${je(n.expectedDuration)}]`),t.push(r)}return t.join(`
`)}function je(i){let t=Math.floor(i/3600),e=Math.floor(i%3600/60);return t>0?e===0?`${t}h`:`${t}h ${e}m`:`${e}m`}function Ut(i){let{el:t,parsed:e,callbacks:n,workId:r,timerManager:a,enableTimerSound:s=!0,enableNotification:o=!1}=i;t.empty();let c=t.createDiv({cls:`work-container state-${e.metadata.state}`}),d=a.isTimerRunning(r),l=a.getTimerState(r),u=d?a.getActiveExerciseIndex(r):-1,p=St(c,e.metadata,l,d);if(e.tasks.length===0&&e.metadata.state==="planned"){Ne(c);return}let m=[],h=c.createDiv({cls:"work-tasks"});for(let g=0;g<e.tasks.length;g++){let k=e.tasks[g];if(!k)continue;let f=g===u,S=vt(h,k,g,f,f?l:null,n,e.metadata.state);m.push(S)}if(bt(c,e.metadata.state,n,e),c.addEventListener("focusout",g=>{let k=g.relatedTarget;(!k||!c.contains(k))&&n.onFlushChanges()}),d){let g=u;a.subscribe(r,k=>{xt(p.timerEl,k);let f=a.getActiveExerciseIndex(r);if(f!==g)return;let S=m[f],x=e.tasks[f];S!=null&&S.timerEl&&x&&N(S.timerEl,k,x.expectedDuration)})}}function Ne(i){i.createDiv({cls:"work-empty-state"}).createDiv({cls:"work-empty-message",text:"\uC5C5\uBB34 \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uCF54\uB4DC\uBE14\uB85D\uC5D0 \uD56D\uBAA9\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}var b=require("obsidian"),yt=[{name:"\uC218\uD559",icon:"",color:"#4A90D9"},{name:"\uC601\uC5B4",icon:"",color:"#7B68EE"},{name:"\uD504\uB85C\uADF8\uB798\uBC0D",icon:"",color:"#50C878"},{name:"\uB3C5\uC11C",icon:"",color:"#FFB347"},{name:"\uAE30\uD0C0",icon:"",color:"#A0A0A0"}],Y=[{name:"\uC0C1\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uD478\uC2DC\uC5C5",params:"\uD69F\uC218: [15]"},{name:"\uB364\uBCA8 \uB85C\uC6B0",params:"\uBB34\uAC8C: [10]kg | \uD69F\uC218: [12]"},{name:"\uC204\uB354 \uD504\uB808\uC2A4",params:"\uBB34\uAC8C: [8]kg | \uD69F\uC218: [10]"}]},{name:"\uD558\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uC2A4\uCFFC\uD2B8",params:"\uBB34\uAC8C: [40]kg | \uD69F\uC218: [12]"},{name:"\uB7F0\uC9C0",params:"\uD69F\uC218: [10] /\uB2E4\uB9AC"},{name:"\uCE74\uD504\uB808\uC774\uC988",params:"\uD69F\uC218: [20]"}]},{name:"HIIT",exercises:[{name:"\uBC84\uD53C",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uC810\uD551\uC7AD",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uB9C8\uC6B4\uD2F4 \uD074\uB77C\uC774\uBA38",params:"\uC2DC\uAC04: [30\uCD08]"}]}],Et={logFolder:"Life Logs",dateFormat:"YYYY-MM-DD",subjects:yt,defaultStudyDuration:30,enablePomodoro:!1,pomodoroWork:25,pomodoroBreak:5,defaultRestDuration:60,workoutTemplates:Y,defaultTab:"study",showRibbonIcon:!0,enableTimerSound:!0,enableNotifications:!0,timerStyle:"digital",usePerTypeTimerStyle:!1,studyTimerStyle:"pomodoro",workTimerStyle:"digital",workoutTimerStyle:"digital"},O=class extends b.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e,console.log("[Life Log] LifeLogSettingTab constructed")}display(){console.log("[Life Log] LifeLogSettingTab.display() called");let{containerEl:t}=this;if(t.empty(),t.createEl("h2",{text:"Life Log \uC124\uC815"}),!this.plugin.settings){t.createEl("p",{text:"\uC124\uC815\uC744 \uBD88\uB7EC\uC624\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."});return}this.renderSaveSettings(t),this.renderStudySettings(t),this.renderWorkoutSettings(t),this.renderTimerStyleSettings(t),this.renderUISettings(t),this.renderNotificationSettings(t)}renderSaveSettings(t){t.createEl("h3",{text:"\u{1F4C1} \uC800\uC7A5 \uC124\uC815"}),new b.Setting(t).setName("\uAE30\uB85D \uC800\uC7A5 \uD3F4\uB354").setDesc("\uD559\uC2B5/\uC6B4\uB3D9 \uAE30\uB85D\uC774 \uC800\uC7A5\uB420 \uD3F4\uB354 \uACBD\uB85C").addText(e=>e.setPlaceholder("Life Logs").setValue(this.plugin.settings.logFolder).onChange(async n=>{this.plugin.settings.logFolder=n||"Life Logs",await this.plugin.saveSettings()})),new b.Setting(t).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uB420 \uB0A0\uC9DC \uD615\uC2DD").addDropdown(e=>e.addOption("YYYY-MM-DD","YYYY-MM-DD").addOption("YYYY/MM/DD","YYYY/MM/DD").addOption("DD-MM-YYYY","DD-MM-YYYY").setValue(this.plugin.settings.dateFormat).onChange(async n=>{this.plugin.settings.dateFormat=n,await this.plugin.saveSettings()}))}renderStudySettings(t){t.createEl("h3",{text:"\u{1F4DA} \uD559\uC2B5 \uAE30\uB85D \uC124\uC815"}),new b.Setting(t).setName("\uAE30\uBCF8 \uBAA9\uD45C \uC2DC\uAC04").setDesc("\uD559\uC2B5 \uD56D\uBAA9\uC758 \uAE30\uBCF8 \uBAA9\uD45C \uC2DC\uAC04 (\uBD84)").addText(e=>e.setPlaceholder("30").setValue(String(this.plugin.settings.defaultStudyDuration)).onChange(async n=>{let r=parseInt(n)||30;this.plugin.settings.defaultStudyDuration=Math.max(1,Math.min(480,r)),await this.plugin.saveSettings()})),new b.Setting(t).setName("\uD3EC\uBAA8\uB3C4\uB85C \uBAA8\uB4DC").setDesc("25\uBD84 \uD559\uC2B5 + 5\uBD84 \uD734\uC2DD \uC0AC\uC774\uD074 \uD65C\uC131\uD654").addToggle(e=>e.setValue(this.plugin.settings.enablePomodoro).onChange(async n=>{this.plugin.settings.enablePomodoro=n,await this.plugin.saveSettings()})),this.plugin.settings.enablePomodoro&&(new b.Setting(t).setName("\uC791\uC5C5 \uC2DC\uAC04").setDesc("\uD3EC\uBAA8\uB3C4\uB85C \uC791\uC5C5 \uC2DC\uAC04 (\uBD84)").addText(e=>e.setPlaceholder("25").setValue(String(this.plugin.settings.pomodoroWork)).onChange(async n=>{let r=parseInt(n)||25;this.plugin.settings.pomodoroWork=Math.max(1,Math.min(60,r)),await this.plugin.saveSettings()})),new b.Setting(t).setName("\uD734\uC2DD \uC2DC\uAC04").setDesc("\uD3EC\uBAA8\uB3C4\uB85C \uD734\uC2DD \uC2DC\uAC04 (\uBD84)").addText(e=>e.setPlaceholder("5").setValue(String(this.plugin.settings.pomodoroBreak)).onChange(async n=>{let r=parseInt(n)||5;this.plugin.settings.pomodoroBreak=Math.max(1,Math.min(30,r)),await this.plugin.saveSettings()}))),this.renderSubjectManager(t)}renderSubjectManager(t){let e=t.createDiv({cls:"subject-manager"});new b.Setting(e).setName("\uACFC\uBAA9 \uAD00\uB9AC").setDesc("\uC790\uC8FC \uC0AC\uC6A9\uD558\uB294 \uACFC\uBAA9\uC744 \uAD00\uB9AC\uD569\uB2C8\uB2E4").addButton(r=>r.setButtonText("+ \uACFC\uBAA9 \uCD94\uAC00").onClick(async()=>{this.plugin.settings.subjects.push({name:"\uC0C8 \uACFC\uBAA9",icon:"\u{1F4DA}",color:"#808080"}),await this.plugin.saveSettings(),this.display()}));let n=e.createDiv({cls:"subject-list"});for(let r=0;r<this.plugin.settings.subjects.length;r++){let a=this.plugin.settings.subjects[r];if(!a)continue;let s=n.createDiv({cls:"subject-row"}),o=s.createEl("input",{type:"text",value:a.icon,cls:"subject-icon-input"});o.maxLength=2,o.addEventListener("change",async()=>{a.icon=o.value||"\u{1F4DA}",await this.plugin.saveSettings()});let c=s.createEl("input",{type:"text",value:a.name,cls:"subject-name-input"});c.addEventListener("change",async()=>{a.name=c.value||"\uACFC\uBAA9",await this.plugin.saveSettings()});let d=s.createEl("input",{type:"color",value:a.color,cls:"subject-color-input"});d.addEventListener("change",async()=>{a.color=d.value,await this.plugin.saveSettings()}),s.createEl("button",{text:"\u{1F5D1}",cls:"subject-delete-btn"}).addEventListener("click",async()=>{this.plugin.settings.subjects.splice(r,1),await this.plugin.saveSettings(),this.display()})}}renderWorkoutSettings(t){t.createEl("h3",{text:"\uC6B4\uB3D9 \uAE30\uB85D \uC124\uC815"}),new b.Setting(t).setName("\uAE30\uBCF8 \uD734\uC2DD \uC2DC\uAC04").setDesc("\uC6B4\uB3D9 \uC138\uD2B8 \uC0AC\uC774 \uAE30\uBCF8 \uD734\uC2DD \uC2DC\uAC04 (\uCD08)").addText(e=>e.setPlaceholder("60").setValue(String(this.plugin.settings.defaultRestDuration)).onChange(async n=>{let r=parseInt(n)||60;this.plugin.settings.defaultRestDuration=Math.max(10,Math.min(300,r)),await this.plugin.saveSettings()})),this.renderWorkoutTemplateManager(t)}renderWorkoutTemplateManager(t){let e=t.createDiv({cls:"template-manager"});new b.Setting(e).setName("\uC6B4\uB3D9 \uD15C\uD50C\uB9BF \uAD00\uB9AC").setDesc("\uBE60\uB978 \uD15C\uD50C\uB9BF\uC5D0 \uD45C\uC2DC\uB418\uB294 \uC6B4\uB3D9 \uC138\uD2B8\uB97C \uAD00\uB9AC\uD569\uB2C8\uB2E4").addButton(r=>r.setButtonText("+ \uD15C\uD50C\uB9BF \uCD94\uAC00").onClick(async()=>{this.plugin.settings.workoutTemplates.push({name:"\uC0C8 \uD15C\uD50C\uB9BF",exercises:[{name:"\uC6B4\uB3D9\uBA85",params:"\uD69F\uC218: [10]"}]}),await this.plugin.saveSettings(),this.display()}));let n=e.createDiv({cls:"template-list"});this.plugin.settings.workoutTemplates||(this.plugin.settings.workoutTemplates=[...Y]);for(let r=0;r<this.plugin.settings.workoutTemplates.length;r++){let a=this.plugin.settings.workoutTemplates[r];if(!a)continue;let s=n.createDiv({cls:"template-item"}),o=s.createDiv({cls:"template-header-row"}),c=o.createEl("input",{type:"text",value:a.name,cls:"template-name-input"});c.addEventListener("change",async()=>{a.name=c.value||"\uD15C\uD50C\uB9BF",await this.plugin.saveSettings()}),o.createEl("button",{text:"\uC0AD\uC81C",cls:"template-delete-btn"}).addEventListener("click",async()=>{this.plugin.settings.workoutTemplates.splice(r,1),await this.plugin.saveSettings(),this.display()});let l=s.createDiv({cls:"template-exercise-list"});for(let p=0;p<a.exercises.length;p++){let m=a.exercises[p];if(!m)continue;let h=l.createDiv({cls:"template-exercise-row"}),g=h.createEl("input",{type:"text",value:m.name,placeholder:"\uC6B4\uB3D9\uBA85",cls:"template-exercise-name"});g.addEventListener("change",async()=>{m.name=g.value||"\uC6B4\uB3D9",await this.plugin.saveSettings()});let k=h.createEl("input",{type:"text",value:m.params,placeholder:"\uBB34\uAC8C: [60]kg | \uD69F\uC218: [10]",cls:"template-exercise-params"});k.addEventListener("change",async()=>{m.params=k.value||"",await this.plugin.saveSettings()}),h.createEl("button",{text:"\xD7",cls:"template-exercise-delete"}).addEventListener("click",async()=>{a.exercises.splice(p,1),await this.plugin.saveSettings(),this.display()})}s.createEl("button",{text:"+ \uC6B4\uB3D9 \uCD94\uAC00",cls:"template-add-exercise"}).addEventListener("click",async()=>{a.exercises.push({name:"\uC6B4\uB3D9\uBA85",params:"\uD69F\uC218: [10]"}),await this.plugin.saveSettings(),this.display()})}}renderTimerStyleSettings(t){t.createEl("h3",{text:"\uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C"});let e=[{value:"digital",label:"\uB514\uC9C0\uD138 (00:00:00)"},{value:"pomodoro",label:"\uBF40\uBAA8\uB3C4\uB85C (25/5 \uC0AC\uC774\uD074)"},{value:"analog",label:"\uC544\uB0A0\uB85C\uADF8 (\uC6D0\uD615 \uC2DC\uACC4)"}];new b.Setting(t).setName("\uACF5\uD1B5 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").setDesc("\uBAA8\uB4E0 \uAE30\uB85D \uC720\uD615\uC5D0 \uC801\uC6A9\uB418\uB294 \uAE30\uBCF8 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(n=>{for(let r of e)n.addOption(r.value,r.label);n.setValue(this.plugin.settings.timerStyle).onChange(async r=>{this.plugin.settings.timerStyle=r,await this.plugin.saveSettings()})}),new b.Setting(t).setName("\uC720\uD615\uBCC4 \uAC1C\uBCC4 \uC124\uC815").setDesc("\uD559\uC2B5/\uC5C5\uBB34/\uC6B4\uB3D9 \uAE30\uB85D\uB9C8\uB2E4 \uB2E4\uB978 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C \uC0AC\uC6A9").addToggle(n=>n.setValue(this.plugin.settings.usePerTypeTimerStyle).onChange(async r=>{this.plugin.settings.usePerTypeTimerStyle=r,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.usePerTypeTimerStyle&&(new b.Setting(t).setName("\uD559\uC2B5 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uD559\uC2B5 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(n=>{for(let r of e)n.addOption(r.value,r.label);n.setValue(this.plugin.settings.studyTimerStyle).onChange(async r=>{this.plugin.settings.studyTimerStyle=r,await this.plugin.saveSettings()})}),new b.Setting(t).setName("\uC5C5\uBB34 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uC5C5\uBB34 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(n=>{for(let r of e)n.addOption(r.value,r.label);n.setValue(this.plugin.settings.workTimerStyle).onChange(async r=>{this.plugin.settings.workTimerStyle=r,await this.plugin.saveSettings()})}),new b.Setting(t).setName("\uC6B4\uB3D9 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uC6B4\uB3D9 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(n=>{for(let r of e)n.addOption(r.value,r.label);n.setValue(this.plugin.settings.workoutTimerStyle).onChange(async r=>{this.plugin.settings.workoutTimerStyle=r,await this.plugin.saveSettings()})}))}renderUISettings(t){t.createEl("h3",{text:"UI \uC124\uC815"}),new b.Setting(t).setName("\uAE30\uBCF8 \uD0ED").setDesc("\uC0C8 \uAE30\uB85D \uBAA8\uB2EC\uC744 \uC5F4 \uB54C \uAE30\uBCF8\uC73C\uB85C \uC120\uD0DD\uB418\uB294 \uD0ED").addDropdown(e=>e.addOption("study","\uD559\uC2B5 \uAE30\uB85D").addOption("workout","\uC6B4\uB3D9 \uAE30\uB85D").setValue(this.plugin.settings.defaultTab).onChange(async n=>{this.plugin.settings.defaultTab=n,await this.plugin.saveSettings()})),new b.Setting(t).setName("\uB9AC\uBCF8 \uC544\uC774\uCF58").setDesc("\uC67C\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uBE60\uB978 \uC811\uADFC \uC544\uC774\uCF58 \uD45C\uC2DC").addToggle(e=>e.setValue(this.plugin.settings.showRibbonIcon).onChange(async n=>{this.plugin.settings.showRibbonIcon=n,await this.plugin.saveSettings(),this.plugin.updateRibbonIcon()}))}renderNotificationSettings(t){t.createEl("h3",{text:"\u{1F514} \uC54C\uB9BC \uC124\uC815"}),new b.Setting(t).setName("\uD0C0\uC774\uBA38 \uC644\uB8CC\uC74C").setDesc("\uCE74\uC6B4\uD2B8\uB2E4\uC6B4 \uC644\uB8CC \uC2DC \uC54C\uB9BC\uC74C \uC7AC\uC0DD").addToggle(e=>e.setValue(this.plugin.settings.enableTimerSound).onChange(async n=>{this.plugin.settings.enableTimerSound=n,await this.plugin.saveSettings()})),new b.Setting(t).setName("\uC2DC\uC2A4\uD15C \uC54C\uB9BC").setDesc("\uD0C0\uC774\uBA38 \uC644\uB8CC \uC2DC \uC2DC\uC2A4\uD15C \uC54C\uB9BC \uD45C\uC2DC").addToggle(e=>e.setValue(this.plugin.settings.enableNotifications).onChange(async n=>{this.plugin.settings.enableNotifications=n,await this.plugin.saveSettings()}))}};var Gt=require("obsidian");var z=class{constructor(t,e){this.selectedSubject=null;this.taskInputs=[];this.container=t,this.ctx=e}render(){this.container.empty(),this.container.addClass("study-log-tab"),this.renderSubjectSelector(),this.renderTaskInput(),this.renderCreateButton()}renderSubjectSelector(){var r;let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uACFC\uBAA9 \uC120\uD0DD",cls:"tab-label"});let e=t.createDiv({cls:"subject-grid"});for(let a of this.ctx.settings.subjects){let s=e.createEl("button",{cls:`subject-btn ${((r=this.selectedSubject)==null?void 0:r.name)===a.name?"selected":""}`});s.style.setProperty("--subject-color",a.color),s.createSpan({text:a.name,cls:"subject-name"}),s.addEventListener("click",()=>{this.selectedSubject=a,e.querySelectorAll(".subject-btn").forEach(o=>{o.classList.remove("selected")}),s.classList.add("selected")})}let n=e.createEl("button",{cls:"subject-btn subject-btn-add"});n.createSpan({text:"+"}),n.createSpan({text:"\uC9C1\uC811 \uC785\uB825"}),n.addEventListener("click",()=>{this.showCustomSubjectInput(t)})}showCustomSubjectInput(t){if(t.querySelector(".custom-subject-input"))return;let n=t.createDiv({cls:"custom-subject-input"}),r=n.createEl("input",{type:"text",placeholder:"\uACFC\uBAA9\uBA85 \uC785\uB825..."});r.focus(),r.addEventListener("keydown",a=>{a.key==="Enter"&&r.value.trim()?(this.selectedSubject={name:r.value.trim(),icon:"",color:"#808080"},n.remove(),this.render()):a.key==="Escape"&&n.remove()})}renderTaskInput(){let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uD559\uC2B5 \uD56D\uBAA9",cls:"tab-label"});let e=t.createDiv({cls:"task-input-list"});this.addTaskInputRow(e),t.createEl("button",{cls:"add-task-btn",text:"+ \uD56D\uBAA9 \uCD94\uAC00"}).addEventListener("click",()=>{this.addTaskInputRow(e)})}addTaskInputRow(t){let e=t.createDiv({cls:"task-input-row"}),n=e.createEl("input",{type:"text",placeholder:"\uD559\uC2B5 \uD56D\uBAA9 (\uC608: Chapter 3 \uBCF5\uC2B5)",cls:"task-name-input"});this.taskInputs.push(n);let r=e.createEl("input",{type:"text",placeholder:"\uBAA9\uD45C \uC2DC\uAC04 (\uC608: 30m)",cls:"task-duration-input"});r.value=`${this.ctx.settings.defaultStudyDuration}m`,e.createEl("button",{cls:"task-remove-btn",text:"\xD7"}).addEventListener("click",()=>{let s=this.taskInputs.indexOf(n);s>-1&&this.taskInputs.splice(s,1),e.remove()}),n.focus()}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uD559\uC2B5 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createStudyLog())}async createStudyLog(){if(!this.selectedSubject)return;let t=this.collectTasks();if(t.length===0)return;let e=this.buildCodeBlockContent(t),n=await this.ctx.fileCreator.createLogFile("study",e);this.ctx.onCreated(n)}collectTasks(){let t=[];return this.container.querySelectorAll(".task-input-row").forEach(n=>{let r=n.querySelector(".task-name-input"),a=n.querySelector(".task-duration-input");r!=null&&r.value.trim()&&t.push({name:r.value.trim(),duration:(a==null?void 0:a.value.trim())||`${this.ctx.settings.defaultStudyDuration}m`})}),t}buildCodeBlockContent(t){var s;let e=[],r=new Date().getHours(),a=r<12?"\uC624\uC804":r<18?"\uC624\uD6C4":"\uC800\uB141";e.push(`title: ${a} \uD559\uC2B5`),e.push(`subject: ${((s=this.selectedSubject)==null?void 0:s.name)||"\uAE30\uD0C0"}`),e.push("state: planned"),e.push("---");for(let o of t)e.push(`- [ ] ${o.name} | Duration: [${o.duration}]`);return e.join(`
`)}};var Oe={high:"#E74C3C",medium:"#F39C12",low:"#3498DB"},_=class{constructor(t,e){this.container=t,this.ctx=e}render(){this.container.empty(),this.container.addClass("work-log-tab"),this.renderTitleInput(),this.renderTaskInput(),this.renderCreateButton()}renderTitleInput(){let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uC5C5\uBB34 \uC81C\uBAA9",cls:"tab-label"});let e=t.createEl("input",{type:"text",placeholder:"\uC608: \uC624\uC804 \uC5C5\uBB34, \uD504\uB85C\uC81D\uD2B8 A",cls:"work-title-input"}),r=new Date().getHours(),a=r<12?"\uC624\uC804":r<18?"\uC624\uD6C4":"\uC800\uB141";e.value=`${a} \uC5C5\uBB34`}renderTaskInput(){let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uC5C5\uBB34 \uD56D\uBAA9",cls:"tab-label"});let e=t.createDiv({cls:"work-task-input-list"});this.addTaskInputRow(e),t.createEl("button",{cls:"add-task-btn",text:"+ \uC5C5\uBB34 \uCD94\uAC00"}).addEventListener("click",()=>{this.addTaskInputRow(e)})}addTaskInputRow(t){let e=t.createDiv({cls:"work-task-input-row"}),n=e.createEl("input",{type:"text",placeholder:"\uC5C5\uBB34 \uB0B4\uC6A9 (\uC608: \uAE30\uD68D\uC11C \uC791\uC131)",cls:"work-task-name-input"}),r=e.createEl("select",{cls:"work-task-priority-select"}),a=[{value:"high",label:"\uB192\uC74C"},{value:"medium",label:"\uBCF4\uD1B5"},{value:"low",label:"\uB0AE\uC74C"}];for(let c of a){let d=r.createEl("option",{value:c.value,text:c.label});c.value==="medium"&&(d.selected=!0)}r.addEventListener("change",()=>{let c=Oe[r.value];r.style.borderColor=c});let s=e.createEl("input",{type:"text",placeholder:"\uC608\uC0C1 \uC2DC\uAC04 (\uC608: 2h)",cls:"work-task-duration-input"});s.value="1h",e.createEl("button",{cls:"work-task-remove-btn",text:"\xD7"}).addEventListener("click",()=>{e.remove()}),n.focus()}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uC5C5\uBB34 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createWorkLog())}async createWorkLog(){let t=this.collectTasks();if(t.length===0)return;let e=this.container.querySelector(".work-title-input"),n=(e==null?void 0:e.value.trim())||"\uC5C5\uBB34",r=this.buildCodeBlockContent(n,t),a=await this.ctx.fileCreator.createLogFile("work",r);this.ctx.onCreated(a)}collectTasks(){let t=[];return this.container.querySelectorAll(".work-task-input-row").forEach(n=>{let r=n.querySelector(".work-task-name-input"),a=n.querySelector(".work-task-priority-select"),s=n.querySelector(".work-task-duration-input");r!=null&&r.value.trim()&&t.push({name:r.value.trim(),priority:(a==null?void 0:a.value)||"medium",expectedDuration:(s==null?void 0:s.value.trim())||"1h"})}),t}buildCodeBlockContent(t,e){let n=[];n.push(`title: ${t}`),n.push("state: planned"),n.push("---");for(let r of e)n.push(`- [ ] ${r.name} | Priority: ${r.priority} | Expected: [${r.expectedDuration}]`);return n.join(`
`)}};var q=class{constructor(t,e){this.exerciseInputs=[];this.container=t,this.ctx=e}render(){this.container.empty(),this.container.addClass("workout-log-tab"),this.renderTitleInput(),this.renderExerciseInput(),this.renderQuickTemplates(),this.renderCreateButton()}renderTitleInput(){let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uC6B4\uB3D9 \uC774\uB984",cls:"tab-label"});let e=t.createEl("input",{type:"text",placeholder:"\uC608: \uC544\uCE68 \uC6B4\uB3D9, \uC0C1\uCCB4 \uC6B4\uB3D9",cls:"workout-title-input"}),r=new Date().getHours(),a=r<12?"\uC544\uCE68":r<18?"\uC624\uD6C4":"\uC800\uB141";e.value=`${a} \uC6B4\uB3D9`}renderExerciseInput(){let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uC6B4\uB3D9 \uD56D\uBAA9",cls:"tab-label"});let e=t.createDiv({cls:"exercise-input-list"});this.addExerciseInputRow(e),t.createEl("button",{cls:"add-exercise-btn",text:"+ \uC6B4\uB3D9 \uCD94\uAC00"}).addEventListener("click",()=>{this.addExerciseInputRow(e)})}addExerciseInputRow(t){let e=t.createDiv({cls:"exercise-input-row"}),n=e.createEl("input",{type:"text",placeholder:"\uC6B4\uB3D9\uBA85 (\uC608: \uC2A4\uCFFC\uD2B8)",cls:"exercise-name-input"}),r=e.createEl("input",{type:"text",placeholder:"\uBB34\uAC8C: [60]kg | \uD69F\uC218: [10]",cls:"exercise-params-input"});e.createEl("button",{cls:"exercise-remove-btn",text:"\xD7"}).addEventListener("click",()=>{e.remove()}),n.focus()}renderQuickTemplates(){var a;let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uBE60\uB978 \uD15C\uD50C\uB9BF",cls:"tab-label"});let e=t.createDiv({cls:"template-grid"}),n=[{name:"\uC0C1\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uD478\uC2DC\uC5C5",params:"\uD69F\uC218: [15]"},{name:"\uB364\uBCA8 \uB85C\uC6B0",params:"\uBB34\uAC8C: [10]kg | \uD69F\uC218: [12]"},{name:"\uC204\uB354 \uD504\uB808\uC2A4",params:"\uBB34\uAC8C: [8]kg | \uD69F\uC218: [10]"}]},{name:"\uD558\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uC2A4\uCFFC\uD2B8",params:"\uBB34\uAC8C: [40]kg | \uD69F\uC218: [12]"},{name:"\uB7F0\uC9C0",params:"\uD69F\uC218: [10] /\uB2E4\uB9AC"},{name:"\uCE74\uD504\uB808\uC774\uC988",params:"\uD69F\uC218: [20]"}]},{name:"HIIT",exercises:[{name:"\uBC84\uD53C",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uC810\uD551\uC7AD",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uB9C8\uC6B4\uD2F4 \uD074\uB77C\uC774\uBA38",params:"\uC2DC\uAC04: [30\uCD08]"}]}],r=((a=this.ctx.settings.workoutTemplates)==null?void 0:a.length)>0?this.ctx.settings.workoutTemplates:n;for(let s of r){let o=e.createEl("button",{cls:"template-btn"});o.createSpan({text:s.name}),o.addEventListener("click",()=>{this.applyTemplate(s)})}}applyTemplate(t){let e=this.container.querySelector(".workout-title-input");e&&(e.value=t.name);let n=this.container.querySelector(".exercise-input-list");if(n){n.empty();for(let r of t.exercises)this.addExerciseInputRowWithData(n,r)}}addExerciseInputRowWithData(t,e){let n=t.createDiv({cls:"exercise-input-row"}),r=n.createEl("input",{type:"text",placeholder:"\uC6B4\uB3D9\uBA85",cls:"exercise-name-input"});r.value=e.name;let a=n.createEl("input",{type:"text",placeholder:"\uD30C\uB77C\uBBF8\uD130",cls:"exercise-params-input"});a.value=e.params,n.createEl("button",{cls:"exercise-remove-btn",text:"\xD7"}).addEventListener("click",()=>{n.remove()})}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uC6B4\uB3D9 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createWorkoutLog())}async createWorkoutLog(){let t=this.collectExercises();if(t.length===0)return;let e=this.container.querySelector(".workout-title-input"),n=(e==null?void 0:e.value.trim())||"\uC6B4\uB3D9",r=this.buildCodeBlockContent(n,t),a=await this.ctx.fileCreator.createLogFile("workout",r);this.ctx.onCreated(a)}collectExercises(){let t=[];return this.container.querySelectorAll(".exercise-input-row").forEach(n=>{let r=n.querySelector(".exercise-name-input"),a=n.querySelector(".exercise-params-input");r!=null&&r.value.trim()&&t.push({name:r.value.trim(),params:(a==null?void 0:a.value.trim())||""})}),t}buildCodeBlockContent(t,e){let n=[];n.push(`title: ${t}`),n.push("state: planned"),n.push("startDate:"),n.push("duration:"),n.push(`restDuration: ${this.ctx.settings.defaultRestDuration}s`),n.push("---");for(let r of e)r.params?n.push(`- [ ] ${r.name} | ${r.params}`):n.push(`- [ ] ${r.name}`);return n.join(`
`)}};var D=class extends Gt.Modal{constructor(e,n,r){super(e);this.tabContentEl=null;this.settings=n,this.fileCreator=r,this.activeTab=n.defaultTab}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("quick-log-modal"),this.renderHeader(e),this.renderTabs(e),this.renderTabContent(e)}renderHeader(e){e.createDiv({cls:"modal-header"}).createEl("h2",{text:"Life Log"})}renderTabs(e){let n=e.createDiv({cls:"modal-tabs"});n.createEl("button",{cls:`modal-tab ${this.activeTab==="study"?"active":""}`,text:"\uD559\uC2B5 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="study",this.updateActiveTab(n),this.renderTabContent(e)}),n.createEl("button",{cls:`modal-tab ${this.activeTab==="work"?"active":""}`,text:"\uC5C5\uBB34 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="work",this.updateActiveTab(n),this.renderTabContent(e)}),n.createEl("button",{cls:`modal-tab ${this.activeTab==="workout"?"active":""}`,text:"\uC6B4\uB3D9 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="workout",this.updateActiveTab(n),this.renderTabContent(e)})}updateActiveTab(e){let n=["study","work","workout"];e.querySelectorAll(".modal-tab").forEach((r,a)=>{n[a]===this.activeTab?r.classList.add("active"):r.classList.remove("active")})}renderTabContent(e){this.tabContentEl&&this.tabContentEl.remove(),this.tabContentEl=e.createDiv({cls:"modal-tab-content"});let n=r=>{this.close(),this.app.workspace.getLeaf().openFile(r)};this.activeTab==="study"?new z(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:n}).render():this.activeTab==="work"?new _(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:n}).render():new q(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:n}).render()}onClose(){let{contentEl:e}=this;e.empty()}};var Kt=require("obsidian"),V=class extends Kt.Modal{constructor(e,n){super(e);this.focusScore=4;this.comprehensionScore=4;this.notes="";this.onSubmit=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("self-eval-modal"),e.createEl("h2",{text:"\u{1F389} \uD559\uC2B5 \uC644\uB8CC! \uC790\uAC00\uD3C9\uAC00\uB97C \uD574\uC8FC\uC138\uC694"}),this.renderFocusScore(e),this.renderComprehensionScore(e),this.renderNotesInput(e),this.renderButtons(e)}renderFocusScore(e){let n=e.createDiv({cls:"eval-section"});n.createEl("label",{text:"\uC9D1\uC911\uB3C4",cls:"eval-label"});let r=n.createDiv({cls:"eval-stars"});this.renderStarPicker(r,this.focusScore,a=>{this.focusScore=a})}renderComprehensionScore(e){let n=e.createDiv({cls:"eval-section"});n.createEl("label",{text:"\uC774\uD574\uB3C4",cls:"eval-label"});let r=n.createDiv({cls:"eval-stars"});this.renderStarPicker(r,this.comprehensionScore,a=>{this.comprehensionScore=a})}renderStarPicker(e,n,r){for(let a=1;a<=5;a++){let s=e.createSpan({cls:`eval-star ${a<=n?"filled":""}`,text:a<=n?"\u2605":"\u2606"});s.addEventListener("click",()=>{r(a),e.querySelectorAll(".eval-star").forEach((o,c)=>{let d=o;c<a?(d.textContent="\u2605",d.classList.add("filled")):(d.textContent="\u2606",d.classList.remove("filled"))})}),s.addEventListener("mouseenter",()=>{e.querySelectorAll(".eval-star").forEach((o,c)=>{let d=o;c<a&&d.classList.add("hover")})}),s.addEventListener("mouseleave",()=>{e.querySelectorAll(".eval-star").forEach(o=>{o.classList.remove("hover")})})}}renderNotesInput(e){let n=e.createDiv({cls:"eval-section"});n.createEl("label",{text:"\uBA54\uBAA8 (\uC120\uD0DD)",cls:"eval-label"});let r=n.createEl("textarea",{cls:"eval-notes-input",placeholder:"\uC624\uB298 \uD559\uC2B5\uC5D0 \uB300\uD55C \uC9E7\uC740 \uBA54\uBAA8..."});r.rows=3,r.addEventListener("input",()=>{this.notes=r.value})}renderButtons(e){let n=e.createDiv({cls:"eval-buttons"});n.createEl("button",{cls:"eval-btn eval-btn-secondary",text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{cls:"eval-btn eval-btn-primary",text:"\uC800\uC7A5\uD558\uACE0 \uC885\uB8CC"}).addEventListener("click",()=>{this.onSubmit({focusScore:this.focusScore,comprehensionScore:this.comprehensionScore,notes:this.notes||void 0}),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var Ye='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/><circle cx="12" cy="12" r="3"/></svg>',U=class extends G.Plugin{constructor(){super(...arguments);this.timerManager=new A;this.fileUpdater=null;this.fileCreator=null;this.ribbonIconEl=null;this.settings=Et}async onload(){await this.loadSettings(),this.fileUpdater=new B(this.app),this.fileCreator=new $(this.app,this.settings),(0,G.addIcon)("life-log",Ye),this.registerMarkdownCodeBlockProcessor("life-log",(e,n,r)=>{this.processWorkoutBlock(e,n,r)}),this.registerMarkdownCodeBlockProcessor("study-log",(e,n,r)=>{this.processStudyBlock(e,n,r)}),this.registerMarkdownCodeBlockProcessor("work-log",(e,n,r)=>{this.processWorkBlock(e,n,r)}),this.addCommand({id:"open-quick-log",name:"\uC0C8 \uAE30\uB85D",hotkeys:[{modifiers:["Mod","Shift"],key:"l"}],callback:()=>{this.fileCreator&&new D(this.app,this.settings,this.fileCreator).open()}}),this.addCommand({id:"open-study-log",name:"\uC0C8 \uD559\uC2B5 \uAE30\uB85D",callback:()=>{this.fileCreator&&new D(this.app,{...this.settings,defaultTab:"study"},this.fileCreator).open()}}),this.addCommand({id:"open-work-log",name:"\uC0C8 \uC5C5\uBB34 \uAE30\uB85D",callback:()=>{this.fileCreator&&new D(this.app,{...this.settings,defaultTab:"work"},this.fileCreator).open()}}),this.addCommand({id:"open-workout-log",name:"\uC0C8 \uC6B4\uB3D9 \uAE30\uB85D",callback:()=>{this.fileCreator&&new D(this.app,{...this.settings,defaultTab:"workout"},this.fileCreator).open()}}),console.log("[Life Log] Registering settings tab..."),this.addSettingTab(new O(this.app,this)),console.log("[Life Log] Settings tab registered"),this.updateRibbonIcon()}onunload(){this.timerManager.destroy()}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},Et,e),(!this.settings.subjects||this.settings.subjects.length===0)&&(this.settings.subjects=[...yt]),(!this.settings.workoutTemplates||this.settings.workoutTemplates.length===0)&&(this.settings.workoutTemplates=[...Y])}async saveSettings(){await this.saveData(this.settings),this.fileCreator&&(this.fileCreator=new $(this.app,this.settings))}updateRibbonIcon(){this.ribbonIconEl&&(this.ribbonIconEl.remove(),this.ribbonIconEl=null),this.settings.showRibbonIcon&&(this.ribbonIconEl=this.addRibbonIcon("life-log","Life Log: \uC0C8 \uAE30\uB85D",()=>{this.fileCreator&&new D(this.app,this.settings,this.fileCreator).open()}))}processWorkoutBlock(e,n,r){var l;let a=Dt(e),s=r.getSectionInfo(n),o=`${r.sourcePath}:${(l=s==null?void 0:s.lineStart)!=null?l:0}`,c=this.timerManager.isTimerRunning(o);if(c&&a.metadata.state!=="started")this.timerManager.stopWorkoutTimer(o);else if(c&&a.metadata.state==="started"){let u=a.exercises.findIndex(m=>m.state==="inProgress"),p=this.timerManager.getActiveExerciseIndex(o);u>=0&&u!==p&&this.timerManager.setActiveExerciseIndex(o,u)}let d=this.createWorkoutCallbacks(r,s,a,o);At({el:n,parsed:a,callbacks:d,workoutId:o,timerManager:this.timerManager})}processStudyBlock(e,n,r){var l;let a=Rt(e),s=r.getSectionInfo(n),o=`study:${r.sourcePath}:${(l=s==null?void 0:s.lineStart)!=null?l:0}`,c=this.timerManager.isTimerRunning(o);if(c&&a.metadata.state!=="started")this.timerManager.stopWorkoutTimer(o);else if(c&&a.metadata.state==="started"){let u=a.tasks.findIndex(m=>m.state==="inProgress"),p=this.timerManager.getActiveExerciseIndex(o);u>=0&&u!==p&&this.timerManager.setActiveExerciseIndex(o,u)}let d=this.createStudyCallbacks(r,s,a,o);zt({el:n,parsed:a,callbacks:d,studyId:o,timerManager:this.timerManager,enableTimerSound:this.settings.enableTimerSound,enableNotification:this.settings.enableNotifications})}processWorkBlock(e,n,r){var l;let a=qt(e),s=r.getSectionInfo(n),o=`work:${r.sourcePath}:${(l=s==null?void 0:s.lineStart)!=null?l:0}`,c=this.timerManager.isTimerRunning(o);if(c&&a.metadata.state!=="started")this.timerManager.stopWorkoutTimer(o);else if(c&&a.metadata.state==="started"){let u=a.tasks.findIndex(m=>m.state==="inProgress"),p=this.timerManager.getActiveExerciseIndex(o);u>=0&&u!==p&&this.timerManager.setActiveExerciseIndex(o,u)}let d=this.createWorkCallbacks(r,s,a,o);Ut({el:n,parsed:a,callbacks:d,workId:o,timerManager:this.timerManager,enableTimerSound:this.settings.enableTimerSound,enableNotification:this.settings.enableNotifications})}createWorkCallbacks(e,n,r,a){let s=r,o=!1,c=async l=>{var m;s=l,o=!1;let u=Vt(l),p=s.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(e.sourcePath,n,u,p))};return{onStartWork:async()=>{o=!1,s.metadata.state="started",s.metadata.startDate=this.formatStartDate(new Date);let l=s.tasks.findIndex(u=>u.state==="pending");l>=0&&(s=P(s,l,"inProgress")),await c(s),this.timerManager.startWorkoutTimer(a,l>=0?l:0)},onFinishWork:async()=>{let l=this.timerManager.getTimerState(a);l&&(s.metadata.totalDuration=T(l.workoutElapsed)),s.metadata.endDate=this.formatStartDate(new Date),s.metadata.state="completed";for(let u=0;u<s.tasks.length;u++){let p=s.tasks[u];if(p&&p.state==="inProgress"){let m=this.timerManager.getTimerState(a);m&&(s=j(s,u,T(m.exerciseElapsed))),s=P(s,u,"completed")}}await c(s),this.timerManager.stopWorkoutTimer(a)},onTaskFinish:async l=>{if(o=!1,!s.tasks[l])return;let p=this.timerManager.getTimerState(a);p&&(s=j(s,l,T(p.exerciseElapsed))),s=P(s,l,"completed");let m=s.tasks.findIndex((h,g)=>g>l&&h.state==="pending");m>=0?(s=P(s,m,"inProgress"),this.timerManager.advanceExercise(a,m),await c(s)):await c(s)},onTaskSkip:async l=>{o=!1;let u=this.timerManager.getTimerState(a);u&&u.exerciseElapsed>0&&(s=j(s,l,T(u.exerciseElapsed))),s=P(s,l,"skipped");let p=s.tasks.findIndex((m,h)=>h>l&&m.state==="pending");p>=0?(s=P(s,p,"inProgress"),this.timerManager.advanceExercise(a,p),await c(s)):await c(s)},onPauseTask:()=>{this.timerManager.pauseExercise(a)},onResumeTask:()=>{this.timerManager.resumeExercise(a)},onFlushChanges:async()=>{o&&await c(s)}}}createWorkoutCallbacks(e,n,r,a){let s=r,o=!1,c=async l=>{var m;s=l,o=!1;let u=tt(l),p=s.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(e.sourcePath,n,u,p))};return{onStartWorkout:async()=>{o=!1,s.metadata.state="started",s.metadata.startDate=this.formatStartDate(new Date);let l=s.exercises.findIndex(u=>u.state==="pending");if(l>=0){let u=s.exercises[l];u&&(u.state="inProgress")}await c(s),this.timerManager.startWorkoutTimer(a,l>=0?l:0)},onFinishWorkout:async()=>{let l=this.timerManager.getTimerState(a);l&&(s.metadata.duration=T(l.workoutElapsed)),s.metadata.state="completed",s=I(s),await c(s),this.timerManager.stopWorkoutTimer(a)},onExerciseFinish:async l=>{if(o=!1,!s.exercises[l])return;let p=this.timerManager.getTimerState(a);p&&(s=W(s,l,T(p.exerciseElapsed))),s=L(s,l,"completed");let m=s.exercises.findIndex((h,g)=>g>l&&h.state==="pending");if(m>=0)s=L(s,m,"inProgress"),this.timerManager.advanceExercise(a,m),await c(s);else{s.metadata.state="completed";let h=this.timerManager.getTimerState(a);h&&(s.metadata.duration=T(h.workoutElapsed)),s=I(s),await c(s),this.timerManager.stopWorkoutTimer(a)}},onExerciseAddSet:async l=>{if(o=!1,!s.exercises[l])return;let p=this.timerManager.getTimerState(a);p&&(s=W(s,l,T(p.exerciseElapsed))),s=L(s,l,"completed"),s=Pt(s,l),s=L(s,l+1,"inProgress"),this.timerManager.advanceExercise(a,l+1),await c(s)},onExerciseAddRest:async l=>{o=!1;let u=s.exercises[l],p=s.metadata.restDuration;if(!u||!p)return;let m=this.timerManager.getTimerState(a);m&&(s=W(s,l,T(m.exerciseElapsed))),s=L(s,l,"completed"),s=Mt(s,l,p),s=L(s,l+1,"inProgress"),this.timerManager.advanceExercise(a,l+1),await c(s)},onExerciseSkip:async l=>{o=!1;let u=this.timerManager.getTimerState(a);u&&u.exerciseElapsed>0&&(s=W(s,l,T(u.exerciseElapsed))),s=L(s,l,"skipped");let p=s.exercises.findIndex((m,h)=>h>l&&m.state==="pending");if(p>=0)s=L(s,p,"inProgress"),this.timerManager.advanceExercise(a,p),await c(s);else{s.metadata.state="completed";let m=this.timerManager.getTimerState(a);m&&(s.metadata.duration=T(m.workoutElapsed)),s=I(s),this.timerManager.stopWorkoutTimer(a),await c(s)}},onParamChange:(l,u,p)=>{let m=s.exercises[l],h=m==null?void 0:m.params.find(g=>g.key===u);(h==null?void 0:h.value)!==p&&(s=Ct(s,l,u,p),o=!0)},onFlushChanges:async()=>{o&&await c(s)},onPauseExercise:()=>{this.timerManager.pauseExercise(a)},onResumeExercise:()=>{this.timerManager.resumeExercise(a)},onAddSample:async()=>{var p;let l=Wt(),u=tt(l);await((p=this.fileUpdater)==null?void 0:p.updateCodeBlock(e.sourcePath,n,u,l.metadata.title))}}}createStudyCallbacks(e,n,r,a){let s=r,o=!1,c=async l=>{var m;s=l,o=!1;let u=Ft(l),p=s.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(e.sourcePath,n,u,p))};return{onStartStudy:async()=>{o=!1,s.metadata.state="started",s.metadata.startDate=this.formatStartDate(new Date);let l=s.tasks.findIndex(u=>u.state==="pending");l>=0&&(s=M(s,l,"inProgress")),await c(s),this.timerManager.startWorkoutTimer(a,l>=0?l:0)},onFinishStudy:async()=>{let l=this.timerManager.getTimerState(a);l&&(s.metadata.totalDuration=T(l.workoutElapsed)),s.metadata.endDate=this.formatStartDate(new Date),s.metadata.state="completed",await c(s),this.timerManager.stopWorkoutTimer(a)},onTaskFinish:async l=>{if(o=!1,!s.tasks[l])return;let p=this.timerManager.getTimerState(a);p&&(s=R(s,l,T(p.exerciseElapsed))),s=M(s,l,"completed");let m=s.tasks.findIndex((h,g)=>g>l&&h.state==="pending");m>=0?(s=M(s,m,"inProgress"),this.timerManager.advanceExercise(a,m),await c(s)):await c(s)},onTaskSkip:async l=>{o=!1;let u=this.timerManager.getTimerState(a);u&&u.exerciseElapsed>0&&(s=R(s,l,T(u.exerciseElapsed))),s=M(s,l,"skipped");let p=s.tasks.findIndex((m,h)=>h>l&&m.state==="pending");p>=0?(s=M(s,p,"inProgress"),this.timerManager.advanceExercise(a,p),await c(s)):await c(s)},onPauseTask:()=>{this.timerManager.pauseExercise(a)},onResumeTask:()=>{this.timerManager.resumeExercise(a)},onFlushChanges:async()=>{o&&await c(s)},onOpenSelfEval:()=>{new V(this.app,async l=>{s=jt(s,l.focusScore,l.comprehensionScore);let u=this.timerManager.getTimerState(a);u&&(s.metadata.totalDuration=T(u.workoutElapsed)),s.metadata.endDate=this.formatStartDate(new Date),s.metadata.state="completed";for(let p=0;p<s.tasks.length;p++){let m=s.tasks[p];if(m&&m.state==="inProgress"){let h=this.timerManager.getTimerState(a);h&&(s=R(s,p,T(h.exerciseElapsed))),s=M(s,p,"completed")}}await c(s),this.timerManager.stopWorkoutTimer(a)}).open()}}}formatStartDate(e){let n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}-${r}-${a} ${s}:${o}`}};
