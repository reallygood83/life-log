/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Le=Object.defineProperty;var Yt=Object.getOwnPropertyDescriptor;var Ut=Object.getOwnPropertyNames;var Vt=Object.prototype.hasOwnProperty;var qt=(s,t)=>{for(var e in t)Le(s,e,{get:t[e],enumerable:!0})},Jt=(s,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Ut(t))!Vt.call(s,a)&&a!==e&&Le(s,a,{get:()=>t[a],enumerable:!(r=Yt(t,a))||r.enumerable});return s};var Qt=s=>Jt(Le({},"__esModule",{value:!0}),s);var Xr={};qt(Xr,{default:()=>Ce});module.exports=Qt(Xr);var De=require("obsidian");var Xt=/^-\s*\[(.)\]\s*(.+)$/,Zt={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},er={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function Pe(s,t){var p,m,g,h;let e=s.match(Xt);if(!e)return null;let r=(p=e[1])!=null?p:" ",a=(m=e[2])!=null?m:"",n=(g=Zt[r])!=null?g:"pending",o=a.split("|").map(y=>y.trim()),i=(h=o[0])!=null?h:"",l=o.slice(1),d=[],c,u;for(let y of l){let f=tr(y);f&&(d.push(f),f.key.toLowerCase()==="duration"&&(f.editable?c=$(f.value):u=f.value+(f.unit?` ${f.unit}`:"")))}return{state:n,name:i,params:d,targetDuration:c,recordedDuration:u,lineIndex:t}}function tr(s){var l,d,c;let t=s.indexOf(":");if(t===-1)return null;let e=s.substring(0,t).trim(),r=s.substring(t+1).trim(),a=r.match(/^\[([^\]]*)\](.*)$/);if(a){let u=(l=a[1])!=null?l:"",p=((d=a[2])!=null?d:"").trim();return{key:e,value:u,editable:!0,unit:p||void 0}}let n=r.split(/\s+/),o=(c=n[0])!=null?c:"",i=n.slice(1).join(" ")||void 0;return{key:e,value:o,editable:!1,unit:i}}function $(s){var o,i,l,d,c,u;let t=s.trim(),e=t.match(/^(\d+)s$/);if(e)return parseInt((o=e[1])!=null?o:"0",10);let r=t.match(/^(\d+):(\d{2})$/);if(r){let p=parseInt((i=r[1])!=null?i:"0",10),m=parseInt((l=r[2])!=null?l:"0",10);return p*60+m}let a=t.match(/^(\d+)m\s*(\d+)?s?$/);if(a){let p=parseInt((d=a[1])!=null?d:"0",10),m=parseInt((c=a[2])!=null?c:"0",10);return p*60+m}let n=t.match(/^(\d+)$/);return n?parseInt((u=n[1])!=null?u:"0",10):0}function w(s){let t=Math.floor(s/60),e=s%60;return`${t}:${e.toString().padStart(2,"0")}`}function b(s){let t=Math.floor(s/60),e=s%60;return t===0?`${e}s`:e===0?`${t}m`:`${t}m ${e}s`}function yt(s){return er[s]}function Ae(s){let e=`- [${yt(s.state)}] ${s.name}`;for(let r of s.params)e+=" | ",e+=`${r.key}: `,r.editable?e+=`[${r.value}]`:e+=r.value,r.unit&&(e+=` ${r.unit}`);return e}var rr=["planned","started","completed"];function Me(s){let t={state:"planned"};for(let e of s){let r=e.indexOf(":");if(r===-1)continue;let a=e.substring(0,r).trim().toLowerCase(),n=e.substring(r+1).trim();switch(a){case"title":n&&(t.title=n);break;case"state":rr.includes(n)&&(t.state=n);break;case"startdate":n&&(t.startDate=n);break;case"duration":n&&(t.duration=n);break;case"restduration":if(n){let o=$(n);o>0&&(t.restDuration=o)}break}}return t}function Ie(s){let t=[];return s.title!==void 0&&t.push(`title: ${s.title}`),t.push(`state: ${s.state}`),s.startDate!==void 0&&t.push(`startDate: ${s.startDate}`),s.duration!==void 0&&t.push(`duration: ${s.duration}`),s.restDuration!==void 0&&t.push(`restDuration: ${b(s.restDuration)}`),t}function ne(s){var l;let t=s.split(`
`),e=-1;for(let d=0;d<t.length;d++)if(((l=t[d])==null?void 0:l.trim())==="---"){e=d;break}let r=e>0?t.slice(0,e):[],a=Me(r),n=e>=0?e+1:0,o=t.slice(n),i=[];for(let d=0;d<o.length;d++){let c=o[d];if(!c)continue;let u=Pe(c,d);u&&i.push(u)}return{metadata:a,exercises:i,rawLines:t,metadataEndIndex:e>=0?e:-1}}function $e(s){let t=[],e=Ie(s.metadata);t.push(...e),t.push("---");for(let r of s.exercises)t.push(Ae(r));return t.join(`
`)}function kt(s,t,e,r){let a=structuredClone(s),n=a.exercises[t];if(!n)return s;let o=n.params.find(i=>i.key===e);return o&&(o.value=r),a}function R(s,t,e){let r=structuredClone(s),a=r.exercises[t];return a?(a.state=e,r):s}function oe(s){let t=structuredClone(s);for(let e of t.exercises)for(let r of e.params)r.editable=!1;return t}function vt(s,t,e){let r=structuredClone(s),a=r.exercises[t];if(!a)return s;let n={state:"pending",name:"Rest",params:[{key:"Duration",value:`${e}s`,editable:!0}],targetDuration:e,lineIndex:a.lineIndex+1};r.exercises.splice(t+1,0,n);for(let o=t+2;o<r.exercises.length;o++){let i=r.exercises[o];i&&i.lineIndex++}return r}function St(s,t){let e=structuredClone(s),r=e.exercises[t];if(!r)return s;let a={...structuredClone(r),state:"pending",recordedDuration:void 0,lineIndex:r.lineIndex+1};for(let n of a.params)n.key.toLowerCase()==="duration"&&!n.editable&&(n.editable=r.targetDuration!==void 0);e.exercises.splice(t+1,0,a);for(let n=t+2;n<e.exercises.length;n++){let o=e.exercises[n];o&&o.lineIndex++}return e}function q(s,t,e){let r=structuredClone(s),a=r.exercises[t];if(!a)return s;let n=a.params.find(o=>o.key.toLowerCase()==="duration");return n?(n.value=e,n.editable=!1):a.params.push({key:"Duration",value:e,editable:!1}),a.recordedDuration=e,r}function Tt(){return{metadata:{title:"Sample Workout",state:"planned",restDuration:60},exercises:[{state:"pending",name:"Squats",params:[{key:"Weight",value:"60",editable:!0,unit:"kg"},{key:"Reps",value:"12",editable:!0}],lineIndex:0},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:1},{state:"pending",name:"Push-ups",params:[{key:"Reps",value:"15",editable:!0}],lineIndex:2},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:3},{state:"pending",name:"Dumbbell Rows",params:[{key:"Weight",value:"20",editable:!0,unit:"kg"},{key:"Reps",value:"10",editable:!0,unit:"/arm"}],lineIndex:4},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:5},{state:"pending",name:"Plank Hold",params:[{key:"Duration",value:"45s",editable:!0}],targetDuration:45,lineIndex:6},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:7},{state:"pending",name:"Lunges",params:[{key:"Reps",value:"10",editable:!0,unit:"/leg"}],lineIndex:8}],rawLines:[],metadataEndIndex:-1}}function xt(s){let t=[];s.metadata.title&&t.push(`title: ${s.metadata.title}`),t.push("state: planned"),t.push("startDate:"),t.push("duration:"),t.push("---");let e=new Set,r=[];for(let a of s.exercises)e.has(a.name)||(e.add(a.name),r.push(a));for(let a of r){let n=`- [ ] ${a.name}`;for(let o of a.params)if(n+=" | ",n+=`${o.key}: `,!(o.key.toLowerCase()==="duration"&&!a.targetDuration)){if(o.key.toLowerCase()==="duration"&&a.targetDuration){let i=Math.floor(a.targetDuration/60),l=a.targetDuration%60,d=i>0?`${i}m ${l}s`:`${l}s`;n+=`[${d}]`}else n+=`[${o.value}]`;o.unit&&(n+=` ${o.unit}`)}t.push(n)}return t.join(`
`)}function W(s,t,e,r=!1){switch(s.empty(),s.removeClass("timer-digital","timer-analog","timer-pomodoro"),s.addClass(`timer-${e}`),e){case"analog":nr(s,t);break;case"pomodoro":ar(s,t,r);break;case"digital":default:bt(s,t,r);break}}function bt(s,t,e){let r=e?t.exerciseElapsed:t.workoutElapsed;s.createSpan({cls:"timer-value",text:w(r)}),s.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}function ar(s,t,e){var r,a;if(t.pomodoroEnabled&&t.pomodoroPhase){let n=t.pomodoroPhase==="work"?"\uC9D1\uC911":"\uD734\uC2DD",o=(r=t.pomodoroRemaining)!=null?r:0,i=(a=t.pomodoroProgress)!=null?a:0,l=s.createDiv({cls:"pomodoro-timer-wrapper"}),d=l.createDiv({cls:"pomodoro-text"});d.createSpan({cls:"pomodoro-phase",text:n}),d.createSpan({cls:"pomodoro-time",text:w(o)}),l.createDiv({cls:"pomodoro-progress-bar"}).createDiv({cls:"pomodoro-progress-fill",attr:{style:`width: ${i}%`}})}else bt(s,t,e)}function nr(s,t){let e=t.workoutElapsed,r=40,a=r/2,n=r/2-2,o=e%60*6,i=e/60%60*6+e%60*.1,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width",`${r}`),l.setAttribute("height",`${r}`),l.setAttribute("viewBox",`0 0 ${r} ${r}`),l.classList.add("analog-clock-svg");let d=document.createElementNS("http://www.w3.org/2000/svg","circle");d.setAttribute("cx",`${a}`),d.setAttribute("cy",`${a}`),d.setAttribute("r",`${n}`),d.setAttribute("fill","none"),d.setAttribute("stroke","currentColor"),d.setAttribute("stroke-width","2"),l.appendChild(d);let c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("x1",`${a}`),c.setAttribute("y1",`${a}`),c.setAttribute("x2",`${a}`),c.setAttribute("y2",`${a-n*.7}`),c.setAttribute("stroke","currentColor"),c.setAttribute("stroke-width","2"),c.setAttribute("transform",`rotate(${i} ${a} ${a})`),l.appendChild(c);let u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",`${a}`),u.setAttribute("y1",`${a}`),u.setAttribute("x2",`${a}`),u.setAttribute("y2",`${a-n*.85}`),u.setAttribute("stroke","var(--text-accent)"),u.setAttribute("stroke-width","1"),u.setAttribute("transform",`rotate(${o} ${a} ${a})`),l.appendChild(u);let p=document.createElementNS("http://www.w3.org/2000/svg","circle");p.setAttribute("cx",`${a}`),p.setAttribute("cy",`${a}`),p.setAttribute("r","2"),p.setAttribute("fill","currentColor"),l.appendChild(p),s.appendChild(l),s.setAttribute("title",`Total: ${w(e)}`)}function Re(s,t,e,r,a="digital"){let n=s.createDiv({cls:"workout-header"}),o=n.createDiv({cls:"workout-title"});if(o.textContent=t.title||"Workout",t.restDuration){let d=n.createDiv({cls:"workout-rest-duration"}),c=b(t.restDuration);d.setText(`Rest: ${c}`)}let l=n.createDiv({cls:"workout-header-timer"}).createSpan({cls:"workout-timer"});return t.state==="completed"&&t.duration?(l.textContent=t.duration,l.createSpan({cls:"workout-timer-indicator recorded",text:" \u2713"})):r&&e?W(l,e,a):(t.state,l.textContent="--:--"),{titleEl:o,timerEl:l}}function We(s,t,e="digital"){W(s,t,e)}var or={pending:"\u25CB",inProgress:"\u25D0",completed:"\u2713",skipped:"\u2014"};function sr(s){let t=5381;for(let a=0;a<s.length;a++)t=(t<<5)+t^s.charCodeAt(a);let e=.618033988749895,r=Math.abs(t)%1e3/1e3;return Math.floor(r*e%1*360)}function wt(s){return s.params.some(t=>t.key.toLowerCase()!=="duration")}function Be(s,t,e,r,a,n,o,i){let l=!wt(t),d=s.createDiv({cls:`workout-exercise state-${t.state}${r?" active":""}${l?" simple":""}`}),c=sr(t.name);d.style.setProperty("--exercise-color",`hsl(${c}, 65%, 55%)`);let u=new Map,p=d.createDiv({cls:"workout-exercise-main"}),m=p.createSpan({cls:"workout-exercise-icon"});m.textContent=or[t.state];let g=p.createSpan({cls:"workout-exercise-name"});if(g.textContent=t.name,wt(t)){let y=p.createSpan({cls:"workout-exercise-params"});for(let f of t.params){if(f.key.toLowerCase()==="duration")continue;let v=y.createSpan({cls:"workout-param"});if(f.unit||v.createSpan({cls:"workout-param-prefix",text:"\xD7"}),f.editable&&o!=="completed"){let S=v.createEl("input",{cls:"workout-param-input",type:"text",value:f.value});S.addEventListener("input",()=>{n.onParamChange(e,f.key,S.value)}),S.addEventListener("keydown",T=>{T.key==="Enter"&&S.blur()}),u.set(f.key,S)}else v.createSpan({cls:"workout-param-value",text:f.value});f.unit&&v.createSpan({cls:"workout-param-unit",text:` ${f.unit}`})}}let h=p.createSpan({cls:"workout-exercise-timer"});return t.state==="completed"&&t.recordedDuration?(h.textContent=t.recordedDuration,h.createSpan({cls:"timer-indicator recorded",text:" \u2713"})):r&&a?se(h,a,t.targetDuration):t.targetDuration?(h.textContent=w(t.targetDuration),h.createSpan({cls:"timer-indicator count-down",text:" \u25BC"})):t.state==="pending"&&(h.textContent="--"),r&&o==="started"&&ir(d,e,n,i),{container:d,timerEl:h,inputs:u}}function ir(s,t,e,r){let a=s.createDiv({cls:"workout-exercise-controls"}),n=a.createEl("button",{cls:"workout-btn",text:"Pause"});n.addEventListener("click",()=>{n.textContent==="Pause"?(e.onPauseExercise(),n.textContent="Resume"):(e.onResumeExercise(),n.textContent="Pause")}),a.createEl("button",{cls:"workout-btn",text:"Skip"}).addEventListener("click",()=>{e.onExerciseSkip(t)});let i=a.createDiv({cls:"workout-btn-group"});i.createEl("button",{cls:"workout-btn",text:"+ Set"}).addEventListener("click",()=>{e.onExerciseAddSet(t)}),r!==void 0&&i.createEl("button",{cls:"workout-btn",text:"+ Rest"}).addEventListener("click",()=>{e.onExerciseAddRest(t)}),i.createEl("button",{cls:"workout-btn",text:"Next"}).addEventListener("click",()=>{e.onExerciseFinish(t)})}function se(s,t,e){if(s.empty(),e!==void 0){let r=e-t.exerciseElapsed;r>0?(s.textContent=w(r),s.createSpan({cls:"timer-indicator count-down",text:" \u25BC"})):(s.textContent=w(Math.abs(r)),s.addClass("overtime"),s.createSpan({cls:"timer-indicator overtime",text:" \u26A0"}))}else s.textContent=w(t.exerciseElapsed),s.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}var M=null,Et=!1;function N(){if(!Et)try{M=new(window.AudioContext||window.webkitAudioContext),M.state==="suspended"&&M.resume(),Et=!0,console.log("[Life Log] AudioContext initialized")}catch(s){console.warn("[Life Log] Failed to initialize AudioContext:",s)}}function J(s="complete"){if(M||N(),!M){console.warn("[Life Log] AudioContext not available");return}M.state==="suspended"&&M.resume();try{switch(s){case"complete":lr(M);break;case"break":cr(M);break;case"warning":dr(M);break}}catch(t){console.warn("[Life Log] Failed to play sound:",t)}}function lr(s){let t=s.currentTime,e=s.createOscillator(),r=s.createGain();e.connect(r),r.connect(s.destination),e.frequency.value=523.25,e.type="sine",r.gain.setValueAtTime(.3,t),r.gain.exponentialRampToValueAtTime(.01,t+.3),e.start(t),e.stop(t+.3);let a=s.createOscillator(),n=s.createGain();a.connect(n),n.connect(s.destination),a.frequency.value=659.25,a.type="sine",n.gain.setValueAtTime(.3,t+.15),n.gain.exponentialRampToValueAtTime(.01,t+.45),a.start(t+.15),a.stop(t+.45);let o=s.createOscillator(),i=s.createGain();o.connect(i),i.connect(s.destination),o.frequency.value=783.99,o.type="sine",i.gain.setValueAtTime(.3,t+.3),i.gain.exponentialRampToValueAtTime(.01,t+.6),o.start(t+.3),o.stop(t+.6)}function cr(s){let t=s.currentTime,e=s.createOscillator(),r=s.createGain();e.connect(r),r.connect(s.destination),e.frequency.value=440,e.type="sine",r.gain.setValueAtTime(.2,t),r.gain.exponentialRampToValueAtTime(.01,t+.5),e.start(t),e.stop(t+.5);let a=s.createOscillator(),n=s.createGain();a.connect(n),n.connect(s.destination),a.frequency.value=349.23,a.type="sine",n.gain.setValueAtTime(.2,t+.3),n.gain.exponentialRampToValueAtTime(.01,t+.8),a.start(t+.3),a.stop(t+.8)}function dr(s){let t=s.currentTime;for(let e=0;e<3;e++){let r=s.createOscillator(),a=s.createGain();r.connect(a),a.connect(s.destination),r.frequency.value=880,r.type="square",a.gain.setValueAtTime(.15,t+e*.2),a.gain.exponentialRampToValueAtTime(.01,t+e*.2+.1),r.start(t+e*.2),r.stop(t+e*.2+.1)}}function Fe(s,t,e,r){let a=s.createDiv({cls:"workout-controls"});if(t==="planned"){let n=a.createEl("button",{cls:"workout-btn workout-btn-primary workout-btn-large"});n.createSpan({cls:"workout-btn-icon",text:"\u25B6"}),n.createSpan({text:"Start Workout"}),n.addEventListener("click",()=>{N(),e.onStartWorkout()})}else if(t==="completed"){let n=a.createSpan({cls:"workout-completed-label"});n.createSpan({cls:"workout-btn-icon",text:"\u2713"}),n.createSpan({text:"Completed"});let o=a.createEl("button",{cls:"workout-btn"});o.createSpan({cls:"workout-btn-icon",text:"\u{1F4CB}"}),o.createSpan({text:"Copy as Template"}),o.addEventListener("click",async()=>{let i=xt(r);await navigator.clipboard.writeText("```workout\n"+i+"\n```");let l=o.querySelector("span:last-child");if(l){let d=l.textContent;l.textContent="Copied!",setTimeout(()=>{l.textContent=d},1500)}})}return a}function Ct(s,t){let e=s.createDiv({cls:"workout-empty-state"});e.createDiv({cls:"workout-empty-message"}).createSpan({text:"This workout is empty"});let n=e.createDiv({cls:"workout-empty-action"}).createEl("button",{cls:"workout-btn workout-btn-primary workout-btn-large"});return n.createSpan({cls:"workout-btn-icon",text:"\u2728"}),n.createSpan({text:"Add Sample Workout"}),n.addEventListener("click",async()=>{await t()}),e}function Dt(s){let{el:t,parsed:e,callbacks:r,workoutId:a,timerManager:n,timerStyle:o}=s;t.empty();let i=t.createDiv({cls:`workout-container state-${e.metadata.state}`}),l=n.isTimerRunning(a),d=n.getTimerState(a),c=l?n.getActiveExerciseIndex(a):-1,{timerEl:u}=Re(i,e.metadata,d,l,o);if(e.exercises.length===0&&e.metadata.state==="planned"){Ct(i,r.onAddSample);return}let p=[],m=i.createDiv({cls:"workout-exercises"}),g=Math.max(...e.exercises.map(h=>h.name.length));m.style.setProperty("--max-name-chars",String(g));for(let h=0;h<e.exercises.length;h++){let y=e.exercises[h];if(!y)continue;let f=h===c,v=Be(m,y,h,f,f?d:null,r,e.metadata.state,e.metadata.restDuration);p.push(v)}if(Fe(i,e.metadata.state,r,e),i.addEventListener("focusout",h=>{let y=h.relatedTarget;(!y||!i.contains(y))&&r.onFlushChanges()}),l){let h=c,y=!1;n.subscribe(a,f=>{We(u,f,o);let v=n.getActiveExerciseIndex(a);if(v!==h)return;let S=p[v],T=e.exercises[v];S!=null&&S.timerEl&&T&&(se(S.timerEl,f,T.targetDuration),!y&&T.targetDuration!==void 0&&f.exerciseElapsed>=T.targetDuration&&(y=!0,r.onExerciseFinish(v)))})}}var ie=class{constructor(){this.timers=new Map;this.intervalId=null;this.onAutoAdvance=null;this.onPomodoroPhaseChange=null}setAutoAdvanceCallback(t){this.onAutoAdvance=t}setPomodoroPhaseChangeCallback(t){this.onPomodoroPhaseChange=t}startWorkoutTimer(t,e=0,r){var o,i,l;let a=Date.now(),n=this.timers.get(t);n?(n.exerciseStartTime=a,n.exercisePausedTime=0,n.isPaused=!1,n.activeExerciseIndex=e,r!=null&&r.enabled&&(n.pomodoroEnabled=!0,n.pomodoroPhase="work",n.pomodoroCycle=1,n.pomodoroWorkDuration=r.workDuration,n.pomodoroBreakDuration=r.breakDuration,n.pomodoroPhaseStartTime=a,n.pomodoroPausedTime=0)):this.timers.set(t,{workoutId:t,workoutStartTime:a,exerciseStartTime:a,exercisePausedTime:0,isPaused:!1,activeExerciseIndex:e,callbacks:new Set,pomodoroEnabled:(o=r==null?void 0:r.enabled)!=null?o:!1,pomodoroPhase:"work",pomodoroCycle:1,pomodoroWorkDuration:(i=r==null?void 0:r.workDuration)!=null?i:25*60,pomodoroBreakDuration:(l=r==null?void 0:r.breakDuration)!=null?l:5*60,pomodoroPhaseStartTime:a,pomodoroPausedTime:0}),this.ensureInterval()}advanceExercise(t,e){let r=this.timers.get(t);r&&(r.exerciseStartTime=Date.now(),r.exercisePausedTime=0,r.isPaused=!1,r.activeExerciseIndex=e)}pauseExercise(t){let e=this.timers.get(t);if(!e||e.isPaused)return;e.isPaused=!0;let r=Date.now();e.exercisePausedTime+=r-e.exerciseStartTime,e.pomodoroEnabled&&(e.pomodoroPausedTime+=r-e.pomodoroPhaseStartTime)}resumeExercise(t){let e=this.timers.get(t);if(!e||!e.isPaused)return;e.isPaused=!1;let r=Date.now();e.exerciseStartTime=r,e.pomodoroEnabled&&(e.pomodoroPhaseStartTime=r)}stopWorkoutTimer(t){this.timers.delete(t),this.timers.size===0&&this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)}subscribe(t,e){let r=this.timers.get(t);if(!r)return()=>{};r.callbacks.add(e);let a=this.getTimerState(t);return a&&e(a),()=>{r.callbacks.delete(e)}}getTimerState(t){let e=this.timers.get(t);if(!e)return null;let r=Date.now(),a=Math.floor((r-e.workoutStartTime)/1e3),n;if(e.isPaused)n=Math.floor(e.exercisePausedTime/1e3);else{let i=r-e.exerciseStartTime;n=Math.floor((e.exercisePausedTime+i)/1e3)}let o={workoutElapsed:a,exerciseElapsed:n,isOvertime:!1};if(e.pomodoroEnabled){let i=e.pomodoroPhase==="work"?e.pomodoroWorkDuration:e.pomodoroBreakDuration,l;if(e.isPaused)l=Math.floor(e.pomodoroPausedTime/1e3);else{let u=r-e.pomodoroPhaseStartTime;l=Math.floor((e.pomodoroPausedTime+u)/1e3)}let d=Math.max(0,i-l),c=Math.min(100,l/i*100);o.pomodoroEnabled=!0,o.pomodoroPhase=e.pomodoroPhase,o.pomodoroCycle=e.pomodoroCycle,o.pomodoroElapsed=l,o.pomodoroRemaining=d,o.pomodoroProgress=c}return o}getActiveExerciseIndex(t){var r;let e=this.timers.get(t);return(r=e==null?void 0:e.activeExerciseIndex)!=null?r:0}setActiveExerciseIndex(t,e){let r=this.timers.get(t);r&&r.activeExerciseIndex!==e&&(r.activeExerciseIndex=e,r.exerciseStartTime=Date.now(),r.exercisePausedTime=0,r.isPaused=!1)}isTimerRunning(t){return this.timers.has(t)}isPaused(t){var r;let e=this.timers.get(t);return(r=e==null?void 0:e.isPaused)!=null?r:!1}getPomodoroPhase(t){let e=this.timers.get(t);return!e||!e.pomodoroEnabled?null:e.pomodoroPhase}ensureInterval(){this.intervalId===null&&(this.intervalId=window.setInterval(()=>{this.tick()},1e3))}tick(){for(let[t,e]of this.timers){let r=this.getTimerState(t);if(r){e.pomodoroEnabled&&!e.isPaused&&this.checkPomodoroPhaseComplete(t,e,r);for(let a of e.callbacks)a(r)}}}checkPomodoroPhaseComplete(t,e,r){if(!r.pomodoroRemaining||r.pomodoroRemaining>0)return;let a=Date.now(),n=e.pomodoroPhase;e.pomodoroPhase==="work"?(e.pomodoroPhase="break",J("break")):(e.pomodoroPhase="work",e.pomodoroCycle++,J("complete")),e.pomodoroPhaseStartTime=a,e.pomodoroPausedTime=0,this.onPomodoroPhaseChange&&this.onPomodoroPhaseChange(t,e.pomodoroPhase,e.pomodoroCycle)}checkAutoAdvance(t,e){if(e===void 0)return;let r=this.getTimerState(t);r&&r.exerciseElapsed>=e&&this.onAutoAdvance&&this.onAutoAdvance(t)}destroy(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timers.clear()}};var He=require("obsidian"),le=class{constructor(t){this.app=t;this.updateLocks=new Map}async withLock(t,e){let r=this.updateLocks.get(t);r&&await r;let a,n=new Promise(o=>{a=o});this.updateLocks.set(t,n);try{return await e()}finally{a(),this.updateLocks.get(t)===n&&this.updateLocks.delete(t)}}async updateCodeBlock(t,e,r,a){let n=this.app.vault.getAbstractFileByPath(t);if(!(n instanceof He.TFile)){console.error("File not found:",t);return}if(!e){console.error("No section info available");return}await this.withLock(t,async()=>{await this.app.vault.process(n,o=>{var v;let i=o.split(`
`),l=i[e.lineStart],d=l==null?void 0:l.trim().startsWith("```life-log"),c=l==null?void 0:l.trim().startsWith("```study-log"),u=l==null?void 0:l.trim().startsWith("```work-log"),p=l==null?void 0:l.trim().startsWith("```meal-log");if(!l||!d&&!c&&!u&&!p)return console.error("Stale sectionInfo: expected ```life-log, ```study-log, ```work-log, or ```meal-log at line",e.lineStart),o;if(a){let T=i.slice(e.lineStart+1,e.lineEnd).join(`
`).match(/^title:\s*(.+)$/m),x=(v=T==null?void 0:T[1])==null?void 0:v.trim();if(x&&x!==a)return console.error("Title mismatch: expected",a,"but found",x),o}let m=e.lineStart,g=e.lineEnd,h=i.slice(0,m+1),y=i.slice(g);return[...h,r,...y].join(`
`)})})}async insertLineAfter(t,e,r,a){let n=this.app.vault.getAbstractFileByPath(t);if(!(n instanceof He.TFile)){console.error("File not found:",t);return}if(!e){console.error("No section info available");return}await this.app.vault.process(n,o=>{let i=o.split(`
`),l=e.lineStart+1+r;return i.splice(l+1,0,a),i.join(`
`)})}};var j=require("obsidian"),Q=class{constructor(t,e){this.app=t;this.settings=e}async createLogFile(t,e){let r=new Date,a=this.buildFolderPath(r),n=this.buildFileName(r,t),o=(0,j.normalizePath)(`${a}/${n}`);await this.ensureFolderExists(a);let i=this.app.vault.getAbstractFileByPath(o);return i instanceof j.TFile?this.appendToExistingFile(i,t,e):this.createNewFile(o,t,r,e)}buildFolderPath(t){let e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0");return(0,j.normalizePath)(`${this.settings.logFolder}/${e}/${r}`)}buildFileName(t,e){return`${this.formatDate(t)}-${e}.md`}formatDate(t){let e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");switch(this.settings.dateFormat){case"YYYY/MM/DD":return`${e}/${r}/${a}`;case"DD-MM-YYYY":return`${a}-${r}-${e}`;default:return`${e}-${r}-${a}`}}async ensureFolderExists(t){if(this.app.vault.getAbstractFileByPath(t)instanceof j.TFolder)return;let r=t.split("/"),a="";for(let n of r)a=a?`${a}/${n}`:n,this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a)}async appendToExistingFile(t,e,r){let a=this.getBlockType(e),n=this.buildNewSection(e,r,a);return await this.app.vault.process(t,o=>o+`

---

`+n),t}getBlockType(t){switch(t){case"study":return"study-log";case"work":return"work-log";case"workout":return"life-log"}}async createNewFile(t,e,r,a){let n=this.getBlockType(e),o=this.buildFrontmatter(e,r),i=this.buildHeading(e,r),l=this.buildNewSection(e,a,n),d=`${o}

${i}

${l}`;return await this.app.vault.create(t,d)}buildFrontmatter(t,e){let r=this.formatDate(e),a=e.toISOString();return["---",`type: ${t}-log`,`date: ${r}`,`created: ${a}`,"---"].join(`
`)}buildHeading(t,e){let r=this.formatDate(e),a={study:"\u{1F4DA}",work:"\u{1F4BC}",workout:"\u{1F3CB}\uFE0F"},n={study:"\uD559\uC2B5",work:"\uC5C5\uBB34",workout:"\uC6B4\uB3D9"};return`# ${a[t]} ${r} ${n[t]} \uAE30\uB85D`}buildNewSection(t,e,r){let n=new Date().getHours();return[`## ${n<12?"\uC624\uC804":n<18?"\uC624\uD6C4":"\uC800\uB141"} ${{study:"\uD559\uC2B5",work:"\uC5C5\uBB34",workout:"\uC6B4\uB3D9"}[t]} \uC138\uC158`,"",`\`\`\`${r}`,e,"```"].join(`
`)}formatDateTime(t){let e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return`${e}-${r}-${a} ${n}:${o}`}};var ur=["planned","started","completed"];function Oe(s){let t={title:"",subject:"",state:"planned"};for(let e of s){let r=e.indexOf(":");if(r===-1)continue;let a=e.substring(0,r).trim().toLowerCase(),n=e.substring(r+1).trim();switch(a){case"title":t.title=n;break;case"subject":t.subject=n;break;case"state":ur.includes(n)&&(t.state=n);break;case"startdate":n&&(t.startDate=n);break;case"enddate":n&&(t.endDate=n);break;case"totalduration":n&&(t.totalDuration=n);break;case"focusscore":let o=parseInt(n);o>=1&&o<=5&&(t.focusScore=o);break;case"comprehensionscore":let i=parseInt(n);i>=1&&i<=5&&(t.comprehensionScore=i);break;case"tags":n&&(t.tags=n.split(",").map(l=>l.trim()).filter(l=>l));break}}return t}function Ne(s){let t=[];return s.title&&t.push(`title: ${s.title}`),s.subject&&t.push(`subject: ${s.subject}`),t.push(`state: ${s.state}`),s.startDate&&t.push(`startDate: ${s.startDate}`),s.endDate&&t.push(`endDate: ${s.endDate}`),s.totalDuration&&t.push(`totalDuration: ${s.totalDuration}`),s.focusScore&&t.push(`focusScore: ${s.focusScore}`),s.comprehensionScore&&t.push(`comprehensionScore: ${s.comprehensionScore}`),s.tags&&s.tags.length>0&&t.push(`tags: ${s.tags.join(", ")}`),t}var pr=/^-\s*\[(.)\]\s*(.+)$/,mr={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},gr={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function je(s,t){var u,p,m,g,h;let e=s.match(pr);if(!e)return null;let r=(u=e[1])!=null?u:" ",a=(p=e[2])!=null?p:"",n=(m=mr[r])!=null?m:"pending",o=a.split("|").map(y=>y.trim()),i=(g=o[0])!=null?g:"",l,d,c;for(let y=1;y<o.length;y++){let f=o[y];if(!f)continue;let v=f.indexOf(":");if(v===-1){c=f;continue}let S=f.substring(0,v).trim().toLowerCase(),T=f.substring(v+1).trim();if(S==="duration"){let x=T.match(/^\[([^\]]*)\]$/);x?l=$((h=x[1])!=null?h:"0"):d=T}else c?c+=" | "+f:c=f}return{state:n,name:i,targetDuration:l,recordedDuration:d,notes:c,lineIndex:t}}function Lt(s){return gr[s]}function ze(s){let e=`- [${Lt(s.state)}] ${s.name}`;return s.targetDuration!==void 0&&s.state==="pending"?e+=` | Duration: [${fr(s.targetDuration)}]`:s.recordedDuration&&(e+=` | Duration: ${s.recordedDuration}`),s.notes&&(e+=` | ${s.notes}`),e}function fr(s){let t=Math.floor(s/60),e=s%60;return t===0?`${e}s`:e===0?`${t}m`:`${t}m ${e}s`}function ce(s){var l;let t=s.split(`
`),e=-1;for(let d=0;d<t.length;d++)if(((l=t[d])==null?void 0:l.trim())==="---"){e=d;break}let r=e>0?t.slice(0,e):[],a=Oe(r),n=e>=0?e+1:0,o=t.slice(n),i=[];for(let d=0;d<o.length;d++){let c=o[d];if(!c)continue;let u=je(c,d);u&&i.push(u)}return{metadata:a,tasks:i,rawLines:t,metadataEndIndex:e>=0?e:-1}}function Pt(s){let t=[],e=Ne(s.metadata);t.push(...e),t.push("---");for(let r of s.tasks)t.push(ze(r));return t.join(`
`)}function z(s,t,e){let r=structuredClone(s),a=r.tasks[t];return a?(a.state=e,r):s}function de(s,t,e){let r=structuredClone(s),a=r.tasks[t];return a?(a.recordedDuration=e,a.targetDuration=void 0,r):s}function At(s,t,e){let r=structuredClone(s);return r.metadata.focusScore=t,r.metadata.comprehensionScore=e,r}function Ge(s,t,e,r,a="digital"){let n=s.createDiv({cls:"study-header"}),o=n.createDiv({cls:"study-header-top"}),i=o.createDiv({cls:"study-title"}),l=kr(t.subject);i.createSpan({cls:"study-subject-icon",text:l}),i.createSpan({cls:"study-subject-name",text:t.subject||"\uD559\uC2B5"}),t.title&&i.createSpan({cls:"study-title-text",text:` - ${t.title}`});let d=o.createDiv({cls:"study-timer"});hr(d,t,e,r,a);let c=n.createDiv({cls:"study-scores"});if(t.state==="completed"&&yr(c,t.focusScore,t.comprehensionScore),t.tags&&t.tags.length>0){let u=n.createDiv({cls:"study-tags"});for(let p of t.tags)u.createSpan({cls:"study-tag",text:p})}return{titleEl:i,timerEl:d,scoresEl:c}}function hr(s,t,e,r,a){t.state==="completed"&&t.totalDuration?(s.createSpan({cls:"study-timer-value",text:t.totalDuration}),s.createSpan({cls:"study-timer-indicator recorded",text:" \u2713"})):r&&e?W(s,e,a):s.createSpan({cls:"study-timer-value",text:"--:--"})}function yr(s,t,e){if(t){let r=s.createDiv({cls:"study-score-item"});r.createSpan({cls:"study-score-label",text:"\uC9D1\uC911\uB3C4: "}),Mt(r,t)}if(e){let r=s.createDiv({cls:"study-score-item"});r.createSpan({cls:"study-score-label",text:"\uC774\uD574\uB3C4: "}),Mt(r,e)}}function Mt(s,t){let e=s.createSpan({cls:`study-stars score-${t}`});for(let r=1;r<=5;r++)e.createSpan({cls:`study-star ${r<=t?"filled":"empty"}`,text:r<=t?"\u2605":"\u2606"})}function kr(s){return{\uC218\uD559:"\u{1F4D0}",\uC601\uC5B4:"\u{1F524}",\uD504\uB85C\uADF8\uB798\uBC0D:"\u{1F4BB}",\uB3C5\uC11C:"\u{1F4D6}",\uAE30\uD0C0:"\u{1F4DD}"}[s]||"\u{1F4DA}"}function _e(s,t,e="digital"){W(s,t,e)}function Ke(s,t,e,r,a,n,o){let i=s.createDiv({cls:`study-task state-${t.state} ${r?"active":""}`}),l=i.createDiv({cls:"study-task-main"}),d=l.createSpan({cls:"study-task-icon"});d.textContent=Sr(t.state);let c=l.createSpan({cls:"study-task-name"});c.textContent=t.name;let u=null;if(t.notes){let p=l.createSpan({cls:"study-task-notes"});p.textContent=t.notes}if(u=l.createSpan({cls:"study-task-timer"}),t.state==="completed"&&t.recordedDuration)u.textContent=t.recordedDuration,u.createSpan({cls:"timer-indicator recorded",text:" \u2713"});else if(r&&a)ue(u,a,t.targetDuration);else if(t.targetDuration){let p=Math.floor(t.targetDuration/60),m=t.targetDuration%60;u.textContent=`[${p}m ${m>0?m+"s":""}]`,u.classList.add("target")}return r&&o==="started"&&vr(i,e,n),{taskEl:i,timerEl:u}}function vr(s,t,e){let r=s.createDiv({cls:"study-task-controls"});r.createEl("button",{cls:"study-btn",text:"\u2713 \uC644\uB8CC"}).addEventListener("click",()=>e.onTaskFinish(t)),r.createEl("button",{cls:"study-btn",text:"\u23ED \uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>e.onTaskSkip(t))}function Sr(s){switch(s){case"completed":return"\u2713";case"inProgress":return"\u25B6";case"skipped":return"\u2013";default:return"\u25CB"}}function ue(s,t,e){if(s.empty(),s.classList.remove("overtime"),e!==void 0){let r=e-t.exerciseElapsed;r<0?(s.classList.add("overtime"),s.textContent=`+${w(Math.abs(r))}`,s.createSpan({cls:"timer-indicator overtime",text:" !"})):(s.textContent=w(r),s.createSpan({cls:"timer-indicator count-down",text:" \u25BC"}))}else s.textContent=w(t.exerciseElapsed),s.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}function Ye(s,t,e,r){let a=s.createDiv({cls:"study-controls"});if(t==="planned"){let n=a.createEl("button",{cls:"study-btn study-btn-primary study-btn-large"});n.createSpan({cls:"study-btn-icon",text:"\u25B6"}),n.createSpan({text:"\uD559\uC2B5 \uC2DC\uC791"}),n.addEventListener("click",()=>{N(),e.onStartStudy()})}else if(t==="started"){let n=a.createEl("button",{cls:"study-btn study-btn-primary"});n.createSpan({cls:"study-btn-icon",text:"\u2713"}),n.createSpan({text:"\uD559\uC2B5 \uC644\uB8CC"}),n.addEventListener("click",()=>e.onOpenSelfEval())}else if(t==="completed"){let n=a.createSpan({cls:"study-completed-label"});n.createSpan({cls:"study-btn-icon",text:"\u2713"}),n.createSpan({text:"\uC644\uB8CC\uB428"});let o=a.createEl("button",{cls:"study-btn"});o.createSpan({cls:"study-btn-icon",text:"\u{1F4CB}"}),o.createSpan({text:"\uD15C\uD50C\uB9BF \uBCF5\uC0AC"}),o.addEventListener("click",async()=>{let i=Tr(r);await navigator.clipboard.writeText("```study-log\n"+i+"\n```");let l=o.querySelector("span:last-child");if(l){let d=l.textContent;l.textContent="Copied!",setTimeout(()=>{l.textContent=d},1500)}})}return a}function Tr(s){let t=[];s.metadata.subject&&t.push(`subject: ${s.metadata.subject}`),t.push("state: planned"),t.push("---");let e=new Set;for(let r of s.tasks)if(!e.has(r.name)){e.add(r.name);let a=`- [ ] ${r.name}`;if(r.targetDuration){let n=Math.floor(r.targetDuration/60),o=r.targetDuration%60;a+=` | Duration: [${n}m${o>0?" "+o+"s":""}]`}t.push(a)}return t.join(`
`)}var It=0,xr=3e3;function pe(s,t,e="complete"){let r=Date.now();r-It<xr||(It=r,s.enableSound&&J(e),s.enableNotification&&br(t,e))}function br(s,t){if("Notification"in window)if(Notification.permission==="granted"){let e;t==="break"?e="\uD734\uC2DD \uC2DC\uAC04\uC774 \uB05D\uB0AC\uC2B5\uB2C8\uB2E4! \uB2E4\uC2DC \uC9D1\uC911\uD558\uC138\uC694.":s?e=`"${s}" \uC644\uB8CC!`:e="\uD0C0\uC774\uBA38\uAC00 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!",new Notification("Life Log",{body:e,icon:void 0,silent:!0})}else Notification.permission!=="denied"&&Notification.requestPermission()}function $t(s){let{el:t,parsed:e,callbacks:r,studyId:a,timerManager:n,enableTimerSound:o=!0,enableNotification:i=!1,timerStyle:l}=s;t.empty();let d=t.createDiv({cls:`study-container state-${e.metadata.state}`}),c=n.isTimerRunning(a),u=n.getTimerState(a),p=c?n.getActiveExerciseIndex(a):-1,m=Ge(d,e.metadata,u,c,l);if(e.tasks.length===0&&e.metadata.state==="planned"){wr(d);return}let g=[],h=d.createDiv({cls:"study-tasks"});for(let y=0;y<e.tasks.length;y++){let f=e.tasks[y];if(!f)continue;let v=y===p,S=Ke(h,f,y,v,v?u:null,r,e.metadata.state);g.push(S)}if(Ye(d,e.metadata.state,r,e),d.addEventListener("focusout",y=>{let f=y.relatedTarget;(!f||!d.contains(f))&&r.onFlushChanges()}),c){let y=p,f=p>=0?e.tasks[p]:null,v=(f==null?void 0:f.targetDuration)!==void 0&&u?u.exerciseElapsed>=f.targetDuration:!1;n.subscribe(a,S=>{_e(m.timerEl,S,l);let T=n.getActiveExerciseIndex(a);if(T!==y){y=T;let I=e.tasks[T];v=(I==null?void 0:I.targetDuration)!==void 0?S.exerciseElapsed>=I.targetDuration:!1;return}let x=g[T],C=e.tasks[T];x!=null&&x.timerEl&&C&&(ue(x.timerEl,S,C.targetDuration),!v&&C.targetDuration!==void 0&&S.exerciseElapsed>=C.targetDuration&&(v=!0,pe({enableSound:o,enableNotification:i},C.name)))})}}function wr(s){s.createDiv({cls:"study-empty-state"}).createDiv({cls:"study-empty-message",text:"\uD559\uC2B5 \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uCF54\uB4DC\uBE14\uB85D\uC5D0 \uD56D\uBAA9\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}var Er=["planned","started","completed"];function Ue(s){let t={title:"",state:"planned"};for(let e of s){let r=e.indexOf(":");if(r===-1)continue;let a=e.substring(0,r).trim().toLowerCase(),n=e.substring(r+1).trim();switch(a){case"title":t.title=n;break;case"state":Er.includes(n)&&(t.state=n);break;case"startdate":n&&(t.startDate=n);break;case"enddate":n&&(t.endDate=n);break;case"totalduration":n&&(t.totalDuration=n);break;case"tags":n&&(t.tags=n.split(",").map(o=>o.trim()).filter(o=>o));break}}return t}function Ve(s){let t=[];return s.title&&t.push(`title: ${s.title}`),t.push(`state: ${s.state}`),s.startDate&&t.push(`startDate: ${s.startDate}`),s.endDate&&t.push(`endDate: ${s.endDate}`),s.totalDuration&&t.push(`totalDuration: ${s.totalDuration}`),s.tags&&s.tags.length>0&&t.push(`tags: ${s.tags.join(", ")}`),t}var Cr=/^-\s*\[(.)\]\s*(.+)$/,Dr={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},Lr={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function qe(s,t){var p,m,g,h,y;let e=s.match(Cr);if(!e)return null;let r=(p=e[1])!=null?p:" ",a=(m=e[2])!=null?m:"",n=(g=Dr[r])!=null?g:"pending",o=a.split("|").map(f=>f.trim()),i=(h=o[0])!=null?h:"",l="medium",d,c,u;for(let f=1;f<o.length;f++){let v=o[f];if(!v)continue;let S=v.indexOf(":");if(S===-1){u=u?u+" | "+v:v;continue}let T=v.substring(0,S).trim().toLowerCase(),x=v.substring(S+1).trim();if(T==="priority")["high","medium","low"].includes(x.toLowerCase())&&(l=x.toLowerCase());else if(T==="expected"){let C=x.match(/^\[([^\]]*)\]$/);C?d=$((y=C[1])!=null?y:"0"):d=$(x)}else T==="actual"?x&&x!==""&&(c=x):u=u?u+" | "+v:v}return{state:n,name:i,priority:l,expectedDuration:d,actualDuration:c,notes:u,lineIndex:t}}function Rt(s){return Lr[s]}function Je(s){let e=`- [${Rt(s.state)}] ${s.name}`;return e+=` | Priority: ${s.priority}`,s.expectedDuration!==void 0&&(e+=` | Expected: [${Pr(s.expectedDuration)}]`),s.actualDuration&&(e+=` | Actual: ${s.actualDuration}`),s.notes&&(e+=` | ${s.notes}`),e}function Pr(s){let t=Math.floor(s/3600),e=Math.floor(s%3600/60),r=s%60;return t>0?e===0&&r===0?`${t}h`:r===0?`${t}h ${e}m`:`${t}h ${e}m ${r}s`:e===0?`${r}s`:r===0?`${e}m`:`${e}m ${r}s`}function me(s){var l;let t=s.split(`
`),e=-1;for(let d=0;d<t.length;d++)if(((l=t[d])==null?void 0:l.trim())==="---"){e=d;break}let r=e>0?t.slice(0,e):[],a=Ue(r),n=e>=0?e+1:0,o=t.slice(n),i=[];for(let d=0;d<o.length;d++){let c=o[d];if(!c)continue;let u=qe(c,d);u&&i.push(u)}return{metadata:a,tasks:i,rawLines:t,metadataEndIndex:e>=0?e:-1}}function Wt(s){let t=[],e=Ve(s.metadata);t.push(...e),t.push("---");for(let r of s.tasks)t.push(Je(r));return t.join(`
`)}function G(s,t,e){let r=structuredClone(s),a=r.tasks[t];return a?(a.state=e,r):s}function ge(s,t,e){let r=structuredClone(s),a=r.tasks[t];return a?(a.actualDuration=e,r):s}function Qe(s,t,e,r,a="digital"){let n=s.createDiv({cls:"work-header"}),o=n.createDiv({cls:"work-header-top"}),i=o.createDiv({cls:"work-title"});i.createSpan({cls:"work-icon",text:"\u{1F4BC}"}),i.createSpan({cls:"work-title-text",text:t.title||"\uC5C5\uBB34"});let l=o.createDiv({cls:"work-timer"});if(Ar(l,t,e,r,a),t.tags&&t.tags.length>0){let d=n.createDiv({cls:"work-tags"});for(let c of t.tags)d.createSpan({cls:"work-tag",text:c})}return{titleEl:i,timerEl:l}}function Ar(s,t,e,r,a){t.state==="completed"&&t.totalDuration?(s.createSpan({cls:"work-timer-value",text:t.totalDuration}),s.createSpan({cls:"work-timer-indicator recorded",text:" \u2713"})):r&&e?W(s,e,a):s.createSpan({cls:"work-timer-value",text:"--:--"})}function Xe(s,t,e="digital"){W(s,t,e)}var Mr={high:"#E74C3C",medium:"#F39C12",low:"#3498DB"},Ir={high:"\uB192\uC74C",medium:"\uBCF4\uD1B5",low:"\uB0AE\uC74C"};function Ze(s,t,e,r,a,n,o){let i=s.createDiv({cls:`work-task state-${t.state} priority-${t.priority} ${r?"active":""}`}),l=i.createDiv({cls:"work-task-main"}),d=l.createSpan({cls:"work-task-icon"});d.textContent=Br(t.state);let c=l.createSpan({cls:"work-task-priority"});c.style.backgroundColor=Mr[t.priority],c.setAttribute("title",Ir[t.priority]);let u=l.createSpan({cls:"work-task-name"});u.textContent=t.name;let p=null;if(t.notes){let m=l.createSpan({cls:"work-task-notes"});m.textContent=t.notes}return p=l.createDiv({cls:"work-task-timer-group"}),t.state==="completed"&&t.actualDuration?$r(p,t):r&&a?fe(p,a,t.expectedDuration):t.expectedDuration&&Rr(p,t.expectedDuration),r&&o==="started"&&Wr(i,e,n),{taskEl:i,timerEl:p}}function $r(s,t){if(t.expectedDuration){let r=s.createSpan({cls:"work-timer-expected"});r.textContent=`\uC608\uC0C1: ${et(t.expectedDuration)}`}let e=s.createSpan({cls:"work-timer-actual"});e.textContent=`\uC2E4\uC81C: ${t.actualDuration}`,e.createSpan({cls:"timer-indicator recorded",text:" \u2713"})}function Rr(s,t){let e=s.createSpan({cls:"work-timer-expected target"});e.textContent=`\uC608\uC0C1: [${et(t)}]`}function Wr(s,t,e){let r=s.createDiv({cls:"work-task-controls"});r.createEl("button",{cls:"work-btn",text:"\u2713 \uC644\uB8CC"}).addEventListener("click",()=>e.onTaskFinish(t)),r.createEl("button",{cls:"work-btn",text:"\u23ED \uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>e.onTaskSkip(t))}function Br(s){switch(s){case"completed":return"\u2713";case"inProgress":return"\u25B6";case"skipped":return"\u2013";default:return"\u25CB"}}function fe(s,t,e){if(s.empty(),s.classList.remove("overtime"),e!==void 0){let r=s.createSpan({cls:"work-timer-expected"});r.textContent=`\uC608\uC0C1: ${et(e)}`;let a=s.createSpan({cls:"work-timer-actual"});t.exerciseElapsed>e?(s.classList.add("overtime"),a.textContent=`\uC2E4\uC81C: ${w(t.exerciseElapsed)}`,a.createSpan({cls:"timer-indicator overtime",text:" !"})):(a.textContent=`\uC2E4\uC81C: ${w(t.exerciseElapsed)}`,a.createSpan({cls:"timer-indicator count-up",text:" \u25B2"}))}else{let r=s.createSpan({cls:"work-timer-actual"});r.textContent=w(t.exerciseElapsed),r.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}}function et(s){let t=Math.floor(s/3600),e=Math.floor(s%3600/60),r=s%60;return t>0?e===0&&r===0?`${t}h`:r===0?`${t}h ${e}m`:`${t}h ${e}m`:e===0?`${r}s`:r===0?`${e}m`:`${e}m ${r}s`}function tt(s,t,e,r){let a=s.createDiv({cls:"work-controls"});if(t==="planned"){let n=a.createEl("button",{cls:"work-btn work-btn-primary work-btn-large"});n.createSpan({cls:"work-btn-icon",text:"\u25B6"}),n.createSpan({text:"\uC5C5\uBB34 \uC2DC\uC791"}),n.addEventListener("click",async()=>{console.log("[Life Log] Work start button clicked"),N();try{await e.onStartWork(),console.log("[Life Log] onStartWork completed")}catch(o){console.error("[Life Log] onStartWork error:",o)}})}else if(t==="started"){let n=a.createEl("button",{cls:"work-btn work-btn-primary"});n.createSpan({cls:"work-btn-icon",text:"\u2713"}),n.createSpan({text:"\uC5C5\uBB34 \uC644\uB8CC"}),n.addEventListener("click",()=>e.onFinishWork())}else if(t==="completed"){let n=a.createSpan({cls:"work-completed-label"});n.createSpan({cls:"work-btn-icon",text:"\u2713"}),n.createSpan({text:"\uC644\uB8CC\uB428"}),Fr(a,r);let o=a.createEl("button",{cls:"work-btn"});o.createSpan({cls:"work-btn-icon",text:"\u{1F4CB}"}),o.createSpan({text:"\uD15C\uD50C\uB9BF \uBCF5\uC0AC"}),o.addEventListener("click",async()=>{let i=Hr(r);await navigator.clipboard.writeText("```work-log\n"+i+"\n```");let l=o.querySelector("span:last-child");if(l){let d=l.textContent;l.textContent="Copied!",setTimeout(()=>{l.textContent=d},1500)}})}return a}function Fr(s,t){let e=s.createDiv({cls:"work-stats"}),r=t.tasks.filter(i=>i.state==="completed").length,a=t.tasks.length;e.createSpan({cls:"work-stat",text:`\uC644\uB8CC: ${r}/${a}`});let n=t.tasks.filter(i=>i.priority==="high"&&i.state==="completed").length,o=t.tasks.filter(i=>i.priority==="high").length;if(o>0){let i=e.createSpan({cls:"work-stat high-priority"});i.createSpan({cls:"priority-dot high"}),i.createSpan({text:` \uC911\uC694: ${n}/${o}`})}}function Hr(s){let t=[];t.push("state: planned"),t.push("---");let e=new Set;for(let r of s.tasks)if(!e.has(r.name)){e.add(r.name);let a=`- [ ] ${r.name} | Priority: ${r.priority}`;r.expectedDuration&&(a+=` | Expected: [${Or(r.expectedDuration)}]`),t.push(a)}return t.join(`
`)}function Or(s){let t=Math.floor(s/3600),e=Math.floor(s%3600/60);return t>0?e===0?`${t}h`:`${t}h ${e}m`:`${e}m`}function Bt(s){let{el:t,parsed:e,callbacks:r,workId:a,timerManager:n,enableTimerSound:o=!0,enableNotification:i=!1,timerStyle:l}=s;t.empty();let d=t.createDiv({cls:`work-container state-${e.metadata.state}`}),c=n.isTimerRunning(a),u=n.getTimerState(a),p=c?n.getActiveExerciseIndex(a):-1,m=Qe(d,e.metadata,u,c,l);if(e.tasks.length===0&&e.metadata.state==="planned"){Nr(d);return}let g=[],h=d.createDiv({cls:"work-tasks"});for(let y=0;y<e.tasks.length;y++){let f=e.tasks[y];if(!f)continue;let v=Ze(h,f,y,y===p,y===p?u:null,r,e.metadata.state);g.push(v)}if(tt(d,e.metadata.state,r,e),d.addEventListener("focusout",y=>{let f=y.relatedTarget;(!f||!d.contains(f))&&r.onFlushChanges()}),c){let y=p,f=p>=0?e.tasks[p]:null,v=(f==null?void 0:f.expectedDuration)!==void 0&&u?u.exerciseElapsed>=f.expectedDuration:!1;n.subscribe(a,S=>{Xe(m.timerEl,S,l);let T=n.getActiveExerciseIndex(a);if(T!==y){y=T;let I=e.tasks[T];v=(I==null?void 0:I.expectedDuration)!==void 0?S.exerciseElapsed>=I.expectedDuration:!1;return}let x=g[T],C=e.tasks[T];x!=null&&x.timerEl&&C&&(fe(x.timerEl,S,C.expectedDuration),!v&&C.expectedDuration!==void 0&&S.exerciseElapsed>=C.expectedDuration&&(v=!0,pe({enableSound:o,enableNotification:i},C.name)))})}}function Nr(s){s.createDiv({cls:"work-empty-state"}).createDiv({cls:"work-empty-message",text:"\uC5C5\uBB34 \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uCF54\uB4DC\uBE14\uB85D\uC5D0 \uD56D\uBAA9\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}var jr=["planned","started","completed"],zr=["breakfast","lunch","dinner","snack"];function rt(s){let t={title:"",mealType:"lunch",state:"planned"};for(let e of s){let r=e.indexOf(":");if(r===-1)continue;let a=e.substring(0,r).trim().toLowerCase(),n=e.substring(r+1).trim();switch(a){case"title":t.title=n;break;case"mealtype":zr.includes(n.toLowerCase())&&(t.mealType=n.toLowerCase());break;case"state":jr.includes(n)&&(t.state=n);break;case"date":n&&(t.date=n);break;case"photo":n&&(t.photo=n);break;case"notes":n&&(t.notes=n);break}}return t}function at(s){let t=[];return s.title&&t.push(`title: ${s.title}`),t.push(`mealType: ${s.mealType}`),t.push(`state: ${s.state}`),s.date&&t.push(`date: ${s.date}`),s.photo&&t.push(`photo: ${s.photo}`),s.notes&&t.push(`notes: ${s.notes}`),t}var Gr=/^-\s*\[(.)\]\s*(.+)$/;var _r={pending:" ",completed:"x"};function nt(s,t){var o,i;let e=s.match(Gr);if(!e)return null;let r=(o=e[1])!=null?o:" ",a=((i=e[2])!=null?i:"").trim();return{state:r==="x"?"completed":"pending",name:a,lineIndex:t}}function Ft(s){return _r[s]}function ot(s){return`- [${Ft(s.state)}] ${s.name}`}function he(s){var l;let t=s.split(`
`),e=-1;for(let d=0;d<t.length;d++)if(((l=t[d])==null?void 0:l.trim())==="---"){e=d;break}let r=e>0?t.slice(0,e):[],a=rt(r),n=e>=0?e+1:0,o=t.slice(n),i=[];for(let d=0;d<o.length;d++){let c=o[d];if(!c)continue;let u=nt(c,d);u&&i.push(u)}return{metadata:a,foods:i,rawLines:t,metadataEndIndex:e>=0?e:-1}}function Ht(s){let t=[],e=at(s.metadata);t.push(...e),t.push("---");for(let r of s.foods)t.push(ot(r));return t.join(`
`)}function Ot(s,t){let e=structuredClone(s),r={state:"pending",name:t,lineIndex:e.foods.length};return e.foods.push(r),e}function Nt(s,t){let e=structuredClone(s);if(t<0||t>=e.foods.length)return s;e.foods.splice(t,1);for(let r=t;r<e.foods.length;r++){let a=e.foods[r];a&&(a.lineIndex=r)}return e}function jt(s,t){let e=structuredClone(s);return e.metadata.photo=t,e}function st(s,t){let e=structuredClone(s),r=e.foods[t];return r?(r.state=r.state==="completed"?"pending":"completed",e):s}var Kr={breakfast:{icon:"\u{1F305}",label:"\uC544\uCE68"},lunch:{icon:"\u2600\uFE0F",label:"\uC810\uC2EC"},dinner:{icon:"\u{1F319}",label:"\uC800\uB141"},snack:{icon:"\u{1F36A}",label:"\uAC04\uC2DD"}};function it(s,t){let e=s.createDiv({cls:"meal-header"}),r=e.createDiv({cls:"meal-header-top"}),a=r.createDiv({cls:"meal-title"}),n=Kr[t.mealType];a.createSpan({cls:"meal-icon",text:n.icon}),a.createSpan({cls:"meal-title-text",text:t.title||n.label}),t.date&&r.createDiv({cls:"meal-date"}).createSpan({text:t.date});let o=null;if(t.photo){o=e.createDiv({cls:"meal-photo-container"});let i=o.createDiv({cls:"meal-photo"});i.innerHTML=`<span class="meal-photo-embed">${t.photo}</span>`}if(t.notes){let i=e.createDiv({cls:"meal-notes"});i.createSpan({cls:"meal-notes-icon",text:"\u{1F4DD}"}),i.createSpan({cls:"meal-notes-text",text:t.notes})}return{titleEl:a,photoEl:o}}function lt(s,t,e,r,a){let n=s.createDiv({cls:`meal-food-item state-${t.state}`}),o=n.createDiv({cls:"meal-food-content"}),i=o.createEl("input",{type:"checkbox",cls:"meal-food-checkbox"});i.checked=t.state==="completed",i.disabled=a==="completed",i.addEventListener("change",async()=>{await r.onFoodToggle(e)});let l=o.createDiv({cls:"meal-food-name"});return l.setText(t.name),a!=="completed"&&o.createEl("button",{cls:"meal-food-remove-btn",text:"\u2715"}).addEventListener("click",async c=>{c.preventDefault(),await r.onRemoveFood(e)}),{container:n,checkboxEl:i,nameEl:l}}function ct(s,t,e,r){let a=s.createDiv({cls:"meal-controls"});if(t==="completed"){Yr(a);return}let n=a.createDiv({cls:"meal-add-food"}),o=n.createEl("input",{type:"text",cls:"meal-food-input",placeholder:"\uC74C\uC2DD \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694..."}),i=n.createEl("button",{cls:"meal-add-btn",text:"\u2795 \uCD94\uAC00"}),l=async()=>{let d=o.value.trim();d&&(await e.onAddFood(d),o.value="")};i.addEventListener("click",l),o.addEventListener("keypress",async d=>{d.key==="Enter"&&await l()}),r.foods.length>0&&a.createEl("button",{cls:"meal-complete-btn",text:"\u2713 \uC2DD\uC0AC \uC644\uB8CC"}).addEventListener("click",async()=>{await e.onCompleteMeal()})}function Yr(s){let t=s.createDiv({cls:"meal-completed-badge"});t.createSpan({cls:"meal-completed-icon",text:"\u2713"}),t.createSpan({cls:"meal-completed-text",text:"\uC2DD\uC0AC \uC644\uB8CC"})}function zt(s){let{el:t,parsed:e,callbacks:r,app:a}=s;t.empty();let n=t.createDiv({cls:`meal-container state-${e.metadata.state}`}),o=it(n,e.metadata);o.photoEl&&e.metadata.photo&&Vr(o.photoEl,e.metadata.photo,a);let i=n.createDiv({cls:"meal-foods"}),l=[];if(e.foods.length===0&&e.metadata.state!=="completed")Ur(i);else for(let d=0;d<e.foods.length;d++){let c=e.foods[d];if(!c)continue;let u=lt(i,c,d,r,e.metadata.state);l.push(u)}ct(n,e.metadata.state,r,e),n.addEventListener("focusout",d=>{let c=d.relatedTarget;(!c||!n.contains(c))&&r.onFlushChanges()})}function Ur(s){s.createDiv({cls:"meal-empty-state"}).createDiv({cls:"meal-empty-message",text:"\uC544\uC9C1 \uC74C\uC2DD\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uC544\uB798\uC5D0\uC11C \uC74C\uC2DD\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}function Vr(s,t,e){var l;let r=t.match(/!\[\[([^\]]+)\]\]/);if(!r)return;let a=r[1];if(!a)return;let n=e.metadataCache.getFirstLinkpathDest(a,"");if(!n){(l=s.querySelector(".meal-photo-embed"))==null||l.setText(`\u{1F4F7} ${a} (\uC774\uBBF8\uC9C0\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC74C)`);return}let o=e.vault.getResourcePath(n),i=s.querySelector(".meal-photo");if(i){i.empty();let d=i.createEl("img",{cls:"meal-photo-image",attr:{src:o,alt:a}})}}var k=require("obsidian"),dt=[{name:"\uC218\uD559",icon:"",color:"#4A90D9"},{name:"\uC601\uC5B4",icon:"",color:"#7B68EE"},{name:"\uD504\uB85C\uADF8\uB798\uBC0D",icon:"",color:"#50C878"},{name:"\uB3C5\uC11C",icon:"",color:"#FFB347"},{name:"\uAE30\uD0C0",icon:"",color:"#A0A0A0"}],ke=[{name:"\uC0C1\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uD478\uC2DC\uC5C5",params:"\uD69F\uC218: [15]"},{name:"\uB364\uBCA8 \uB85C\uC6B0",params:"\uBB34\uAC8C: [10]kg | \uD69F\uC218: [12]"},{name:"\uC204\uB354 \uD504\uB808\uC2A4",params:"\uBB34\uAC8C: [8]kg | \uD69F\uC218: [10]"}]},{name:"\uD558\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uC2A4\uCFFC\uD2B8",params:"\uBB34\uAC8C: [40]kg | \uD69F\uC218: [12]"},{name:"\uB7F0\uC9C0",params:"\uD69F\uC218: [10] /\uB2E4\uB9AC"},{name:"\uCE74\uD504\uB808\uC774\uC988",params:"\uD69F\uC218: [20]"}]},{name:"HIIT",exercises:[{name:"\uBC84\uD53C",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uC810\uD551\uC7AD",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uB9C8\uC6B4\uD2F4 \uD074\uB77C\uC774\uBA38",params:"\uC2DC\uAC04: [30\uCD08]"}]}],X={defaultProvider:"openai",openaiApiKey:"",openaiModel:"gpt-5",geminiApiKey:"",geminiModel:"gemini-2.5-flash",grokApiKey:"",grokModel:"grok-4",openRouterApiKey:"",openRouterModel:"anthropic/claude-sonnet-4",openRouterCustomModels:[],autoAnalysis:!1,analysisSchedule:"manual",enabledTemplates:["study-weekly","study-monthly","workout-weekly","workout-progress","work-weekly","work-productivity","meal-weekly","meal-pattern"],customTemplates:[],reportSavePath:"Life Logs/Reports",reportNaming:"{{category}}_{{date}}_report"},ut={logFolder:"Life Logs",dateFormat:"YYYY-MM-DD",subjects:dt,defaultStudyDuration:30,enablePomodoro:!1,pomodoroWork:25,pomodoroBreak:5,defaultRestDuration:60,workoutTemplates:ke,defaultTab:"study",showRibbonIcon:!0,enableTimerSound:!0,enableNotifications:!0,timerStyle:"digital",usePerTypeTimerStyle:!1,studyTimerStyle:"pomodoro",workTimerStyle:"digital",workoutTimerStyle:"digital",aiAnalysis:X},ye=class extends k.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e,console.log("[Life Log] LifeLogSettingTab constructed")}display(){console.log("[Life Log] LifeLogSettingTab.display() called");let{containerEl:t}=this;if(t.empty(),t.createEl("h2",{text:"Life Log \uC124\uC815"}),!this.plugin.settings){t.createEl("p",{text:"\uC124\uC815\uC744 \uBD88\uB7EC\uC624\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."});return}this.plugin.settings.aiAnalysis||(this.plugin.settings.aiAnalysis={...X}),this.renderSaveSettings(t),this.renderStudySettings(t),this.renderWorkoutSettings(t),this.renderTimerStyleSettings(t),this.renderUISettings(t),this.renderNotificationSettings(t),this.renderAISettings(t)}renderSaveSettings(t){t.createEl("h3",{text:"\u{1F4C1} \uC800\uC7A5 \uC124\uC815"}),new k.Setting(t).setName("\uAE30\uB85D \uC800\uC7A5 \uD3F4\uB354").setDesc("\uD559\uC2B5/\uC6B4\uB3D9 \uAE30\uB85D\uC774 \uC800\uC7A5\uB420 \uD3F4\uB354 \uACBD\uB85C").addText(e=>e.setPlaceholder("Life Logs").setValue(this.plugin.settings.logFolder).onChange(async r=>{this.plugin.settings.logFolder=r||"Life Logs",await this.plugin.saveSettings()})),new k.Setting(t).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uB420 \uB0A0\uC9DC \uD615\uC2DD").addDropdown(e=>e.addOption("YYYY-MM-DD","YYYY-MM-DD").addOption("YYYY/MM/DD","YYYY/MM/DD").addOption("DD-MM-YYYY","DD-MM-YYYY").setValue(this.plugin.settings.dateFormat).onChange(async r=>{this.plugin.settings.dateFormat=r,await this.plugin.saveSettings()}))}renderStudySettings(t){t.createEl("h3",{text:"\u{1F4DA} \uD559\uC2B5 \uAE30\uB85D \uC124\uC815"}),new k.Setting(t).setName("\uAE30\uBCF8 \uBAA9\uD45C \uC2DC\uAC04").setDesc("\uD559\uC2B5 \uD56D\uBAA9\uC758 \uAE30\uBCF8 \uBAA9\uD45C \uC2DC\uAC04 (\uBD84)").addText(e=>e.setPlaceholder("30").setValue(String(this.plugin.settings.defaultStudyDuration)).onChange(async r=>{let a=parseInt(r)||30;this.plugin.settings.defaultStudyDuration=Math.max(1,Math.min(480,a)),await this.plugin.saveSettings()})),new k.Setting(t).setName("\uD3EC\uBAA8\uB3C4\uB85C \uBAA8\uB4DC").setDesc("25\uBD84 \uD559\uC2B5 + 5\uBD84 \uD734\uC2DD \uC0AC\uC774\uD074 \uD65C\uC131\uD654").addToggle(e=>e.setValue(this.plugin.settings.enablePomodoro).onChange(async r=>{this.plugin.settings.enablePomodoro=r,await this.plugin.saveSettings()})),this.plugin.settings.enablePomodoro&&(new k.Setting(t).setName("\uC791\uC5C5 \uC2DC\uAC04").setDesc("\uD3EC\uBAA8\uB3C4\uB85C \uC791\uC5C5 \uC2DC\uAC04 (\uBD84)").addText(e=>e.setPlaceholder("25").setValue(String(this.plugin.settings.pomodoroWork)).onChange(async r=>{let a=parseInt(r)||25;this.plugin.settings.pomodoroWork=Math.max(1,Math.min(60,a)),await this.plugin.saveSettings()})),new k.Setting(t).setName("\uD734\uC2DD \uC2DC\uAC04").setDesc("\uD3EC\uBAA8\uB3C4\uB85C \uD734\uC2DD \uC2DC\uAC04 (\uBD84)").addText(e=>e.setPlaceholder("5").setValue(String(this.plugin.settings.pomodoroBreak)).onChange(async r=>{let a=parseInt(r)||5;this.plugin.settings.pomodoroBreak=Math.max(1,Math.min(30,a)),await this.plugin.saveSettings()}))),this.renderSubjectManager(t)}renderSubjectManager(t){let e=t.createDiv({cls:"subject-manager"});new k.Setting(e).setName("\uACFC\uBAA9 \uAD00\uB9AC").setDesc("\uC790\uC8FC \uC0AC\uC6A9\uD558\uB294 \uACFC\uBAA9\uC744 \uAD00\uB9AC\uD569\uB2C8\uB2E4").addButton(a=>a.setButtonText("+ \uACFC\uBAA9 \uCD94\uAC00").onClick(async()=>{this.plugin.settings.subjects.push({name:"\uC0C8 \uACFC\uBAA9",icon:"\u{1F4DA}",color:"#808080"}),await this.plugin.saveSettings(),this.display()}));let r=e.createDiv({cls:"subject-list"});for(let a=0;a<this.plugin.settings.subjects.length;a++){let n=this.plugin.settings.subjects[a];if(!n)continue;let o=r.createDiv({cls:"subject-row"}),i=o.createEl("input",{type:"text",value:n.icon,cls:"subject-icon-input"});i.maxLength=2,i.addEventListener("change",async()=>{n.icon=i.value||"\u{1F4DA}",await this.plugin.saveSettings()});let l=o.createEl("input",{type:"text",value:n.name,cls:"subject-name-input"});l.addEventListener("change",async()=>{n.name=l.value||"\uACFC\uBAA9",await this.plugin.saveSettings()});let d=o.createEl("input",{type:"color",value:n.color,cls:"subject-color-input"});d.addEventListener("change",async()=>{n.color=d.value,await this.plugin.saveSettings()}),o.createEl("button",{text:"\u{1F5D1}",cls:"subject-delete-btn"}).addEventListener("click",async()=>{this.plugin.settings.subjects.splice(a,1),await this.plugin.saveSettings(),this.display()})}}renderWorkoutSettings(t){t.createEl("h3",{text:"\uC6B4\uB3D9 \uAE30\uB85D \uC124\uC815"}),new k.Setting(t).setName("\uAE30\uBCF8 \uD734\uC2DD \uC2DC\uAC04").setDesc("\uC6B4\uB3D9 \uC138\uD2B8 \uC0AC\uC774 \uAE30\uBCF8 \uD734\uC2DD \uC2DC\uAC04 (\uCD08)").addText(e=>e.setPlaceholder("60").setValue(String(this.plugin.settings.defaultRestDuration)).onChange(async r=>{let a=parseInt(r)||60;this.plugin.settings.defaultRestDuration=Math.max(10,Math.min(300,a)),await this.plugin.saveSettings()})),this.renderWorkoutTemplateManager(t)}renderWorkoutTemplateManager(t){let e=t.createDiv({cls:"template-manager"});new k.Setting(e).setName("\uC6B4\uB3D9 \uD15C\uD50C\uB9BF \uAD00\uB9AC").setDesc("\uBE60\uB978 \uD15C\uD50C\uB9BF\uC5D0 \uD45C\uC2DC\uB418\uB294 \uC6B4\uB3D9 \uC138\uD2B8\uB97C \uAD00\uB9AC\uD569\uB2C8\uB2E4").addButton(a=>a.setButtonText("+ \uD15C\uD50C\uB9BF \uCD94\uAC00").onClick(async()=>{this.plugin.settings.workoutTemplates.push({name:"\uC0C8 \uD15C\uD50C\uB9BF",exercises:[{name:"\uC6B4\uB3D9\uBA85",params:"\uD69F\uC218: [10]"}]}),await this.plugin.saveSettings(),this.display()}));let r=e.createDiv({cls:"template-list"});this.plugin.settings.workoutTemplates||(this.plugin.settings.workoutTemplates=[...ke]);for(let a=0;a<this.plugin.settings.workoutTemplates.length;a++){let n=this.plugin.settings.workoutTemplates[a];if(!n)continue;let o=r.createDiv({cls:"template-item"}),i=o.createDiv({cls:"template-header-row"}),l=i.createEl("input",{type:"text",value:n.name,cls:"template-name-input"});l.addEventListener("change",async()=>{n.name=l.value||"\uD15C\uD50C\uB9BF",await this.plugin.saveSettings()}),i.createEl("button",{text:"\uC0AD\uC81C",cls:"template-delete-btn"}).addEventListener("click",async()=>{this.plugin.settings.workoutTemplates.splice(a,1),await this.plugin.saveSettings(),this.display()});let c=o.createDiv({cls:"template-exercise-list"});for(let p=0;p<n.exercises.length;p++){let m=n.exercises[p];if(!m)continue;let g=c.createDiv({cls:"template-exercise-row"}),h=g.createEl("input",{type:"text",value:m.name,placeholder:"\uC6B4\uB3D9\uBA85",cls:"template-exercise-name"});h.addEventListener("change",async()=>{m.name=h.value||"\uC6B4\uB3D9",await this.plugin.saveSettings()});let y=g.createEl("input",{type:"text",value:m.params,placeholder:"\uBB34\uAC8C: [60]kg | \uD69F\uC218: [10]",cls:"template-exercise-params"});y.addEventListener("change",async()=>{m.params=y.value||"",await this.plugin.saveSettings()}),g.createEl("button",{text:"\xD7",cls:"template-exercise-delete"}).addEventListener("click",async()=>{n.exercises.splice(p,1),await this.plugin.saveSettings(),this.display()})}o.createEl("button",{text:"+ \uC6B4\uB3D9 \uCD94\uAC00",cls:"template-add-exercise"}).addEventListener("click",async()=>{n.exercises.push({name:"\uC6B4\uB3D9\uBA85",params:"\uD69F\uC218: [10]"}),await this.plugin.saveSettings(),this.display()})}}renderTimerStyleSettings(t){t.createEl("h3",{text:"\uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C"});let e=[{value:"digital",label:"\uB514\uC9C0\uD138 (00:00:00)"},{value:"pomodoro",label:"\uBF40\uBAA8\uB3C4\uB85C (25/5 \uC0AC\uC774\uD074)"},{value:"analog",label:"\uC544\uB0A0\uB85C\uADF8 (\uC6D0\uD615 \uC2DC\uACC4)"}];new k.Setting(t).setName("\uACF5\uD1B5 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").setDesc("\uBAA8\uB4E0 \uAE30\uB85D \uC720\uD615\uC5D0 \uC801\uC6A9\uB418\uB294 \uAE30\uBCF8 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(r=>{for(let a of e)r.addOption(a.value,a.label);r.setValue(this.plugin.settings.timerStyle).onChange(async a=>{this.plugin.settings.timerStyle=a,await this.plugin.saveSettings()})}),new k.Setting(t).setName("\uC720\uD615\uBCC4 \uAC1C\uBCC4 \uC124\uC815").setDesc("\uD559\uC2B5/\uC5C5\uBB34/\uC6B4\uB3D9 \uAE30\uB85D\uB9C8\uB2E4 \uB2E4\uB978 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C \uC0AC\uC6A9").addToggle(r=>r.setValue(this.plugin.settings.usePerTypeTimerStyle).onChange(async a=>{this.plugin.settings.usePerTypeTimerStyle=a,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.usePerTypeTimerStyle&&(new k.Setting(t).setName("\uD559\uC2B5 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uD559\uC2B5 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(r=>{for(let a of e)r.addOption(a.value,a.label);r.setValue(this.plugin.settings.studyTimerStyle).onChange(async a=>{this.plugin.settings.studyTimerStyle=a,await this.plugin.saveSettings()})}),new k.Setting(t).setName("\uC5C5\uBB34 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uC5C5\uBB34 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(r=>{for(let a of e)r.addOption(a.value,a.label);r.setValue(this.plugin.settings.workTimerStyle).onChange(async a=>{this.plugin.settings.workTimerStyle=a,await this.plugin.saveSettings()})}),new k.Setting(t).setName("\uC6B4\uB3D9 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uC6B4\uB3D9 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(r=>{for(let a of e)r.addOption(a.value,a.label);r.setValue(this.plugin.settings.workoutTimerStyle).onChange(async a=>{this.plugin.settings.workoutTimerStyle=a,await this.plugin.saveSettings()})}))}renderUISettings(t){t.createEl("h3",{text:"UI \uC124\uC815"}),new k.Setting(t).setName("\uAE30\uBCF8 \uD0ED").setDesc("\uC0C8 \uAE30\uB85D \uBAA8\uB2EC\uC744 \uC5F4 \uB54C \uAE30\uBCF8\uC73C\uB85C \uC120\uD0DD\uB418\uB294 \uD0ED").addDropdown(e=>e.addOption("study","\uD559\uC2B5 \uAE30\uB85D").addOption("workout","\uC6B4\uB3D9 \uAE30\uB85D").setValue(this.plugin.settings.defaultTab).onChange(async r=>{this.plugin.settings.defaultTab=r,await this.plugin.saveSettings()})),new k.Setting(t).setName("\uB9AC\uBCF8 \uC544\uC774\uCF58").setDesc("\uC67C\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uBE60\uB978 \uC811\uADFC \uC544\uC774\uCF58 \uD45C\uC2DC").addToggle(e=>e.setValue(this.plugin.settings.showRibbonIcon).onChange(async r=>{this.plugin.settings.showRibbonIcon=r,await this.plugin.saveSettings(),this.plugin.updateRibbonIcon()}))}renderNotificationSettings(t){t.createEl("h3",{text:"\u{1F514} \uC54C\uB9BC \uC124\uC815"}),new k.Setting(t).setName("\uD0C0\uC774\uBA38 \uC644\uB8CC\uC74C").setDesc("\uCE74\uC6B4\uD2B8\uB2E4\uC6B4 \uC644\uB8CC \uC2DC \uC54C\uB9BC\uC74C \uC7AC\uC0DD").addToggle(e=>e.setValue(this.plugin.settings.enableTimerSound).onChange(async r=>{this.plugin.settings.enableTimerSound=r,await this.plugin.saveSettings()})),new k.Setting(t).setName("\uC2DC\uC2A4\uD15C \uC54C\uB9BC").setDesc("\uD0C0\uC774\uBA38 \uC644\uB8CC \uC2DC \uC2DC\uC2A4\uD15C \uC54C\uB9BC \uD45C\uC2DC").addToggle(e=>e.setValue(this.plugin.settings.enableNotifications).onChange(async r=>{this.plugin.settings.enableNotifications=r,await this.plugin.saveSettings()}))}renderAISettings(t){t.createEl("h3",{text:"\u{1F916} AI \uBD84\uC11D \uC124\uC815"});let e=this.plugin.settings.aiAnalysis;new k.Setting(t).setName("AI Provider").setDesc("\uBD84\uC11D\uC5D0 \uC0AC\uC6A9\uD560 AI \uC11C\uBE44\uC2A4\uB97C \uC120\uD0DD\uD569\uB2C8\uB2E4").addDropdown(r=>r.addOption("openai","OpenAI (GPT-4)").addOption("gemini","Google Gemini").addOption("grok","xAI Grok").addOption("openrouter","OpenRouter").setValue(e.defaultProvider).onChange(async a=>{e.defaultProvider=a,await this.plugin.saveSettings(),this.display()})),this.renderOpenAISettings(t,e),this.renderGeminiSettings(t,e),this.renderGrokSettings(t,e),this.renderOpenRouterSettings(t,e),this.renderReportSettings(t,e)}renderOpenAISettings(t,e){let r=e.defaultProvider==="openai",a=t.createDiv({cls:`ai-provider-section ${r?"active":"collapsed"}`});new k.Setting(a).setName("\u25B6 OpenAI \uC124\uC815").setDesc(r?"\uD604\uC7AC \uC0AC\uC6A9 \uC911":"\uD074\uB9AD\uD558\uC5EC \uD655\uC7A5").setClass("ai-provider-header").addButton(n=>n.setButtonText("\uC5F0\uACB0 \uD14C\uC2A4\uD2B8").setDisabled(!e.openaiApiKey).onClick(async()=>{await this.testOpenAIConnection(e)})),(r||e.openaiApiKey)&&(new k.Setting(a).setName("API Key").setDesc("OpenAI API \uD0A4").addText(n=>n.setPlaceholder("sk-...").setValue(e.openaiApiKey?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async o=>{o&&!o.startsWith("\u2022\u2022")&&(e.openaiApiKey=o,await this.plugin.saveSettings())})),new k.Setting(a).setName("\uBAA8\uB378").setDesc("\uC0AC\uC6A9\uD560 OpenAI \uBAA8\uB378").addDropdown(n=>n.addOption("gpt-4o","GPT-4o (\uCD94\uCC9C)").addOption("gpt-4o-mini","GPT-4o Mini (\uBE60\uB984)").addOption("gpt-4-turbo","GPT-4 Turbo").addOption("gpt-4","GPT-4").setValue(e.openaiModel).onChange(async o=>{e.openaiModel=o,await this.plugin.saveSettings()})))}renderGeminiSettings(t,e){let r=e.defaultProvider==="gemini",a=t.createDiv({cls:`ai-provider-section ${r?"active":"collapsed"}`});new k.Setting(a).setName("\u25B6 Google Gemini \uC124\uC815").setDesc(r?"\uD604\uC7AC \uC0AC\uC6A9 \uC911":"\uD074\uB9AD\uD558\uC5EC \uD655\uC7A5").setClass("ai-provider-header").addButton(n=>n.setButtonText("\uC5F0\uACB0 \uD14C\uC2A4\uD2B8").setDisabled(!e.geminiApiKey).onClick(async()=>{await this.testGeminiConnection(e)})),(r||e.geminiApiKey)&&(new k.Setting(a).setName("API Key").setDesc("Google AI Studio API \uD0A4").addText(n=>n.setPlaceholder("AIza...").setValue(e.geminiApiKey?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async o=>{o&&!o.startsWith("\u2022\u2022")&&(e.geminiApiKey=o,await this.plugin.saveSettings())})),new k.Setting(a).setName("\uBAA8\uB378").setDesc("\uC0AC\uC6A9\uD560 Gemini \uBAA8\uB378").addDropdown(n=>n.addOption("gemini-2.0-flash","Gemini 2.0 Flash (\uCD94\uCC9C)").addOption("gemini-1.5-pro","Gemini 1.5 Pro").addOption("gemini-1.5-flash","Gemini 1.5 Flash").setValue(e.geminiModel).onChange(async o=>{e.geminiModel=o,await this.plugin.saveSettings()})))}renderGrokSettings(t,e){let r=e.defaultProvider==="grok",a=t.createDiv({cls:`ai-provider-section ${r?"active":"collapsed"}`});new k.Setting(a).setName("\u25B6 xAI Grok \uC124\uC815").setDesc(r?"\uD604\uC7AC \uC0AC\uC6A9 \uC911":"\uD074\uB9AD\uD558\uC5EC \uD655\uC7A5").setClass("ai-provider-header").addButton(n=>n.setButtonText("\uC5F0\uACB0 \uD14C\uC2A4\uD2B8").setDisabled(!e.grokApiKey).onClick(async()=>{await this.testGrokConnection(e)})),(r||e.grokApiKey)&&(new k.Setting(a).setName("API Key").setDesc("xAI API \uD0A4").addText(n=>n.setPlaceholder("xai-...").setValue(e.grokApiKey?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async o=>{o&&!o.startsWith("\u2022\u2022")&&(e.grokApiKey=o,await this.plugin.saveSettings())})),new k.Setting(a).setName("\uBAA8\uB378").setDesc("\uC0AC\uC6A9\uD560 Grok \uBAA8\uB378").addDropdown(n=>n.addOption("grok-3","Grok 3 (\uCD94\uCC9C)").addOption("grok-2","Grok 2").setValue(e.grokModel).onChange(async o=>{e.grokModel=o,await this.plugin.saveSettings()})))}renderOpenRouterSettings(t,e){let r=e.defaultProvider==="openrouter",a=t.createDiv({cls:`ai-provider-section ${r?"active":"collapsed"}`});if(new k.Setting(a).setName("\u25B6 OpenRouter \uC124\uC815").setDesc(r?"\uD604\uC7AC \uC0AC\uC6A9 \uC911 - \uB2E4\uC591\uD55C \uBAA8\uB378 \uC120\uD0DD \uAC00\uB2A5":"\uD074\uB9AD\uD558\uC5EC \uD655\uC7A5").setClass("ai-provider-header").addButton(n=>n.setButtonText("\uC5F0\uACB0 \uD14C\uC2A4\uD2B8").setDisabled(!e.openRouterApiKey).onClick(async()=>{await this.testOpenRouterConnection(e)})),r||e.openRouterApiKey){new k.Setting(a).setName("API Key").setDesc("OpenRouter API \uD0A4").addText(l=>l.setPlaceholder("sk-or-...").setValue(e.openRouterApiKey?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async d=>{d&&!d.startsWith("\u2022\u2022")&&(e.openRouterApiKey=d,await this.plugin.saveSettings())})),new k.Setting(a).setName("\uAE30\uBCF8 \uBAA8\uB378").setDesc("\uC0AC\uC6A9\uD560 OpenRouter \uBAA8\uB378 ID (\uC608: anthropic/claude-3.5-sonnet)").addText(l=>l.setPlaceholder("anthropic/claude-3.5-sonnet").setValue(e.openRouterModel).onChange(async d=>{e.openRouterModel=d||"anthropic/claude-3.5-sonnet",await this.plugin.saveSettings()}));let n=a.createDiv({cls:"custom-models-section"});new k.Setting(n).setName("\uCD94\uAC00 \uBAA8\uB378 \uAD00\uB9AC").setDesc("\uC790\uC8FC \uC0AC\uC6A9\uD558\uB294 \uBAA8\uB378\uC744 \uCD94\uAC00\uD569\uB2C8\uB2E4").addButton(l=>l.setButtonText("+ \uBAA8\uB378 \uCD94\uAC00").onClick(async()=>{e.openRouterCustomModels.push(""),await this.plugin.saveSettings(),this.display()}));let o=["anthropic/claude-3.5-sonnet","anthropic/claude-3-opus","google/gemini-pro-1.5","meta-llama/llama-3.1-405b-instruct","mistralai/mistral-large"],i=n.createDiv({cls:"model-list"});for(let l=0;l<e.openRouterCustomModels.length;l++){let d=i.createDiv({cls:"model-row"}),c=d.createEl("input",{type:"text",value:e.openRouterCustomModels[l],placeholder:"model/name",cls:"model-input"});c.addEventListener("change",async()=>{e.openRouterCustomModels[l]=c.value,await this.plugin.saveSettings()}),d.createEl("button",{text:"\xD7",cls:"model-delete-btn"}).addEventListener("click",async()=>{e.openRouterCustomModels.splice(l,1),await this.plugin.saveSettings(),this.display()})}new k.Setting(n).setName("\uCD94\uCC9C \uBAA8\uB378").setDesc("\uC790\uC8FC \uC0AC\uC6A9\uB418\uB294 \uBAA8\uB378 \uBAA9\uB85D").addDropdown(l=>{l.addOption("","-- \uC120\uD0DD\uD558\uC5EC \uCD94\uAC00 --");for(let d of o)e.openRouterCustomModels.includes(d)||l.addOption(d,d);l.onChange(async d=>{d&&(e.openRouterCustomModels.push(d),await this.plugin.saveSettings(),this.display())})})}}renderReportSettings(t,e){t.createEl("h4",{text:"\u{1F4CA} \uB9AC\uD3EC\uD2B8 \uC124\uC815"}),new k.Setting(t).setName("\uC800\uC7A5 \uACBD\uB85C").setDesc("AI \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uAC00 \uC800\uC7A5\uB420 \uD3F4\uB354 \uACBD\uB85C").addText(r=>r.setPlaceholder("Life Logs/Reports").setValue(e.reportSavePath).onChange(async a=>{e.reportSavePath=a||"Life Logs/Reports",await this.plugin.saveSettings()})),new k.Setting(t).setName("\uD30C\uC77C\uBA85 \uD615\uC2DD").setDesc("\uB9AC\uD3EC\uD2B8 \uD30C\uC77C\uBA85 \uD615\uC2DD ({{category}}, {{date}} \uC0AC\uC6A9 \uAC00\uB2A5)").addText(r=>r.setPlaceholder("{{category}}_{{date}}_report").setValue(e.reportNaming).onChange(async a=>{e.reportNaming=a||"{{category}}_{{date}}_report",await this.plugin.saveSettings()})),new k.Setting(t).setName("\uC790\uB3D9 \uBD84\uC11D").setDesc("\uC790\uB3D9 \uBD84\uC11D \uC77C\uC815 \uC124\uC815").addDropdown(r=>r.addOption("manual","\uC218\uB3D9 \uC2E4\uD589\uB9CC").addOption("daily","\uB9E4\uC77C").addOption("weekly","\uB9E4\uC8FC").setValue(e.analysisSchedule).onChange(async a=>{e.analysisSchedule=a,e.autoAnalysis=a!=="manual",await this.plugin.saveSettings()}))}async testOpenAIConnection(t){var e;new k.Notice("OpenAI \uC5F0\uACB0 \uD14C\uC2A4\uD2B8 \uC911...");try{let r=await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${t.openaiApiKey}`}});if(r.ok)new k.Notice("\u2705 OpenAI \uC5F0\uACB0 \uC131\uACF5!");else{let a=await r.json();new k.Notice(`\u274C OpenAI \uC5F0\uACB0 \uC2E4\uD328: ${((e=a.error)==null?void 0:e.message)||r.statusText}`)}}catch(r){new k.Notice(`\u274C OpenAI \uC5F0\uACB0 \uC2E4\uD328: ${r instanceof Error?r.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}}async testGeminiConnection(t){var e;new k.Notice("Gemini \uC5F0\uACB0 \uD14C\uC2A4\uD2B8 \uC911...");try{let r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${t.geminiApiKey}`);if(r.ok)new k.Notice("\u2705 Gemini \uC5F0\uACB0 \uC131\uACF5!");else{let a=await r.json();new k.Notice(`\u274C Gemini \uC5F0\uACB0 \uC2E4\uD328: ${((e=a.error)==null?void 0:e.message)||r.statusText}`)}}catch(r){new k.Notice(`\u274C Gemini \uC5F0\uACB0 \uC2E4\uD328: ${r instanceof Error?r.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}}async testGrokConnection(t){var e;new k.Notice("Grok \uC5F0\uACB0 \uD14C\uC2A4\uD2B8 \uC911...");try{let r=await fetch("https://api.x.ai/v1/models",{headers:{Authorization:`Bearer ${t.grokApiKey}`}});if(r.ok)new k.Notice("\u2705 Grok \uC5F0\uACB0 \uC131\uACF5!");else{let a=await r.json();new k.Notice(`\u274C Grok \uC5F0\uACB0 \uC2E4\uD328: ${((e=a.error)==null?void 0:e.message)||r.statusText}`)}}catch(r){new k.Notice(`\u274C Grok \uC5F0\uACB0 \uC2E4\uD328: ${r instanceof Error?r.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}}async testOpenRouterConnection(t){var e,r,a;new k.Notice("OpenRouter \uC5F0\uACB0 \uD14C\uC2A4\uD2B8 \uC911...");try{let n=await fetch("https://openrouter.ai/api/v1/auth/key",{headers:{Authorization:`Bearer ${t.openRouterApiKey}`}});if(n.ok){let o=await n.json();new k.Notice(`\u2705 OpenRouter \uC5F0\uACB0 \uC131\uACF5! (\uD06C\uB808\uB527: $${((r=(e=o.data)==null?void 0:e.limit_remaining)==null?void 0:r.toFixed(2))||"N/A"})`)}else{let o=await n.json();new k.Notice(`\u274C OpenRouter \uC5F0\uACB0 \uC2E4\uD328: ${((a=o.error)==null?void 0:a.message)||n.statusText}`)}}catch(n){new k.Notice(`\u274C OpenRouter \uC5F0\uACB0 \uC2E4\uD328: ${n instanceof Error?n.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}}};var Gt=require("obsidian");var ve=class{constructor(t,e){this.selectedSubject=null;this.taskInputs=[];this.container=t,this.ctx=e}render(){this.container.empty(),this.container.addClass("study-log-tab"),this.renderSubjectSelector(),this.renderTaskInput(),this.renderCreateButton()}renderSubjectSelector(){var a;let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uACFC\uBAA9 \uC120\uD0DD",cls:"tab-label"});let e=t.createDiv({cls:"subject-grid"});for(let n of this.ctx.settings.subjects){let o=e.createEl("button",{cls:`subject-btn ${((a=this.selectedSubject)==null?void 0:a.name)===n.name?"selected":""}`});o.style.setProperty("--subject-color",n.color),o.createSpan({text:n.name,cls:"subject-name"}),o.addEventListener("click",()=>{this.selectedSubject=n,e.querySelectorAll(".subject-btn").forEach(i=>{i.classList.remove("selected")}),o.classList.add("selected")})}let r=e.createEl("button",{cls:"subject-btn subject-btn-add"});r.createSpan({text:"+"}),r.createSpan({text:"\uC9C1\uC811 \uC785\uB825"}),r.addEventListener("click",()=>{this.showCustomSubjectInput(t)})}showCustomSubjectInput(t){if(t.querySelector(".custom-subject-input"))return;let r=t.createDiv({cls:"custom-subject-input"}),a=r.createEl("input",{type:"text",placeholder:"\uACFC\uBAA9\uBA85 \uC785\uB825..."});a.focus(),a.addEventListener("keydown",n=>{n.key==="Enter"&&a.value.trim()?(this.selectedSubject={name:a.value.trim(),icon:"",color:"#808080"},r.remove(),this.render()):n.key==="Escape"&&r.remove()})}renderTaskInput(){let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uD559\uC2B5 \uD56D\uBAA9",cls:"tab-label"});let e=t.createDiv({cls:"task-input-list"});this.addTaskInputRow(e),t.createEl("button",{cls:"add-task-btn",text:"+ \uD56D\uBAA9 \uCD94\uAC00"}).addEventListener("click",()=>{this.addTaskInputRow(e)})}addTaskInputRow(t){let e=t.createDiv({cls:"task-input-row"}),r=e.createEl("input",{type:"text",placeholder:"\uD559\uC2B5 \uD56D\uBAA9 (\uC608: Chapter 3 \uBCF5\uC2B5)",cls:"task-name-input"});this.taskInputs.push(r);let a=e.createEl("input",{type:"text",placeholder:"\uBAA9\uD45C \uC2DC\uAC04 (\uC608: 30m)",cls:"task-duration-input"});a.value=`${this.ctx.settings.defaultStudyDuration}m`,e.createEl("button",{cls:"task-remove-btn",text:"\xD7"}).addEventListener("click",()=>{let o=this.taskInputs.indexOf(r);o>-1&&this.taskInputs.splice(o,1),e.remove()}),r.focus()}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uD559\uC2B5 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createStudyLog())}async createStudyLog(){if(!this.selectedSubject)return;let t=this.collectTasks();if(t.length===0)return;let e=this.buildCodeBlockContent(t),r=await this.ctx.fileCreator.createLogFile("study",e);this.ctx.onCreated(r)}collectTasks(){let t=[];return this.container.querySelectorAll(".task-input-row").forEach(r=>{let a=r.querySelector(".task-name-input"),n=r.querySelector(".task-duration-input");a!=null&&a.value.trim()&&t.push({name:a.value.trim(),duration:(n==null?void 0:n.value.trim())||`${this.ctx.settings.defaultStudyDuration}m`})}),t}buildCodeBlockContent(t){var o;let e=[],a=new Date().getHours(),n=a<12?"\uC624\uC804":a<18?"\uC624\uD6C4":"\uC800\uB141";e.push(`title: ${n} \uD559\uC2B5`),e.push(`subject: ${((o=this.selectedSubject)==null?void 0:o.name)||"\uAE30\uD0C0"}`),e.push("state: planned"),e.push("---");for(let i of t)e.push(`- [ ] ${i.name} | Duration: [${i.duration}]`);return e.join(`
`)}};var qr={high:"#E74C3C",medium:"#F39C12",low:"#3498DB"},Se=class{constructor(t,e){this.container=t,this.ctx=e}render(){this.container.empty(),this.container.addClass("work-log-tab"),this.renderTitleInput(),this.renderTaskInput(),this.renderCreateButton()}renderTitleInput(){let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uC5C5\uBB34 \uC81C\uBAA9",cls:"tab-label"});let e=t.createEl("input",{type:"text",placeholder:"\uC608: \uC624\uC804 \uC5C5\uBB34, \uD504\uB85C\uC81D\uD2B8 A",cls:"work-title-input"}),a=new Date().getHours(),n=a<12?"\uC624\uC804":a<18?"\uC624\uD6C4":"\uC800\uB141";e.value=`${n} \uC5C5\uBB34`}renderTaskInput(){let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uC5C5\uBB34 \uD56D\uBAA9",cls:"tab-label"});let e=t.createDiv({cls:"work-task-input-list"});this.addTaskInputRow(e),t.createEl("button",{cls:"add-task-btn",text:"+ \uC5C5\uBB34 \uCD94\uAC00"}).addEventListener("click",()=>{this.addTaskInputRow(e)})}addTaskInputRow(t){let e=t.createDiv({cls:"work-task-input-row"}),r=e.createEl("input",{type:"text",placeholder:"\uC5C5\uBB34 \uB0B4\uC6A9 (\uC608: \uAE30\uD68D\uC11C \uC791\uC131)",cls:"work-task-name-input"}),a=e.createEl("select",{cls:"work-task-priority-select"}),n=[{value:"high",label:"\uB192\uC74C"},{value:"medium",label:"\uBCF4\uD1B5"},{value:"low",label:"\uB0AE\uC74C"}];for(let l of n){let d=a.createEl("option",{value:l.value,text:l.label});l.value==="medium"&&(d.selected=!0)}a.addEventListener("change",()=>{let l=qr[a.value];a.style.borderColor=l});let o=e.createEl("input",{type:"text",placeholder:"\uC608\uC0C1 \uC2DC\uAC04 (\uC608: 2h)",cls:"work-task-duration-input"});o.value="1h",e.createEl("button",{cls:"work-task-remove-btn",text:"\xD7"}).addEventListener("click",()=>{e.remove()}),r.focus()}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uC5C5\uBB34 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createWorkLog())}async createWorkLog(){let t=this.collectTasks();if(t.length===0)return;let e=this.container.querySelector(".work-title-input"),r=(e==null?void 0:e.value.trim())||"\uC5C5\uBB34",a=this.buildCodeBlockContent(r,t),n=await this.ctx.fileCreator.createLogFile("work",a);this.ctx.onCreated(n)}collectTasks(){let t=[];return this.container.querySelectorAll(".work-task-input-row").forEach(r=>{let a=r.querySelector(".work-task-name-input"),n=r.querySelector(".work-task-priority-select"),o=r.querySelector(".work-task-duration-input");a!=null&&a.value.trim()&&t.push({name:a.value.trim(),priority:(n==null?void 0:n.value)||"medium",expectedDuration:(o==null?void 0:o.value.trim())||"1h"})}),t}buildCodeBlockContent(t,e){let r=[];r.push(`title: ${t}`),r.push("state: planned"),r.push("---");for(let a of e)r.push(`- [ ] ${a.name} | Priority: ${a.priority} | Expected: [${a.expectedDuration}]`);return r.join(`
`)}};var Te=class{constructor(t,e){this.exerciseInputs=[];this.container=t,this.ctx=e}render(){this.container.empty(),this.container.addClass("workout-log-tab"),this.renderTitleInput(),this.renderExerciseInput(),this.renderQuickTemplates(),this.renderCreateButton()}renderTitleInput(){let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uC6B4\uB3D9 \uC774\uB984",cls:"tab-label"});let e=t.createEl("input",{type:"text",placeholder:"\uC608: \uC544\uCE68 \uC6B4\uB3D9, \uC0C1\uCCB4 \uC6B4\uB3D9",cls:"workout-title-input"}),a=new Date().getHours(),n=a<12?"\uC544\uCE68":a<18?"\uC624\uD6C4":"\uC800\uB141";e.value=`${n} \uC6B4\uB3D9`}renderExerciseInput(){let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uC6B4\uB3D9 \uD56D\uBAA9",cls:"tab-label"});let e=t.createDiv({cls:"exercise-input-list"});this.addExerciseInputRow(e),t.createEl("button",{cls:"add-exercise-btn",text:"+ \uC6B4\uB3D9 \uCD94\uAC00"}).addEventListener("click",()=>{this.addExerciseInputRow(e)})}addExerciseInputRow(t){let e=t.createDiv({cls:"exercise-input-row"}),r=e.createEl("input",{type:"text",placeholder:"\uC6B4\uB3D9\uBA85 (\uC608: \uC2A4\uCFFC\uD2B8)",cls:"exercise-name-input"}),a=e.createEl("input",{type:"text",placeholder:"\uBB34\uAC8C: [60]kg | \uD69F\uC218: [10]",cls:"exercise-params-input"});e.createEl("button",{cls:"exercise-remove-btn",text:"\xD7"}).addEventListener("click",()=>{e.remove()}),r.focus()}renderQuickTemplates(){var n;let t=this.container.createDiv({cls:"tab-section"});t.createEl("label",{text:"\uBE60\uB978 \uD15C\uD50C\uB9BF",cls:"tab-label"});let e=t.createDiv({cls:"template-grid"}),r=[{name:"\uC0C1\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uD478\uC2DC\uC5C5",params:"\uD69F\uC218: [15]"},{name:"\uB364\uBCA8 \uB85C\uC6B0",params:"\uBB34\uAC8C: [10]kg | \uD69F\uC218: [12]"},{name:"\uC204\uB354 \uD504\uB808\uC2A4",params:"\uBB34\uAC8C: [8]kg | \uD69F\uC218: [10]"}]},{name:"\uD558\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uC2A4\uCFFC\uD2B8",params:"\uBB34\uAC8C: [40]kg | \uD69F\uC218: [12]"},{name:"\uB7F0\uC9C0",params:"\uD69F\uC218: [10] /\uB2E4\uB9AC"},{name:"\uCE74\uD504\uB808\uC774\uC988",params:"\uD69F\uC218: [20]"}]},{name:"HIIT",exercises:[{name:"\uBC84\uD53C",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uC810\uD551\uC7AD",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uB9C8\uC6B4\uD2F4 \uD074\uB77C\uC774\uBA38",params:"\uC2DC\uAC04: [30\uCD08]"}]}],a=((n=this.ctx.settings.workoutTemplates)==null?void 0:n.length)>0?this.ctx.settings.workoutTemplates:r;for(let o of a){let i=e.createEl("button",{cls:"template-btn"});i.createSpan({text:o.name}),i.addEventListener("click",()=>{this.applyTemplate(o)})}}applyTemplate(t){let e=this.container.querySelector(".workout-title-input");e&&(e.value=t.name);let r=this.container.querySelector(".exercise-input-list");if(r){r.empty();for(let a of t.exercises)this.addExerciseInputRowWithData(r,a)}}addExerciseInputRowWithData(t,e){let r=t.createDiv({cls:"exercise-input-row"}),a=r.createEl("input",{type:"text",placeholder:"\uC6B4\uB3D9\uBA85",cls:"exercise-name-input"});a.value=e.name;let n=r.createEl("input",{type:"text",placeholder:"\uD30C\uB77C\uBBF8\uD130",cls:"exercise-params-input"});n.value=e.params,r.createEl("button",{cls:"exercise-remove-btn",text:"\xD7"}).addEventListener("click",()=>{r.remove()})}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uC6B4\uB3D9 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createWorkoutLog())}async createWorkoutLog(){let t=this.collectExercises();if(t.length===0)return;let e=this.container.querySelector(".workout-title-input"),r=(e==null?void 0:e.value.trim())||"\uC6B4\uB3D9",a=this.buildCodeBlockContent(r,t),n=await this.ctx.fileCreator.createLogFile("workout",a);this.ctx.onCreated(n)}collectExercises(){let t=[];return this.container.querySelectorAll(".exercise-input-row").forEach(r=>{let a=r.querySelector(".exercise-name-input"),n=r.querySelector(".exercise-params-input");a!=null&&a.value.trim()&&t.push({name:a.value.trim(),params:(n==null?void 0:n.value.trim())||""})}),t}buildCodeBlockContent(t,e){let r=[];r.push(`title: ${t}`),r.push("state: planned"),r.push("startDate:"),r.push("duration:"),r.push(`restDuration: ${this.ctx.settings.defaultRestDuration}s`),r.push("---");for(let a of e)a.params?r.push(`- [ ] ${a.name} | ${a.params}`):r.push(`- [ ] ${a.name}`);return r.join(`
`)}};var B=class extends Gt.Modal{constructor(e,r,a){super(e);this.tabContentEl=null;this.settings=r,this.fileCreator=a,this.activeTab=r.defaultTab}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("quick-log-modal"),this.renderHeader(e),this.renderTabs(e),this.renderTabContent(e)}renderHeader(e){e.createDiv({cls:"modal-header"}).createEl("h2",{text:"Life Log"})}renderTabs(e){let r=e.createDiv({cls:"modal-tabs"});r.createEl("button",{cls:`modal-tab ${this.activeTab==="study"?"active":""}`,text:"\uD559\uC2B5 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="study",this.updateActiveTab(r),this.renderTabContent(e)}),r.createEl("button",{cls:`modal-tab ${this.activeTab==="work"?"active":""}`,text:"\uC5C5\uBB34 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="work",this.updateActiveTab(r),this.renderTabContent(e)}),r.createEl("button",{cls:`modal-tab ${this.activeTab==="workout"?"active":""}`,text:"\uC6B4\uB3D9 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="workout",this.updateActiveTab(r),this.renderTabContent(e)})}updateActiveTab(e){let r=["study","work","workout"];e.querySelectorAll(".modal-tab").forEach((a,n)=>{r[n]===this.activeTab?a.classList.add("active"):a.classList.remove("active")})}renderTabContent(e){this.tabContentEl&&this.tabContentEl.remove(),this.tabContentEl=e.createDiv({cls:"modal-tab-content"});let r=a=>{this.close(),this.app.workspace.getLeaf().openFile(a)};this.activeTab==="study"?new ve(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:r}).render():this.activeTab==="work"?new Se(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:r}).render():new Te(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:r}).render()}onClose(){let{contentEl:e}=this;e.empty()}};var _t=require("obsidian"),xe=class extends _t.Modal{constructor(e,r){super(e);this.focusScore=4;this.comprehensionScore=4;this.notes="";this.onSubmit=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("self-eval-modal"),e.createEl("h2",{text:"\u{1F389} \uD559\uC2B5 \uC644\uB8CC! \uC790\uAC00\uD3C9\uAC00\uB97C \uD574\uC8FC\uC138\uC694"}),this.renderFocusScore(e),this.renderComprehensionScore(e),this.renderNotesInput(e),this.renderButtons(e)}renderFocusScore(e){let r=e.createDiv({cls:"eval-section"});r.createEl("label",{text:"\uC9D1\uC911\uB3C4",cls:"eval-label"});let a=r.createDiv({cls:"eval-stars"});this.renderStarPicker(a,this.focusScore,n=>{this.focusScore=n})}renderComprehensionScore(e){let r=e.createDiv({cls:"eval-section"});r.createEl("label",{text:"\uC774\uD574\uB3C4",cls:"eval-label"});let a=r.createDiv({cls:"eval-stars"});this.renderStarPicker(a,this.comprehensionScore,n=>{this.comprehensionScore=n})}renderStarPicker(e,r,a){for(let n=1;n<=5;n++){let o=e.createSpan({cls:`eval-star ${n<=r?"filled":""}`,text:n<=r?"\u2605":"\u2606"});o.addEventListener("click",()=>{a(n),e.querySelectorAll(".eval-star").forEach((i,l)=>{let d=i;l<n?(d.textContent="\u2605",d.classList.add("filled")):(d.textContent="\u2606",d.classList.remove("filled"))})}),o.addEventListener("mouseenter",()=>{e.querySelectorAll(".eval-star").forEach((i,l)=>{let d=i;l<n&&d.classList.add("hover")})}),o.addEventListener("mouseleave",()=>{e.querySelectorAll(".eval-star").forEach(i=>{i.classList.remove("hover")})})}}renderNotesInput(e){let r=e.createDiv({cls:"eval-section"});r.createEl("label",{text:"\uBA54\uBAA8 (\uC120\uD0DD)",cls:"eval-label"});let a=r.createEl("textarea",{cls:"eval-notes-input",placeholder:"\uC624\uB298 \uD559\uC2B5\uC5D0 \uB300\uD55C \uC9E7\uC740 \uBA54\uBAA8..."});a.rows=3,a.addEventListener("input",()=>{this.notes=a.value})}renderButtons(e){let r=e.createDiv({cls:"eval-buttons"});r.createEl("button",{cls:"eval-btn eval-btn-secondary",text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),r.createEl("button",{cls:"eval-btn eval-btn-primary",text:"\uC800\uC7A5\uD558\uACE0 \uC885\uB8CC"}).addEventListener("click",()=>{this.onSubmit({focusScore:this.focusScore,comprehensionScore:this.comprehensionScore,notes:this.notes||void 0}),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var E=require("obsidian");var pt=[{id:"study-weekly",name:"\uC8FC\uAC04 \uD559\uC2B5 \uB9AC\uD3EC\uD2B8",category:"study",description:"\uC77C\uC8FC\uC77C\uAC04\uC758 \uD559\uC2B5 \uD328\uD134\uACFC \uC131\uACFC\uB97C \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:`\uB2F9\uC2E0\uC740 \uD559\uC2B5 \uD6A8\uC728 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uD559\uC0DD\uC758 \uD559\uC2B5 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uD6A8\uACFC\uC801\uC778 \uD559\uC2B5 \uC804\uB7B5\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.
\uBD84\uC11D \uC2DC \uB2E4\uC74C\uC744 \uACE0\uB824\uD558\uC138\uC694:
- \uACFC\uBAA9\uBCC4 \uD559\uC2B5 \uC2DC\uAC04 \uBD84\uD3EC
- \uC9D1\uC911\uB825\uACFC \uD6A8\uC728\uC131 \uD328\uD134
- \uAC15\uC810\uACFC \uAC1C\uC120\uC774 \uD544\uC694\uD55C \uC601\uC5ED
- \uAD6C\uCCB4\uC801\uC774\uACE0 \uC2E4\uD589 \uAC00\uB2A5\uD55C \uC870\uC5B8`,userPromptTemplate:`\uB2E4\uC74C \uD559\uC2B5 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC8FC\uAC04 \uD559\uC2B5 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uD559\uC2B5 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uD559\uC2B5 \uC2DC\uAC04 \uC694\uC57D (\uCD1D \uC2DC\uAC04, \uC77C\uD3C9\uADE0, \uACFC\uBAA9\uBCC4)
2. \uD559\uC2B5 \uD328\uD134 \uBD84\uC11D (\uC2DC\uAC04\uB300\uBCC4 \uC9D1\uC911\uB3C4, \uD6A8\uC728\uC801\uC778 \uD559\uC2B5 \uC2DC\uAC04)
3. \uACFC\uBAA9\uBCC4 \uC2EC\uCE35 \uBD84\uC11D
4. \uAC15\uC810 \uBC0F \uAC1C\uC120\uC810
5. \uB2E4\uC74C \uC8FC \uCD94\uCC9C \uD559\uC2B5 \uACC4\uD68D

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC694\uC57D","\uD559\uC2B5 \uC2DC\uAC04 \uBD84\uC11D","\uACFC\uBAA9\uBCC4 \uBD84\uC11D","\uAC15\uC810","\uAC1C\uC120\uC810","\uCD94\uCC9C \uACC4\uD68D"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"study-monthly",name:"\uC6D4\uAC04 \uD559\uC2B5 \uB9AC\uD3EC\uD2B8",category:"study",description:"\uD55C \uB2EC\uAC04\uC758 \uD559\uC2B5 \uC131\uACFC\uC640 \uC131\uC7A5\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uD559\uC2B5 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC6D4\uAC04 \uD559\uC2B5 \uB370\uC774\uD130\uB97C \uBD84\uC11D\uD558\uC5EC \uC7A5\uAE30\uC801\uC778 \uC131\uC7A5 \uD2B8\uB80C\uB4DC\uC640 \uBAA9\uD45C \uB2EC\uC131\uB960\uC744 \uD3C9\uAC00\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uD559\uC2B5 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC6D4\uAC04 \uD559\uC2B5 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uD559\uC2B5 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC6D4\uAC04 \uD559\uC2B5 \uC694\uC57D (\uCD1D \uC2DC\uAC04, \uC8FC\uBCC4 \uCD94\uC774)
2. \uBAA9\uD45C \uB2EC\uC131\uB960 \uBD84\uC11D
3. \uC8FC\uBCC4 \uD2B8\uB80C\uB4DC \uBCC0\uD654
4. \uACFC\uBAA9\uBCC4 \uC131\uC7A5 \uBD84\uC11D
5. \uB2E4\uC74C \uB2EC \uBAA9\uD45C \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"month",outputFormat:"markdown",outputSections:["\uC6D4\uAC04 \uC694\uC57D","\uBAA9\uD45C \uB2EC\uC131\uB960","\uD2B8\uB80C\uB4DC \uBD84\uC11D","\uC131\uC7A5 \uBD84\uC11D","\uB2E4\uC74C \uB2EC \uBAA9\uD45C"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"study-subject",name:"\uACFC\uBAA9\uBCC4 \uC2EC\uCE35 \uBD84\uC11D",category:"study",description:"\uD2B9\uC815 \uACFC\uBAA9\uC758 \uD559\uC2B5 \uD328\uD134\uACFC \uD6A8\uC728\uC131\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uACFC\uBAA9\uBCC4 \uD559\uC2B5 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uD2B9\uC815 \uACFC\uBAA9\uC5D0 \uB300\uD55C \uAE4A\uC774 \uC788\uB294 \uBD84\uC11D\uACFC \uB9DE\uCDA4\uD615 \uD559\uC2B5 \uC804\uB7B5\uC744 \uC81C\uACF5\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uD559\uC2B5 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uACFC\uBAA9\uBCC4 \uC2EC\uCE35 \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uD559\uC2B5 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uACFC\uBAA9\uBCC4 \uD559\uC2B5 \uC2DC\uAC04 \uBC0F \uBE48\uB3C4
2. \uAC01 \uACFC\uBAA9\uC758 \uD559\uC2B5 \uD6A8\uC728\uC131 \uD3C9\uAC00
3. \uACFC\uBAA9 \uAC04 \uADE0\uD615 \uBD84\uC11D
4. \uCDE8\uC57D \uACFC\uBAA9 \uC2DD\uBCC4 \uBC0F \uAC1C\uC120 \uBC29\uC548
5. \uACFC\uBAA9\uBCC4 \uB9DE\uCDA4 \uD559\uC2B5 \uC804\uB7B5

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"month",outputFormat:"markdown",outputSections:["\uACFC\uBAA9\uBCC4 \uC694\uC57D","\uD6A8\uC728\uC131 \uBD84\uC11D","\uADE0\uD615 \uBD84\uC11D","\uAC1C\uC120 \uBC29\uC548","\uB9DE\uCDA4 \uC804\uB7B5"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0}],mt=[{id:"workout-weekly",name:"\uC8FC\uAC04 \uC6B4\uB3D9 \uB9AC\uD3EC\uD2B8",category:"workout",description:"\uC77C\uC8FC\uC77C\uAC04\uC758 \uC6B4\uB3D9 \uAE30\uB85D\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uD53C\uD2B8\uB2C8\uC2A4 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC6B4\uB3D9 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uD6A8\uACFC\uC801\uC778 \uD2B8\uB808\uC774\uB2DD \uC804\uB7B5\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC6B4\uB3D9 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC8FC\uAC04 \uC6B4\uB3D9 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC6B4\uB3D9 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC8FC\uAC04 \uC6B4\uB3D9 \uC694\uC57D (\uCD1D \uC6B4\uB3D9 \uC2DC\uAC04, \uD69F\uC218)
2. \uC6B4\uB3D9 \uC720\uD615\uBCC4 \uBD84\uC11D
3. \uC6B4\uB3D9 \uAC15\uB3C4 \uBC0F \uBCFC\uB968 \uBD84\uC11D
4. \uD734\uC2DD \uD328\uD134 \uD3C9\uAC00
5. \uB2E4\uC74C \uC8FC \uC6B4\uB3D9 \uCD94\uCC9C

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC8FC\uAC04 \uC694\uC57D","\uC6B4\uB3D9 \uBD84\uC11D","\uAC15\uB3C4 \uBD84\uC11D","\uD734\uC2DD \uBD84\uC11D","\uCD94\uCC9C \uACC4\uD68D"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"workout-progress",name:"\uC9C4\uCC99\uB3C4 \uBD84\uC11D",category:"workout",description:"\uC6B4\uB3D9 \uC9C4\uD589 \uC0C1\uD669\uACFC \uC131\uACFC\uB97C \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC6B4\uB3D9 \uC131\uACFC \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC6B4\uB3D9 \uAE30\uB85D\uC758 \uC9C4\uCC99\uB3C4\uB97C \uBD84\uC11D\uD558\uC5EC \uC131\uC7A5 \uD2B8\uB80C\uB4DC\uC640 \uAC1C\uC120\uC810\uC744 \uC81C\uC2DC\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC6B4\uB3D9 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC9C4\uCC99\uB3C4 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC6B4\uB3D9 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC804\uBC18\uC801\uC778 \uC9C4\uCC99\uB3C4 \uD3C9\uAC00
2. \uC6B4\uB3D9\uBCC4 \uC131\uACFC \uBCC0\uD654 \uCD94\uC774
3. \uAC1C\uC778 \uAE30\uB85D \uB2EC\uC131 \uD604\uD669
4. \uADFC\uC721 \uADF8\uB8F9\uBCC4 \uBC1C\uB2EC \uC0C1\uD0DC
5. \uD5A5\uD6C4 \uBAA9\uD45C \uBC0F \uC870\uC5B8

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"month",outputFormat:"markdown",outputSections:["\uC9C4\uCC99\uB3C4 \uC694\uC57D","\uC131\uACFC \uCD94\uC774","\uAE30\uB85D \uD604\uD669","\uBC1C\uB2EC \uBD84\uC11D","\uBAA9\uD45C \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"workout-balance",name:"\uC6B4\uB3D9 \uBC38\uB7F0\uC2A4 \uBD84\uC11D",category:"workout",description:"\uADFC\uC721 \uADF8\uB8F9\uBCC4 \uC6B4\uB3D9 \uADE0\uD615\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC6B4\uB3D9 \uADE0\uD615 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uADFC\uC721 \uADF8\uB8F9\uBCC4 \uC6B4\uB3D9 \uBD84\uD3EC\uB97C \uBD84\uC11D\uD558\uC5EC \uADE0\uD615 \uC7A1\uD78C \uD2B8\uB808\uC774\uB2DD\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC6B4\uB3D9 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC6B4\uB3D9 \uBC38\uB7F0\uC2A4 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC6B4\uB3D9 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC804\uCCB4 \uC6B4\uB3D9 \uBD84\uD3EC \uC694\uC57D
2. \uADFC\uC721 \uADF8\uB8F9\uBCC4 \uD6C8\uB828 \uBE44\uC728
3. \uBD88\uADE0\uD615 \uAC10\uC9C0 \uBC0F \uBD84\uC11D
4. \uACFC\uD6C8\uB828/\uBBF8\uD6C8\uB828 \uC601\uC5ED \uC2DD\uBCC4
5. \uADE0\uD615 \uAC1C\uC120 \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"month",outputFormat:"markdown",outputSections:["\uBD84\uD3EC \uC694\uC57D","\uADF8\uB8F9\uBCC4 \uBD84\uC11D","\uBD88\uADE0\uD615 \uAC10\uC9C0","\uC704\uD5D8 \uC601\uC5ED","\uAC1C\uC120 \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0}],gt=[{id:"work-weekly",name:"\uC8FC\uAC04 \uC5C5\uBB34 \uB9AC\uD3EC\uD2B8",category:"work",description:"\uC77C\uC8FC\uC77C\uAC04\uC758 \uC5C5\uBB34 \uD604\uD669\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC5C5\uBB34 \uC0DD\uC0B0\uC131 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC5C5\uBB34 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uD6A8\uC728\uC801\uC778 \uC2DC\uAC04 \uAD00\uB9AC\uC640 \uC0DD\uC0B0\uC131 \uD5A5\uC0C1 \uC804\uB7B5\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC5C5\uBB34 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC8FC\uAC04 \uC5C5\uBB34 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC5C5\uBB34 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC8FC\uAC04 \uC5C5\uBB34 \uC694\uC57D (\uCD1D \uC5C5\uBB34 \uC2DC\uAC04, \uC644\uB8CC \uD0DC\uC2A4\uD06C \uC218)
2. \uC5C5\uBB34 \uCE74\uD14C\uACE0\uB9AC\uBCC4 \uC2DC\uAC04 \uBD84\uBC30
3. \uC0DD\uC0B0\uC131 \uD328\uD134 \uBD84\uC11D
4. \uC608\uC0C1 \uB300\uBE44 \uC2E4\uC81C \uC18C\uC694 \uC2DC\uAC04 \uBE44\uAD50
5. \uB2E4\uC74C \uC8FC \uC5C5\uBB34 \uAC1C\uC120 \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC8FC\uAC04 \uC694\uC57D","\uCE74\uD14C\uACE0\uB9AC \uBD84\uC11D","\uC0DD\uC0B0\uC131 \uBD84\uC11D","\uC2DC\uAC04 \uBE44\uAD50","\uAC1C\uC120 \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"work-productivity",name:"\uC0DD\uC0B0\uC131 \uBD84\uC11D",category:"work",description:"\uC5C5\uBB34 \uC0DD\uC0B0\uC131\uACFC \uD6A8\uC728\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC5C5\uBB34 \uD6A8\uC728 \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC5C5\uBB34 \uD328\uD134\uC744 \uBD84\uC11D\uD558\uC5EC \uC0DD\uC0B0\uC131 \uCD5C\uC801\uD654 \uBC29\uC548\uC744 \uC81C\uC2DC\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC5C5\uBB34 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC0DD\uC0B0\uC131 \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC5C5\uBB34 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC804\uBC18\uC801\uC778 \uC0DD\uC0B0\uC131 \uC810\uC218
2. \uC2DC\uAC04\uB300\uBCC4 \uC0DD\uC0B0\uC131 \uD328\uD134
3. \uC5C5\uBB34 \uC644\uB8CC\uC728 \uBC0F \uC9C0\uC5F0 \uBD84\uC11D
4. \uC9D1\uC911 \uC5C5\uBB34 \uC2DC\uAC04 \uBD84\uC11D
5. \uC0DD\uC0B0\uC131 \uD5A5\uC0C1 \uC804\uB7B5

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC0DD\uC0B0\uC131 \uC810\uC218","\uC2DC\uAC04\uB300 \uBD84\uC11D","\uC644\uB8CC\uC728 \uBD84\uC11D","\uC9D1\uC911 \uC2DC\uAC04","\uD5A5\uC0C1 \uC804\uB7B5"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"work-burnout",name:"\uBC88\uC544\uC6C3 \uC704\uD5D8 \uBD84\uC11D",category:"work",description:"\uACFC\uB85C \uD328\uD134\uACFC \uBC88\uC544\uC6C3 \uC704\uD5D8\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC6CC\uB77C\uBC38 \uC804\uBB38 \uC0C1\uB2F4\uC0AC\uC785\uB2C8\uB2E4. \uC5C5\uBB34 \uD328\uD134\uC744 \uBD84\uC11D\uD558\uC5EC \uBC88\uC544\uC6C3 \uC704\uD5D8\uC744 \uD3C9\uAC00\uD558\uACE0 \uAC74\uAC15\uD55C \uC5C5\uBB34 \uBC29\uC2DD\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC5C5\uBB34 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uBC88\uC544\uC6C3 \uC704\uD5D8 \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC5C5\uBB34 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uBC88\uC544\uC6C3 \uC704\uD5D8\uB3C4 \uD3C9\uAC00 (\uB0AE\uC74C/\uBCF4\uD1B5/\uB192\uC74C)
2. \uC57C\uADFC \uBC0F \uCD08\uACFC \uADFC\uBB34 \uD328\uD134
3. \uD734\uC2DD \uBC0F \uD68C\uBCF5 \uC2DC\uAC04 \uBD84\uC11D
4. \uC2A4\uD2B8\uB808\uC2A4 \uC694\uC778 \uC2DD\uBCC4
5. \uC6CC\uB77C\uBC38 \uAC1C\uC120 \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC704\uD5D8\uB3C4 \uD3C9\uAC00","\uCD08\uACFC \uADFC\uBB34 \uBD84\uC11D","\uD734\uC2DD \uBD84\uC11D","\uC2A4\uD2B8\uB808\uC2A4 \uC694\uC778","\uAC1C\uC120 \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0}],ft=[{id:"meal-weekly",name:"\uC8FC\uAC04 \uC2DD\uB2E8 \uB9AC\uD3EC\uD2B8",category:"meal",description:"\uC77C\uC8FC\uC77C\uAC04\uC758 \uC2DD\uC0AC \uD328\uD134\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC601\uC591 \uBC0F \uC2DD\uC2B5\uAD00 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC2DD\uC0AC \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uAC74\uAC15\uD55C \uC2DD\uC2B5\uAD00 \uD615\uC131\uC744 \uB3D5\uC2B5\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC2DD\uC0AC \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC8FC\uAC04 \uC2DD\uB2E8 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC2DD\uC0AC \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC8FC\uAC04 \uC2DD\uC0AC \uC694\uC57D (\uB07C\uB2C8\uBCC4 \uC2DD\uC0AC \uD69F\uC218)
2. \uC2DD\uC0AC \uADDC\uCE59\uC131 \uBD84\uC11D
3. \uC74C\uC2DD \uB2E4\uC591\uC131 \uD3C9\uAC00
4. \uC2DD\uC0AC \uC2DC\uAC04\uB300 \uD328\uD134
5. \uAC1C\uC120 \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC8FC\uAC04 \uC694\uC57D","\uADDC\uCE59\uC131 \uBD84\uC11D","\uB2E4\uC591\uC131 \uBD84\uC11D","\uC2DC\uAC04\uB300 \uBD84\uC11D","\uAC1C\uC120 \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"meal-pattern",name:"\uC2DD\uC0AC \uD328\uD134 \uBD84\uC11D",category:"meal",description:"\uC2DD\uC0AC \uC2DC\uAC04\uACFC \uADDC\uCE59\uC131\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC2DD\uC2B5\uAD00 \uD328\uD134 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC2DD\uC0AC \uC2DC\uAC04\uACFC \uADDC\uCE59\uC131\uC744 \uBD84\uC11D\uD558\uC5EC \uAC74\uAC15\uD55C \uC2DD\uC0AC \uC2B5\uAD00\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC2DD\uC0AC \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC2DD\uC0AC \uD328\uD134 \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC2DD\uC0AC \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC2DD\uC0AC \uADDC\uCE59\uC131 \uC810\uC218
2. \uB07C\uB2C8\uBCC4 \uC2DD\uC0AC \uC2DC\uAC04 \uBD84\uC11D
3. \uACB0\uC2DD \uD328\uD134 \uBD84\uC11D
4. \uC2DD\uC0AC \uAC04\uACA9 \uBD84\uC11D
5. \uADDC\uCE59\uC801\uC778 \uC2DD\uC0AC\uB97C \uC704\uD55C \uC870\uC5B8

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uADDC\uCE59\uC131 \uC810\uC218","\uC2DC\uAC04 \uBD84\uC11D","\uACB0\uC2DD \uBD84\uC11D","\uAC04\uACA9 \uBD84\uC11D","\uAC1C\uC120 \uC870\uC5B8"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"meal-nutrition",name:"\uC601\uC591 \uBC38\uB7F0\uC2A4 \uBD84\uC11D",category:"meal",description:"\uC74C\uC2DD \uB2E4\uC591\uC131\uACFC \uC601\uC591 \uADE0\uD615\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC601\uC591 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC2DD\uC0AC \uAE30\uB85D\uC5D0\uC11C \uC601\uC591 \uADE0\uD615\uACFC \uB2E4\uC591\uC131\uC744 \uBD84\uC11D\uD558\uC5EC \uAC74\uAC15\uD55C \uC2DD\uB2E8\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC2DD\uC0AC \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC601\uC591 \uBC38\uB7F0\uC2A4 \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC2DD\uC0AC \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC74C\uC2DD \uB2E4\uC591\uC131 \uC810\uC218
2. \uC790\uC8FC \uBA39\uB294 \uC74C\uC2DD TOP 10
3. \uC601\uC591\uC18C \uADE0\uD615 \uCD94\uC815 (\uD0C4\uC218\uD654\uBB3C, \uB2E8\uBC31\uC9C8, \uCC44\uC18C \uB4F1)
4. \uBD80\uC871\uD560 \uC218 \uC788\uB294 \uC601\uC591 \uC694\uC18C
5. \uC2DD\uB2E8 \uAC1C\uC120 \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"month",outputFormat:"markdown",outputSections:["\uB2E4\uC591\uC131 \uC810\uC218","\uBE48\uB3C4 \uBD84\uC11D","\uC601\uC591 \uADE0\uD615","\uBD80\uC871 \uC601\uC591\uC18C","\uAC1C\uC120 \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0}],Jr=[...pt,...mt,...gt,...ft];function ht(s){switch(s){case"study":return pt;case"workout":return mt;case"work":return gt;case"meal":return ft;default:return[]}}var D=class{static render(t,e){let r=t;return r=r.replace(/\{\{period\}\}/g,e.period),r=r.replace(/\{\{category\}\}/g,e.category),r=r.replace(/\{\{recordCount\}\}/g,String(e.recordCount)),r=r.replace(/\{\{totalDuration\}\}/g,e.totalDuration),r=r.replace(/\{\{rawData\}\}/g,e.rawData),r=r.replace(/\{\{summary\}\}/g,e.summary),r=r.replace(/\{\{userName\}\}/g,e.userName||"\uC0AC\uC6A9\uC790"),r=r.replace(/\{\{currentDate\}\}/g,e.currentDate),r}static formatDateRange(t){let e=r=>{let a=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0");return`${a}-${n}-${o}`};return`${e(t.start)} ~ ${e(t.end)}`}static getCurrentDateString(){let t=new Date,e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${r}-${a}`}static formatDuration(t){if(t<60)return`${t}\uCD08`;let e=Math.floor(t/3600),r=Math.floor(t%3600/60),a=t%60,n=[];return e>0&&n.push(`${e}\uC2DC\uAC04`),r>0&&n.push(`${r}\uBD84`),a>0&&e===0&&n.push(`${a}\uCD08`),n.join(" ")||"0\uCD08"}static calculateDateRange(t,e){let r=new Date;r.setHours(23,59,59,999);let a=new Date;switch(a.setHours(0,0,0,0),t){case"day":break;case"week":a.setDate(a.getDate()-6);break;case"month":a.setDate(a.getDate()-29);break;case"quarter":a.setDate(a.getDate()-89);break;case"custom":e&&e>0&&a.setDate(a.getDate()-(e-1));break}return{start:a,end:r}}static validateTemplate(t){let e=[];return(!t.id||t.id.trim()==="")&&e.push("\uD15C\uD50C\uB9BF ID\uAC00 \uD544\uC694\uD569\uB2C8\uB2E4."),(!t.name||t.name.trim()==="")&&e.push("\uD15C\uD50C\uB9BF \uC774\uB984\uC774 \uD544\uC694\uD569\uB2C8\uB2E4."),(!t.userPromptTemplate||t.userPromptTemplate.trim()==="")&&e.push("\uC0AC\uC6A9\uC790 \uD504\uB86C\uD504\uD2B8 \uD15C\uD50C\uB9BF\uC774 \uD544\uC694\uD569\uB2C8\uB2E4."),t.userPromptTemplate.includes("{{rawData}}")||e.push("\uD504\uB86C\uD504\uD2B8\uC5D0 {{rawData}} \uBCC0\uC218\uAC00 \uD3EC\uD568\uB418\uC5B4\uC57C \uD569\uB2C8\uB2E4."),{valid:e.length===0,errors:e}}static getCategoryName(t){switch(t){case"study":return"\uD559\uC2B5";case"workout":return"\uC6B4\uB3D9";case"work":return"\uC5C5\uBB34";case"meal":return"\uC2DD\uB2E8";default:return t}}};var P=class{constructor(t,e){this.apiKey=t,this.model=e}isConfigured(){return!!this.apiKey&&this.apiKey.length>0}getCurrentModel(){return this.model}createResult(t,e,r,a){return{success:t,content:e,metadata:{provider:this.name,model:this.model,tokensUsed:r,generatedAt:new Date().toISOString()},error:a}}createErrorResult(t){let e=t instanceof Error?t.message:String(t);return this.createResult(!1,"",void 0,e)}};async function L(s,t,e=6e4){let r=new AbortController,a=setTimeout(()=>r.abort(),e);try{return await fetch(s,{...t,signal:r.signal})}finally{clearTimeout(a)}}var K=class K extends P{constructor(){super(...arguments);this.name="OpenAI";this.type="openai"}getAvailableModels(){return K.MODELS}async testConnection(){if(!this.isConfigured())return!1;try{return(await L("https://api.openai.com/v1/models",{method:"GET",headers:{Authorization:`Bearer ${this.apiKey}`}},1e4)).ok}catch(e){return!1}}async analyze(e,r){var a,n,o,i,l,d;if(!this.isConfigured())return this.createResult(!1,"",void 0,"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");try{let c=[];r!=null&&r.systemPrompt&&c.push({role:"system",content:r.systemPrompt}),c.push({role:"user",content:e});let u=await L(K.API_URL,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:(r==null?void 0:r.model)||this.model,messages:c,temperature:(a=r==null?void 0:r.temperature)!=null?a:.7,max_tokens:(n=r==null?void 0:r.maxTokens)!=null?n:4096})}),p=await u.json();if(!u.ok||p.error)return this.createResult(!1,"",void 0,((o=p.error)==null?void 0:o.message)||`HTTP ${u.status}`);let m=((l=(i=p.choices[0])==null?void 0:i.message)==null?void 0:l.content)||"",g=(d=p.usage)==null?void 0:d.total_tokens;return this.createResult(!0,m,g)}catch(c){return this.createErrorResult(c)}}};K.API_URL="https://api.openai.com/v1/chat/completions",K.MODELS=["gpt-5.2","gpt-5","o4-mini","o3","gpt-4o","gpt-4o-mini"];var Z=K;var _=class _ extends P{constructor(){super(...arguments);this.name="Gemini";this.type="gemini"}getAvailableModels(){return _.MODELS}async testConnection(){if(!this.isConfigured())return!1;try{return(await L(`${_.API_BASE}?key=${this.apiKey}`,{method:"GET",headers:{}},1e4)).ok}catch(e){return!1}}async analyze(e,r){var a,n,o,i,l,d,c,u,p;if(!this.isConfigured())return this.createResult(!1,"",void 0,"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");try{let m=(r==null?void 0:r.model)||this.model,g=[],h;r!=null&&r.systemPrompt&&(h=r.systemPrompt),g.push({role:"user",parts:[{text:e}]});let y={contents:g,generationConfig:{temperature:(a=r==null?void 0:r.temperature)!=null?a:.7,maxOutputTokens:(n=r==null?void 0:r.maxTokens)!=null?n:8192}};h&&(y.systemInstruction={parts:[{text:h}]});let f=await L(`${_.API_BASE}/${m}:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}),v=await f.json();if(!f.ok||v.error)return this.createResult(!1,"",void 0,((o=v.error)==null?void 0:o.message)||`HTTP ${f.status}`);let S=((u=(c=(d=(l=(i=v.candidates)==null?void 0:i[0])==null?void 0:l.content)==null?void 0:d.parts)==null?void 0:c[0])==null?void 0:u.text)||"",T=(p=v.usageMetadata)==null?void 0:p.totalTokenCount;return this.createResult(!0,S,T)}catch(m){return this.createErrorResult(m)}}};_.API_BASE="https://generativelanguage.googleapis.com/v1beta/models",_.MODELS=["gemini-3-pro-preview","gemini-3-flash-preview","gemini-2.5-pro","gemini-2.5-flash","gemini-2.5-flash-lite"];var ee=_;var Y=class Y extends P{constructor(){super(...arguments);this.name="Grok";this.type="grok"}getAvailableModels(){return Y.MODELS}async testConnection(){if(!this.isConfigured())return!1;try{return(await L("https://api.x.ai/v1/models",{method:"GET",headers:{Authorization:`Bearer ${this.apiKey}`}},1e4)).ok}catch(e){return!1}}async analyze(e,r){var a,n,o,i,l,d;if(!this.isConfigured())return this.createResult(!1,"",void 0,"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");try{let c=[];r!=null&&r.systemPrompt&&c.push({role:"system",content:r.systemPrompt}),c.push({role:"user",content:e});let u=await L(Y.API_URL,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:(r==null?void 0:r.model)||this.model,messages:c,temperature:(a=r==null?void 0:r.temperature)!=null?a:.7,max_tokens:(n=r==null?void 0:r.maxTokens)!=null?n:4096})}),p=await u.json();if(!u.ok||p.error)return this.createResult(!1,"",void 0,((o=p.error)==null?void 0:o.message)||`HTTP ${u.status}`);let m=((l=(i=p.choices[0])==null?void 0:i.message)==null?void 0:l.content)||"",g=(d=p.usage)==null?void 0:d.total_tokens;return this.createResult(!0,m,g)}catch(c){return this.createErrorResult(c)}}};Y.API_URL="https://api.x.ai/v1/chat/completions",Y.MODELS=["grok-4-heavy","grok-4","grok-3","grok-3-mini"];var te=Y;var U=class U extends P{constructor(e,r,a=[]){super(e,r);this.name="OpenRouter";this.type="openrouter";this.customModels=a}getAvailableModels(){let e=[...U.DEFAULT_MODELS];for(let r of this.customModels)r&&!e.includes(r)&&e.push(r);return e}async testConnection(){if(!this.isConfigured())return!1;try{return(await L("https://openrouter.ai/api/v1/auth/key",{method:"GET",headers:{Authorization:`Bearer ${this.apiKey}`}},1e4)).ok}catch(e){return!1}}async getCredits(){var e,r;if(!this.isConfigured())return null;try{let a=await L("https://openrouter.ai/api/v1/auth/key",{method:"GET",headers:{Authorization:`Bearer ${this.apiKey}`}},1e4);return a.ok&&(r=(e=(await a.json()).data)==null?void 0:e.limit_remaining)!=null?r:null}catch(a){return null}}async analyze(e,r){var a,n,o,i,l,d;if(!this.isConfigured())return this.createResult(!1,"",void 0,"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");try{let c=[];r!=null&&r.systemPrompt&&c.push({role:"system",content:r.systemPrompt}),c.push({role:"user",content:e});let u=await L(U.API_URL,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":"https://obsidian.md","X-Title":"Life Log Plugin"},body:JSON.stringify({model:(r==null?void 0:r.model)||this.model,messages:c,temperature:(a=r==null?void 0:r.temperature)!=null?a:.7,max_tokens:(n=r==null?void 0:r.maxTokens)!=null?n:4096})}),p=await u.json();if(!u.ok||p.error)return this.createResult(!1,"",void 0,((o=p.error)==null?void 0:o.message)||`HTTP ${u.status}`);let m=((l=(i=p.choices[0])==null?void 0:i.message)==null?void 0:l.content)||"",g=(d=p.usage)==null?void 0:d.total_tokens;return this.createResult(!0,m,g)}catch(c){return this.createErrorResult(c)}}};U.API_URL="https://openrouter.ai/api/v1/chat/completions",U.DEFAULT_MODELS=["anthropic/claude-sonnet-4","anthropic/claude-opus-4","openai/gpt-5","openai/o3","google/gemini-2.5-pro","google/gemini-3-flash-preview","meta-llama/llama-4-maverick","deepseek/deepseek-r1"];var re=U;var be=class{static createProvider(t,e){switch(t){case"openai":return new Z(e.openaiApiKey,e.openaiModel);case"gemini":return new ee(e.geminiApiKey,e.geminiModel);case"grok":return new te(e.grokApiKey,e.grokModel);case"openrouter":return new re(e.openRouterApiKey,e.openRouterModel,e.openRouterCustomModels);default:throw new Error(`Unknown provider type: ${t}`)}}static createDefaultProvider(t){return this.createProvider(t.defaultProvider,t)}static getConfiguredProviders(t){let e=[];return t.openaiApiKey&&e.push(this.createProvider("openai",t)),t.geminiApiKey&&e.push(this.createProvider("gemini",t)),t.grokApiKey&&e.push(this.createProvider("grok",t)),t.openRouterApiKey&&e.push(this.createProvider("openrouter",t)),e}static getProviderName(t){switch(t){case"openai":return"OpenAI";case"gemini":return"Google Gemini";case"grok":return"xAI Grok";case"openrouter":return"OpenRouter";default:return t}}static isProviderConfigured(t,e){switch(t){case"openai":return!!e.openaiApiKey;case"gemini":return!!e.geminiApiKey;case"grok":return!!e.grokApiKey;case"openrouter":return!!e.openRouterApiKey;default:return!1}}};var A=class{constructor(t,e){this.app=t,this.logFolder=e}async collect(t){let e=[],r=this.app.vault.getMarkdownFiles();for(let a of r)if(!(this.logFolder&&!a.path.startsWith(this.logFolder)))try{let n=await this.app.vault.cachedRead(a),o=this.extractCodeBlocks(n);for(let i of o){let l=this.parseBlock(i.content);if(!l)continue;let d=this.extractDate(l);d&&d>=t.start&&d<=t.end&&e.push({file:a,filePath:a.path,data:l,date:d})}}catch(n){console.error(`Error reading file ${a.path}:`,n)}return e.sort((a,n)=>a.date.getTime()-n.date.getTime()),{logs:e,totalCount:e.length,dateRange:t,category:this.category}}extractCodeBlocks(t){var l;let e=[],r=t.split(`
`),a=!1,n="",o=[],i=0;for(let d=0;d<r.length;d++){let c=(l=r[d])!=null?l:"";if(c.startsWith("```")&&!a){let u=c.slice(3).trim();u===this.codeBlockType&&(a=!0,n=u,o=[],i=d)}else c.startsWith("```")&&a?(n===this.codeBlockType&&e.push({content:o.join(`
`),startLine:i,endLine:d}),a=!1,n="",o=[]):a&&o.push(c)}return e}parseDateString(t){if(!t)return null;let e=t.match(/^(\d{4})-(\d{2})-(\d{2})(?:\s+(\d{2}):(\d{2}))?/);if(e&&e[1]&&e[2]&&e[3]){let r=parseInt(e[1],10),a=parseInt(e[2],10)-1,n=parseInt(e[3],10),o=e[4]?parseInt(e[4],10):0,i=e[5]?parseInt(e[5],10):0;return new Date(r,a,n,o,i)}return null}parseDurationToSeconds(t){if(!t)return 0;let e=0,r=t.match(/(\d+)\s*(?:h|)/);r&&r[1]&&(e+=parseInt(r[1],10)*3600);let a=t.match(/(\d+)\s*(?:m|)/);a&&a[1]&&(e+=parseInt(a[1],10)*60);let n=t.match(/(\d+)\s*(?:s|)/);return n&&n[1]&&(e+=parseInt(n[1],10)),e}};var F=class extends A{constructor(e,r){super(e,r);this.category="study";this.codeBlockType="study-log"}parseBlock(e){try{let r=ce(e);return r.metadata.title||r.tasks.length>0?r:null}catch(r){return console.error("Error parsing study log:",r),null}}extractDate(e){return this.parseDateString(e.metadata.startDate)}async collectForAnalysis(e){let r=await this.collect(e),a=new Map,n=0,o=0,i=[];for(let d of r.logs){let c=d.data,u=c.metadata.subject||"\uAE30\uD0C0",p=this.parseDurationToSeconds(c.metadata.totalDuration);n+=p;let m=a.get(u)||{duration:0,count:0};m.duration+=p,m.count+=1,a.set(u,m),(c.metadata.focusScore!==void 0||c.metadata.comprehensionScore!==void 0)&&i.push({understanding:c.metadata.comprehensionScore||0,effort:c.metadata.focusScore||0,satisfaction:Math.round((c.metadata.focusScore||0)*.5+(c.metadata.comprehensionScore||0)*.5)});let g=c.tasks.filter(h=>h.state==="completed");o+=g.length}let l=Array.from(a.entries()).map(([d,c])=>({subject:d,duration:c.duration,count:c.count}));return l.sort((d,c)=>c.duration-d.duration),{period:e,sessions:r.logs.map(d=>d.data),subjectStats:l,totalStudyTime:n,pomodoroCount:o,scores:i}}toJSON(e){let r=e.logs.map(a=>({date:a.date.toISOString().split("T")[0],title:a.data.metadata.title,subject:a.data.metadata.subject,state:a.data.metadata.state,totalDuration:a.data.metadata.totalDuration,focusScore:a.data.metadata.focusScore,comprehensionScore:a.data.metadata.comprehensionScore,tasks:a.data.tasks.map(n=>({name:n.name,state:n.state,duration:n.recordedDuration})),tags:a.data.metadata.tags}));return JSON.stringify(r,null,2)}};var H=class extends A{constructor(e,r){super(e,r);this.category="workout";this.codeBlockType="life-log"}parseBlock(e){try{let r=ne(e);return r.metadata.title||r.exercises.length>0?r:null}catch(r){return console.error("Error parsing workout log:",r),null}}extractDate(e){return this.parseDateString(e.metadata.startDate)}async collectForAnalysis(e){let r=await this.collect(e),a=new Map,n=0,o=0,i=0;for(let c of r.logs){let u=c.data;i++;let p=this.parseDurationToSeconds(u.metadata.duration);n+=p,u.metadata.state==="completed"&&o++;for(let m of u.exercises){let g=m.name,h=a.get(g)||{totalSets:0,totalReps:0};h.totalSets+=1;let y=m.params.find(f=>f.key.toLowerCase().includes("rep")||f.key.toLowerCase().includes("\uD69F\uC218"));if(y){let f=parseInt(y.value)||0;h.totalReps+=f}a.set(g,h)}}let l=Array.from(a.entries()).map(([c,u])=>({name:c,totalSets:u.totalSets,totalReps:u.totalReps}));l.sort((c,u)=>u.totalSets-c.totalSets);let d=i>0?o/i*100:0;return{period:e,workouts:r.logs.map(c=>c.data),exerciseStats:l,totalDuration:n,completionRate:d}}toJSON(e){let r=e.logs.map(a=>({date:a.date.toISOString().split("T")[0],title:a.data.metadata.title,state:a.data.metadata.state,duration:a.data.metadata.duration,exercises:a.data.exercises.map(n=>({name:n.name,state:n.state,params:n.params.reduce((o,i)=>(o[i.key]=i.value+(i.unit?` ${i.unit}`:""),o),{}),duration:n.recordedDuration}))}));return JSON.stringify(r,null,2)}};var O=class extends A{constructor(e,r){super(e,r);this.category="work";this.codeBlockType="work-log"}parseBlock(e){try{let r=me(e);return r.metadata.title||r.tasks.length>0?r:null}catch(r){return console.error("Error parsing work log:",r),null}}extractDate(e){return this.parseDateString(e.metadata.startDate)}async collectForAnalysis(e){let r=await this.collect(e),a=new Map,n=0,o=0,i=0,l=0;for(let u of r.logs){let p=u.data;l++;let m=this.parseDurationToSeconds(p.metadata.totalDuration);n+=m,p.metadata.state==="completed"&&i++;for(let h of p.tasks)if(h.expectedDuration&&h.actualDuration){let y=h.expectedDuration;this.parseDurationToSeconds(h.actualDuration)>y*1.2&&o++}let g=p.metadata.tags||["\uBBF8\uBD84\uB958"];for(let h of g){let y=a.get(h)||{duration:0,count:0};y.duration+=m/g.length,y.count+=1,a.set(h,y)}}let d=Array.from(a.entries()).map(([u,p])=>({category:u,duration:Math.round(p.duration),count:p.count}));d.sort((u,p)=>p.duration-u.duration);let c=l>0?i/l*100:0;return{period:e,tasks:r.logs.map(u=>u.data),categoryStats:d,totalWorkTime:n,overtimeCount:o,completionRate:c}}toJSON(e){let r=e.logs.map(a=>({date:a.date.toISOString().split("T")[0],title:a.data.metadata.title,state:a.data.metadata.state,totalDuration:a.data.metadata.totalDuration,tasks:a.data.tasks.map(n=>({name:n.name,state:n.state,priority:n.priority,expectedDuration:n.expectedDuration,actualDuration:n.actualDuration,notes:n.notes})),tags:a.data.metadata.tags}));return JSON.stringify(r,null,2)}};var V=class extends A{constructor(e,r){super(e,r);this.category="meal";this.codeBlockType="meal-log"}parseBlock(e){try{let r=he(e);return r.metadata.title||r.foods.length>0?r:null}catch(r){return console.error("Error parsing meal log:",r),null}}extractDate(e){return this.parseDateString(e.metadata.date)}async collectForAnalysis(e){var p;let r=await this.collect(e),a=new Map,n=new Map,o=new Map;for(let m of r.logs){let g=m.data,h=(p=m.date.toISOString().split("T")[0])!=null?p:"",y=g.metadata.mealType;a.set(y,(a.get(y)||0)+1),h&&o.set(h,(o.get(h)||0)+1);for(let f of g.foods){let v=f.name.toLowerCase().trim();n.set(v,(n.get(v)||0)+1)}}let i=[{type:"breakfast",count:a.get("breakfast")||0},{type:"lunch",count:a.get("lunch")||0},{type:"dinner",count:a.get("dinner")||0},{type:"snack",count:a.get("snack")||0}],l=Array.from(n.entries()).map(([m,g])=>({name:m,count:g})).sort((m,g)=>g.count-m.count).slice(0,20),d=o.size,c=0;for(let m of o.values())m>=3&&c++;let u=d>0?Math.round(c/d*100):0;return{period:e,meals:r.logs.map(m=>m.data),mealTypeStats:i,foodFrequency:l,regularityScore:u}}toJSON(e){let r=e.logs.map(a=>({date:a.date.toISOString().split("T")[0],title:a.data.metadata.title,mealType:a.data.metadata.mealType,state:a.data.metadata.state,foods:a.data.foods.map(n=>n.name),notes:a.data.metadata.notes}));return JSON.stringify(r,null,2)}};var ae=class{static createCollector(t,e,r){switch(t){case"study":return new F(e,r);case"workout":return new H(e,r);case"work":return new O(e,r);case"meal":return new V(e,r);default:throw new Error(`Unknown category: ${t}`)}}static createAllCollectors(t,e){let r=new Map;return r.set("study",new F(t,e)),r.set("workout",new H(t,e)),r.set("work",new O(t,e)),r.set("meal",new V(t,e)),r}};function Kt(s,t,e){switch(s){case"study":return t.toJSON(e);case"workout":return t.toJSON(e);case"work":return t.toJSON(e);case"meal":return t.toJSON(e);default:return JSON.stringify(e.logs.map(r=>r.data),null,2)}}var we=class{constructor(t,e,r){this.app=t,this.settings=e,this.logFolder=r}async analyze(t,e){try{e==null||e({stage:"collecting",message:"\uB370\uC774\uD130\uB97C \uC218\uC9D1\uD558\uB294 \uC911...",progress:10});let r=await this.collectData(t.category,t.dateRange);if(r.totalCount===0)return this.createErrorResult("\uC120\uD0DD\uD55C \uAE30\uAC04\uC5D0 \uB370\uC774\uD130\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uB978 \uAE30\uAC04\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.");e==null||e({stage:"processing",message:"\uB370\uC774\uD130\uB97C \uCC98\uB9AC\uD558\uB294 \uC911...",progress:30});let a=await this.processData(t.category,r);e==null||e({stage:"analyzing",message:"AI\uAC00 \uBD84\uC11D\uD558\uB294 \uC911...",progress:50});let n=this.createProvider(t.providerType);if(!n.isConfigured())return this.createErrorResult(`${n.name} API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C API \uD0A4\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694.`);let o=this.buildPrompt(t.template,t.category,t.dateRange,a);e==null||e({stage:"analyzing",message:"AI \uC751\uB2F5\uC744 \uAE30\uB2E4\uB9AC\uB294 \uC911...",progress:70});let i=await n.analyze(o,{systemPrompt:t.template.systemPrompt,model:t.model,temperature:.7,maxTokens:4096});return e==null||e({stage:"completed",message:"\uBD84\uC11D\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!",progress:100}),i}catch(r){return e==null||e({stage:"error",message:r instanceof Error?r.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958",progress:0}),this.createErrorResult(r instanceof Error?r.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.")}}async collectData(t,e){return await ae.createCollector(t,this.app,this.logFolder).collect(e)}async processData(t,e){let r=ae.createCollector(t,this.app,this.logFolder),a=Kt(t,r,e),n=this.generateSummary(t,e),o=await this.calculateTotalDuration(t,e);return{rawData:a,summary:n,totalDuration:o}}generateSummary(t,e){let r=e.totalCount,a=D.getCategoryName(t);switch(t){case"study":return`\uCD1D ${r}\uAC1C\uC758 \uD559\uC2B5 \uC138\uC158\uC774 \uAE30\uB85D\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`;case"workout":return`\uCD1D ${r}\uAC1C\uC758 \uC6B4\uB3D9 \uAE30\uB85D\uC774 \uC788\uC2B5\uB2C8\uB2E4.`;case"work":return`\uCD1D ${r}\uAC1C\uC758 \uC5C5\uBB34 \uAE30\uB85D\uC774 \uC788\uC2B5\uB2C8\uB2E4.`;case"meal":return`\uCD1D ${r}\uAC1C\uC758 \uC2DD\uC0AC \uAE30\uB85D\uC774 \uC788\uC2B5\uB2C8\uB2E4.`;default:return`\uCD1D ${r}\uAC1C\uC758 ${a} \uAE30\uB85D\uC774 \uC788\uC2B5\uB2C8\uB2E4.`}}async calculateTotalDuration(t,e){let r=0;switch(t){case"study":{r=(await new F(this.app,this.logFolder).collectForAnalysis({start:new Date(0),end:new Date})).totalStudyTime;break}case"workout":{r=(await new H(this.app,this.logFolder).collectForAnalysis({start:new Date(0),end:new Date})).totalDuration;break}case"work":{r=(await new O(this.app,this.logFolder).collectForAnalysis({start:new Date(0),end:new Date})).totalWorkTime;break}case"meal":return"\uD574\uB2F9 \uC5C6\uC74C"}return D.formatDuration(r)}buildPrompt(t,e,r,a){let n={period:D.formatDateRange(r),category:e,recordCount:JSON.parse(a.rawData).length,totalDuration:a.totalDuration,rawData:a.rawData,summary:a.summary,currentDate:D.getCurrentDateString()};return D.render(t.userPromptTemplate,n)}createProvider(t){return be.createProvider(t,this.settings)}createErrorResult(t){return{success:!1,content:"",metadata:{provider:"",model:"",generatedAt:new Date().toISOString()},error:t}}getAvailableProviders(){return[{type:"openai",name:"OpenAI",key:this.settings.openaiApiKey},{type:"gemini",name:"Google Gemini",key:this.settings.geminiApiKey},{type:"grok",name:"xAI Grok",key:this.settings.grokApiKey},{type:"openrouter",name:"OpenRouter",key:this.settings.openRouterApiKey}].map(e=>({type:e.type,name:e.name,configured:!!e.key}))}};var Ee=class extends E.Modal{constructor(e,r,a){super(e);this.selectedCategory="study";this.selectedTemplate=null;this.selectedDataRange="week";this.customDays=7;this.resultContainer=null;this.progressContainer=null;this.settings=r,this.logFolder=a,this.selectedProvider=r.defaultProvider,this.engine=new we(e,r,a),this.renderComponent=new E.Component}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ai-analysis-modal"),this.renderComponent.load(),e.createEl("h2",{text:"\u{1F916} AI \uBD84\uC11D"}),this.renderCategorySelector(e),this.renderTemplateSelector(e),this.renderDateRangeSelector(e),this.renderProviderSelector(e),this.progressContainer=e.createDiv({cls:"analysis-progress hidden"}),this.resultContainer=e.createDiv({cls:"analysis-result hidden"}),this.renderButtons(e)}renderCategorySelector(e){let r=e.createDiv({cls:"analysis-section"});r.createEl("label",{text:"\uBD84\uC11D \uB300\uC0C1",cls:"analysis-label"});let a=[{value:"study",label:"\uD559\uC2B5",icon:"\u{1F4DA}"},{value:"workout",label:"\uC6B4\uB3D9",icon:"\u{1F4AA}"},{value:"work",label:"\uC5C5\uBB34",icon:"\u{1F4BC}"},{value:"meal",label:"\uC2DD\uB2E8",icon:"\u{1F37D}\uFE0F"}],n=r.createDiv({cls:"category-btn-group"});for(let o of a){let i=n.createEl("button",{cls:`category-btn ${this.selectedCategory===o.value?"active":""}`,text:`${o.icon} ${o.label}`});i.addEventListener("click",()=>{this.selectedCategory=o.value,this.selectedTemplate=null,n.querySelectorAll(".category-btn").forEach(l=>l.removeClass("active")),i.addClass("active"),this.updateTemplateList()})}}renderTemplateSelector(e){let r=e.createDiv({cls:"analysis-section template-section"});r.createEl("label",{text:"\uBD84\uC11D \uD15C\uD50C\uB9BF",cls:"analysis-label"});let a=r.createDiv({cls:"template-list"});a.id="template-list",this.updateTemplateList()}updateTemplateList(){var n;let e=document.getElementById("template-list");if(!e)return;e.empty();let r=ht(this.selectedCategory),a=this.settings.enabledTemplates;for(let o of r){if(!a.includes(o.id))continue;let i=e.createDiv({cls:`template-item ${((n=this.selectedTemplate)==null?void 0:n.id)===o.id?"selected":""}`}),l=i.createDiv({cls:"template-title",text:o.name}),d=i.createDiv({cls:"template-desc",text:o.description});i.addEventListener("click",()=>{this.selectedTemplate=o,e.querySelectorAll(".template-item").forEach(c=>c.removeClass("selected")),i.addClass("selected")})}if(r.length>0&&!this.selectedTemplate){let o=r.find(i=>a.includes(i.id));if(o){this.selectedTemplate=o;let i=e.querySelector(".template-item");i==null||i.addClass("selected")}}}renderDateRangeSelector(e){let r=e.createDiv({cls:"analysis-section"});r.createEl("label",{text:"\uBD84\uC11D \uAE30\uAC04",cls:"analysis-label"});let a=[{value:"day",label:"\uC624\uB298"},{value:"week",label:"\uCD5C\uADFC 7\uC77C"},{value:"month",label:"\uCD5C\uADFC 30\uC77C"},{value:"quarter",label:"\uCD5C\uADFC 90\uC77C"},{value:"custom",label:"\uC9C1\uC811 \uC785\uB825"}],n=r.createEl("select",{cls:"analysis-select"});for(let l of a){let d=n.createEl("option",{text:l.label,value:l.value});l.value===this.selectedDataRange&&(d.selected=!0)}let o=r.createDiv({cls:`custom-days-container ${this.selectedDataRange!=="custom"?"hidden":""}`}),i=o.createEl("input",{type:"number",cls:"custom-days-input",value:String(this.customDays),placeholder:"\uC77C\uC218"});o.createSpan({text:"\uC77C"}),n.addEventListener("change",()=>{this.selectedDataRange=n.value,this.selectedDataRange==="custom"?o.removeClass("hidden"):o.addClass("hidden")}),i.addEventListener("change",()=>{this.customDays=parseInt(i.value)||7})}renderProviderSelector(e){let r=e.createDiv({cls:"analysis-section"});r.createEl("label",{text:"AI Provider",cls:"analysis-label"});let a=this.engine.getAvailableProviders(),n=r.createEl("select",{cls:"analysis-select"});for(let i of a){let l=i.configured?i.name:`${i.name} (API \uD0A4 \uD544\uC694)`,d=n.createEl("option",{text:l,value:i.type});d.disabled=!i.configured,i.type===this.selectedProvider&&i.configured&&(d.selected=!0)}let o=a.find(i=>i.configured);if(o){this.selectedProvider=o.type;for(let i=0;i<n.options.length;i++){let l=n.options[i];if(l&&l.value===this.selectedProvider){l.selected=!0;break}}}n.addEventListener("change",()=>{this.selectedProvider=n.value})}renderButtons(e){let r=e.createDiv({cls:"analysis-buttons"});r.createEl("button",{cls:"analysis-btn analysis-btn-secondary",text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close());let n=r.createEl("button",{cls:"analysis-btn analysis-btn-primary",text:"\u{1F680} \uBD84\uC11D \uC2DC\uC791"});n.id="analyze-btn",n.addEventListener("click",()=>this.startAnalysis())}async startAnalysis(){if(!this.selectedTemplate){new E.Notice("\uBD84\uC11D \uD15C\uD50C\uB9BF\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.");return}let r=this.engine.getAvailableProviders().find(o=>o.type===this.selectedProvider);if(!(r!=null&&r.configured)){new E.Notice(`${(r==null?void 0:r.name)||"AI"} API \uD0A4\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694.`);return}let a=document.getElementById("analyze-btn");a&&(a.disabled=!0,a.textContent="\uBD84\uC11D \uC911..."),this.showProgress();let n=D.calculateDateRange(this.selectedDataRange,this.customDays);try{let o=await this.engine.analyze({category:this.selectedCategory,template:this.selectedTemplate,dateRange:n,providerType:this.selectedProvider},i=>this.updateProgress(i));o.success?(this.showResult(o.content),new E.Notice("\uBD84\uC11D\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!")):(this.showError(o.error||"\uBD84\uC11D \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."),new E.Notice(`\uBD84\uC11D \uC2E4\uD328: ${o.error}`))}catch(o){let i=o instanceof Error?o.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958";this.showError(i),new E.Notice(`\uBD84\uC11D \uC624\uB958: ${i}`)}a&&(a.disabled=!1,a.textContent="\u{1F680} \uBD84\uC11D \uC2DC\uC791")}showProgress(){this.progressContainer&&(this.progressContainer.removeClass("hidden"),this.progressContainer.empty(),this.progressContainer.createDiv({cls:"progress-bar"}).createDiv({cls:"progress-fill"}),this.progressContainer.createDiv({cls:"progress-text",text:"\uC2DC\uC791 \uC911..."})),this.resultContainer&&this.resultContainer.addClass("hidden")}updateProgress(e){if(!this.progressContainer)return;let r=this.progressContainer.querySelector(".progress-fill"),a=this.progressContainer.querySelector(".progress-text");r&&(r.style.width=`${e.progress}%`),a&&(a.textContent=e.message)}showResult(e){if(this.progressContainer&&this.progressContainer.addClass("hidden"),this.resultContainer){this.resultContainer.removeClass("hidden"),this.resultContainer.empty();let r=this.resultContainer.createDiv({cls:"result-header"});r.createEl("h3",{text:"\u{1F4CA} \uBD84\uC11D \uACB0\uACFC"}),r.createEl("button",{cls:"result-save-btn",text:"\u{1F4DD} \uB178\uD2B8\uB85C \uC800\uC7A5"}).addEventListener("click",()=>this.saveAsNote(e));let n=this.resultContainer.createDiv({cls:"result-content"});E.MarkdownRenderer.render(this.app,e,n,"",this.renderComponent)}}showError(e){if(this.progressContainer&&this.progressContainer.addClass("hidden"),this.resultContainer){this.resultContainer.removeClass("hidden"),this.resultContainer.empty();let r=this.resultContainer.createDiv({cls:"result-error"});r.createEl("h3",{text:"\u274C \uC624\uB958 \uBC1C\uC0DD"}),r.createEl("p",{text:e})}}async saveAsNote(e){var u,p;let r=D.getCurrentDateString(),a=D.getCategoryName(this.selectedCategory),n=((u=this.selectedTemplate)==null?void 0:u.name)||"analysis",o=this.settings.reportNaming.replace("{{category}}",this.selectedCategory).replace("{{date}}",r);o=`${o}.md`;let i=this.settings.reportSavePath,l=`${i}/${o}`;this.app.vault.getAbstractFileByPath(i)||await this.app.vault.createFolder(i);let c=`---
type: ai-analysis
category: ${this.selectedCategory}
template: ${((p=this.selectedTemplate)==null?void 0:p.id)||"unknown"}
provider: ${this.selectedProvider}
date: ${r}
---

# ${a} \uBD84\uC11D \uB9AC\uD3EC\uD2B8

> \uC0DD\uC131\uC77C\uC2DC: ${new Date().toLocaleString("ko-KR")}
> \uD15C\uD50C\uB9BF: ${n}

${e}
`;try{if(this.app.vault.getAbstractFileByPath(l)){let g=Date.now(),h=o.replace(".md",`_${g}.md`);await this.app.vault.create(`${i}/${h}`,c),new E.Notice(`\uB9AC\uD3EC\uD2B8\uAC00 \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4: ${h}`)}else await this.app.vault.create(l,c),new E.Notice(`\uB9AC\uD3EC\uD2B8\uAC00 \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4: ${o}`)}catch(m){new E.Notice(`\uC800\uC7A5 \uC2E4\uD328: ${m instanceof Error?m.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}}onClose(){let{contentEl:e}=this;e.empty(),this.renderComponent.unload()}};var Qr='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/><circle cx="12" cy="12" r="3"/></svg>',Ce=class extends De.Plugin{constructor(){super(...arguments);this.timerManager=new ie;this.fileUpdater=null;this.fileCreator=null;this.ribbonIconEl=null;this.settings=ut}async onload(){await this.loadSettings(),this.fileUpdater=new le(this.app),this.fileCreator=new Q(this.app,this.settings),(0,De.addIcon)("life-log",Qr),this.registerMarkdownCodeBlockProcessor("life-log",(e,r,a)=>{this.processWorkoutBlock(e,r,a)}),this.registerMarkdownCodeBlockProcessor("study-log",(e,r,a)=>{this.processStudyBlock(e,r,a)}),this.registerMarkdownCodeBlockProcessor("work-log",(e,r,a)=>{this.processWorkBlock(e,r,a)}),this.registerMarkdownCodeBlockProcessor("meal-log",(e,r,a)=>{this.processMealBlock(e,r,a)}),this.addCommand({id:"open-quick-log",name:"\uC0C8 \uAE30\uB85D",hotkeys:[{modifiers:["Mod","Shift"],key:"l"}],callback:()=>{this.fileCreator&&new B(this.app,this.settings,this.fileCreator).open()}}),this.addCommand({id:"open-study-log",name:"\uC0C8 \uD559\uC2B5 \uAE30\uB85D",callback:()=>{this.fileCreator&&new B(this.app,{...this.settings,defaultTab:"study"},this.fileCreator).open()}}),this.addCommand({id:"open-work-log",name:"\uC0C8 \uC5C5\uBB34 \uAE30\uB85D",callback:()=>{this.fileCreator&&new B(this.app,{...this.settings,defaultTab:"work"},this.fileCreator).open()}}),this.addCommand({id:"open-workout-log",name:"\uC0C8 \uC6B4\uB3D9 \uAE30\uB85D",callback:()=>{this.fileCreator&&new B(this.app,{...this.settings,defaultTab:"workout"},this.fileCreator).open()}}),this.addCommand({id:"open-ai-analysis",name:"AI \uBD84\uC11D",hotkeys:[{modifiers:["Mod","Shift"],key:"a"}],callback:()=>{new Ee(this.app,this.settings.aiAnalysis,this.settings.logFolder).open()}}),console.log("[Life Log] Registering settings tab..."),this.addSettingTab(new ye(this.app,this)),console.log("[Life Log] Settings tab registered"),this.updateRibbonIcon()}onunload(){this.timerManager.destroy()}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},ut,e),(!this.settings.subjects||this.settings.subjects.length===0)&&(this.settings.subjects=[...dt]),(!this.settings.workoutTemplates||this.settings.workoutTemplates.length===0)&&(this.settings.workoutTemplates=[...ke]),this.settings.aiAnalysis?this.settings.aiAnalysis=Object.assign({},X,this.settings.aiAnalysis):this.settings.aiAnalysis={...X}}async saveSettings(){await this.saveData(this.settings),this.fileCreator&&(this.fileCreator=new Q(this.app,this.settings))}updateRibbonIcon(){this.ribbonIconEl&&(this.ribbonIconEl.remove(),this.ribbonIconEl=null),this.settings.showRibbonIcon&&(this.ribbonIconEl=this.addRibbonIcon("life-log","Life Log: \uC0C8 \uAE30\uB85D",()=>{this.fileCreator&&new B(this.app,this.settings,this.fileCreator).open()}))}processWorkoutBlock(e,r,a){var u;let n=ne(e),o=a.getSectionInfo(r),i=`${a.sourcePath}:${(u=o==null?void 0:o.lineStart)!=null?u:0}`,l=this.timerManager.isTimerRunning(i);if(l&&n.metadata.state!=="started")this.timerManager.stopWorkoutTimer(i);else if(l&&n.metadata.state==="started"){let p=n.exercises.findIndex(g=>g.state==="inProgress"),m=this.timerManager.getActiveExerciseIndex(i);p>=0&&p!==m&&this.timerManager.setActiveExerciseIndex(i,p)}let d=this.createWorkoutCallbacks(a,o,n,i),c=this.settings.usePerTypeTimerStyle?this.settings.workoutTimerStyle:this.settings.timerStyle;Dt({el:r,parsed:n,callbacks:d,workoutId:i,timerManager:this.timerManager,timerStyle:c})}processStudyBlock(e,r,a){var u;let n=ce(e),o=a.getSectionInfo(r),i=`study:${a.sourcePath}:${(u=o==null?void 0:o.lineStart)!=null?u:0}`,l=this.timerManager.isTimerRunning(i);if(l&&n.metadata.state!=="started")this.timerManager.stopWorkoutTimer(i);else if(l&&n.metadata.state==="started"){let p=n.tasks.findIndex(g=>g.state==="inProgress"),m=this.timerManager.getActiveExerciseIndex(i);p>=0&&p!==m&&this.timerManager.setActiveExerciseIndex(i,p)}let d=this.createStudyCallbacks(a,o,n,i),c=this.settings.usePerTypeTimerStyle?this.settings.studyTimerStyle:this.settings.timerStyle;$t({el:r,parsed:n,callbacks:d,studyId:i,timerManager:this.timerManager,enableTimerSound:this.settings.enableTimerSound,enableNotification:this.settings.enableNotifications,timerStyle:c})}processWorkBlock(e,r,a){var u;let n=me(e),o=a.getSectionInfo(r),i=`work:${a.sourcePath}:${(u=o==null?void 0:o.lineStart)!=null?u:0}`,l=this.timerManager.isTimerRunning(i);if(l&&n.metadata.state!=="started")this.timerManager.stopWorkoutTimer(i);else if(l&&n.metadata.state==="started"){let p=n.tasks.findIndex(g=>g.state==="inProgress"),m=this.timerManager.getActiveExerciseIndex(i);p>=0&&p!==m&&this.timerManager.setActiveExerciseIndex(i,p)}let d=this.createWorkCallbacks(a,o,n,i),c=this.settings.usePerTypeTimerStyle?this.settings.workTimerStyle:this.settings.timerStyle;Bt({el:r,parsed:n,callbacks:d,workId:i,timerManager:this.timerManager,enableTimerSound:this.settings.enableTimerSound,enableNotification:this.settings.enableNotifications,timerStyle:c})}createWorkCallbacks(e,r,a,n){let o=a,i=!1,l=async c=>{var m;o=c,i=!1;let u=Wt(c),p=o.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(e.sourcePath,r,u,p))};return{onStartWork:async()=>{i=!1,o.metadata.state="started",o.metadata.startDate=this.formatStartDate(new Date);let c=o.tasks.findIndex(u=>u.state==="pending");c>=0&&(o=G(o,c,"inProgress")),await l(o),this.timerManager.startWorkoutTimer(n,c>=0?c:0)},onFinishWork:async()=>{let c=this.timerManager.getTimerState(n);c&&(o.metadata.totalDuration=b(c.workoutElapsed)),o.metadata.endDate=this.formatStartDate(new Date),o.metadata.state="completed";for(let u=0;u<o.tasks.length;u++){let p=o.tasks[u];if(p&&p.state==="inProgress"){let m=this.timerManager.getTimerState(n);m&&(o=ge(o,u,b(m.exerciseElapsed))),o=G(o,u,"completed")}}await l(o),this.timerManager.stopWorkoutTimer(n)},onTaskFinish:async c=>{if(i=!1,!o.tasks[c])return;let p=this.timerManager.getTimerState(n);p&&(o=ge(o,c,b(p.exerciseElapsed))),o=G(o,c,"completed");let m=o.tasks.findIndex((g,h)=>h>c&&g.state==="pending");m>=0?(o=G(o,m,"inProgress"),this.timerManager.advanceExercise(n,m),await l(o)):await l(o)},onTaskSkip:async c=>{i=!1;let u=this.timerManager.getTimerState(n);u&&u.exerciseElapsed>0&&(o=ge(o,c,b(u.exerciseElapsed))),o=G(o,c,"skipped");let p=o.tasks.findIndex((m,g)=>g>c&&m.state==="pending");p>=0?(o=G(o,p,"inProgress"),this.timerManager.advanceExercise(n,p),await l(o)):await l(o)},onPauseTask:()=>{this.timerManager.pauseExercise(n)},onResumeTask:()=>{this.timerManager.resumeExercise(n)},onFlushChanges:async()=>{i&&await l(o)}}}createWorkoutCallbacks(e,r,a,n){let o=a,i=!1,l=async c=>{var m;o=c,i=!1;let u=$e(c),p=o.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(e.sourcePath,r,u,p))};return{onStartWorkout:async()=>{i=!1,o.metadata.state="started",o.metadata.startDate=this.formatStartDate(new Date);let c=o.exercises.findIndex(u=>u.state==="pending");if(c>=0){let u=o.exercises[c];u&&(u.state="inProgress")}await l(o),this.timerManager.startWorkoutTimer(n,c>=0?c:0)},onFinishWorkout:async()=>{let c=this.timerManager.getTimerState(n);c&&(o.metadata.duration=b(c.workoutElapsed)),o.metadata.state="completed",o=oe(o),await l(o),this.timerManager.stopWorkoutTimer(n)},onExerciseFinish:async c=>{if(i=!1,!o.exercises[c])return;let p=this.timerManager.getTimerState(n);p&&(o=q(o,c,b(p.exerciseElapsed))),o=R(o,c,"completed");let m=o.exercises.findIndex((g,h)=>h>c&&g.state==="pending");if(m>=0)o=R(o,m,"inProgress"),this.timerManager.advanceExercise(n,m),await l(o);else{o.metadata.state="completed";let g=this.timerManager.getTimerState(n);g&&(o.metadata.duration=b(g.workoutElapsed)),o=oe(o),await l(o),this.timerManager.stopWorkoutTimer(n)}},onExerciseAddSet:async c=>{if(i=!1,!o.exercises[c])return;let p=this.timerManager.getTimerState(n);p&&(o=q(o,c,b(p.exerciseElapsed))),o=R(o,c,"completed"),o=St(o,c),o=R(o,c+1,"inProgress"),this.timerManager.advanceExercise(n,c+1),await l(o)},onExerciseAddRest:async c=>{i=!1;let u=o.exercises[c],p=o.metadata.restDuration;if(!u||!p)return;let m=this.timerManager.getTimerState(n);m&&(o=q(o,c,b(m.exerciseElapsed))),o=R(o,c,"completed"),o=vt(o,c,p),o=R(o,c+1,"inProgress"),this.timerManager.advanceExercise(n,c+1),await l(o)},onExerciseSkip:async c=>{i=!1;let u=this.timerManager.getTimerState(n);u&&u.exerciseElapsed>0&&(o=q(o,c,b(u.exerciseElapsed))),o=R(o,c,"skipped");let p=o.exercises.findIndex((m,g)=>g>c&&m.state==="pending");if(p>=0)o=R(o,p,"inProgress"),this.timerManager.advanceExercise(n,p),await l(o);else{o.metadata.state="completed";let m=this.timerManager.getTimerState(n);m&&(o.metadata.duration=b(m.workoutElapsed)),o=oe(o),this.timerManager.stopWorkoutTimer(n),await l(o)}},onParamChange:(c,u,p)=>{let m=o.exercises[c],g=m==null?void 0:m.params.find(h=>h.key===u);(g==null?void 0:g.value)!==p&&(o=kt(o,c,u,p),i=!0)},onFlushChanges:async()=>{i&&await l(o)},onPauseExercise:()=>{this.timerManager.pauseExercise(n)},onResumeExercise:()=>{this.timerManager.resumeExercise(n)},onAddSample:async()=>{var p;let c=Tt(),u=$e(c);await((p=this.fileUpdater)==null?void 0:p.updateCodeBlock(e.sourcePath,r,u,c.metadata.title))}}}createStudyCallbacks(e,r,a,n){let o=a,i=!1,l=async c=>{var m;o=c,i=!1;let u=Pt(c),p=o.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(e.sourcePath,r,u,p))};return{onStartStudy:async()=>{i=!1,o.metadata.state="started",o.metadata.startDate=this.formatStartDate(new Date);let c=o.tasks.findIndex(u=>u.state==="pending");c>=0&&(o=z(o,c,"inProgress")),await l(o),this.timerManager.startWorkoutTimer(n,c>=0?c:0,this.settings.enablePomodoro?{enabled:!0,workDuration:this.settings.pomodoroWork*60,breakDuration:this.settings.pomodoroBreak*60}:void 0)},onFinishStudy:async()=>{let c=this.timerManager.getTimerState(n);c&&(o.metadata.totalDuration=b(c.workoutElapsed)),o.metadata.endDate=this.formatStartDate(new Date),o.metadata.state="completed",await l(o),this.timerManager.stopWorkoutTimer(n)},onTaskFinish:async c=>{if(i=!1,!o.tasks[c])return;let p=this.timerManager.getTimerState(n);p&&(o=de(o,c,b(p.exerciseElapsed))),o=z(o,c,"completed");let m=o.tasks.findIndex((g,h)=>h>c&&g.state==="pending");m>=0?(o=z(o,m,"inProgress"),this.timerManager.advanceExercise(n,m),await l(o)):await l(o)},onTaskSkip:async c=>{i=!1;let u=this.timerManager.getTimerState(n);u&&u.exerciseElapsed>0&&(o=de(o,c,b(u.exerciseElapsed))),o=z(o,c,"skipped");let p=o.tasks.findIndex((m,g)=>g>c&&m.state==="pending");p>=0?(o=z(o,p,"inProgress"),this.timerManager.advanceExercise(n,p),await l(o)):await l(o)},onPauseTask:()=>{this.timerManager.pauseExercise(n)},onResumeTask:()=>{this.timerManager.resumeExercise(n)},onFlushChanges:async()=>{i&&await l(o)},onOpenSelfEval:()=>{new xe(this.app,async c=>{o=At(o,c.focusScore,c.comprehensionScore);let u=this.timerManager.getTimerState(n);u&&(o.metadata.totalDuration=b(u.workoutElapsed)),o.metadata.endDate=this.formatStartDate(new Date),o.metadata.state="completed";for(let p=0;p<o.tasks.length;p++){let m=o.tasks[p];if(m&&m.state==="inProgress"){let g=this.timerManager.getTimerState(n);g&&(o=de(o,p,b(g.exerciseElapsed))),o=z(o,p,"completed")}}await l(o),this.timerManager.stopWorkoutTimer(n)}).open()}}}formatStartDate(e){let r=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0");return`${r}-${a}-${n} ${o}:${i}`}processMealBlock(e,r,a){var d;let n=he(e),o=a.getSectionInfo(r),i=`meal:${a.sourcePath}:${(d=o==null?void 0:o.lineStart)!=null?d:0}`,l=this.createMealCallbacks(a,o,n,i);zt({el:r,parsed:n,callbacks:l,mealId:i,app:this.app})}createMealCallbacks(e,r,a,n){let o=a,i=async l=>{var u;o=l;let d=Ht(l),c=o.metadata.title;await((u=this.fileUpdater)==null?void 0:u.updateCodeBlock(e.sourcePath,r,d,c))};return{onCompleteMeal:async()=>{o.metadata.state="completed",o.metadata.date||(o.metadata.date=this.formatStartDate(new Date));for(let l=0;l<o.foods.length;l++){let d=o.foods[l];d&&d.state==="pending"&&(o=st(o,l))}await i(o)},onFoodToggle:async l=>{o=st(o,l),await i(o)},onAddFood:async l=>{o=Ot(o,l),await i(o)},onRemoveFood:async l=>{o=Nt(o,l),await i(o)},onPhotoChange:async l=>{o=jt(o,l),await i(o)},onFlushChanges:async()=>{}}}};
