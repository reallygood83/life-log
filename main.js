/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Pe=Object.defineProperty;var Ut=Object.getOwnPropertyDescriptor;var qt=Object.getOwnPropertyNames;var Jt=Object.prototype.hasOwnProperty;var Qt=(n,r)=>{for(var e in r)Pe(n,e,{get:r[e],enumerable:!0})},Xt=(n,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of qt(r))!Jt.call(n,a)&&a!==e&&Pe(n,a,{get:()=>r[a],enumerable:!(t=Ut(r,a))||t.enumerable});return n};var Zt=n=>Xt(Pe({},"__esModule",{value:!0}),n);var ea={};Qt(ea,{default:()=>Le});module.exports=Zt(ea);var Me=require("obsidian");var er=/^-\s*\[(.)\]\s*(.+)$/,tr={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},rr={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function Ae(n,r){var p,m,g,h;let e=n.match(er);if(!e)return null;let t=(p=e[1])!=null?p:" ",a=(m=e[2])!=null?m:"",o=(g=tr[t])!=null?g:"pending",s=a.split("|").map(y=>y.trim()),i=(h=s[0])!=null?h:"",l=s.slice(1),d=[],c,u;for(let y of l){let f=ar(y);f&&(d.push(f),f.key.toLowerCase()==="duration"&&(f.editable?c=$(f.value):u=f.value+(f.unit?` ${f.unit}`:"")))}return{state:o,name:i,params:d,targetDuration:c,recordedDuration:u,lineIndex:r}}function ar(n){var l,d,c;let r=n.indexOf(":");if(r===-1)return null;let e=n.substring(0,r).trim(),t=n.substring(r+1).trim(),a=t.match(/^\[([^\]]*)\](.*)$/);if(a){let u=(l=a[1])!=null?l:"",p=((d=a[2])!=null?d:"").trim();return{key:e,value:u,editable:!0,unit:p||void 0}}let o=t.split(/\s+/),s=(c=o[0])!=null?c:"",i=o.slice(1).join(" ")||void 0;return{key:e,value:s,editable:!1,unit:i}}function $(n){var s,i,l,d,c,u;let r=n.trim(),e=r.match(/^(\d+)s$/);if(e)return parseInt((s=e[1])!=null?s:"0",10);let t=r.match(/^(\d+):(\d{2})$/);if(t){let p=parseInt((i=t[1])!=null?i:"0",10),m=parseInt((l=t[2])!=null?l:"0",10);return p*60+m}let a=r.match(/^(\d+)m\s*(\d+)?s?$/);if(a){let p=parseInt((d=a[1])!=null?d:"0",10),m=parseInt((c=a[2])!=null?c:"0",10);return p*60+m}let o=r.match(/^(\d+)$/);return o?parseInt((u=o[1])!=null?u:"0",10):0}function w(n){let r=Math.floor(n/60),e=n%60;return`${r}:${e.toString().padStart(2,"0")}`}function x(n){let r=Math.floor(n/60),e=n%60;return r===0?`${e}s`:e===0?`${r}m`:`${r}m ${e}s`}function vt(n){return rr[n]}function Ie(n){let e=`- [${vt(n.state)}] ${n.name}`;for(let t of n.params)e+=" | ",e+=`${t.key}: `,t.editable?e+=`[${t.value}]`:e+=t.value,t.unit&&(e+=` ${t.unit}`);return e}var or=["planned","started","completed"];function $e(n){let r={state:"planned"};for(let e of n){let t=e.indexOf(":");if(t===-1)continue;let a=e.substring(0,t).trim().toLowerCase(),o=e.substring(t+1).trim();switch(a){case"title":o&&(r.title=o);break;case"state":or.includes(o)&&(r.state=o);break;case"startdate":o&&(r.startDate=o);break;case"duration":o&&(r.duration=o);break;case"restduration":if(o){let s=$(o);s>0&&(r.restDuration=s)}break}}return r}function Re(n){let r=[];return n.title!==void 0&&r.push(`title: ${n.title}`),r.push(`state: ${n.state}`),n.startDate!==void 0&&r.push(`startDate: ${n.startDate}`),n.duration!==void 0&&r.push(`duration: ${n.duration}`),n.restDuration!==void 0&&r.push(`restDuration: ${x(n.restDuration)}`),r}function se(n){var l;let r=n.split(`
`),e=-1;for(let d=0;d<r.length;d++)if(((l=r[d])==null?void 0:l.trim())==="---"){e=d;break}let t=e>0?r.slice(0,e):[],a=$e(t),o=e>=0?e+1:0,s=r.slice(o),i=[];for(let d=0;d<s.length;d++){let c=s[d];if(!c)continue;let u=Ae(c,d);u&&i.push(u)}return{metadata:a,exercises:i,rawLines:r,metadataEndIndex:e>=0?e:-1}}function We(n){let r=[],e=Re(n.metadata);r.push(...e),r.push("---");for(let t of n.exercises)r.push(Ie(t));return r.join(`
`)}function St(n,r,e,t){let a=structuredClone(n),o=a.exercises[r];if(!o)return n;let s=o.params.find(i=>i.key===e);return s&&(s.value=t),a}function R(n,r,e){let t=structuredClone(n),a=t.exercises[r];return a?(a.state=e,t):n}function ne(n){let r=structuredClone(n);for(let e of r.exercises)for(let t of e.params)t.editable=!1;return r}function Tt(n,r,e){let t=structuredClone(n),a=t.exercises[r];if(!a)return n;let o={state:"pending",name:"Rest",params:[{key:"Duration",value:`${e}s`,editable:!0}],targetDuration:e,lineIndex:a.lineIndex+1};t.exercises.splice(r+1,0,o);for(let s=r+2;s<t.exercises.length;s++){let i=t.exercises[s];i&&i.lineIndex++}return t}function bt(n,r){let e=structuredClone(n),t=e.exercises[r];if(!t)return n;let a={...structuredClone(t),state:"pending",recordedDuration:void 0,lineIndex:t.lineIndex+1};for(let o of a.params)o.key.toLowerCase()==="duration"&&!o.editable&&(o.editable=t.targetDuration!==void 0);e.exercises.splice(r+1,0,a);for(let o=r+2;o<e.exercises.length;o++){let s=e.exercises[o];s&&s.lineIndex++}return e}function q(n,r,e){let t=structuredClone(n),a=t.exercises[r];if(!a)return n;let o=a.params.find(s=>s.key.toLowerCase()==="duration");return o?(o.value=e,o.editable=!1):a.params.push({key:"Duration",value:e,editable:!1}),a.recordedDuration=e,t}function xt(){return{metadata:{title:"Sample Workout",state:"planned",restDuration:60},exercises:[{state:"pending",name:"Squats",params:[{key:"Weight",value:"60",editable:!0,unit:"kg"},{key:"Reps",value:"12",editable:!0}],lineIndex:0},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:1},{state:"pending",name:"Push-ups",params:[{key:"Reps",value:"15",editable:!0}],lineIndex:2},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:3},{state:"pending",name:"Dumbbell Rows",params:[{key:"Weight",value:"20",editable:!0,unit:"kg"},{key:"Reps",value:"10",editable:!0,unit:"/arm"}],lineIndex:4},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:5},{state:"pending",name:"Plank Hold",params:[{key:"Duration",value:"45s",editable:!0}],targetDuration:45,lineIndex:6},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:7},{state:"pending",name:"Lunges",params:[{key:"Reps",value:"10",editable:!0,unit:"/leg"}],lineIndex:8}],rawLines:[],metadataEndIndex:-1}}function wt(n){let r=[];n.metadata.title&&r.push(`title: ${n.metadata.title}`),r.push("state: planned"),r.push("startDate:"),r.push("duration:"),r.push("---");let e=new Set,t=[];for(let a of n.exercises)e.has(a.name)||(e.add(a.name),t.push(a));for(let a of t){let o=`- [ ] ${a.name}`;for(let s of a.params)if(o+=" | ",o+=`${s.key}: `,!(s.key.toLowerCase()==="duration"&&!a.targetDuration)){if(s.key.toLowerCase()==="duration"&&a.targetDuration){let i=Math.floor(a.targetDuration/60),l=a.targetDuration%60,d=i>0?`${i}m ${l}s`:`${l}s`;o+=`[${d}]`}else o+=`[${s.value}]`;s.unit&&(o+=` ${s.unit}`)}r.push(o)}return r.join(`
`)}function W(n,r,e,t=!1){switch(n.empty(),n.removeClass("timer-digital","timer-analog","timer-pomodoro"),n.addClass(`timer-${e}`),e){case"analog":nr(n,r);break;case"pomodoro":sr(n,r,t);break;case"digital":default:Et(n,r,t);break}}function Et(n,r,e){let t=e?r.exerciseElapsed:r.workoutElapsed;n.createSpan({cls:"timer-value",text:w(t)}),n.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}function sr(n,r,e){var t,a;if(r.pomodoroEnabled&&r.pomodoroPhase){let o=r.pomodoroPhase==="work"?"\uC9D1\uC911":"\uD734\uC2DD",s=(t=r.pomodoroRemaining)!=null?t:0,i=(a=r.pomodoroProgress)!=null?a:0,l=n.createDiv({cls:"pomodoro-timer-wrapper"}),d=l.createDiv({cls:"pomodoro-text"});d.createSpan({cls:"pomodoro-phase",text:o}),d.createSpan({cls:"pomodoro-time",text:w(s)}),l.createDiv({cls:"pomodoro-progress-bar"}).createDiv({cls:"pomodoro-progress-fill",attr:{style:`width: ${i}%`}})}else Et(n,r,e)}function nr(n,r){let e=r.workoutElapsed,t=40,a=t/2,o=t/2-2,s=e%60*6,i=e/60%60*6+e%60*.1,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width",`${t}`),l.setAttribute("height",`${t}`),l.setAttribute("viewBox",`0 0 ${t} ${t}`),l.classList.add("analog-clock-svg");let d=document.createElementNS("http://www.w3.org/2000/svg","circle");d.setAttribute("cx",`${a}`),d.setAttribute("cy",`${a}`),d.setAttribute("r",`${o}`),d.setAttribute("fill","none"),d.setAttribute("stroke","currentColor"),d.setAttribute("stroke-width","2"),l.appendChild(d);let c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("x1",`${a}`),c.setAttribute("y1",`${a}`),c.setAttribute("x2",`${a}`),c.setAttribute("y2",`${a-o*.7}`),c.setAttribute("stroke","currentColor"),c.setAttribute("stroke-width","2"),c.setAttribute("transform",`rotate(${i} ${a} ${a})`),l.appendChild(c);let u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",`${a}`),u.setAttribute("y1",`${a}`),u.setAttribute("x2",`${a}`),u.setAttribute("y2",`${a-o*.85}`),u.setAttribute("stroke","var(--text-accent)"),u.setAttribute("stroke-width","1"),u.setAttribute("transform",`rotate(${s} ${a} ${a})`),l.appendChild(u);let p=document.createElementNS("http://www.w3.org/2000/svg","circle");p.setAttribute("cx",`${a}`),p.setAttribute("cy",`${a}`),p.setAttribute("r","2"),p.setAttribute("fill","currentColor"),l.appendChild(p),n.appendChild(l),n.setAttribute("title",`Total: ${w(e)}`)}function Be(n,r,e,t,a="digital"){let o=n.createDiv({cls:"workout-header"}),s=o.createDiv({cls:"workout-title"});if(s.textContent=r.title||"Workout",r.restDuration){let d=o.createDiv({cls:"workout-rest-duration"}),c=x(r.restDuration);d.setText(`Rest: ${c}`)}let l=o.createDiv({cls:"workout-header-timer"}).createSpan({cls:"workout-timer"});return r.state==="completed"&&r.duration?(l.textContent=r.duration,l.createSpan({cls:"workout-timer-indicator recorded",text:" \u2713"})):t&&e?W(l,e,a):(r.state,l.textContent="--:--"),{titleEl:s,timerEl:l}}function Fe(n,r,e="digital"){W(n,r,e)}var ir={pending:"\u25CB",inProgress:"\u25D0",completed:"\u2713",skipped:"\u2014"};function lr(n){let r=5381;for(let a=0;a<n.length;a++)r=(r<<5)+r^n.charCodeAt(a);let e=.618033988749895,t=Math.abs(r)%1e3/1e3;return Math.floor(t*e%1*360)}function Ct(n){return n.params.some(r=>r.key.toLowerCase()!=="duration")}function He(n,r,e,t,a,o,s,i){let l=!Ct(r),d=n.createDiv({cls:`workout-exercise state-${r.state}${t?" active":""}${l?" simple":""}`}),c=lr(r.name);d.style.setProperty("--exercise-color",`hsl(${c}, 65%, 55%)`);let u=new Map,p=d.createDiv({cls:"workout-exercise-main"}),m=p.createSpan({cls:"workout-exercise-icon"});m.textContent=ir[r.state];let g=p.createSpan({cls:"workout-exercise-name"});if(g.textContent=r.name,Ct(r)){let y=p.createSpan({cls:"workout-exercise-params"});for(let f of r.params){if(f.key.toLowerCase()==="duration")continue;let v=y.createSpan({cls:"workout-param"});if(f.unit||v.createSpan({cls:"workout-param-prefix",text:"\xD7"}),f.editable&&s!=="completed"){let S=v.createEl("input",{cls:"workout-param-input",type:"text",value:f.value});S.addEventListener("input",()=>{o.onParamChange(e,f.key,S.value)}),S.addEventListener("keydown",T=>{T.key==="Enter"&&S.blur()}),u.set(f.key,S)}else v.createSpan({cls:"workout-param-value",text:f.value});f.unit&&v.createSpan({cls:"workout-param-unit",text:` ${f.unit}`})}}let h=p.createSpan({cls:"workout-exercise-timer"});return r.state==="completed"&&r.recordedDuration?(h.textContent=r.recordedDuration,h.createSpan({cls:"timer-indicator recorded",text:" \u2713"})):t&&a?ie(h,a,r.targetDuration):r.targetDuration?(h.textContent=w(r.targetDuration),h.createSpan({cls:"timer-indicator count-down",text:" \u25BC"})):r.state==="pending"&&(h.textContent="--"),t&&s==="started"&&cr(d,e,o,i),{container:d,timerEl:h,inputs:u}}function cr(n,r,e,t){let a=n.createDiv({cls:"workout-exercise-controls"}),o=a.createEl("button",{cls:"workout-btn",text:"Pause"});o.addEventListener("click",()=>{o.textContent==="Pause"?(e.onPauseExercise(),o.textContent="Resume"):(e.onResumeExercise(),o.textContent="Pause")}),a.createEl("button",{cls:"workout-btn",text:"Skip"}).addEventListener("click",()=>{e.onExerciseSkip(r)});let i=a.createDiv({cls:"workout-btn-group"});i.createEl("button",{cls:"workout-btn",text:"+ Set"}).addEventListener("click",()=>{e.onExerciseAddSet(r)}),t!==void 0&&i.createEl("button",{cls:"workout-btn",text:"+ Rest"}).addEventListener("click",()=>{e.onExerciseAddRest(r)}),i.createEl("button",{cls:"workout-btn",text:"Next"}).addEventListener("click",()=>{e.onExerciseFinish(r)})}function ie(n,r,e){if(n.empty(),e!==void 0){let t=e-r.exerciseElapsed;t>0?(n.textContent=w(t),n.createSpan({cls:"timer-indicator count-down",text:" \u25BC"})):(n.textContent=w(Math.abs(t)),n.addClass("overtime"),n.createSpan({cls:"timer-indicator overtime",text:" \u26A0"}))}else n.textContent=w(r.exerciseElapsed),n.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}var A=null,Dt=!1;function N(){if(!Dt)try{A=new(window.AudioContext||window.webkitAudioContext),A.state==="suspended"&&A.resume(),Dt=!0,console.log("[Life Log] AudioContext initialized")}catch(n){console.warn("[Life Log] Failed to initialize AudioContext:",n)}}function J(n="complete"){if(A||N(),!A){console.warn("[Life Log] AudioContext not available");return}A.state==="suspended"&&A.resume();try{switch(n){case"complete":dr(A);break;case"break":ur(A);break;case"warning":pr(A);break}}catch(r){console.warn("[Life Log] Failed to play sound:",r)}}function dr(n){let r=n.currentTime,e=n.createOscillator(),t=n.createGain();e.connect(t),t.connect(n.destination),e.frequency.value=523.25,e.type="sine",t.gain.setValueAtTime(.3,r),t.gain.exponentialRampToValueAtTime(.01,r+.3),e.start(r),e.stop(r+.3);let a=n.createOscillator(),o=n.createGain();a.connect(o),o.connect(n.destination),a.frequency.value=659.25,a.type="sine",o.gain.setValueAtTime(.3,r+.15),o.gain.exponentialRampToValueAtTime(.01,r+.45),a.start(r+.15),a.stop(r+.45);let s=n.createOscillator(),i=n.createGain();s.connect(i),i.connect(n.destination),s.frequency.value=783.99,s.type="sine",i.gain.setValueAtTime(.3,r+.3),i.gain.exponentialRampToValueAtTime(.01,r+.6),s.start(r+.3),s.stop(r+.6)}function ur(n){let r=n.currentTime,e=n.createOscillator(),t=n.createGain();e.connect(t),t.connect(n.destination),e.frequency.value=440,e.type="sine",t.gain.setValueAtTime(.2,r),t.gain.exponentialRampToValueAtTime(.01,r+.5),e.start(r),e.stop(r+.5);let a=n.createOscillator(),o=n.createGain();a.connect(o),o.connect(n.destination),a.frequency.value=349.23,a.type="sine",o.gain.setValueAtTime(.2,r+.3),o.gain.exponentialRampToValueAtTime(.01,r+.8),a.start(r+.3),a.stop(r+.8)}function pr(n){let r=n.currentTime;for(let e=0;e<3;e++){let t=n.createOscillator(),a=n.createGain();t.connect(a),a.connect(n.destination),t.frequency.value=880,t.type="square",a.gain.setValueAtTime(.15,r+e*.2),a.gain.exponentialRampToValueAtTime(.01,r+e*.2+.1),t.start(r+e*.2),t.stop(r+e*.2+.1)}}function Oe(n,r,e,t){let a=n.createDiv({cls:"workout-controls"});if(r==="planned"){let o=a.createEl("button",{cls:"workout-btn workout-btn-primary workout-btn-large"});o.createSpan({cls:"workout-btn-icon",text:"\u25B6"}),o.createSpan({text:"Start Workout"}),o.addEventListener("click",()=>{N(),e.onStartWorkout()})}else if(r==="completed"){let o=a.createSpan({cls:"workout-completed-label"});o.createSpan({cls:"workout-btn-icon",text:"\u2713"}),o.createSpan({text:"Completed"});let s=a.createEl("button",{cls:"workout-btn"});s.createSpan({cls:"workout-btn-icon",text:"\u{1F4CB}"}),s.createSpan({text:"Copy as Template"}),s.addEventListener("click",async()=>{let i=wt(t);await navigator.clipboard.writeText("```workout\n"+i+"\n```");let l=s.querySelector("span:last-child");if(l){let d=l.textContent;l.textContent="Copied!",setTimeout(()=>{l.textContent=d},1500)}})}return a}function Lt(n,r){let e=n.createDiv({cls:"workout-empty-state"});e.createDiv({cls:"workout-empty-message"}).createSpan({text:"This workout is empty"});let o=e.createDiv({cls:"workout-empty-action"}).createEl("button",{cls:"workout-btn workout-btn-primary workout-btn-large"});return o.createSpan({cls:"workout-btn-icon",text:"\u2728"}),o.createSpan({text:"Add Sample Workout"}),o.addEventListener("click",async()=>{await r()}),e}function Mt(n){let{el:r,parsed:e,callbacks:t,workoutId:a,timerManager:o,timerStyle:s}=n;r.empty();let i=r.createDiv({cls:`workout-container state-${e.metadata.state}`}),l=o.isTimerRunning(a),d=o.getTimerState(a),c=l?o.getActiveExerciseIndex(a):-1,{timerEl:u}=Be(i,e.metadata,d,l,s);if(e.exercises.length===0&&e.metadata.state==="planned"){Lt(i,t.onAddSample);return}let p=[],m=i.createDiv({cls:"workout-exercises"}),g=Math.max(...e.exercises.map(h=>h.name.length));m.style.setProperty("--max-name-chars",String(g));for(let h=0;h<e.exercises.length;h++){let y=e.exercises[h];if(!y)continue;let f=h===c,v=He(m,y,h,f,f?d:null,t,e.metadata.state,e.metadata.restDuration);p.push(v)}if(Oe(i,e.metadata.state,t,e),i.addEventListener("focusout",h=>{let y=h.relatedTarget;(!y||!i.contains(y))&&t.onFlushChanges()}),l){let h=c,y=!1;o.subscribe(a,f=>{Fe(u,f,s);let v=o.getActiveExerciseIndex(a);if(v!==h)return;let S=p[v],T=e.exercises[v];S!=null&&S.timerEl&&T&&(ie(S.timerEl,f,T.targetDuration),!y&&T.targetDuration!==void 0&&f.exerciseElapsed>=T.targetDuration&&(y=!0,t.onExerciseFinish(v)))})}}var le=class{constructor(){this.timers=new Map;this.intervalId=null;this.onAutoAdvance=null;this.onPomodoroPhaseChange=null}setAutoAdvanceCallback(r){this.onAutoAdvance=r}setPomodoroPhaseChangeCallback(r){this.onPomodoroPhaseChange=r}startWorkoutTimer(r,e=0,t){var s,i,l;let a=Date.now(),o=this.timers.get(r);o?(o.exerciseStartTime=a,o.exercisePausedTime=0,o.isPaused=!1,o.activeExerciseIndex=e,t!=null&&t.enabled&&(o.pomodoroEnabled=!0,o.pomodoroPhase="work",o.pomodoroCycle=1,o.pomodoroWorkDuration=t.workDuration,o.pomodoroBreakDuration=t.breakDuration,o.pomodoroPhaseStartTime=a,o.pomodoroPausedTime=0)):this.timers.set(r,{workoutId:r,workoutStartTime:a,exerciseStartTime:a,exercisePausedTime:0,isPaused:!1,activeExerciseIndex:e,callbacks:new Set,pomodoroEnabled:(s=t==null?void 0:t.enabled)!=null?s:!1,pomodoroPhase:"work",pomodoroCycle:1,pomodoroWorkDuration:(i=t==null?void 0:t.workDuration)!=null?i:25*60,pomodoroBreakDuration:(l=t==null?void 0:t.breakDuration)!=null?l:5*60,pomodoroPhaseStartTime:a,pomodoroPausedTime:0}),this.ensureInterval()}advanceExercise(r,e){let t=this.timers.get(r);t&&(t.exerciseStartTime=Date.now(),t.exercisePausedTime=0,t.isPaused=!1,t.activeExerciseIndex=e)}pauseExercise(r){let e=this.timers.get(r);if(!e||e.isPaused)return;e.isPaused=!0;let t=Date.now();e.exercisePausedTime+=t-e.exerciseStartTime,e.pomodoroEnabled&&(e.pomodoroPausedTime+=t-e.pomodoroPhaseStartTime)}resumeExercise(r){let e=this.timers.get(r);if(!e||!e.isPaused)return;e.isPaused=!1;let t=Date.now();e.exerciseStartTime=t,e.pomodoroEnabled&&(e.pomodoroPhaseStartTime=t)}stopWorkoutTimer(r){this.timers.delete(r),this.timers.size===0&&this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)}subscribe(r,e){let t=this.timers.get(r);if(!t)return()=>{};t.callbacks.add(e);let a=this.getTimerState(r);return a&&e(a),()=>{t.callbacks.delete(e)}}getTimerState(r){let e=this.timers.get(r);if(!e)return null;let t=Date.now(),a=Math.floor((t-e.workoutStartTime)/1e3),o;if(e.isPaused)o=Math.floor(e.exercisePausedTime/1e3);else{let i=t-e.exerciseStartTime;o=Math.floor((e.exercisePausedTime+i)/1e3)}let s={workoutElapsed:a,exerciseElapsed:o,isOvertime:!1};if(e.pomodoroEnabled){let i=e.pomodoroPhase==="work"?e.pomodoroWorkDuration:e.pomodoroBreakDuration,l;if(e.isPaused)l=Math.floor(e.pomodoroPausedTime/1e3);else{let u=t-e.pomodoroPhaseStartTime;l=Math.floor((e.pomodoroPausedTime+u)/1e3)}let d=Math.max(0,i-l),c=Math.min(100,l/i*100);s.pomodoroEnabled=!0,s.pomodoroPhase=e.pomodoroPhase,s.pomodoroCycle=e.pomodoroCycle,s.pomodoroElapsed=l,s.pomodoroRemaining=d,s.pomodoroProgress=c}return s}getActiveExerciseIndex(r){var t;let e=this.timers.get(r);return(t=e==null?void 0:e.activeExerciseIndex)!=null?t:0}setActiveExerciseIndex(r,e){let t=this.timers.get(r);t&&t.activeExerciseIndex!==e&&(t.activeExerciseIndex=e,t.exerciseStartTime=Date.now(),t.exercisePausedTime=0,t.isPaused=!1)}isTimerRunning(r){return this.timers.has(r)}isPaused(r){var t;let e=this.timers.get(r);return(t=e==null?void 0:e.isPaused)!=null?t:!1}getPomodoroPhase(r){let e=this.timers.get(r);return!e||!e.pomodoroEnabled?null:e.pomodoroPhase}ensureInterval(){this.intervalId===null&&(this.intervalId=window.setInterval(()=>{this.tick()},1e3))}tick(){for(let[r,e]of this.timers){let t=this.getTimerState(r);if(t){e.pomodoroEnabled&&!e.isPaused&&this.checkPomodoroPhaseComplete(r,e,t);for(let a of e.callbacks)a(t)}}}checkPomodoroPhaseComplete(r,e,t){if(!t.pomodoroRemaining||t.pomodoroRemaining>0)return;let a=Date.now(),o=e.pomodoroPhase;e.pomodoroPhase==="work"?(e.pomodoroPhase="break",J("break")):(e.pomodoroPhase="work",e.pomodoroCycle++,J("complete")),e.pomodoroPhaseStartTime=a,e.pomodoroPausedTime=0,this.onPomodoroPhaseChange&&this.onPomodoroPhaseChange(r,e.pomodoroPhase,e.pomodoroCycle)}checkAutoAdvance(r,e){if(e===void 0)return;let t=this.getTimerState(r);t&&t.exerciseElapsed>=e&&this.onAutoAdvance&&this.onAutoAdvance(r)}destroy(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timers.clear()}};var Ne=require("obsidian"),ce=class{constructor(r){this.app=r;this.updateLocks=new Map}async withLock(r,e){let t=this.updateLocks.get(r);t&&await t;let a,o=new Promise(s=>{a=s});this.updateLocks.set(r,o);try{return await e()}finally{a(),this.updateLocks.get(r)===o&&this.updateLocks.delete(r)}}async updateCodeBlock(r,e,t,a){let o=this.app.vault.getAbstractFileByPath(r);if(!(o instanceof Ne.TFile)){console.error("File not found:",r);return}if(!e){console.error("No section info available");return}await this.withLock(r,async()=>{await this.app.vault.process(o,s=>{var v;let i=s.split(`
`),l=i[e.lineStart],d=l==null?void 0:l.trim().startsWith("```life-log"),c=l==null?void 0:l.trim().startsWith("```study-log"),u=l==null?void 0:l.trim().startsWith("```work-log"),p=l==null?void 0:l.trim().startsWith("```meal-log");if(!l||!d&&!c&&!u&&!p)return console.error("Stale sectionInfo: expected ```life-log, ```study-log, ```work-log, or ```meal-log at line",e.lineStart),s;if(a){let T=i.slice(e.lineStart+1,e.lineEnd).join(`
`).match(/^title:\s*(.+)$/m),b=(v=T==null?void 0:T[1])==null?void 0:v.trim();if(b&&b!==a)return console.error("Title mismatch: expected",a,"but found",b),s}let m=e.lineStart,g=e.lineEnd,h=i.slice(0,m+1),y=i.slice(g);return[...h,t,...y].join(`
`)})})}async insertLineAfter(r,e,t,a){let o=this.app.vault.getAbstractFileByPath(r);if(!(o instanceof Ne.TFile)){console.error("File not found:",r);return}if(!e){console.error("No section info available");return}await this.app.vault.process(o,s=>{let i=s.split(`
`),l=e.lineStart+1+t;return i.splice(l+1,0,a),i.join(`
`)})}};var j=require("obsidian"),Q=class{constructor(r,e){this.app=r;this.settings=e}async createLogFile(r,e){let t=new Date,a=this.buildFolderPath(t),o=this.buildFileName(t,r),s=(0,j.normalizePath)(`${a}/${o}`);await this.ensureFolderExists(a);let i=this.app.vault.getAbstractFileByPath(s);return i instanceof j.TFile?this.appendToExistingFile(i,r,e):this.createNewFile(s,r,t,e)}buildFolderPath(r){let e=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0");return(0,j.normalizePath)(`${this.settings.logFolder}/${e}/${t}`)}buildFileName(r,e){return`${this.formatDate(r)}-${e}.md`}formatDate(r){let e=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0");switch(this.settings.dateFormat){case"YYYY/MM/DD":return`${e}/${t}/${a}`;case"DD-MM-YYYY":return`${a}-${t}-${e}`;default:return`${e}-${t}-${a}`}}async ensureFolderExists(r){if(this.app.vault.getAbstractFileByPath(r)instanceof j.TFolder)return;let t=r.split("/"),a="";for(let o of t)a=a?`${a}/${o}`:o,this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a)}async appendToExistingFile(r,e,t){let a=this.getBlockType(e),o=this.buildNewSection(e,t,a);return await this.app.vault.process(r,s=>s+`

---

`+o),r}getBlockType(r){switch(r){case"study":return"study-log";case"work":return"work-log";case"workout":return"life-log";case"meal":return"meal-log"}}async createNewFile(r,e,t,a){let o=this.getBlockType(e),s=this.buildFrontmatter(e,t),i=this.buildHeading(e,t),l=this.buildNewSection(e,a,o),d=`${s}

${i}

${l}`;return await this.app.vault.create(r,d)}buildFrontmatter(r,e){let t=this.formatDate(e),a=e.toISOString();return["---",`type: ${r}-log`,`date: ${t}`,`created: ${a}`,"---"].join(`
`)}buildHeading(r,e){let t=this.formatDate(e),a={study:"\u{1F4DA}",work:"\u{1F4BC}",workout:"\u{1F3CB}\uFE0F",meal:"\u{1F37D}\uFE0F"},o={study:"\uD559\uC2B5",work:"\uC5C5\uBB34",workout:"\uC6B4\uB3D9",meal:"\uC2DD\uB2E8"};return`# ${a[r]} ${t} ${o[r]} \uAE30\uB85D`}buildNewSection(r,e,t){let o=new Date().getHours();return[`## ${o<12?"\uC624\uC804":o<18?"\uC624\uD6C4":"\uC800\uB141"} ${{study:"\uD559\uC2B5",work:"\uC5C5\uBB34",workout:"\uC6B4\uB3D9",meal:"\uC2DD\uB2E8"}[r]} \uC138\uC158`,"",`\`\`\`${t}`,e,"```"].join(`
`)}formatDateTime(r){let e=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0"),o=String(r.getHours()).padStart(2,"0"),s=String(r.getMinutes()).padStart(2,"0");return`${e}-${t}-${a} ${o}:${s}`}};var mr=["planned","started","completed"];function je(n){let r={title:"",subject:"",state:"planned"};for(let e of n){let t=e.indexOf(":");if(t===-1)continue;let a=e.substring(0,t).trim().toLowerCase(),o=e.substring(t+1).trim();switch(a){case"title":r.title=o;break;case"subject":r.subject=o;break;case"state":mr.includes(o)&&(r.state=o);break;case"startdate":o&&(r.startDate=o);break;case"enddate":o&&(r.endDate=o);break;case"totalduration":o&&(r.totalDuration=o);break;case"focusscore":let s=parseInt(o);s>=1&&s<=5&&(r.focusScore=s);break;case"comprehensionscore":let i=parseInt(o);i>=1&&i<=5&&(r.comprehensionScore=i);break;case"tags":o&&(r.tags=o.split(",").map(l=>l.trim()).filter(l=>l));break}}return r}function Ge(n){let r=[];return n.title&&r.push(`title: ${n.title}`),n.subject&&r.push(`subject: ${n.subject}`),r.push(`state: ${n.state}`),n.startDate&&r.push(`startDate: ${n.startDate}`),n.endDate&&r.push(`endDate: ${n.endDate}`),n.totalDuration&&r.push(`totalDuration: ${n.totalDuration}`),n.focusScore&&r.push(`focusScore: ${n.focusScore}`),n.comprehensionScore&&r.push(`comprehensionScore: ${n.comprehensionScore}`),n.tags&&n.tags.length>0&&r.push(`tags: ${n.tags.join(", ")}`),r}var gr=/^-\s*\[(.)\]\s*(.+)$/,fr={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},hr={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function ze(n,r){var u,p,m,g,h;let e=n.match(gr);if(!e)return null;let t=(u=e[1])!=null?u:" ",a=(p=e[2])!=null?p:"",o=(m=fr[t])!=null?m:"pending",s=a.split("|").map(y=>y.trim()),i=(g=s[0])!=null?g:"",l,d,c;for(let y=1;y<s.length;y++){let f=s[y];if(!f)continue;let v=f.indexOf(":");if(v===-1){c=f;continue}let S=f.substring(0,v).trim().toLowerCase(),T=f.substring(v+1).trim();if(S==="duration"){let b=T.match(/^\[([^\]]*)\]$/);b?l=$((h=b[1])!=null?h:"0"):d=T}else c?c+=" | "+f:c=f}return{state:o,name:i,targetDuration:l,recordedDuration:d,notes:c,lineIndex:r}}function Pt(n){return hr[n]}function _e(n){let e=`- [${Pt(n.state)}] ${n.name}`;return n.targetDuration!==void 0&&n.state==="pending"?e+=` | Duration: [${yr(n.targetDuration)}]`:n.recordedDuration&&(e+=` | Duration: ${n.recordedDuration}`),n.notes&&(e+=` | ${n.notes}`),e}function yr(n){let r=Math.floor(n/60),e=n%60;return r===0?`${e}s`:e===0?`${r}m`:`${r}m ${e}s`}function de(n){var l;let r=n.split(`
`),e=-1;for(let d=0;d<r.length;d++)if(((l=r[d])==null?void 0:l.trim())==="---"){e=d;break}let t=e>0?r.slice(0,e):[],a=je(t),o=e>=0?e+1:0,s=r.slice(o),i=[];for(let d=0;d<s.length;d++){let c=s[d];if(!c)continue;let u=ze(c,d);u&&i.push(u)}return{metadata:a,tasks:i,rawLines:r,metadataEndIndex:e>=0?e:-1}}function At(n){let r=[],e=Ge(n.metadata);r.push(...e),r.push("---");for(let t of n.tasks)r.push(_e(t));return r.join(`
`)}function G(n,r,e){let t=structuredClone(n),a=t.tasks[r];return a?(a.state=e,t):n}function ue(n,r,e){let t=structuredClone(n),a=t.tasks[r];return a?(a.recordedDuration=e,a.targetDuration=void 0,t):n}function It(n,r,e){let t=structuredClone(n);return t.metadata.focusScore=r,t.metadata.comprehensionScore=e,t}function Ke(n,r,e,t,a="digital"){let o=n.createDiv({cls:"study-header"}),s=o.createDiv({cls:"study-header-top"}),i=s.createDiv({cls:"study-title"}),l=Sr(r.subject);i.createSpan({cls:"study-subject-icon",text:l}),i.createSpan({cls:"study-subject-name",text:r.subject||"\uD559\uC2B5"}),r.title&&i.createSpan({cls:"study-title-text",text:` - ${r.title}`});let d=s.createDiv({cls:"study-timer"});kr(d,r,e,t,a);let c=o.createDiv({cls:"study-scores"});if(r.state==="completed"&&vr(c,r.focusScore,r.comprehensionScore),r.tags&&r.tags.length>0){let u=o.createDiv({cls:"study-tags"});for(let p of r.tags)u.createSpan({cls:"study-tag",text:p})}return{titleEl:i,timerEl:d,scoresEl:c}}function kr(n,r,e,t,a){r.state==="completed"&&r.totalDuration?(n.createSpan({cls:"study-timer-value",text:r.totalDuration}),n.createSpan({cls:"study-timer-indicator recorded",text:" \u2713"})):t&&e?W(n,e,a):n.createSpan({cls:"study-timer-value",text:"--:--"})}function vr(n,r,e){if(r){let t=n.createDiv({cls:"study-score-item"});t.createSpan({cls:"study-score-label",text:"\uC9D1\uC911\uB3C4: "}),$t(t,r)}if(e){let t=n.createDiv({cls:"study-score-item"});t.createSpan({cls:"study-score-label",text:"\uC774\uD574\uB3C4: "}),$t(t,e)}}function $t(n,r){let e=n.createSpan({cls:`study-stars score-${r}`});for(let t=1;t<=5;t++)e.createSpan({cls:`study-star ${t<=r?"filled":"empty"}`,text:t<=r?"\u2605":"\u2606"})}function Sr(n){return{\uC218\uD559:"\u{1F4D0}",\uC601\uC5B4:"\u{1F524}",\uD504\uB85C\uADF8\uB798\uBC0D:"\u{1F4BB}",\uB3C5\uC11C:"\u{1F4D6}",\uAE30\uD0C0:"\u{1F4DD}"}[n]||"\u{1F4DA}"}function Ye(n,r,e="digital"){W(n,r,e)}function Ve(n,r,e,t,a,o,s){let i=n.createDiv({cls:`study-task state-${r.state} ${t?"active":""}`}),l=i.createDiv({cls:"study-task-main"}),d=l.createSpan({cls:"study-task-icon"});d.textContent=br(r.state);let c=l.createSpan({cls:"study-task-name"});c.textContent=r.name;let u=null;if(r.notes){let p=l.createSpan({cls:"study-task-notes"});p.textContent=r.notes}if(u=l.createSpan({cls:"study-task-timer"}),r.state==="completed"&&r.recordedDuration)u.textContent=r.recordedDuration,u.createSpan({cls:"timer-indicator recorded",text:" \u2713"});else if(t&&a)pe(u,a,r.targetDuration);else if(r.targetDuration){let p=Math.floor(r.targetDuration/60),m=r.targetDuration%60;u.textContent=`[${p}m ${m>0?m+"s":""}]`,u.classList.add("target")}return t&&s==="started"&&Tr(i,e,o),{taskEl:i,timerEl:u}}function Tr(n,r,e){let t=n.createDiv({cls:"study-task-controls"});t.createEl("button",{cls:"study-btn",text:"\u2713 \uC644\uB8CC"}).addEventListener("click",()=>e.onTaskFinish(r)),t.createEl("button",{cls:"study-btn",text:"\u23ED \uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>e.onTaskSkip(r))}function br(n){switch(n){case"completed":return"\u2713";case"inProgress":return"\u25B6";case"skipped":return"\u2013";default:return"\u25CB"}}function pe(n,r,e){if(n.empty(),n.classList.remove("overtime"),e!==void 0){let t=e-r.exerciseElapsed;t<0?(n.classList.add("overtime"),n.textContent=`+${w(Math.abs(t))}`,n.createSpan({cls:"timer-indicator overtime",text:" !"})):(n.textContent=w(t),n.createSpan({cls:"timer-indicator count-down",text:" \u25BC"}))}else n.textContent=w(r.exerciseElapsed),n.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}function Ue(n,r,e,t){let a=n.createDiv({cls:"study-controls"});if(r==="planned"){let o=a.createEl("button",{cls:"study-btn study-btn-primary study-btn-large"});o.createSpan({cls:"study-btn-icon",text:"\u25B6"}),o.createSpan({text:"\uD559\uC2B5 \uC2DC\uC791"}),o.addEventListener("click",()=>{N(),e.onStartStudy()})}else if(r==="started"){let o=a.createEl("button",{cls:"study-btn study-btn-primary"});o.createSpan({cls:"study-btn-icon",text:"\u2713"}),o.createSpan({text:"\uD559\uC2B5 \uC644\uB8CC"}),o.addEventListener("click",()=>e.onOpenSelfEval())}else if(r==="completed"){let o=a.createSpan({cls:"study-completed-label"});o.createSpan({cls:"study-btn-icon",text:"\u2713"}),o.createSpan({text:"\uC644\uB8CC\uB428"});let s=a.createEl("button",{cls:"study-btn"});s.createSpan({cls:"study-btn-icon",text:"\u{1F4CB}"}),s.createSpan({text:"\uD15C\uD50C\uB9BF \uBCF5\uC0AC"}),s.addEventListener("click",async()=>{let i=xr(t);await navigator.clipboard.writeText("```study-log\n"+i+"\n```");let l=s.querySelector("span:last-child");if(l){let d=l.textContent;l.textContent="Copied!",setTimeout(()=>{l.textContent=d},1500)}})}return a}function xr(n){let r=[];n.metadata.subject&&r.push(`subject: ${n.metadata.subject}`),r.push("state: planned"),r.push("---");let e=new Set;for(let t of n.tasks)if(!e.has(t.name)){e.add(t.name);let a=`- [ ] ${t.name}`;if(t.targetDuration){let o=Math.floor(t.targetDuration/60),s=t.targetDuration%60;a+=` | Duration: [${o}m${s>0?" "+s+"s":""}]`}r.push(a)}return r.join(`
`)}var Rt=0,wr=3e3;function me(n,r,e="complete"){let t=Date.now();t-Rt<wr||(Rt=t,n.enableSound&&J(e),n.enableNotification&&Er(r,e))}function Er(n,r){if("Notification"in window)if(Notification.permission==="granted"){let e;r==="break"?e="\uD734\uC2DD \uC2DC\uAC04\uC774 \uB05D\uB0AC\uC2B5\uB2C8\uB2E4! \uB2E4\uC2DC \uC9D1\uC911\uD558\uC138\uC694.":n?e=`"${n}" \uC644\uB8CC!`:e="\uD0C0\uC774\uBA38\uAC00 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!",new Notification("Life Log",{body:e,icon:void 0,silent:!0})}else Notification.permission!=="denied"&&Notification.requestPermission()}function Wt(n){let{el:r,parsed:e,callbacks:t,studyId:a,timerManager:o,enableTimerSound:s=!0,enableNotification:i=!1,timerStyle:l}=n;r.empty();let d=r.createDiv({cls:`study-container state-${e.metadata.state}`}),c=o.isTimerRunning(a),u=o.getTimerState(a),p=c?o.getActiveExerciseIndex(a):-1,m=Ke(d,e.metadata,u,c,l);if(e.tasks.length===0&&e.metadata.state==="planned"){Cr(d);return}let g=[],h=d.createDiv({cls:"study-tasks"});for(let y=0;y<e.tasks.length;y++){let f=e.tasks[y];if(!f)continue;let v=y===p,S=Ve(h,f,y,v,v?u:null,t,e.metadata.state);g.push(S)}if(Ue(d,e.metadata.state,t,e),d.addEventListener("focusout",y=>{let f=y.relatedTarget;(!f||!d.contains(f))&&t.onFlushChanges()}),c){let y=p,f=p>=0?e.tasks[p]:null,v=(f==null?void 0:f.targetDuration)!==void 0&&u?u.exerciseElapsed>=f.targetDuration:!1;o.subscribe(a,S=>{Ye(m.timerEl,S,l);let T=o.getActiveExerciseIndex(a);if(T!==y){y=T;let I=e.tasks[T];v=(I==null?void 0:I.targetDuration)!==void 0?S.exerciseElapsed>=I.targetDuration:!1;return}let b=g[T],C=e.tasks[T];b!=null&&b.timerEl&&C&&(pe(b.timerEl,S,C.targetDuration),!v&&C.targetDuration!==void 0&&S.exerciseElapsed>=C.targetDuration&&(v=!0,me({enableSound:s,enableNotification:i},C.name)))})}}function Cr(n){n.createDiv({cls:"study-empty-state"}).createDiv({cls:"study-empty-message",text:"\uD559\uC2B5 \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uCF54\uB4DC\uBE14\uB85D\uC5D0 \uD56D\uBAA9\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}var Dr=["planned","started","completed"];function qe(n){let r={title:"",state:"planned"};for(let e of n){let t=e.indexOf(":");if(t===-1)continue;let a=e.substring(0,t).trim().toLowerCase(),o=e.substring(t+1).trim();switch(a){case"title":r.title=o;break;case"state":Dr.includes(o)&&(r.state=o);break;case"startdate":o&&(r.startDate=o);break;case"enddate":o&&(r.endDate=o);break;case"totalduration":o&&(r.totalDuration=o);break;case"tags":o&&(r.tags=o.split(",").map(s=>s.trim()).filter(s=>s));break}}return r}function Je(n){let r=[];return n.title&&r.push(`title: ${n.title}`),r.push(`state: ${n.state}`),n.startDate&&r.push(`startDate: ${n.startDate}`),n.endDate&&r.push(`endDate: ${n.endDate}`),n.totalDuration&&r.push(`totalDuration: ${n.totalDuration}`),n.tags&&n.tags.length>0&&r.push(`tags: ${n.tags.join(", ")}`),r}var Lr=/^-\s*\[(.)\]\s*(.+)$/,Mr={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},Pr={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function Qe(n,r){var p,m,g,h,y;let e=n.match(Lr);if(!e)return null;let t=(p=e[1])!=null?p:" ",a=(m=e[2])!=null?m:"",o=(g=Mr[t])!=null?g:"pending",s=a.split("|").map(f=>f.trim()),i=(h=s[0])!=null?h:"",l="medium",d,c,u;for(let f=1;f<s.length;f++){let v=s[f];if(!v)continue;let S=v.indexOf(":");if(S===-1){u=u?u+" | "+v:v;continue}let T=v.substring(0,S).trim().toLowerCase(),b=v.substring(S+1).trim();if(T==="priority")["high","medium","low"].includes(b.toLowerCase())&&(l=b.toLowerCase());else if(T==="expected"){let C=b.match(/^\[([^\]]*)\]$/);C?d=$((y=C[1])!=null?y:"0"):d=$(b)}else T==="actual"?b&&b!==""&&(c=b):u=u?u+" | "+v:v}return{state:o,name:i,priority:l,expectedDuration:d,actualDuration:c,notes:u,lineIndex:r}}function Bt(n){return Pr[n]}function Xe(n){let e=`- [${Bt(n.state)}] ${n.name}`;return e+=` | Priority: ${n.priority}`,n.expectedDuration!==void 0&&(e+=` | Expected: [${Ar(n.expectedDuration)}]`),n.actualDuration&&(e+=` | Actual: ${n.actualDuration}`),n.notes&&(e+=` | ${n.notes}`),e}function Ar(n){let r=Math.floor(n/3600),e=Math.floor(n%3600/60),t=n%60;return r>0?e===0&&t===0?`${r}h`:t===0?`${r}h ${e}m`:`${r}h ${e}m ${t}s`:e===0?`${t}s`:t===0?`${e}m`:`${e}m ${t}s`}function ge(n){var l;let r=n.split(`
`),e=-1;for(let d=0;d<r.length;d++)if(((l=r[d])==null?void 0:l.trim())==="---"){e=d;break}let t=e>0?r.slice(0,e):[],a=qe(t),o=e>=0?e+1:0,s=r.slice(o),i=[];for(let d=0;d<s.length;d++){let c=s[d];if(!c)continue;let u=Qe(c,d);u&&i.push(u)}return{metadata:a,tasks:i,rawLines:r,metadataEndIndex:e>=0?e:-1}}function Ft(n){let r=[],e=Je(n.metadata);r.push(...e),r.push("---");for(let t of n.tasks)r.push(Xe(t));return r.join(`
`)}function z(n,r,e){let t=structuredClone(n),a=t.tasks[r];return a?(a.state=e,t):n}function fe(n,r,e){let t=structuredClone(n),a=t.tasks[r];return a?(a.actualDuration=e,t):n}function Ze(n,r,e,t,a="digital"){let o=n.createDiv({cls:"work-header"}),s=o.createDiv({cls:"work-header-top"}),i=s.createDiv({cls:"work-title"});i.createSpan({cls:"work-icon",text:"\u{1F4BC}"}),i.createSpan({cls:"work-title-text",text:r.title||"\uC5C5\uBB34"});let l=s.createDiv({cls:"work-timer"});if(Ir(l,r,e,t,a),r.tags&&r.tags.length>0){let d=o.createDiv({cls:"work-tags"});for(let c of r.tags)d.createSpan({cls:"work-tag",text:c})}return{titleEl:i,timerEl:l}}function Ir(n,r,e,t,a){r.state==="completed"&&r.totalDuration?(n.createSpan({cls:"work-timer-value",text:r.totalDuration}),n.createSpan({cls:"work-timer-indicator recorded",text:" \u2713"})):t&&e?W(n,e,a):n.createSpan({cls:"work-timer-value",text:"--:--"})}function et(n,r,e="digital"){W(n,r,e)}var $r={high:"#E74C3C",medium:"#F39C12",low:"#3498DB"},Rr={high:"\uB192\uC74C",medium:"\uBCF4\uD1B5",low:"\uB0AE\uC74C"};function tt(n,r,e,t,a,o,s){let i=n.createDiv({cls:`work-task state-${r.state} priority-${r.priority} ${t?"active":""}`}),l=i.createDiv({cls:"work-task-main"}),d=l.createSpan({cls:"work-task-icon"});d.textContent=Hr(r.state);let c=l.createSpan({cls:"work-task-priority"});c.style.backgroundColor=$r[r.priority],c.setAttribute("title",Rr[r.priority]);let u=l.createSpan({cls:"work-task-name"});u.textContent=r.name;let p=null;if(r.notes){let m=l.createSpan({cls:"work-task-notes"});m.textContent=r.notes}return p=l.createDiv({cls:"work-task-timer-group"}),r.state==="completed"&&r.actualDuration?Wr(p,r):t&&a?he(p,a,r.expectedDuration):r.expectedDuration&&Br(p,r.expectedDuration),t&&s==="started"&&Fr(i,e,o),{taskEl:i,timerEl:p}}function Wr(n,r){if(r.expectedDuration){let t=n.createSpan({cls:"work-timer-expected"});t.textContent=`\uC608\uC0C1: ${rt(r.expectedDuration)}`}let e=n.createSpan({cls:"work-timer-actual"});e.textContent=`\uC2E4\uC81C: ${r.actualDuration}`,e.createSpan({cls:"timer-indicator recorded",text:" \u2713"})}function Br(n,r){let e=n.createSpan({cls:"work-timer-expected target"});e.textContent=`\uC608\uC0C1: [${rt(r)}]`}function Fr(n,r,e){let t=n.createDiv({cls:"work-task-controls"});t.createEl("button",{cls:"work-btn",text:"\u2713 \uC644\uB8CC"}).addEventListener("click",()=>e.onTaskFinish(r)),t.createEl("button",{cls:"work-btn",text:"\u23ED \uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>e.onTaskSkip(r))}function Hr(n){switch(n){case"completed":return"\u2713";case"inProgress":return"\u25B6";case"skipped":return"\u2013";default:return"\u25CB"}}function he(n,r,e){if(n.empty(),n.classList.remove("overtime"),e!==void 0){let t=n.createSpan({cls:"work-timer-expected"});t.textContent=`\uC608\uC0C1: ${rt(e)}`;let a=n.createSpan({cls:"work-timer-actual"});r.exerciseElapsed>e?(n.classList.add("overtime"),a.textContent=`\uC2E4\uC81C: ${w(r.exerciseElapsed)}`,a.createSpan({cls:"timer-indicator overtime",text:" !"})):(a.textContent=`\uC2E4\uC81C: ${w(r.exerciseElapsed)}`,a.createSpan({cls:"timer-indicator count-up",text:" \u25B2"}))}else{let t=n.createSpan({cls:"work-timer-actual"});t.textContent=w(r.exerciseElapsed),t.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}}function rt(n){let r=Math.floor(n/3600),e=Math.floor(n%3600/60),t=n%60;return r>0?e===0&&t===0?`${r}h`:t===0?`${r}h ${e}m`:`${r}h ${e}m`:e===0?`${t}s`:t===0?`${e}m`:`${e}m ${t}s`}function at(n,r,e,t){let a=n.createDiv({cls:"work-controls"});if(r==="planned"){let o=a.createEl("button",{cls:"work-btn work-btn-primary work-btn-large"});o.createSpan({cls:"work-btn-icon",text:"\u25B6"}),o.createSpan({text:"\uC5C5\uBB34 \uC2DC\uC791"}),o.addEventListener("click",async()=>{console.log("[Life Log] Work start button clicked"),N();try{await e.onStartWork(),console.log("[Life Log] onStartWork completed")}catch(s){console.error("[Life Log] onStartWork error:",s)}})}else if(r==="started"){let o=a.createEl("button",{cls:"work-btn work-btn-primary"});o.createSpan({cls:"work-btn-icon",text:"\u2713"}),o.createSpan({text:"\uC5C5\uBB34 \uC644\uB8CC"}),o.addEventListener("click",()=>e.onFinishWork())}else if(r==="completed"){let o=a.createSpan({cls:"work-completed-label"});o.createSpan({cls:"work-btn-icon",text:"\u2713"}),o.createSpan({text:"\uC644\uB8CC\uB428"}),Or(a,t);let s=a.createEl("button",{cls:"work-btn"});s.createSpan({cls:"work-btn-icon",text:"\u{1F4CB}"}),s.createSpan({text:"\uD15C\uD50C\uB9BF \uBCF5\uC0AC"}),s.addEventListener("click",async()=>{let i=Nr(t);await navigator.clipboard.writeText("```work-log\n"+i+"\n```");let l=s.querySelector("span:last-child");if(l){let d=l.textContent;l.textContent="Copied!",setTimeout(()=>{l.textContent=d},1500)}})}return a}function Or(n,r){let e=n.createDiv({cls:"work-stats"}),t=r.tasks.filter(i=>i.state==="completed").length,a=r.tasks.length;e.createSpan({cls:"work-stat",text:`\uC644\uB8CC: ${t}/${a}`});let o=r.tasks.filter(i=>i.priority==="high"&&i.state==="completed").length,s=r.tasks.filter(i=>i.priority==="high").length;if(s>0){let i=e.createSpan({cls:"work-stat high-priority"});i.createSpan({cls:"priority-dot high"}),i.createSpan({text:` \uC911\uC694: ${o}/${s}`})}}function Nr(n){let r=[];r.push("state: planned"),r.push("---");let e=new Set;for(let t of n.tasks)if(!e.has(t.name)){e.add(t.name);let a=`- [ ] ${t.name} | Priority: ${t.priority}`;t.expectedDuration&&(a+=` | Expected: [${jr(t.expectedDuration)}]`),r.push(a)}return r.join(`
`)}function jr(n){let r=Math.floor(n/3600),e=Math.floor(n%3600/60);return r>0?e===0?`${r}h`:`${r}h ${e}m`:`${e}m`}function Ht(n){let{el:r,parsed:e,callbacks:t,workId:a,timerManager:o,enableTimerSound:s=!0,enableNotification:i=!1,timerStyle:l}=n;r.empty();let d=r.createDiv({cls:`work-container state-${e.metadata.state}`}),c=o.isTimerRunning(a),u=o.getTimerState(a),p=c?o.getActiveExerciseIndex(a):-1,m=Ze(d,e.metadata,u,c,l);if(e.tasks.length===0&&e.metadata.state==="planned"){Gr(d);return}let g=[],h=d.createDiv({cls:"work-tasks"});for(let y=0;y<e.tasks.length;y++){let f=e.tasks[y];if(!f)continue;let v=tt(h,f,y,y===p,y===p?u:null,t,e.metadata.state);g.push(v)}if(at(d,e.metadata.state,t,e),d.addEventListener("focusout",y=>{let f=y.relatedTarget;(!f||!d.contains(f))&&t.onFlushChanges()}),c){let y=p,f=p>=0?e.tasks[p]:null,v=(f==null?void 0:f.expectedDuration)!==void 0&&u?u.exerciseElapsed>=f.expectedDuration:!1;o.subscribe(a,S=>{et(m.timerEl,S,l);let T=o.getActiveExerciseIndex(a);if(T!==y){y=T;let I=e.tasks[T];v=(I==null?void 0:I.expectedDuration)!==void 0?S.exerciseElapsed>=I.expectedDuration:!1;return}let b=g[T],C=e.tasks[T];b!=null&&b.timerEl&&C&&(he(b.timerEl,S,C.expectedDuration),!v&&C.expectedDuration!==void 0&&S.exerciseElapsed>=C.expectedDuration&&(v=!0,me({enableSound:s,enableNotification:i},C.name)))})}}function Gr(n){n.createDiv({cls:"work-empty-state"}).createDiv({cls:"work-empty-message",text:"\uC5C5\uBB34 \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uCF54\uB4DC\uBE14\uB85D\uC5D0 \uD56D\uBAA9\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}var zr=["planned","started","completed"],_r=["breakfast","lunch","dinner","snack"];function ot(n){let r={title:"",mealType:"lunch",state:"planned"};for(let e of n){let t=e.indexOf(":");if(t===-1)continue;let a=e.substring(0,t).trim().toLowerCase(),o=e.substring(t+1).trim();switch(a){case"title":r.title=o;break;case"mealtype":_r.includes(o.toLowerCase())&&(r.mealType=o.toLowerCase());break;case"state":zr.includes(o)&&(r.state=o);break;case"date":o&&(r.date=o);break;case"photo":o&&(r.photo=o);break;case"notes":o&&(r.notes=o);break}}return r}function st(n){let r=[];return n.title&&r.push(`title: ${n.title}`),r.push(`mealType: ${n.mealType}`),r.push(`state: ${n.state}`),n.date&&r.push(`date: ${n.date}`),n.photo&&r.push(`photo: ${n.photo}`),n.notes&&r.push(`notes: ${n.notes}`),r}var Kr=/^-\s*\[(.)\]\s*(.+)$/;var Yr={pending:" ",completed:"x"};function nt(n,r){var s,i;let e=n.match(Kr);if(!e)return null;let t=(s=e[1])!=null?s:" ",a=((i=e[2])!=null?i:"").trim();return{state:t==="x"?"completed":"pending",name:a,lineIndex:r}}function Ot(n){return Yr[n]}function it(n){return`- [${Ot(n.state)}] ${n.name}`}function ye(n){var l;let r=n.split(`
`),e=-1;for(let d=0;d<r.length;d++)if(((l=r[d])==null?void 0:l.trim())==="---"){e=d;break}let t=e>0?r.slice(0,e):[],a=ot(t),o=e>=0?e+1:0,s=r.slice(o),i=[];for(let d=0;d<s.length;d++){let c=s[d];if(!c)continue;let u=nt(c,d);u&&i.push(u)}return{metadata:a,foods:i,rawLines:r,metadataEndIndex:e>=0?e:-1}}function Nt(n){let r=[],e=st(n.metadata);r.push(...e),r.push("---");for(let t of n.foods)r.push(it(t));return r.join(`
`)}function jt(n,r){let e=structuredClone(n),t={state:"pending",name:r,lineIndex:e.foods.length};return e.foods.push(t),e}function Gt(n,r){let e=structuredClone(n);if(r<0||r>=e.foods.length)return n;e.foods.splice(r,1);for(let t=r;t<e.foods.length;t++){let a=e.foods[t];a&&(a.lineIndex=t)}return e}function zt(n,r){let e=structuredClone(n);return e.metadata.photo=r,e}function lt(n,r){let e=structuredClone(n),t=e.foods[r];return t?(t.state=t.state==="completed"?"pending":"completed",e):n}var Vr={breakfast:{icon:"\u{1F305}",label:"\uC544\uCE68"},lunch:{icon:"\u2600\uFE0F",label:"\uC810\uC2EC"},dinner:{icon:"\u{1F319}",label:"\uC800\uB141"},snack:{icon:"\u{1F36A}",label:"\uAC04\uC2DD"}};function ct(n,r){let e=n.createDiv({cls:"meal-header"}),t=e.createDiv({cls:"meal-header-top"}),a=t.createDiv({cls:"meal-title"}),o=Vr[r.mealType];a.createSpan({cls:"meal-icon",text:o.icon}),a.createSpan({cls:"meal-title-text",text:r.title||o.label}),r.date&&t.createDiv({cls:"meal-date"}).createSpan({text:r.date});let s=null;if(r.photo){s=e.createDiv({cls:"meal-photo-container"});let i=s.createDiv({cls:"meal-photo"});i.innerHTML=`<span class="meal-photo-embed">${r.photo}</span>`}if(r.notes){let i=e.createDiv({cls:"meal-notes"});i.createSpan({cls:"meal-notes-icon",text:"\u{1F4DD}"}),i.createSpan({cls:"meal-notes-text",text:r.notes})}return{titleEl:a,photoEl:s}}function dt(n,r,e,t,a){let o=n.createDiv({cls:`meal-food-item state-${r.state}`}),s=o.createDiv({cls:"meal-food-content"}),i=s.createEl("input",{type:"checkbox",cls:"meal-food-checkbox"});i.checked=r.state==="completed",i.disabled=a==="completed",i.addEventListener("change",async()=>{await t.onFoodToggle(e)});let l=s.createDiv({cls:"meal-food-name"});return l.setText(r.name),a!=="completed"&&s.createEl("button",{cls:"meal-food-remove-btn",text:"\u2715"}).addEventListener("click",async c=>{c.preventDefault(),await t.onRemoveFood(e)}),{container:o,checkboxEl:i,nameEl:l}}function ut(n,r,e,t){let a=n.createDiv({cls:"meal-controls"});if(r==="completed"){Ur(a);return}let o=a.createDiv({cls:"meal-add-food"}),s=o.createEl("input",{type:"text",cls:"meal-food-input",placeholder:"\uC74C\uC2DD \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694..."}),i=o.createEl("button",{cls:"meal-add-btn",text:"\u2795 \uCD94\uAC00"}),l=async()=>{let d=s.value.trim();d&&(await e.onAddFood(d),s.value="")};i.addEventListener("click",l),s.addEventListener("keypress",async d=>{d.key==="Enter"&&await l()}),t.foods.length>0&&a.createEl("button",{cls:"meal-complete-btn",text:"\u2713 \uC2DD\uC0AC \uC644\uB8CC"}).addEventListener("click",async()=>{await e.onCompleteMeal()})}function Ur(n){let r=n.createDiv({cls:"meal-completed-badge"});r.createSpan({cls:"meal-completed-icon",text:"\u2713"}),r.createSpan({cls:"meal-completed-text",text:"\uC2DD\uC0AC \uC644\uB8CC"})}function _t(n){let{el:r,parsed:e,callbacks:t,app:a}=n;r.empty();let o=r.createDiv({cls:`meal-container state-${e.metadata.state}`}),s=ct(o,e.metadata);s.photoEl&&e.metadata.photo&&Jr(s.photoEl,e.metadata.photo,a);let i=o.createDiv({cls:"meal-foods"}),l=[];if(e.foods.length===0&&e.metadata.state!=="completed")qr(i);else for(let d=0;d<e.foods.length;d++){let c=e.foods[d];if(!c)continue;let u=dt(i,c,d,t,e.metadata.state);l.push(u)}ut(o,e.metadata.state,t,e),o.addEventListener("focusout",d=>{let c=d.relatedTarget;(!c||!o.contains(c))&&t.onFlushChanges()})}function qr(n){n.createDiv({cls:"meal-empty-state"}).createDiv({cls:"meal-empty-message",text:"\uC544\uC9C1 \uC74C\uC2DD\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uC544\uB798\uC5D0\uC11C \uC74C\uC2DD\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}function Jr(n,r,e){var l;let t=r.match(/!\[\[([^\]]+)\]\]/);if(!t)return;let a=t[1];if(!a)return;let o=e.metadataCache.getFirstLinkpathDest(a,"");if(!o){(l=n.querySelector(".meal-photo-embed"))==null||l.setText(`\u{1F4F7} ${a} (\uC774\uBBF8\uC9C0\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC74C)`);return}let s=e.vault.getResourcePath(o),i=n.querySelector(".meal-photo");if(i){i.empty();let d=i.createEl("img",{cls:"meal-photo-image",attr:{src:s,alt:a}})}}var k=require("obsidian"),pt=[{name:"\uC218\uD559",icon:"",color:"#4A90D9"},{name:"\uC601\uC5B4",icon:"",color:"#7B68EE"},{name:"\uD504\uB85C\uADF8\uB798\uBC0D",icon:"",color:"#50C878"},{name:"\uB3C5\uC11C",icon:"",color:"#FFB347"},{name:"\uAE30\uD0C0",icon:"",color:"#A0A0A0"}],ve=[{name:"\uC0C1\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uD478\uC2DC\uC5C5",params:"\uD69F\uC218: [15]"},{name:"\uB364\uBCA8 \uB85C\uC6B0",params:"\uBB34\uAC8C: [10]kg | \uD69F\uC218: [12]"},{name:"\uC204\uB354 \uD504\uB808\uC2A4",params:"\uBB34\uAC8C: [8]kg | \uD69F\uC218: [10]"}]},{name:"\uD558\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uC2A4\uCFFC\uD2B8",params:"\uBB34\uAC8C: [40]kg | \uD69F\uC218: [12]"},{name:"\uB7F0\uC9C0",params:"\uD69F\uC218: [10] /\uB2E4\uB9AC"},{name:"\uCE74\uD504\uB808\uC774\uC988",params:"\uD69F\uC218: [20]"}]},{name:"HIIT",exercises:[{name:"\uBC84\uD53C",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uC810\uD551\uC7AD",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uB9C8\uC6B4\uD2F4 \uD074\uB77C\uC774\uBA38",params:"\uC2DC\uAC04: [30\uCD08]"}]}],X={defaultProvider:"openai",openaiApiKey:"",openaiModel:"gpt-5",geminiApiKey:"",geminiModel:"gemini-2.5-flash",grokApiKey:"",grokModel:"grok-4-1-fast",openRouterApiKey:"",openRouterModel:"anthropic/claude-sonnet-4",openRouterCustomModels:[],autoAnalysis:!1,analysisSchedule:"manual",enabledTemplates:["study-weekly","study-monthly","workout-weekly","workout-progress","work-weekly","work-productivity","meal-weekly","meal-pattern"],customTemplates:[],reportSavePath:"Life Logs/Reports",reportNaming:"{{category}}_{{date}}_report"},mt={logFolder:"Life Logs",dateFormat:"YYYY-MM-DD",subjects:pt,defaultStudyDuration:30,enablePomodoro:!1,pomodoroWork:25,pomodoroBreak:5,defaultRestDuration:60,workoutTemplates:ve,defaultTab:"study",showRibbonIcon:!0,enableTimerSound:!0,enableNotifications:!0,timerStyle:"digital",usePerTypeTimerStyle:!1,studyTimerStyle:"pomodoro",workTimerStyle:"digital",workoutTimerStyle:"digital",aiAnalysis:X},ke=class extends k.PluginSettingTab{constructor(r,e){super(r,e),this.plugin=e,console.log("[Life Log] LifeLogSettingTab constructed")}display(){console.log("[Life Log] LifeLogSettingTab.display() called");let{containerEl:r}=this;if(r.empty(),r.createEl("h2",{text:"Life Log \uC124\uC815"}),!this.plugin.settings){r.createEl("p",{text:"\uC124\uC815\uC744 \uBD88\uB7EC\uC624\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."});return}this.plugin.settings.aiAnalysis||(this.plugin.settings.aiAnalysis={...X}),this.renderSaveSettings(r),this.renderStudySettings(r),this.renderWorkoutSettings(r),this.renderTimerStyleSettings(r),this.renderUISettings(r),this.renderNotificationSettings(r),this.renderAISettings(r)}renderSaveSettings(r){r.createEl("h3",{text:"\u{1F4C1} \uC800\uC7A5 \uC124\uC815"}),new k.Setting(r).setName("\uAE30\uB85D \uC800\uC7A5 \uD3F4\uB354").setDesc("\uD559\uC2B5/\uC6B4\uB3D9 \uAE30\uB85D\uC774 \uC800\uC7A5\uB420 \uD3F4\uB354 \uACBD\uB85C").addText(e=>e.setPlaceholder("Life Logs").setValue(this.plugin.settings.logFolder).onChange(async t=>{this.plugin.settings.logFolder=t||"Life Logs",await this.plugin.saveSettings()})),new k.Setting(r).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uB420 \uB0A0\uC9DC \uD615\uC2DD").addDropdown(e=>e.addOption("YYYY-MM-DD","YYYY-MM-DD").addOption("YYYY/MM/DD","YYYY/MM/DD").addOption("DD-MM-YYYY","DD-MM-YYYY").setValue(this.plugin.settings.dateFormat).onChange(async t=>{this.plugin.settings.dateFormat=t,await this.plugin.saveSettings()}))}renderStudySettings(r){r.createEl("h3",{text:"\u{1F4DA} \uD559\uC2B5 \uAE30\uB85D \uC124\uC815"}),new k.Setting(r).setName("\uAE30\uBCF8 \uBAA9\uD45C \uC2DC\uAC04").setDesc("\uD559\uC2B5 \uD56D\uBAA9\uC758 \uAE30\uBCF8 \uBAA9\uD45C \uC2DC\uAC04 (\uBD84)").addText(e=>e.setPlaceholder("30").setValue(String(this.plugin.settings.defaultStudyDuration)).onChange(async t=>{let a=parseInt(t)||30;this.plugin.settings.defaultStudyDuration=Math.max(1,Math.min(480,a)),await this.plugin.saveSettings()})),new k.Setting(r).setName("\uD3EC\uBAA8\uB3C4\uB85C \uBAA8\uB4DC").setDesc("25\uBD84 \uD559\uC2B5 + 5\uBD84 \uD734\uC2DD \uC0AC\uC774\uD074 \uD65C\uC131\uD654").addToggle(e=>e.setValue(this.plugin.settings.enablePomodoro).onChange(async t=>{this.plugin.settings.enablePomodoro=t,await this.plugin.saveSettings()})),this.plugin.settings.enablePomodoro&&(new k.Setting(r).setName("\uC791\uC5C5 \uC2DC\uAC04").setDesc("\uD3EC\uBAA8\uB3C4\uB85C \uC791\uC5C5 \uC2DC\uAC04 (\uBD84)").addText(e=>e.setPlaceholder("25").setValue(String(this.plugin.settings.pomodoroWork)).onChange(async t=>{let a=parseInt(t)||25;this.plugin.settings.pomodoroWork=Math.max(1,Math.min(60,a)),await this.plugin.saveSettings()})),new k.Setting(r).setName("\uD734\uC2DD \uC2DC\uAC04").setDesc("\uD3EC\uBAA8\uB3C4\uB85C \uD734\uC2DD \uC2DC\uAC04 (\uBD84)").addText(e=>e.setPlaceholder("5").setValue(String(this.plugin.settings.pomodoroBreak)).onChange(async t=>{let a=parseInt(t)||5;this.plugin.settings.pomodoroBreak=Math.max(1,Math.min(30,a)),await this.plugin.saveSettings()}))),this.renderSubjectManager(r)}renderSubjectManager(r){let e=r.createDiv({cls:"subject-manager"});new k.Setting(e).setName("\uACFC\uBAA9 \uAD00\uB9AC").setDesc("\uC790\uC8FC \uC0AC\uC6A9\uD558\uB294 \uACFC\uBAA9\uC744 \uAD00\uB9AC\uD569\uB2C8\uB2E4").addButton(a=>a.setButtonText("+ \uACFC\uBAA9 \uCD94\uAC00").onClick(async()=>{this.plugin.settings.subjects.push({name:"\uC0C8 \uACFC\uBAA9",icon:"\u{1F4DA}",color:"#808080"}),await this.plugin.saveSettings(),this.display()}));let t=e.createDiv({cls:"subject-list"});for(let a=0;a<this.plugin.settings.subjects.length;a++){let o=this.plugin.settings.subjects[a];if(!o)continue;let s=t.createDiv({cls:"subject-row"}),i=s.createEl("input",{type:"text",value:o.icon,cls:"subject-icon-input"});i.maxLength=2,i.addEventListener("change",async()=>{o.icon=i.value||"\u{1F4DA}",await this.plugin.saveSettings()});let l=s.createEl("input",{type:"text",value:o.name,cls:"subject-name-input"});l.addEventListener("change",async()=>{o.name=l.value||"\uACFC\uBAA9",await this.plugin.saveSettings()});let d=s.createEl("input",{type:"color",value:o.color,cls:"subject-color-input"});d.addEventListener("change",async()=>{o.color=d.value,await this.plugin.saveSettings()}),s.createEl("button",{text:"\u{1F5D1}",cls:"subject-delete-btn"}).addEventListener("click",async()=>{this.plugin.settings.subjects.splice(a,1),await this.plugin.saveSettings(),this.display()})}}renderWorkoutSettings(r){r.createEl("h3",{text:"\uC6B4\uB3D9 \uAE30\uB85D \uC124\uC815"}),new k.Setting(r).setName("\uAE30\uBCF8 \uD734\uC2DD \uC2DC\uAC04").setDesc("\uC6B4\uB3D9 \uC138\uD2B8 \uC0AC\uC774 \uAE30\uBCF8 \uD734\uC2DD \uC2DC\uAC04 (\uCD08)").addText(e=>e.setPlaceholder("60").setValue(String(this.plugin.settings.defaultRestDuration)).onChange(async t=>{let a=parseInt(t)||60;this.plugin.settings.defaultRestDuration=Math.max(10,Math.min(300,a)),await this.plugin.saveSettings()})),this.renderWorkoutTemplateManager(r)}renderWorkoutTemplateManager(r){let e=r.createDiv({cls:"template-manager"});new k.Setting(e).setName("\uC6B4\uB3D9 \uD15C\uD50C\uB9BF \uAD00\uB9AC").setDesc("\uBE60\uB978 \uD15C\uD50C\uB9BF\uC5D0 \uD45C\uC2DC\uB418\uB294 \uC6B4\uB3D9 \uC138\uD2B8\uB97C \uAD00\uB9AC\uD569\uB2C8\uB2E4").addButton(a=>a.setButtonText("+ \uD15C\uD50C\uB9BF \uCD94\uAC00").onClick(async()=>{this.plugin.settings.workoutTemplates.push({name:"\uC0C8 \uD15C\uD50C\uB9BF",exercises:[{name:"\uC6B4\uB3D9\uBA85",params:"\uD69F\uC218: [10]"}]}),await this.plugin.saveSettings(),this.display()}));let t=e.createDiv({cls:"template-list"});this.plugin.settings.workoutTemplates||(this.plugin.settings.workoutTemplates=[...ve]);for(let a=0;a<this.plugin.settings.workoutTemplates.length;a++){let o=this.plugin.settings.workoutTemplates[a];if(!o)continue;let s=t.createDiv({cls:"template-item"}),i=s.createDiv({cls:"template-header-row"}),l=i.createEl("input",{type:"text",value:o.name,cls:"template-name-input"});l.addEventListener("change",async()=>{o.name=l.value||"\uD15C\uD50C\uB9BF",await this.plugin.saveSettings()}),i.createEl("button",{text:"\uC0AD\uC81C",cls:"template-delete-btn"}).addEventListener("click",async()=>{this.plugin.settings.workoutTemplates.splice(a,1),await this.plugin.saveSettings(),this.display()});let c=s.createDiv({cls:"template-exercise-list"});for(let p=0;p<o.exercises.length;p++){let m=o.exercises[p];if(!m)continue;let g=c.createDiv({cls:"template-exercise-row"}),h=g.createEl("input",{type:"text",value:m.name,placeholder:"\uC6B4\uB3D9\uBA85",cls:"template-exercise-name"});h.addEventListener("change",async()=>{m.name=h.value||"\uC6B4\uB3D9",await this.plugin.saveSettings()});let y=g.createEl("input",{type:"text",value:m.params,placeholder:"\uBB34\uAC8C: [60]kg | \uD69F\uC218: [10]",cls:"template-exercise-params"});y.addEventListener("change",async()=>{m.params=y.value||"",await this.plugin.saveSettings()}),g.createEl("button",{text:"\xD7",cls:"template-exercise-delete"}).addEventListener("click",async()=>{o.exercises.splice(p,1),await this.plugin.saveSettings(),this.display()})}s.createEl("button",{text:"+ \uC6B4\uB3D9 \uCD94\uAC00",cls:"template-add-exercise"}).addEventListener("click",async()=>{o.exercises.push({name:"\uC6B4\uB3D9\uBA85",params:"\uD69F\uC218: [10]"}),await this.plugin.saveSettings(),this.display()})}}renderTimerStyleSettings(r){r.createEl("h3",{text:"\uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C"});let e=[{value:"digital",label:"\uB514\uC9C0\uD138 (00:00:00)"},{value:"pomodoro",label:"\uBF40\uBAA8\uB3C4\uB85C (25/5 \uC0AC\uC774\uD074)"},{value:"analog",label:"\uC544\uB0A0\uB85C\uADF8 (\uC6D0\uD615 \uC2DC\uACC4)"}];new k.Setting(r).setName("\uACF5\uD1B5 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").setDesc("\uBAA8\uB4E0 \uAE30\uB85D \uC720\uD615\uC5D0 \uC801\uC6A9\uB418\uB294 \uAE30\uBCF8 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(t=>{for(let a of e)t.addOption(a.value,a.label);t.setValue(this.plugin.settings.timerStyle).onChange(async a=>{this.plugin.settings.timerStyle=a,await this.plugin.saveSettings()})}),new k.Setting(r).setName("\uC720\uD615\uBCC4 \uAC1C\uBCC4 \uC124\uC815").setDesc("\uD559\uC2B5/\uC5C5\uBB34/\uC6B4\uB3D9 \uAE30\uB85D\uB9C8\uB2E4 \uB2E4\uB978 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C \uC0AC\uC6A9").addToggle(t=>t.setValue(this.plugin.settings.usePerTypeTimerStyle).onChange(async a=>{this.plugin.settings.usePerTypeTimerStyle=a,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.usePerTypeTimerStyle&&(new k.Setting(r).setName("\uD559\uC2B5 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uD559\uC2B5 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(t=>{for(let a of e)t.addOption(a.value,a.label);t.setValue(this.plugin.settings.studyTimerStyle).onChange(async a=>{this.plugin.settings.studyTimerStyle=a,await this.plugin.saveSettings()})}),new k.Setting(r).setName("\uC5C5\uBB34 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uC5C5\uBB34 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(t=>{for(let a of e)t.addOption(a.value,a.label);t.setValue(this.plugin.settings.workTimerStyle).onChange(async a=>{this.plugin.settings.workTimerStyle=a,await this.plugin.saveSettings()})}),new k.Setting(r).setName("\uC6B4\uB3D9 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uC6B4\uB3D9 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(t=>{for(let a of e)t.addOption(a.value,a.label);t.setValue(this.plugin.settings.workoutTimerStyle).onChange(async a=>{this.plugin.settings.workoutTimerStyle=a,await this.plugin.saveSettings()})}))}renderUISettings(r){r.createEl("h3",{text:"UI \uC124\uC815"}),new k.Setting(r).setName("\uAE30\uBCF8 \uD0ED").setDesc("\uC0C8 \uAE30\uB85D \uBAA8\uB2EC\uC744 \uC5F4 \uB54C \uAE30\uBCF8\uC73C\uB85C \uC120\uD0DD\uB418\uB294 \uD0ED").addDropdown(e=>e.addOption("study","\uD559\uC2B5 \uAE30\uB85D").addOption("work","\uC5C5\uBB34 \uAE30\uB85D").addOption("workout","\uC6B4\uB3D9 \uAE30\uB85D").addOption("meal","\uC2DD\uB2E8 \uAE30\uB85D").setValue(this.plugin.settings.defaultTab).onChange(async t=>{this.plugin.settings.defaultTab=t,await this.plugin.saveSettings()})),new k.Setting(r).setName("\uB9AC\uBCF8 \uC544\uC774\uCF58").setDesc("\uC67C\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uBE60\uB978 \uC811\uADFC \uC544\uC774\uCF58 \uD45C\uC2DC").addToggle(e=>e.setValue(this.plugin.settings.showRibbonIcon).onChange(async t=>{this.plugin.settings.showRibbonIcon=t,await this.plugin.saveSettings(),this.plugin.updateRibbonIcon()}))}renderNotificationSettings(r){r.createEl("h3",{text:"\u{1F514} \uC54C\uB9BC \uC124\uC815"}),new k.Setting(r).setName("\uD0C0\uC774\uBA38 \uC644\uB8CC\uC74C").setDesc("\uCE74\uC6B4\uD2B8\uB2E4\uC6B4 \uC644\uB8CC \uC2DC \uC54C\uB9BC\uC74C \uC7AC\uC0DD").addToggle(e=>e.setValue(this.plugin.settings.enableTimerSound).onChange(async t=>{this.plugin.settings.enableTimerSound=t,await this.plugin.saveSettings()})),new k.Setting(r).setName("\uC2DC\uC2A4\uD15C \uC54C\uB9BC").setDesc("\uD0C0\uC774\uBA38 \uC644\uB8CC \uC2DC \uC2DC\uC2A4\uD15C \uC54C\uB9BC \uD45C\uC2DC").addToggle(e=>e.setValue(this.plugin.settings.enableNotifications).onChange(async t=>{this.plugin.settings.enableNotifications=t,await this.plugin.saveSettings()}))}renderAISettings(r){r.createEl("h3",{text:"\u{1F916} AI \uBD84\uC11D \uC124\uC815"});let e=this.plugin.settings.aiAnalysis;new k.Setting(r).setName("AI Provider").setDesc("\uBD84\uC11D\uC5D0 \uC0AC\uC6A9\uD560 AI \uC11C\uBE44\uC2A4\uB97C \uC120\uD0DD\uD569\uB2C8\uB2E4").addDropdown(t=>t.addOption("openai","OpenAI (GPT-4)").addOption("gemini","Google Gemini").addOption("grok","xAI Grok").addOption("openrouter","OpenRouter").setValue(e.defaultProvider).onChange(async a=>{e.defaultProvider=a,await this.plugin.saveSettings(),this.display()})),this.renderOpenAISettings(r,e),this.renderGeminiSettings(r,e),this.renderGrokSettings(r,e),this.renderOpenRouterSettings(r,e),this.renderReportSettings(r,e)}renderOpenAISettings(r,e){let t=e.defaultProvider==="openai",a=r.createDiv({cls:`ai-provider-section ${t?"active":"collapsed"}`});if(new k.Setting(a).setName("\u25B6 OpenAI \uC124\uC815").setDesc(t?"\uD604\uC7AC \uC0AC\uC6A9 \uC911":"\uD074\uB9AD\uD558\uC5EC \uD655\uC7A5").setClass("ai-provider-header").addButton(o=>o.setButtonText("\uC5F0\uACB0 \uD14C\uC2A4\uD2B8").setDisabled(!e.openaiApiKey).onClick(async()=>{await this.testOpenAIConnection(e)})),t||e.openaiApiKey){new k.Setting(a).setName("API Key").setDesc("OpenAI API \uD0A4").addText(i=>i.setPlaceholder("sk-...").setValue(e.openaiApiKey?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async l=>{l&&!l.startsWith("\u2022\u2022")&&(e.openaiApiKey=l,await this.plugin.saveSettings(),this.display())}));let o=[{value:"gpt-5.2",label:"GPT-5.2 (\uCD5C\uC2E0)"},{value:"gpt-5",label:"GPT-5 (\uCD94\uCC9C)"},{value:"o4-mini",label:"o4-mini (\uCD94\uB860 \uCD5C\uC801\uD654)"},{value:"o3",label:"o3 (\uCD94\uB860 \uBAA8\uB378)"},{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini (\uBE60\uB984)"},{value:"custom",label:"\uC9C1\uC811 \uC785\uB825..."}],s=!o.some(i=>i.value===e.openaiModel&&i.value!=="custom");new k.Setting(a).setName("\uBAA8\uB378").setDesc("\uC0AC\uC6A9\uD560 OpenAI \uBAA8\uB378").addDropdown(i=>{for(let l of o)i.addOption(l.value,l.label);i.setValue(s?"custom":e.openaiModel).onChange(async l=>{l==="custom"?this.display():(e.openaiModel=l,await this.plugin.saveSettings(),this.display())})}),(s||e.openaiModel==="custom")&&new k.Setting(a).setName("\uCEE4\uC2A4\uD140 \uBAA8\uB378\uBA85").setDesc("OpenAI \uBAA8\uB378 ID\uB97C \uC9C1\uC811 \uC785\uB825").addText(i=>i.setPlaceholder("gpt-5-turbo").setValue(s?e.openaiModel:"").onChange(async l=>{l&&(e.openaiModel=l,await this.plugin.saveSettings())}))}}renderGeminiSettings(r,e){let t=e.defaultProvider==="gemini",a=r.createDiv({cls:`ai-provider-section ${t?"active":"collapsed"}`});if(new k.Setting(a).setName("\u25B6 Google Gemini \uC124\uC815").setDesc(t?"\uD604\uC7AC \uC0AC\uC6A9 \uC911":"\uD074\uB9AD\uD558\uC5EC \uD655\uC7A5").setClass("ai-provider-header").addButton(o=>o.setButtonText("\uC5F0\uACB0 \uD14C\uC2A4\uD2B8").setDisabled(!e.geminiApiKey).onClick(async()=>{await this.testGeminiConnection(e)})),t||e.geminiApiKey){new k.Setting(a).setName("API Key").setDesc("Google AI Studio API \uD0A4").addText(i=>i.setPlaceholder("AIza...").setValue(e.geminiApiKey?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async l=>{l&&!l.startsWith("\u2022\u2022")&&(e.geminiApiKey=l,await this.plugin.saveSettings(),this.display())}));let o=[{value:"gemini-3-pro-preview",label:"Gemini 3 Pro (\uCD5C\uC2E0)"},{value:"gemini-3-flash-preview",label:"Gemini 3 Flash (\uBE60\uB984)"},{value:"gemini-2.5-pro",label:"Gemini 2.5 Pro (\uCD94\uCC9C)"},{value:"gemini-2.5-flash",label:"Gemini 2.5 Flash"},{value:"gemini-2.5-flash-lite",label:"Gemini 2.5 Flash Lite (\uACBD\uB7C9)"},{value:"custom",label:"\uC9C1\uC811 \uC785\uB825..."}],s=!o.some(i=>i.value===e.geminiModel&&i.value!=="custom");new k.Setting(a).setName("\uBAA8\uB378").setDesc("\uC0AC\uC6A9\uD560 Gemini \uBAA8\uB378").addDropdown(i=>{for(let l of o)i.addOption(l.value,l.label);i.setValue(s?"custom":e.geminiModel).onChange(async l=>{l==="custom"?this.display():(e.geminiModel=l,await this.plugin.saveSettings(),this.display())})}),(s||e.geminiModel==="custom")&&new k.Setting(a).setName("\uCEE4\uC2A4\uD140 \uBAA8\uB378\uBA85").setDesc("Gemini \uBAA8\uB378 ID\uB97C \uC9C1\uC811 \uC785\uB825").addText(i=>i.setPlaceholder("gemini-3-ultra").setValue(s?e.geminiModel:"").onChange(async l=>{l&&(e.geminiModel=l,await this.plugin.saveSettings())}))}}renderGrokSettings(r,e){let t=e.defaultProvider==="grok",a=r.createDiv({cls:`ai-provider-section ${t?"active":"collapsed"}`});if(new k.Setting(a).setName("\u25B6 xAI Grok \uC124\uC815").setDesc(t?"\uD604\uC7AC \uC0AC\uC6A9 \uC911":"\uD074\uB9AD\uD558\uC5EC \uD655\uC7A5").setClass("ai-provider-header").addButton(o=>o.setButtonText("\uC5F0\uACB0 \uD14C\uC2A4\uD2B8").setDisabled(!e.grokApiKey).onClick(async()=>{await this.testGrokConnection(e)})),t||e.grokApiKey){new k.Setting(a).setName("API Key").setDesc("xAI API \uD0A4").addText(i=>i.setPlaceholder("xai-...").setValue(e.grokApiKey?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async l=>{l&&!l.startsWith("\u2022\u2022")&&(e.grokApiKey=l,await this.plugin.saveSettings(),this.display())}));let o=[{value:"grok-4-1-fast",label:"Grok 4.1 Fast (\uCD5C\uC2E0/\uBE60\uB984)"},{value:"grok-4-heavy",label:"Grok 4 Heavy (\uACE0\uC131\uB2A5)"},{value:"grok-4",label:"Grok 4 (\uCD94\uCC9C)"},{value:"grok-3",label:"Grok 3"},{value:"grok-3-mini",label:"Grok 3 Mini (\uACBD\uB7C9)"},{value:"custom",label:"\uC9C1\uC811 \uC785\uB825..."}],s=!o.some(i=>i.value===e.grokModel&&i.value!=="custom");new k.Setting(a).setName("\uBAA8\uB378").setDesc("\uC0AC\uC6A9\uD560 Grok \uBAA8\uB378").addDropdown(i=>{for(let l of o)i.addOption(l.value,l.label);i.setValue(s?"custom":e.grokModel).onChange(async l=>{l==="custom"?this.display():(e.grokModel=l,await this.plugin.saveSettings(),this.display())})}),(s||e.grokModel==="custom")&&new k.Setting(a).setName("\uCEE4\uC2A4\uD140 \uBAA8\uB378\uBA85").setDesc("Grok \uBAA8\uB378 ID\uB97C \uC9C1\uC811 \uC785\uB825").addText(i=>i.setPlaceholder("grok-5-preview").setValue(s?e.grokModel:"").onChange(async l=>{l&&(e.grokModel=l,await this.plugin.saveSettings())}))}}renderOpenRouterSettings(r,e){let t=e.defaultProvider==="openrouter",a=r.createDiv({cls:`ai-provider-section ${t?"active":"collapsed"}`});if(new k.Setting(a).setName("\u25B6 OpenRouter \uC124\uC815").setDesc(t?"\uD604\uC7AC \uC0AC\uC6A9 \uC911 - \uB2E4\uC591\uD55C \uBAA8\uB378 \uC120\uD0DD \uAC00\uB2A5":"\uD074\uB9AD\uD558\uC5EC \uD655\uC7A5").setClass("ai-provider-header").addButton(o=>o.setButtonText("\uC5F0\uACB0 \uD14C\uC2A4\uD2B8").setDisabled(!e.openRouterApiKey).onClick(async()=>{await this.testOpenRouterConnection(e)})),t||e.openRouterApiKey){new k.Setting(a).setName("API Key").setDesc("OpenRouter API \uD0A4").addText(l=>l.setPlaceholder("sk-or-...").setValue(e.openRouterApiKey?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async d=>{d&&!d.startsWith("\u2022\u2022")&&(e.openRouterApiKey=d,await this.plugin.saveSettings(),this.display())})),new k.Setting(a).setName("\uAE30\uBCF8 \uBAA8\uB378").setDesc("\uC0AC\uC6A9\uD560 OpenRouter \uBAA8\uB378 ID (\uC608: anthropic/claude-sonnet-4)").addText(l=>l.setPlaceholder("anthropic/claude-sonnet-4").setValue(e.openRouterModel).onChange(async d=>{e.openRouterModel=d||"anthropic/claude-sonnet-4",await this.plugin.saveSettings()}));let o=a.createDiv({cls:"custom-models-section"});new k.Setting(o).setName("\uCD94\uAC00 \uBAA8\uB378 \uAD00\uB9AC").setDesc("\uC790\uC8FC \uC0AC\uC6A9\uD558\uB294 \uBAA8\uB378\uC744 \uCD94\uAC00\uD569\uB2C8\uB2E4").addButton(l=>l.setButtonText("+ \uBAA8\uB378 \uCD94\uAC00").onClick(async()=>{e.openRouterCustomModels.push(""),await this.plugin.saveSettings(),this.display()}));let s=["anthropic/claude-sonnet-4","anthropic/claude-opus-4","openai/gpt-5","openai/o3","google/gemini-2.5-pro","google/gemini-3-flash-preview","meta-llama/llama-4-maverick","deepseek/deepseek-r1","mistralai/mistral-large-2"],i=o.createDiv({cls:"model-list"});for(let l=0;l<e.openRouterCustomModels.length;l++){let d=i.createDiv({cls:"model-row"}),c=d.createEl("input",{type:"text",value:e.openRouterCustomModels[l],placeholder:"model/name",cls:"model-input"});c.addEventListener("change",async()=>{e.openRouterCustomModels[l]=c.value,await this.plugin.saveSettings()}),d.createEl("button",{text:"\xD7",cls:"model-delete-btn"}).addEventListener("click",async()=>{e.openRouterCustomModels.splice(l,1),await this.plugin.saveSettings(),this.display()})}new k.Setting(o).setName("\uCD94\uCC9C \uBAA8\uB378").setDesc("\uC790\uC8FC \uC0AC\uC6A9\uB418\uB294 \uBAA8\uB378 \uBAA9\uB85D").addDropdown(l=>{l.addOption("","-- \uC120\uD0DD\uD558\uC5EC \uCD94\uAC00 --");for(let d of s)e.openRouterCustomModels.includes(d)||l.addOption(d,d);l.onChange(async d=>{d&&(e.openRouterCustomModels.push(d),await this.plugin.saveSettings(),this.display())})})}}renderReportSettings(r,e){r.createEl("h4",{text:"\u{1F4CA} \uB9AC\uD3EC\uD2B8 \uC124\uC815"}),new k.Setting(r).setName("\uC800\uC7A5 \uACBD\uB85C").setDesc("AI \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uAC00 \uC800\uC7A5\uB420 \uD3F4\uB354 \uACBD\uB85C").addText(t=>t.setPlaceholder("Life Logs/Reports").setValue(e.reportSavePath).onChange(async a=>{e.reportSavePath=a||"Life Logs/Reports",await this.plugin.saveSettings()})),new k.Setting(r).setName("\uD30C\uC77C\uBA85 \uD615\uC2DD").setDesc("\uB9AC\uD3EC\uD2B8 \uD30C\uC77C\uBA85 \uD615\uC2DD ({{category}}, {{date}} \uC0AC\uC6A9 \uAC00\uB2A5)").addText(t=>t.setPlaceholder("{{category}}_{{date}}_report").setValue(e.reportNaming).onChange(async a=>{e.reportNaming=a||"{{category}}_{{date}}_report",await this.plugin.saveSettings()})),new k.Setting(r).setName("\uC790\uB3D9 \uBD84\uC11D").setDesc("\uC790\uB3D9 \uBD84\uC11D \uC77C\uC815 \uC124\uC815").addDropdown(t=>t.addOption("manual","\uC218\uB3D9 \uC2E4\uD589\uB9CC").addOption("daily","\uB9E4\uC77C").addOption("weekly","\uB9E4\uC8FC").setValue(e.analysisSchedule).onChange(async a=>{e.analysisSchedule=a,e.autoAnalysis=a!=="manual",await this.plugin.saveSettings()}))}async testOpenAIConnection(r){var e;new k.Notice("OpenAI \uC5F0\uACB0 \uD14C\uC2A4\uD2B8 \uC911...");try{let t=await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${r.openaiApiKey}`}});if(t.ok)new k.Notice("\u2705 OpenAI \uC5F0\uACB0 \uC131\uACF5!");else{let a=await t.json();new k.Notice(`\u274C OpenAI \uC5F0\uACB0 \uC2E4\uD328: ${((e=a.error)==null?void 0:e.message)||t.statusText}`)}}catch(t){new k.Notice(`\u274C OpenAI \uC5F0\uACB0 \uC2E4\uD328: ${t instanceof Error?t.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}}async testGeminiConnection(r){var e;new k.Notice("Gemini \uC5F0\uACB0 \uD14C\uC2A4\uD2B8 \uC911...");try{let t=await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${r.geminiApiKey}`);if(t.ok)new k.Notice("\u2705 Gemini \uC5F0\uACB0 \uC131\uACF5!");else{let a=await t.json();new k.Notice(`\u274C Gemini \uC5F0\uACB0 \uC2E4\uD328: ${((e=a.error)==null?void 0:e.message)||t.statusText}`)}}catch(t){new k.Notice(`\u274C Gemini \uC5F0\uACB0 \uC2E4\uD328: ${t instanceof Error?t.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}}async testGrokConnection(r){var e;new k.Notice("Grok \uC5F0\uACB0 \uD14C\uC2A4\uD2B8 \uC911...");try{let t=await fetch("https://api.x.ai/v1/models",{headers:{Authorization:`Bearer ${r.grokApiKey}`}});if(t.ok)new k.Notice("\u2705 Grok \uC5F0\uACB0 \uC131\uACF5!");else{let a=await t.json();new k.Notice(`\u274C Grok \uC5F0\uACB0 \uC2E4\uD328: ${((e=a.error)==null?void 0:e.message)||t.statusText}`)}}catch(t){new k.Notice(`\u274C Grok \uC5F0\uACB0 \uC2E4\uD328: ${t instanceof Error?t.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}}async testOpenRouterConnection(r){var e,t,a;new k.Notice("OpenRouter \uC5F0\uACB0 \uD14C\uC2A4\uD2B8 \uC911...");try{let o=await fetch("https://openrouter.ai/api/v1/auth/key",{headers:{Authorization:`Bearer ${r.openRouterApiKey}`}});if(o.ok){let s=await o.json();new k.Notice(`\u2705 OpenRouter \uC5F0\uACB0 \uC131\uACF5! (\uD06C\uB808\uB527: $${((t=(e=s.data)==null?void 0:e.limit_remaining)==null?void 0:t.toFixed(2))||"N/A"})`)}else{let s=await o.json();new k.Notice(`\u274C OpenRouter \uC5F0\uACB0 \uC2E4\uD328: ${((a=s.error)==null?void 0:a.message)||o.statusText}`)}}catch(o){new k.Notice(`\u274C OpenRouter \uC5F0\uACB0 \uC2E4\uD328: ${o instanceof Error?o.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}}};var Kt=require("obsidian");var Se=class{constructor(r,e){this.selectedSubject=null;this.taskInputs=[];this.container=r,this.ctx=e}render(){this.container.empty(),this.container.addClass("study-log-tab"),this.renderSubjectSelector(),this.renderTaskInput(),this.renderCreateButton()}renderSubjectSelector(){var a;let r=this.container.createDiv({cls:"tab-section"});r.createEl("label",{text:"\uACFC\uBAA9 \uC120\uD0DD",cls:"tab-label"});let e=r.createDiv({cls:"subject-grid"});for(let o of this.ctx.settings.subjects){let s=e.createEl("button",{cls:`subject-btn ${((a=this.selectedSubject)==null?void 0:a.name)===o.name?"selected":""}`});s.style.setProperty("--subject-color",o.color),s.createSpan({text:o.name,cls:"subject-name"}),s.addEventListener("click",()=>{this.selectedSubject=o,e.querySelectorAll(".subject-btn").forEach(i=>{i.classList.remove("selected")}),s.classList.add("selected")})}let t=e.createEl("button",{cls:"subject-btn subject-btn-add"});t.createSpan({text:"+"}),t.createSpan({text:"\uC9C1\uC811 \uC785\uB825"}),t.addEventListener("click",()=>{this.showCustomSubjectInput(r)})}showCustomSubjectInput(r){if(r.querySelector(".custom-subject-input"))return;let t=r.createDiv({cls:"custom-subject-input"}),a=t.createEl("input",{type:"text",placeholder:"\uACFC\uBAA9\uBA85 \uC785\uB825..."});a.focus(),a.addEventListener("keydown",o=>{o.key==="Enter"&&a.value.trim()?(this.selectedSubject={name:a.value.trim(),icon:"",color:"#808080"},t.remove(),this.render()):o.key==="Escape"&&t.remove()})}renderTaskInput(){let r=this.container.createDiv({cls:"tab-section"});r.createEl("label",{text:"\uD559\uC2B5 \uD56D\uBAA9",cls:"tab-label"});let e=r.createDiv({cls:"task-input-list"});this.addTaskInputRow(e),r.createEl("button",{cls:"add-task-btn",text:"+ \uD56D\uBAA9 \uCD94\uAC00"}).addEventListener("click",()=>{this.addTaskInputRow(e)})}addTaskInputRow(r){let e=r.createDiv({cls:"task-input-row"}),t=e.createEl("input",{type:"text",placeholder:"\uD559\uC2B5 \uD56D\uBAA9 (\uC608: Chapter 3 \uBCF5\uC2B5)",cls:"task-name-input"});this.taskInputs.push(t);let a=e.createEl("input",{type:"text",placeholder:"\uBAA9\uD45C \uC2DC\uAC04 (\uC608: 30m)",cls:"task-duration-input"});a.value=`${this.ctx.settings.defaultStudyDuration}m`,e.createEl("button",{cls:"task-remove-btn",text:"\xD7"}).addEventListener("click",()=>{let s=this.taskInputs.indexOf(t);s>-1&&this.taskInputs.splice(s,1),e.remove()}),t.focus()}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uD559\uC2B5 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createStudyLog())}async createStudyLog(){if(!this.selectedSubject)return;let r=this.collectTasks();if(r.length===0)return;let e=this.buildCodeBlockContent(r),t=await this.ctx.fileCreator.createLogFile("study",e);this.ctx.onCreated(t)}collectTasks(){let r=[];return this.container.querySelectorAll(".task-input-row").forEach(t=>{let a=t.querySelector(".task-name-input"),o=t.querySelector(".task-duration-input");a!=null&&a.value.trim()&&r.push({name:a.value.trim(),duration:(o==null?void 0:o.value.trim())||`${this.ctx.settings.defaultStudyDuration}m`})}),r}buildCodeBlockContent(r){var s;let e=[],a=new Date().getHours(),o=a<12?"\uC624\uC804":a<18?"\uC624\uD6C4":"\uC800\uB141";e.push(`title: ${o} \uD559\uC2B5`),e.push(`subject: ${((s=this.selectedSubject)==null?void 0:s.name)||"\uAE30\uD0C0"}`),e.push("state: planned"),e.push("---");for(let i of r)e.push(`- [ ] ${i.name} | Duration: [${i.duration}]`);return e.join(`
`)}};var Qr={high:"#E74C3C",medium:"#F39C12",low:"#3498DB"},Te=class{constructor(r,e){this.container=r,this.ctx=e}render(){this.container.empty(),this.container.addClass("work-log-tab"),this.renderTitleInput(),this.renderTaskInput(),this.renderCreateButton()}renderTitleInput(){let r=this.container.createDiv({cls:"tab-section"});r.createEl("label",{text:"\uC5C5\uBB34 \uC81C\uBAA9",cls:"tab-label"});let e=r.createEl("input",{type:"text",placeholder:"\uC608: \uC624\uC804 \uC5C5\uBB34, \uD504\uB85C\uC81D\uD2B8 A",cls:"work-title-input"}),a=new Date().getHours(),o=a<12?"\uC624\uC804":a<18?"\uC624\uD6C4":"\uC800\uB141";e.value=`${o} \uC5C5\uBB34`}renderTaskInput(){let r=this.container.createDiv({cls:"tab-section"});r.createEl("label",{text:"\uC5C5\uBB34 \uD56D\uBAA9",cls:"tab-label"});let e=r.createDiv({cls:"work-task-input-list"});this.addTaskInputRow(e),r.createEl("button",{cls:"add-task-btn",text:"+ \uC5C5\uBB34 \uCD94\uAC00"}).addEventListener("click",()=>{this.addTaskInputRow(e)})}addTaskInputRow(r){let e=r.createDiv({cls:"work-task-input-row"}),t=e.createEl("input",{type:"text",placeholder:"\uC5C5\uBB34 \uB0B4\uC6A9 (\uC608: \uAE30\uD68D\uC11C \uC791\uC131)",cls:"work-task-name-input"}),a=e.createEl("select",{cls:"work-task-priority-select"}),o=[{value:"high",label:"\uB192\uC74C"},{value:"medium",label:"\uBCF4\uD1B5"},{value:"low",label:"\uB0AE\uC74C"}];for(let l of o){let d=a.createEl("option",{value:l.value,text:l.label});l.value==="medium"&&(d.selected=!0)}a.addEventListener("change",()=>{let l=Qr[a.value];a.style.borderColor=l});let s=e.createEl("input",{type:"text",placeholder:"\uC608\uC0C1 \uC2DC\uAC04 (\uC608: 2h)",cls:"work-task-duration-input"});s.value="1h",e.createEl("button",{cls:"work-task-remove-btn",text:"\xD7"}).addEventListener("click",()=>{e.remove()}),t.focus()}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uC5C5\uBB34 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createWorkLog())}async createWorkLog(){let r=this.collectTasks();if(r.length===0)return;let e=this.container.querySelector(".work-title-input"),t=(e==null?void 0:e.value.trim())||"\uC5C5\uBB34",a=this.buildCodeBlockContent(t,r),o=await this.ctx.fileCreator.createLogFile("work",a);this.ctx.onCreated(o)}collectTasks(){let r=[];return this.container.querySelectorAll(".work-task-input-row").forEach(t=>{let a=t.querySelector(".work-task-name-input"),o=t.querySelector(".work-task-priority-select"),s=t.querySelector(".work-task-duration-input");a!=null&&a.value.trim()&&r.push({name:a.value.trim(),priority:(o==null?void 0:o.value)||"medium",expectedDuration:(s==null?void 0:s.value.trim())||"1h"})}),r}buildCodeBlockContent(r,e){let t=[];t.push(`title: ${r}`),t.push("state: planned"),t.push("---");for(let a of e)t.push(`- [ ] ${a.name} | Priority: ${a.priority} | Expected: [${a.expectedDuration}]`);return t.join(`
`)}};var be=class{constructor(r,e){this.exerciseInputs=[];this.container=r,this.ctx=e}render(){this.container.empty(),this.container.addClass("workout-log-tab"),this.renderTitleInput(),this.renderExerciseInput(),this.renderQuickTemplates(),this.renderCreateButton()}renderTitleInput(){let r=this.container.createDiv({cls:"tab-section"});r.createEl("label",{text:"\uC6B4\uB3D9 \uC774\uB984",cls:"tab-label"});let e=r.createEl("input",{type:"text",placeholder:"\uC608: \uC544\uCE68 \uC6B4\uB3D9, \uC0C1\uCCB4 \uC6B4\uB3D9",cls:"workout-title-input"}),a=new Date().getHours(),o=a<12?"\uC544\uCE68":a<18?"\uC624\uD6C4":"\uC800\uB141";e.value=`${o} \uC6B4\uB3D9`}renderExerciseInput(){let r=this.container.createDiv({cls:"tab-section"});r.createEl("label",{text:"\uC6B4\uB3D9 \uD56D\uBAA9",cls:"tab-label"});let e=r.createDiv({cls:"exercise-input-list"});this.addExerciseInputRow(e),r.createEl("button",{cls:"add-exercise-btn",text:"+ \uC6B4\uB3D9 \uCD94\uAC00"}).addEventListener("click",()=>{this.addExerciseInputRow(e)})}addExerciseInputRow(r){let e=r.createDiv({cls:"exercise-input-row"}),t=e.createEl("input",{type:"text",placeholder:"\uC6B4\uB3D9\uBA85 (\uC608: \uC2A4\uCFFC\uD2B8)",cls:"exercise-name-input"}),a=e.createEl("input",{type:"text",placeholder:"\uBB34\uAC8C: [60]kg | \uD69F\uC218: [10]",cls:"exercise-params-input"});e.createEl("button",{cls:"exercise-remove-btn",text:"\xD7"}).addEventListener("click",()=>{e.remove()}),t.focus()}renderQuickTemplates(){var o;let r=this.container.createDiv({cls:"tab-section"});r.createEl("label",{text:"\uBE60\uB978 \uD15C\uD50C\uB9BF",cls:"tab-label"});let e=r.createDiv({cls:"template-grid"}),t=[{name:"\uC0C1\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uD478\uC2DC\uC5C5",params:"\uD69F\uC218: [15]"},{name:"\uB364\uBCA8 \uB85C\uC6B0",params:"\uBB34\uAC8C: [10]kg | \uD69F\uC218: [12]"},{name:"\uC204\uB354 \uD504\uB808\uC2A4",params:"\uBB34\uAC8C: [8]kg | \uD69F\uC218: [10]"}]},{name:"\uD558\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uC2A4\uCFFC\uD2B8",params:"\uBB34\uAC8C: [40]kg | \uD69F\uC218: [12]"},{name:"\uB7F0\uC9C0",params:"\uD69F\uC218: [10] /\uB2E4\uB9AC"},{name:"\uCE74\uD504\uB808\uC774\uC988",params:"\uD69F\uC218: [20]"}]},{name:"HIIT",exercises:[{name:"\uBC84\uD53C",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uC810\uD551\uC7AD",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uB9C8\uC6B4\uD2F4 \uD074\uB77C\uC774\uBA38",params:"\uC2DC\uAC04: [30\uCD08]"}]}],a=((o=this.ctx.settings.workoutTemplates)==null?void 0:o.length)>0?this.ctx.settings.workoutTemplates:t;for(let s of a){let i=e.createEl("button",{cls:"template-btn"});i.createSpan({text:s.name}),i.addEventListener("click",()=>{this.applyTemplate(s)})}}applyTemplate(r){let e=this.container.querySelector(".workout-title-input");e&&(e.value=r.name);let t=this.container.querySelector(".exercise-input-list");if(t){t.empty();for(let a of r.exercises)this.addExerciseInputRowWithData(t,a)}}addExerciseInputRowWithData(r,e){let t=r.createDiv({cls:"exercise-input-row"}),a=t.createEl("input",{type:"text",placeholder:"\uC6B4\uB3D9\uBA85",cls:"exercise-name-input"});a.value=e.name;let o=t.createEl("input",{type:"text",placeholder:"\uD30C\uB77C\uBBF8\uD130",cls:"exercise-params-input"});o.value=e.params,t.createEl("button",{cls:"exercise-remove-btn",text:"\xD7"}).addEventListener("click",()=>{t.remove()})}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uC6B4\uB3D9 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createWorkoutLog())}async createWorkoutLog(){let r=this.collectExercises();if(r.length===0)return;let e=this.container.querySelector(".workout-title-input"),t=(e==null?void 0:e.value.trim())||"\uC6B4\uB3D9",a=this.buildCodeBlockContent(t,r),o=await this.ctx.fileCreator.createLogFile("workout",a);this.ctx.onCreated(o)}collectExercises(){let r=[];return this.container.querySelectorAll(".exercise-input-row").forEach(t=>{let a=t.querySelector(".exercise-name-input"),o=t.querySelector(".exercise-params-input");a!=null&&a.value.trim()&&r.push({name:a.value.trim(),params:(o==null?void 0:o.value.trim())||""})}),r}buildCodeBlockContent(r,e){let t=[];t.push(`title: ${r}`),t.push("state: planned"),t.push("startDate:"),t.push("duration:"),t.push(`restDuration: ${this.ctx.settings.defaultRestDuration}s`),t.push("---");for(let a of e)a.params?t.push(`- [ ] ${a.name} | ${a.params}`):t.push(`- [ ] ${a.name}`);return t.join(`
`)}};var Z=class Z{constructor(r,e){this.selectedMealType=null;this.foodInputs=[];this.container=r,this.ctx=e;let t=new Date().getHours();t>=6&&t<11?this.selectedMealType="breakfast":t>=11&&t<15?this.selectedMealType="lunch":t>=15&&t<21?this.selectedMealType="dinner":this.selectedMealType="snack"}render(){this.container.empty(),this.container.addClass("meal-log-tab"),this.renderMealTypeSelector(),this.renderFoodInput(),this.renderCreateButton()}renderMealTypeSelector(){let r=this.container.createDiv({cls:"tab-section"});r.createEl("label",{text:"\uC2DD\uC0AC \uC885\uB958",cls:"tab-label"});let e=r.createDiv({cls:"meal-type-grid"});for(let t of Z.MEAL_TYPES){let a=e.createEl("button",{cls:`meal-type-btn ${this.selectedMealType===t.type?"selected":""}`,text:t.label});a.addEventListener("click",()=>{this.selectedMealType=t.type,e.querySelectorAll(".meal-type-btn").forEach(o=>{o.classList.remove("selected")}),a.classList.add("selected"),this.clearFoodInputs()})}}renderFoodInput(){let r=this.container.createDiv({cls:"tab-section"});r.createEl("label",{text:"\uC74C\uC2DD \uBAA9\uB85D",cls:"tab-label"});let e=r.createDiv({cls:"food-input-list"});this.addFoodInputRow(e),r.createEl("button",{cls:"add-food-btn",text:"+ \uC74C\uC2DD \uCD94\uAC00"}).addEventListener("click",()=>{this.addFoodInputRow(e)})}clearFoodInputs(){let r=this.container.querySelector(".food-input-list");r&&(r.empty(),this.foodInputs=[],this.addFoodInputRow(r))}addFoodInputRow(r){let e=r.createDiv({cls:"food-input-row"}),t=e.createEl("input",{type:"text",placeholder:"\uC74C\uC2DD \uC774\uB984 (\uC608: \uD604\uBBF8\uBC25, \uB41C\uC7A5\uCC0C\uAC1C)",cls:"food-name-input"});this.foodInputs.push(t),e.createEl("button",{cls:"food-remove-btn",text:"\xD7"}).addEventListener("click",()=>{let o=this.foodInputs.indexOf(t);o>-1&&this.foodInputs.splice(o,1),e.remove()}),t.focus()}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uC2DD\uB2E8 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createMealLog())}async createMealLog(){if(!this.selectedMealType)return;let r=this.collectFoods(),e=this.buildCodeBlockContent(r),t=await this.ctx.fileCreator.createLogFile("meal",e);this.ctx.onCreated(t)}collectFoods(){let r=[];for(let e of this.foodInputs)e.value.trim()&&r.push(e.value.trim());return r}buildCodeBlockContent(r){let e=[],t=Z.MEAL_TYPES.find(a=>a.type===this.selectedMealType);e.push(`title: ${(t==null?void 0:t.label)||"\uC2DD\uC0AC"}`),e.push(`mealType: ${this.selectedMealType}`),e.push("state: planned"),e.push("---");for(let a of r)e.push(`- [ ] ${a}`);return r.length===0&&e.push("- [ ] \uC74C\uC2DD\uC744 \uCD94\uAC00\uD558\uC138\uC694"),e.join(`
`)}};Z.MEAL_TYPES=[{type:"breakfast",label:"\uC544\uCE68",icon:""},{type:"lunch",label:"\uC810\uC2EC",icon:""},{type:"dinner",label:"\uC800\uB141",icon:""},{type:"snack",label:"\uAC04\uC2DD",icon:""}];var xe=Z;var B=class extends Kt.Modal{constructor(e,t,a){super(e);this.tabContentEl=null;this.settings=t,this.fileCreator=a,this.activeTab=t.defaultTab}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("quick-log-modal"),this.renderHeader(e),this.renderTabs(e),this.renderTabContent(e)}renderHeader(e){e.createDiv({cls:"modal-header"}).createEl("h2",{text:"Life Log"})}renderTabs(e){let t=e.createDiv({cls:"modal-tabs"});t.createEl("button",{cls:`modal-tab ${this.activeTab==="study"?"active":""}`,text:"\uD559\uC2B5 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="study",this.updateActiveTab(t),this.renderTabContent(e)}),t.createEl("button",{cls:`modal-tab ${this.activeTab==="work"?"active":""}`,text:"\uC5C5\uBB34 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="work",this.updateActiveTab(t),this.renderTabContent(e)}),t.createEl("button",{cls:`modal-tab ${this.activeTab==="workout"?"active":""}`,text:"\uC6B4\uB3D9 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="workout",this.updateActiveTab(t),this.renderTabContent(e)}),t.createEl("button",{cls:`modal-tab ${this.activeTab==="meal"?"active":""}`,text:"\uC2DD\uB2E8 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="meal",this.updateActiveTab(t),this.renderTabContent(e)})}updateActiveTab(e){let t=["study","work","workout","meal"];e.querySelectorAll(".modal-tab").forEach((a,o)=>{t[o]===this.activeTab?a.classList.add("active"):a.classList.remove("active")})}renderTabContent(e){this.tabContentEl&&this.tabContentEl.remove(),this.tabContentEl=e.createDiv({cls:"modal-tab-content"});let t=a=>{this.close(),this.app.workspace.getLeaf().openFile(a)};this.activeTab==="study"?new Se(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:t}).render():this.activeTab==="work"?new Te(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:t}).render():this.activeTab==="workout"?new be(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:t}).render():this.activeTab==="meal"&&new xe(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:t}).render()}onClose(){let{contentEl:e}=this;e.empty()}};var Yt=require("obsidian"),we=class extends Yt.Modal{constructor(e,t){super(e);this.focusScore=4;this.comprehensionScore=4;this.notes="";this.onSubmit=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("self-eval-modal"),e.createEl("h2",{text:"\u{1F389} \uD559\uC2B5 \uC644\uB8CC! \uC790\uAC00\uD3C9\uAC00\uB97C \uD574\uC8FC\uC138\uC694"}),this.renderFocusScore(e),this.renderComprehensionScore(e),this.renderNotesInput(e),this.renderButtons(e)}renderFocusScore(e){let t=e.createDiv({cls:"eval-section"});t.createEl("label",{text:"\uC9D1\uC911\uB3C4",cls:"eval-label"});let a=t.createDiv({cls:"eval-stars"});this.renderStarPicker(a,this.focusScore,o=>{this.focusScore=o})}renderComprehensionScore(e){let t=e.createDiv({cls:"eval-section"});t.createEl("label",{text:"\uC774\uD574\uB3C4",cls:"eval-label"});let a=t.createDiv({cls:"eval-stars"});this.renderStarPicker(a,this.comprehensionScore,o=>{this.comprehensionScore=o})}renderStarPicker(e,t,a){for(let o=1;o<=5;o++){let s=e.createSpan({cls:`eval-star ${o<=t?"filled":""}`,text:o<=t?"\u2605":"\u2606"});s.addEventListener("click",()=>{a(o),e.querySelectorAll(".eval-star").forEach((i,l)=>{let d=i;l<o?(d.textContent="\u2605",d.classList.add("filled")):(d.textContent="\u2606",d.classList.remove("filled"))})}),s.addEventListener("mouseenter",()=>{e.querySelectorAll(".eval-star").forEach((i,l)=>{let d=i;l<o&&d.classList.add("hover")})}),s.addEventListener("mouseleave",()=>{e.querySelectorAll(".eval-star").forEach(i=>{i.classList.remove("hover")})})}}renderNotesInput(e){let t=e.createDiv({cls:"eval-section"});t.createEl("label",{text:"\uBA54\uBAA8 (\uC120\uD0DD)",cls:"eval-label"});let a=t.createEl("textarea",{cls:"eval-notes-input",placeholder:"\uC624\uB298 \uD559\uC2B5\uC5D0 \uB300\uD55C \uC9E7\uC740 \uBA54\uBAA8..."});a.rows=3,a.addEventListener("input",()=>{this.notes=a.value})}renderButtons(e){let t=e.createDiv({cls:"eval-buttons"});t.createEl("button",{cls:"eval-btn eval-btn-secondary",text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),t.createEl("button",{cls:"eval-btn eval-btn-primary",text:"\uC800\uC7A5\uD558\uACE0 \uC885\uB8CC"}).addEventListener("click",()=>{this.onSubmit({focusScore:this.focusScore,comprehensionScore:this.comprehensionScore,notes:this.notes||void 0}),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var E=require("obsidian");var gt=[{id:"study-weekly",name:"\uC8FC\uAC04 \uD559\uC2B5 \uB9AC\uD3EC\uD2B8",category:"study",description:"\uC77C\uC8FC\uC77C\uAC04\uC758 \uD559\uC2B5 \uD328\uD134\uACFC \uC131\uACFC\uB97C \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:`\uB2F9\uC2E0\uC740 \uD559\uC2B5 \uD6A8\uC728 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uD559\uC0DD\uC758 \uD559\uC2B5 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uD6A8\uACFC\uC801\uC778 \uD559\uC2B5 \uC804\uB7B5\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.
\uBD84\uC11D \uC2DC \uB2E4\uC74C\uC744 \uACE0\uB824\uD558\uC138\uC694:
- \uACFC\uBAA9\uBCC4 \uD559\uC2B5 \uC2DC\uAC04 \uBD84\uD3EC
- \uC9D1\uC911\uB825\uACFC \uD6A8\uC728\uC131 \uD328\uD134
- \uAC15\uC810\uACFC \uAC1C\uC120\uC774 \uD544\uC694\uD55C \uC601\uC5ED
- \uAD6C\uCCB4\uC801\uC774\uACE0 \uC2E4\uD589 \uAC00\uB2A5\uD55C \uC870\uC5B8`,userPromptTemplate:`\uB2E4\uC74C \uD559\uC2B5 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC8FC\uAC04 \uD559\uC2B5 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uD559\uC2B5 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uD559\uC2B5 \uC2DC\uAC04 \uC694\uC57D (\uCD1D \uC2DC\uAC04, \uC77C\uD3C9\uADE0, \uACFC\uBAA9\uBCC4)
2. \uD559\uC2B5 \uD328\uD134 \uBD84\uC11D (\uC2DC\uAC04\uB300\uBCC4 \uC9D1\uC911\uB3C4, \uD6A8\uC728\uC801\uC778 \uD559\uC2B5 \uC2DC\uAC04)
3. \uACFC\uBAA9\uBCC4 \uC2EC\uCE35 \uBD84\uC11D
4. \uAC15\uC810 \uBC0F \uAC1C\uC120\uC810
5. \uB2E4\uC74C \uC8FC \uCD94\uCC9C \uD559\uC2B5 \uACC4\uD68D

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC694\uC57D","\uD559\uC2B5 \uC2DC\uAC04 \uBD84\uC11D","\uACFC\uBAA9\uBCC4 \uBD84\uC11D","\uAC15\uC810","\uAC1C\uC120\uC810","\uCD94\uCC9C \uACC4\uD68D"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"study-monthly",name:"\uC6D4\uAC04 \uD559\uC2B5 \uB9AC\uD3EC\uD2B8",category:"study",description:"\uD55C \uB2EC\uAC04\uC758 \uD559\uC2B5 \uC131\uACFC\uC640 \uC131\uC7A5\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uD559\uC2B5 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC6D4\uAC04 \uD559\uC2B5 \uB370\uC774\uD130\uB97C \uBD84\uC11D\uD558\uC5EC \uC7A5\uAE30\uC801\uC778 \uC131\uC7A5 \uD2B8\uB80C\uB4DC\uC640 \uBAA9\uD45C \uB2EC\uC131\uB960\uC744 \uD3C9\uAC00\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uD559\uC2B5 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC6D4\uAC04 \uD559\uC2B5 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uD559\uC2B5 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC6D4\uAC04 \uD559\uC2B5 \uC694\uC57D (\uCD1D \uC2DC\uAC04, \uC8FC\uBCC4 \uCD94\uC774)
2. \uBAA9\uD45C \uB2EC\uC131\uB960 \uBD84\uC11D
3. \uC8FC\uBCC4 \uD2B8\uB80C\uB4DC \uBCC0\uD654
4. \uACFC\uBAA9\uBCC4 \uC131\uC7A5 \uBD84\uC11D
5. \uB2E4\uC74C \uB2EC \uBAA9\uD45C \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"month",outputFormat:"markdown",outputSections:["\uC6D4\uAC04 \uC694\uC57D","\uBAA9\uD45C \uB2EC\uC131\uB960","\uD2B8\uB80C\uB4DC \uBD84\uC11D","\uC131\uC7A5 \uBD84\uC11D","\uB2E4\uC74C \uB2EC \uBAA9\uD45C"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"study-subject",name:"\uACFC\uBAA9\uBCC4 \uC2EC\uCE35 \uBD84\uC11D",category:"study",description:"\uD2B9\uC815 \uACFC\uBAA9\uC758 \uD559\uC2B5 \uD328\uD134\uACFC \uD6A8\uC728\uC131\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uACFC\uBAA9\uBCC4 \uD559\uC2B5 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uD2B9\uC815 \uACFC\uBAA9\uC5D0 \uB300\uD55C \uAE4A\uC774 \uC788\uB294 \uBD84\uC11D\uACFC \uB9DE\uCDA4\uD615 \uD559\uC2B5 \uC804\uB7B5\uC744 \uC81C\uACF5\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uD559\uC2B5 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uACFC\uBAA9\uBCC4 \uC2EC\uCE35 \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uD559\uC2B5 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uACFC\uBAA9\uBCC4 \uD559\uC2B5 \uC2DC\uAC04 \uBC0F \uBE48\uB3C4
2. \uAC01 \uACFC\uBAA9\uC758 \uD559\uC2B5 \uD6A8\uC728\uC131 \uD3C9\uAC00
3. \uACFC\uBAA9 \uAC04 \uADE0\uD615 \uBD84\uC11D
4. \uCDE8\uC57D \uACFC\uBAA9 \uC2DD\uBCC4 \uBC0F \uAC1C\uC120 \uBC29\uC548
5. \uACFC\uBAA9\uBCC4 \uB9DE\uCDA4 \uD559\uC2B5 \uC804\uB7B5

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"month",outputFormat:"markdown",outputSections:["\uACFC\uBAA9\uBCC4 \uC694\uC57D","\uD6A8\uC728\uC131 \uBD84\uC11D","\uADE0\uD615 \uBD84\uC11D","\uAC1C\uC120 \uBC29\uC548","\uB9DE\uCDA4 \uC804\uB7B5"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0}],ft=[{id:"workout-weekly",name:"\uC8FC\uAC04 \uC6B4\uB3D9 \uB9AC\uD3EC\uD2B8",category:"workout",description:"\uC77C\uC8FC\uC77C\uAC04\uC758 \uC6B4\uB3D9 \uAE30\uB85D\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uD53C\uD2B8\uB2C8\uC2A4 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC6B4\uB3D9 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uD6A8\uACFC\uC801\uC778 \uD2B8\uB808\uC774\uB2DD \uC804\uB7B5\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC6B4\uB3D9 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC8FC\uAC04 \uC6B4\uB3D9 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC6B4\uB3D9 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC8FC\uAC04 \uC6B4\uB3D9 \uC694\uC57D (\uCD1D \uC6B4\uB3D9 \uC2DC\uAC04, \uD69F\uC218)
2. \uC6B4\uB3D9 \uC720\uD615\uBCC4 \uBD84\uC11D
3. \uC6B4\uB3D9 \uAC15\uB3C4 \uBC0F \uBCFC\uB968 \uBD84\uC11D
4. \uD734\uC2DD \uD328\uD134 \uD3C9\uAC00
5. \uB2E4\uC74C \uC8FC \uC6B4\uB3D9 \uCD94\uCC9C

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC8FC\uAC04 \uC694\uC57D","\uC6B4\uB3D9 \uBD84\uC11D","\uAC15\uB3C4 \uBD84\uC11D","\uD734\uC2DD \uBD84\uC11D","\uCD94\uCC9C \uACC4\uD68D"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"workout-progress",name:"\uC9C4\uCC99\uB3C4 \uBD84\uC11D",category:"workout",description:"\uC6B4\uB3D9 \uC9C4\uD589 \uC0C1\uD669\uACFC \uC131\uACFC\uB97C \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC6B4\uB3D9 \uC131\uACFC \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC6B4\uB3D9 \uAE30\uB85D\uC758 \uC9C4\uCC99\uB3C4\uB97C \uBD84\uC11D\uD558\uC5EC \uC131\uC7A5 \uD2B8\uB80C\uB4DC\uC640 \uAC1C\uC120\uC810\uC744 \uC81C\uC2DC\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC6B4\uB3D9 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC9C4\uCC99\uB3C4 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC6B4\uB3D9 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC804\uBC18\uC801\uC778 \uC9C4\uCC99\uB3C4 \uD3C9\uAC00
2. \uC6B4\uB3D9\uBCC4 \uC131\uACFC \uBCC0\uD654 \uCD94\uC774
3. \uAC1C\uC778 \uAE30\uB85D \uB2EC\uC131 \uD604\uD669
4. \uADFC\uC721 \uADF8\uB8F9\uBCC4 \uBC1C\uB2EC \uC0C1\uD0DC
5. \uD5A5\uD6C4 \uBAA9\uD45C \uBC0F \uC870\uC5B8

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"month",outputFormat:"markdown",outputSections:["\uC9C4\uCC99\uB3C4 \uC694\uC57D","\uC131\uACFC \uCD94\uC774","\uAE30\uB85D \uD604\uD669","\uBC1C\uB2EC \uBD84\uC11D","\uBAA9\uD45C \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"workout-balance",name:"\uC6B4\uB3D9 \uBC38\uB7F0\uC2A4 \uBD84\uC11D",category:"workout",description:"\uADFC\uC721 \uADF8\uB8F9\uBCC4 \uC6B4\uB3D9 \uADE0\uD615\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC6B4\uB3D9 \uADE0\uD615 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uADFC\uC721 \uADF8\uB8F9\uBCC4 \uC6B4\uB3D9 \uBD84\uD3EC\uB97C \uBD84\uC11D\uD558\uC5EC \uADE0\uD615 \uC7A1\uD78C \uD2B8\uB808\uC774\uB2DD\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC6B4\uB3D9 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC6B4\uB3D9 \uBC38\uB7F0\uC2A4 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC6B4\uB3D9 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC804\uCCB4 \uC6B4\uB3D9 \uBD84\uD3EC \uC694\uC57D
2. \uADFC\uC721 \uADF8\uB8F9\uBCC4 \uD6C8\uB828 \uBE44\uC728
3. \uBD88\uADE0\uD615 \uAC10\uC9C0 \uBC0F \uBD84\uC11D
4. \uACFC\uD6C8\uB828/\uBBF8\uD6C8\uB828 \uC601\uC5ED \uC2DD\uBCC4
5. \uADE0\uD615 \uAC1C\uC120 \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"month",outputFormat:"markdown",outputSections:["\uBD84\uD3EC \uC694\uC57D","\uADF8\uB8F9\uBCC4 \uBD84\uC11D","\uBD88\uADE0\uD615 \uAC10\uC9C0","\uC704\uD5D8 \uC601\uC5ED","\uAC1C\uC120 \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0}],ht=[{id:"work-weekly",name:"\uC8FC\uAC04 \uC5C5\uBB34 \uB9AC\uD3EC\uD2B8",category:"work",description:"\uC77C\uC8FC\uC77C\uAC04\uC758 \uC5C5\uBB34 \uD604\uD669\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC5C5\uBB34 \uC0DD\uC0B0\uC131 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC5C5\uBB34 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uD6A8\uC728\uC801\uC778 \uC2DC\uAC04 \uAD00\uB9AC\uC640 \uC0DD\uC0B0\uC131 \uD5A5\uC0C1 \uC804\uB7B5\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC5C5\uBB34 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC8FC\uAC04 \uC5C5\uBB34 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC5C5\uBB34 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC8FC\uAC04 \uC5C5\uBB34 \uC694\uC57D (\uCD1D \uC5C5\uBB34 \uC2DC\uAC04, \uC644\uB8CC \uD0DC\uC2A4\uD06C \uC218)
2. \uC5C5\uBB34 \uCE74\uD14C\uACE0\uB9AC\uBCC4 \uC2DC\uAC04 \uBD84\uBC30
3. \uC0DD\uC0B0\uC131 \uD328\uD134 \uBD84\uC11D
4. \uC608\uC0C1 \uB300\uBE44 \uC2E4\uC81C \uC18C\uC694 \uC2DC\uAC04 \uBE44\uAD50
5. \uB2E4\uC74C \uC8FC \uC5C5\uBB34 \uAC1C\uC120 \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC8FC\uAC04 \uC694\uC57D","\uCE74\uD14C\uACE0\uB9AC \uBD84\uC11D","\uC0DD\uC0B0\uC131 \uBD84\uC11D","\uC2DC\uAC04 \uBE44\uAD50","\uAC1C\uC120 \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"work-productivity",name:"\uC0DD\uC0B0\uC131 \uBD84\uC11D",category:"work",description:"\uC5C5\uBB34 \uC0DD\uC0B0\uC131\uACFC \uD6A8\uC728\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC5C5\uBB34 \uD6A8\uC728 \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC5C5\uBB34 \uD328\uD134\uC744 \uBD84\uC11D\uD558\uC5EC \uC0DD\uC0B0\uC131 \uCD5C\uC801\uD654 \uBC29\uC548\uC744 \uC81C\uC2DC\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC5C5\uBB34 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC0DD\uC0B0\uC131 \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC5C5\uBB34 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC804\uBC18\uC801\uC778 \uC0DD\uC0B0\uC131 \uC810\uC218
2. \uC2DC\uAC04\uB300\uBCC4 \uC0DD\uC0B0\uC131 \uD328\uD134
3. \uC5C5\uBB34 \uC644\uB8CC\uC728 \uBC0F \uC9C0\uC5F0 \uBD84\uC11D
4. \uC9D1\uC911 \uC5C5\uBB34 \uC2DC\uAC04 \uBD84\uC11D
5. \uC0DD\uC0B0\uC131 \uD5A5\uC0C1 \uC804\uB7B5

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC0DD\uC0B0\uC131 \uC810\uC218","\uC2DC\uAC04\uB300 \uBD84\uC11D","\uC644\uB8CC\uC728 \uBD84\uC11D","\uC9D1\uC911 \uC2DC\uAC04","\uD5A5\uC0C1 \uC804\uB7B5"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"work-burnout",name:"\uBC88\uC544\uC6C3 \uC704\uD5D8 \uBD84\uC11D",category:"work",description:"\uACFC\uB85C \uD328\uD134\uACFC \uBC88\uC544\uC6C3 \uC704\uD5D8\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC6CC\uB77C\uBC38 \uC804\uBB38 \uC0C1\uB2F4\uC0AC\uC785\uB2C8\uB2E4. \uC5C5\uBB34 \uD328\uD134\uC744 \uBD84\uC11D\uD558\uC5EC \uBC88\uC544\uC6C3 \uC704\uD5D8\uC744 \uD3C9\uAC00\uD558\uACE0 \uAC74\uAC15\uD55C \uC5C5\uBB34 \uBC29\uC2DD\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC5C5\uBB34 \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uBC88\uC544\uC6C3 \uC704\uD5D8 \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC5C5\uBB34 \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uBC88\uC544\uC6C3 \uC704\uD5D8\uB3C4 \uD3C9\uAC00 (\uB0AE\uC74C/\uBCF4\uD1B5/\uB192\uC74C)
2. \uC57C\uADFC \uBC0F \uCD08\uACFC \uADFC\uBB34 \uD328\uD134
3. \uD734\uC2DD \uBC0F \uD68C\uBCF5 \uC2DC\uAC04 \uBD84\uC11D
4. \uC2A4\uD2B8\uB808\uC2A4 \uC694\uC778 \uC2DD\uBCC4
5. \uC6CC\uB77C\uBC38 \uAC1C\uC120 \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC704\uD5D8\uB3C4 \uD3C9\uAC00","\uCD08\uACFC \uADFC\uBB34 \uBD84\uC11D","\uD734\uC2DD \uBD84\uC11D","\uC2A4\uD2B8\uB808\uC2A4 \uC694\uC778","\uAC1C\uC120 \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0}],yt=[{id:"meal-weekly",name:"\uC8FC\uAC04 \uC2DD\uB2E8 \uB9AC\uD3EC\uD2B8",category:"meal",description:"\uC77C\uC8FC\uC77C\uAC04\uC758 \uC2DD\uC0AC \uD328\uD134\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC601\uC591 \uBC0F \uC2DD\uC2B5\uAD00 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC2DD\uC0AC \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uAC74\uAC15\uD55C \uC2DD\uC2B5\uAD00 \uD615\uC131\uC744 \uB3D5\uC2B5\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC2DD\uC0AC \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC8FC\uAC04 \uC2DD\uB2E8 \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC2DD\uC0AC \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC8FC\uAC04 \uC2DD\uC0AC \uC694\uC57D (\uB07C\uB2C8\uBCC4 \uC2DD\uC0AC \uD69F\uC218)
2. \uC2DD\uC0AC \uADDC\uCE59\uC131 \uBD84\uC11D
3. \uC74C\uC2DD \uB2E4\uC591\uC131 \uD3C9\uAC00
4. \uC2DD\uC0AC \uC2DC\uAC04\uB300 \uD328\uD134
5. \uAC1C\uC120 \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uC8FC\uAC04 \uC694\uC57D","\uADDC\uCE59\uC131 \uBD84\uC11D","\uB2E4\uC591\uC131 \uBD84\uC11D","\uC2DC\uAC04\uB300 \uBD84\uC11D","\uAC1C\uC120 \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"meal-pattern",name:"\uC2DD\uC0AC \uD328\uD134 \uBD84\uC11D",category:"meal",description:"\uC2DD\uC0AC \uC2DC\uAC04\uACFC \uADDC\uCE59\uC131\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC2DD\uC2B5\uAD00 \uD328\uD134 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC2DD\uC0AC \uC2DC\uAC04\uACFC \uADDC\uCE59\uC131\uC744 \uBD84\uC11D\uD558\uC5EC \uAC74\uAC15\uD55C \uC2DD\uC0AC \uC2B5\uAD00\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC2DD\uC0AC \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC2DD\uC0AC \uD328\uD134 \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC2DD\uC0AC \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC2DD\uC0AC \uADDC\uCE59\uC131 \uC810\uC218
2. \uB07C\uB2C8\uBCC4 \uC2DD\uC0AC \uC2DC\uAC04 \uBD84\uC11D
3. \uACB0\uC2DD \uD328\uD134 \uBD84\uC11D
4. \uC2DD\uC0AC \uAC04\uACA9 \uBD84\uC11D
5. \uADDC\uCE59\uC801\uC778 \uC2DD\uC0AC\uB97C \uC704\uD55C \uC870\uC5B8

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"week",outputFormat:"markdown",outputSections:["\uADDC\uCE59\uC131 \uC810\uC218","\uC2DC\uAC04 \uBD84\uC11D","\uACB0\uC2DD \uBD84\uC11D","\uAC04\uACA9 \uBD84\uC11D","\uAC1C\uC120 \uC870\uC5B8"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0},{id:"meal-nutrition",name:"\uC601\uC591 \uBC38\uB7F0\uC2A4 \uBD84\uC11D",category:"meal",description:"\uC74C\uC2DD \uB2E4\uC591\uC131\uACFC \uC601\uC591 \uADE0\uD615\uC744 \uBD84\uC11D\uD569\uB2C8\uB2E4.",isBuiltIn:!0,isEnabled:!0,systemPrompt:"\uB2F9\uC2E0\uC740 \uC601\uC591 \uBD84\uC11D \uC804\uBB38\uAC00\uC785\uB2C8\uB2E4. \uC2DD\uC0AC \uAE30\uB85D\uC5D0\uC11C \uC601\uC591 \uADE0\uD615\uACFC \uB2E4\uC591\uC131\uC744 \uBD84\uC11D\uD558\uC5EC \uAC74\uAC15\uD55C \uC2DD\uB2E8\uC744 \uC81C\uC548\uD569\uB2C8\uB2E4.",userPromptTemplate:`\uB2E4\uC74C \uC2DD\uC0AC \uAE30\uB85D\uC744 \uBD84\uC11D\uD558\uC5EC \uC601\uC591 \uBC38\uB7F0\uC2A4 \uBD84\uC11D \uB9AC\uD3EC\uD2B8\uB97C \uC791\uC131\uD574\uC8FC\uC138\uC694.

[\uBD84\uC11D \uAE30\uAC04]
{{period}}

[\uC2DD\uC0AC \uB370\uC774\uD130]
{{rawData}}

[\uC694\uCCAD\uC0AC\uD56D]
1. \uC74C\uC2DD \uB2E4\uC591\uC131 \uC810\uC218
2. \uC790\uC8FC \uBA39\uB294 \uC74C\uC2DD TOP 10
3. \uC601\uC591\uC18C \uADE0\uD615 \uCD94\uC815 (\uD0C4\uC218\uD654\uBB3C, \uB2E8\uBC31\uC9C8, \uCC44\uC18C \uB4F1)
4. \uBD80\uC871\uD560 \uC218 \uC788\uB294 \uC601\uC591 \uC694\uC18C
5. \uC2DD\uB2E8 \uAC1C\uC120 \uC81C\uC548

Markdown \uD615\uC2DD\uC73C\uB85C \uD55C\uAD6D\uC5B4\uB85C \uC791\uC131\uD574\uC8FC\uC138\uC694.`,dataRange:"month",outputFormat:"markdown",outputSections:["\uB2E4\uC591\uC131 \uC810\uC218","\uBE48\uB3C4 \uBD84\uC11D","\uC601\uC591 \uADE0\uD615","\uBD80\uC871 \uC601\uC591\uC18C","\uAC1C\uC120 \uC81C\uC548"],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0}],Xr=[...gt,...ft,...ht,...yt];function kt(n){switch(n){case"study":return gt;case"workout":return ft;case"work":return ht;case"meal":return yt;default:return[]}}var D=class{static render(r,e){let t=r;return t=t.replace(/\{\{period\}\}/g,e.period),t=t.replace(/\{\{category\}\}/g,e.category),t=t.replace(/\{\{recordCount\}\}/g,String(e.recordCount)),t=t.replace(/\{\{totalDuration\}\}/g,e.totalDuration),t=t.replace(/\{\{rawData\}\}/g,e.rawData),t=t.replace(/\{\{summary\}\}/g,e.summary),t=t.replace(/\{\{userName\}\}/g,e.userName||"\uC0AC\uC6A9\uC790"),t=t.replace(/\{\{currentDate\}\}/g,e.currentDate),t}static formatDateRange(r){let e=t=>{let a=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${a}-${o}-${s}`};return`${e(r.start)} ~ ${e(r.end)}`}static getCurrentDateString(){let r=new Date,e=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0");return`${e}-${t}-${a}`}static formatDuration(r){if(r<60)return`${r}\uCD08`;let e=Math.floor(r/3600),t=Math.floor(r%3600/60),a=r%60,o=[];return e>0&&o.push(`${e}\uC2DC\uAC04`),t>0&&o.push(`${t}\uBD84`),a>0&&e===0&&o.push(`${a}\uCD08`),o.join(" ")||"0\uCD08"}static calculateDateRange(r,e){let t=new Date;t.setHours(23,59,59,999);let a=new Date;switch(a.setHours(0,0,0,0),r){case"day":break;case"week":a.setDate(a.getDate()-6);break;case"month":a.setDate(a.getDate()-29);break;case"quarter":a.setDate(a.getDate()-89);break;case"custom":e&&e>0&&a.setDate(a.getDate()-(e-1));break}return{start:a,end:t}}static validateTemplate(r){let e=[];return(!r.id||r.id.trim()==="")&&e.push("\uD15C\uD50C\uB9BF ID\uAC00 \uD544\uC694\uD569\uB2C8\uB2E4."),(!r.name||r.name.trim()==="")&&e.push("\uD15C\uD50C\uB9BF \uC774\uB984\uC774 \uD544\uC694\uD569\uB2C8\uB2E4."),(!r.userPromptTemplate||r.userPromptTemplate.trim()==="")&&e.push("\uC0AC\uC6A9\uC790 \uD504\uB86C\uD504\uD2B8 \uD15C\uD50C\uB9BF\uC774 \uD544\uC694\uD569\uB2C8\uB2E4."),r.userPromptTemplate.includes("{{rawData}}")||e.push("\uD504\uB86C\uD504\uD2B8\uC5D0 {{rawData}} \uBCC0\uC218\uAC00 \uD3EC\uD568\uB418\uC5B4\uC57C \uD569\uB2C8\uB2E4."),{valid:e.length===0,errors:e}}static getCategoryName(r){switch(r){case"study":return"\uD559\uC2B5";case"workout":return"\uC6B4\uB3D9";case"work":return"\uC5C5\uBB34";case"meal":return"\uC2DD\uB2E8";default:return r}}};var M=class{constructor(r,e){this.apiKey=r,this.model=e}isConfigured(){return!!this.apiKey&&this.apiKey.length>0}getCurrentModel(){return this.model}createResult(r,e,t,a){return{success:r,content:e,metadata:{provider:this.name,model:this.model,tokensUsed:t,generatedAt:new Date().toISOString()},error:a}}createErrorResult(r){let e=r instanceof Error?r.message:String(r);return this.createResult(!1,"",void 0,e)}};async function L(n,r,e=6e4){let t=new AbortController,a=setTimeout(()=>t.abort(),e);try{return await fetch(n,{...r,signal:t.signal})}finally{clearTimeout(a)}}var K=class K extends M{constructor(){super(...arguments);this.name="OpenAI";this.type="openai"}getAvailableModels(){return K.MODELS}async testConnection(){if(!this.isConfigured())return!1;try{return(await L("https://api.openai.com/v1/models",{method:"GET",headers:{Authorization:`Bearer ${this.apiKey}`}},1e4)).ok}catch(e){return!1}}async analyze(e,t){var a,o,s,i,l,d;if(!this.isConfigured())return this.createResult(!1,"",void 0,"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");try{let c=[];t!=null&&t.systemPrompt&&c.push({role:"system",content:t.systemPrompt}),c.push({role:"user",content:e});let u=await L(K.API_URL,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:(t==null?void 0:t.model)||this.model,messages:c,temperature:(a=t==null?void 0:t.temperature)!=null?a:.7,max_tokens:(o=t==null?void 0:t.maxTokens)!=null?o:4096})}),p=await u.json();if(!u.ok||p.error)return this.createResult(!1,"",void 0,((s=p.error)==null?void 0:s.message)||`HTTP ${u.status}`);let m=((l=(i=p.choices[0])==null?void 0:i.message)==null?void 0:l.content)||"",g=(d=p.usage)==null?void 0:d.total_tokens;return this.createResult(!0,m,g)}catch(c){return this.createErrorResult(c)}}};K.API_URL="https://api.openai.com/v1/chat/completions",K.MODELS=["gpt-5.2","gpt-5","o4-mini","o3","gpt-4o","gpt-4o-mini"];var ee=K;var _=class _ extends M{constructor(){super(...arguments);this.name="Gemini";this.type="gemini"}getAvailableModels(){return _.MODELS}async testConnection(){if(!this.isConfigured())return!1;try{return(await L(`${_.API_BASE}?key=${this.apiKey}`,{method:"GET",headers:{}},1e4)).ok}catch(e){return!1}}async analyze(e,t){var a,o,s,i,l,d,c,u,p;if(!this.isConfigured())return this.createResult(!1,"",void 0,"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");try{let m=(t==null?void 0:t.model)||this.model,g=[],h;t!=null&&t.systemPrompt&&(h=t.systemPrompt),g.push({role:"user",parts:[{text:e}]});let y={contents:g,generationConfig:{temperature:(a=t==null?void 0:t.temperature)!=null?a:.7,maxOutputTokens:(o=t==null?void 0:t.maxTokens)!=null?o:8192}};h&&(y.systemInstruction={parts:[{text:h}]});let f=await L(`${_.API_BASE}/${m}:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}),v=await f.json();if(!f.ok||v.error)return this.createResult(!1,"",void 0,((s=v.error)==null?void 0:s.message)||`HTTP ${f.status}`);let S=((u=(c=(d=(l=(i=v.candidates)==null?void 0:i[0])==null?void 0:l.content)==null?void 0:d.parts)==null?void 0:c[0])==null?void 0:u.text)||"",T=(p=v.usageMetadata)==null?void 0:p.totalTokenCount;return this.createResult(!0,S,T)}catch(m){return this.createErrorResult(m)}}};_.API_BASE="https://generativelanguage.googleapis.com/v1beta/models",_.MODELS=["gemini-3-pro-preview","gemini-3-flash-preview","gemini-2.5-pro","gemini-2.5-flash","gemini-2.5-flash-lite"];var te=_;var Y=class Y extends M{constructor(){super(...arguments);this.name="Grok";this.type="grok"}getAvailableModels(){return Y.MODELS}async testConnection(){if(!this.isConfigured())return!1;try{return(await L("https://api.x.ai/v1/models",{method:"GET",headers:{Authorization:`Bearer ${this.apiKey}`}},1e4)).ok}catch(e){return!1}}async analyze(e,t){var a,o,s,i,l,d;if(!this.isConfigured())return this.createResult(!1,"",void 0,"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");try{let c=[];t!=null&&t.systemPrompt&&c.push({role:"system",content:t.systemPrompt}),c.push({role:"user",content:e});let u=await L(Y.API_URL,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:(t==null?void 0:t.model)||this.model,messages:c,temperature:(a=t==null?void 0:t.temperature)!=null?a:.7,max_tokens:(o=t==null?void 0:t.maxTokens)!=null?o:4096})}),p=await u.json();if(!u.ok||p.error)return this.createResult(!1,"",void 0,((s=p.error)==null?void 0:s.message)||`HTTP ${u.status}`);let m=((l=(i=p.choices[0])==null?void 0:i.message)==null?void 0:l.content)||"",g=(d=p.usage)==null?void 0:d.total_tokens;return this.createResult(!0,m,g)}catch(c){return this.createErrorResult(c)}}};Y.API_URL="https://api.x.ai/v1/chat/completions",Y.MODELS=["grok-4-1-fast","grok-4-heavy","grok-4","grok-3","grok-3-mini"];var re=Y;var V=class V extends M{constructor(e,t,a=[]){super(e,t);this.name="OpenRouter";this.type="openrouter";this.customModels=a}getAvailableModels(){let e=[...V.DEFAULT_MODELS];for(let t of this.customModels)t&&!e.includes(t)&&e.push(t);return e}async testConnection(){if(!this.isConfigured())return!1;try{return(await L("https://openrouter.ai/api/v1/auth/key",{method:"GET",headers:{Authorization:`Bearer ${this.apiKey}`}},1e4)).ok}catch(e){return!1}}async getCredits(){var e,t;if(!this.isConfigured())return null;try{let a=await L("https://openrouter.ai/api/v1/auth/key",{method:"GET",headers:{Authorization:`Bearer ${this.apiKey}`}},1e4);return a.ok&&(t=(e=(await a.json()).data)==null?void 0:e.limit_remaining)!=null?t:null}catch(a){return null}}async analyze(e,t){var a,o,s,i,l,d;if(!this.isConfigured())return this.createResult(!1,"",void 0,"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");try{let c=[];t!=null&&t.systemPrompt&&c.push({role:"system",content:t.systemPrompt}),c.push({role:"user",content:e});let u=await L(V.API_URL,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":"https://obsidian.md","X-Title":"Life Log Plugin"},body:JSON.stringify({model:(t==null?void 0:t.model)||this.model,messages:c,temperature:(a=t==null?void 0:t.temperature)!=null?a:.7,max_tokens:(o=t==null?void 0:t.maxTokens)!=null?o:4096})}),p=await u.json();if(!u.ok||p.error)return this.createResult(!1,"",void 0,((s=p.error)==null?void 0:s.message)||`HTTP ${u.status}`);let m=((l=(i=p.choices[0])==null?void 0:i.message)==null?void 0:l.content)||"",g=(d=p.usage)==null?void 0:d.total_tokens;return this.createResult(!0,m,g)}catch(c){return this.createErrorResult(c)}}};V.API_URL="https://openrouter.ai/api/v1/chat/completions",V.DEFAULT_MODELS=["anthropic/claude-sonnet-4","anthropic/claude-opus-4","openai/gpt-5","openai/o3","google/gemini-2.5-pro","google/gemini-3-flash-preview","meta-llama/llama-4-maverick","deepseek/deepseek-r1"];var ae=V;var Ee=class{static createProvider(r,e){switch(r){case"openai":return new ee(e.openaiApiKey,e.openaiModel);case"gemini":return new te(e.geminiApiKey,e.geminiModel);case"grok":return new re(e.grokApiKey,e.grokModel);case"openrouter":return new ae(e.openRouterApiKey,e.openRouterModel,e.openRouterCustomModels);default:throw new Error(`Unknown provider type: ${r}`)}}static createDefaultProvider(r){return this.createProvider(r.defaultProvider,r)}static getConfiguredProviders(r){let e=[];return r.openaiApiKey&&e.push(this.createProvider("openai",r)),r.geminiApiKey&&e.push(this.createProvider("gemini",r)),r.grokApiKey&&e.push(this.createProvider("grok",r)),r.openRouterApiKey&&e.push(this.createProvider("openrouter",r)),e}static getProviderName(r){switch(r){case"openai":return"OpenAI";case"gemini":return"Google Gemini";case"grok":return"xAI Grok";case"openrouter":return"OpenRouter";default:return r}}static isProviderConfigured(r,e){switch(r){case"openai":return!!e.openaiApiKey;case"gemini":return!!e.geminiApiKey;case"grok":return!!e.grokApiKey;case"openrouter":return!!e.openRouterApiKey;default:return!1}}};var P=class{constructor(r,e){this.app=r,this.logFolder=e}async collect(r){let e=[],t=this.app.vault.getMarkdownFiles();for(let a of t)if(!(this.logFolder&&!a.path.startsWith(this.logFolder)))try{let o=await this.app.vault.cachedRead(a),s=this.extractCodeBlocks(o);for(let i of s){let l=this.parseBlock(i.content);if(!l)continue;let d=this.extractDate(l);d&&d>=r.start&&d<=r.end&&e.push({file:a,filePath:a.path,data:l,date:d})}}catch(o){console.error(`Error reading file ${a.path}:`,o)}return e.sort((a,o)=>a.date.getTime()-o.date.getTime()),{logs:e,totalCount:e.length,dateRange:r,category:this.category}}extractCodeBlocks(r){var l;let e=[],t=r.split(`
`),a=!1,o="",s=[],i=0;for(let d=0;d<t.length;d++){let c=(l=t[d])!=null?l:"";if(c.startsWith("```")&&!a){let u=c.slice(3).trim();u===this.codeBlockType&&(a=!0,o=u,s=[],i=d)}else c.startsWith("```")&&a?(o===this.codeBlockType&&e.push({content:s.join(`
`),startLine:i,endLine:d}),a=!1,o="",s=[]):a&&s.push(c)}return e}parseDateString(r){if(!r)return null;let e=r.match(/^(\d{4})-(\d{2})-(\d{2})(?:\s+(\d{2}):(\d{2}))?/);if(e&&e[1]&&e[2]&&e[3]){let t=parseInt(e[1],10),a=parseInt(e[2],10)-1,o=parseInt(e[3],10),s=e[4]?parseInt(e[4],10):0,i=e[5]?parseInt(e[5],10):0;return new Date(t,a,o,s,i)}return null}parseDurationToSeconds(r){if(!r)return 0;let e=0,t=r.match(/(\d+)\s*(?:h|)/);t&&t[1]&&(e+=parseInt(t[1],10)*3600);let a=r.match(/(\d+)\s*(?:m|)/);a&&a[1]&&(e+=parseInt(a[1],10)*60);let o=r.match(/(\d+)\s*(?:s|)/);return o&&o[1]&&(e+=parseInt(o[1],10)),e}};var F=class extends P{constructor(e,t){super(e,t);this.category="study";this.codeBlockType="study-log"}parseBlock(e){try{let t=de(e);return t.metadata.title||t.tasks.length>0?t:null}catch(t){return console.error("Error parsing study log:",t),null}}extractDate(e){return this.parseDateString(e.metadata.startDate)}async collectForAnalysis(e){let t=await this.collect(e),a=new Map,o=0,s=0,i=[];for(let d of t.logs){let c=d.data,u=c.metadata.subject||"\uAE30\uD0C0",p=this.parseDurationToSeconds(c.metadata.totalDuration);o+=p;let m=a.get(u)||{duration:0,count:0};m.duration+=p,m.count+=1,a.set(u,m),(c.metadata.focusScore!==void 0||c.metadata.comprehensionScore!==void 0)&&i.push({understanding:c.metadata.comprehensionScore||0,effort:c.metadata.focusScore||0,satisfaction:Math.round((c.metadata.focusScore||0)*.5+(c.metadata.comprehensionScore||0)*.5)});let g=c.tasks.filter(h=>h.state==="completed");s+=g.length}let l=Array.from(a.entries()).map(([d,c])=>({subject:d,duration:c.duration,count:c.count}));return l.sort((d,c)=>c.duration-d.duration),{period:e,sessions:t.logs.map(d=>d.data),subjectStats:l,totalStudyTime:o,pomodoroCount:s,scores:i}}toJSON(e){let t=e.logs.map(a=>({date:a.date.toISOString().split("T")[0],title:a.data.metadata.title,subject:a.data.metadata.subject,state:a.data.metadata.state,totalDuration:a.data.metadata.totalDuration,focusScore:a.data.metadata.focusScore,comprehensionScore:a.data.metadata.comprehensionScore,tasks:a.data.tasks.map(o=>({name:o.name,state:o.state,duration:o.recordedDuration})),tags:a.data.metadata.tags}));return JSON.stringify(t,null,2)}};var H=class extends P{constructor(e,t){super(e,t);this.category="workout";this.codeBlockType="life-log"}parseBlock(e){try{let t=se(e);return t.metadata.title||t.exercises.length>0?t:null}catch(t){return console.error("Error parsing workout log:",t),null}}extractDate(e){return this.parseDateString(e.metadata.startDate)}async collectForAnalysis(e){let t=await this.collect(e),a=new Map,o=0,s=0,i=0;for(let c of t.logs){let u=c.data;i++;let p=this.parseDurationToSeconds(u.metadata.duration);o+=p,u.metadata.state==="completed"&&s++;for(let m of u.exercises){let g=m.name,h=a.get(g)||{totalSets:0,totalReps:0};h.totalSets+=1;let y=m.params.find(f=>f.key.toLowerCase().includes("rep")||f.key.toLowerCase().includes("\uD69F\uC218"));if(y){let f=parseInt(y.value)||0;h.totalReps+=f}a.set(g,h)}}let l=Array.from(a.entries()).map(([c,u])=>({name:c,totalSets:u.totalSets,totalReps:u.totalReps}));l.sort((c,u)=>u.totalSets-c.totalSets);let d=i>0?s/i*100:0;return{period:e,workouts:t.logs.map(c=>c.data),exerciseStats:l,totalDuration:o,completionRate:d}}toJSON(e){let t=e.logs.map(a=>({date:a.date.toISOString().split("T")[0],title:a.data.metadata.title,state:a.data.metadata.state,duration:a.data.metadata.duration,exercises:a.data.exercises.map(o=>({name:o.name,state:o.state,params:o.params.reduce((s,i)=>(s[i.key]=i.value+(i.unit?` ${i.unit}`:""),s),{}),duration:o.recordedDuration}))}));return JSON.stringify(t,null,2)}};var O=class extends P{constructor(e,t){super(e,t);this.category="work";this.codeBlockType="work-log"}parseBlock(e){try{let t=ge(e);return t.metadata.title||t.tasks.length>0?t:null}catch(t){return console.error("Error parsing work log:",t),null}}extractDate(e){return this.parseDateString(e.metadata.startDate)}async collectForAnalysis(e){let t=await this.collect(e),a=new Map,o=0,s=0,i=0,l=0;for(let u of t.logs){let p=u.data;l++;let m=this.parseDurationToSeconds(p.metadata.totalDuration);o+=m,p.metadata.state==="completed"&&i++;for(let h of p.tasks)if(h.expectedDuration&&h.actualDuration){let y=h.expectedDuration;this.parseDurationToSeconds(h.actualDuration)>y*1.2&&s++}let g=p.metadata.tags||["\uBBF8\uBD84\uB958"];for(let h of g){let y=a.get(h)||{duration:0,count:0};y.duration+=m/g.length,y.count+=1,a.set(h,y)}}let d=Array.from(a.entries()).map(([u,p])=>({category:u,duration:Math.round(p.duration),count:p.count}));d.sort((u,p)=>p.duration-u.duration);let c=l>0?i/l*100:0;return{period:e,tasks:t.logs.map(u=>u.data),categoryStats:d,totalWorkTime:o,overtimeCount:s,completionRate:c}}toJSON(e){let t=e.logs.map(a=>({date:a.date.toISOString().split("T")[0],title:a.data.metadata.title,state:a.data.metadata.state,totalDuration:a.data.metadata.totalDuration,tasks:a.data.tasks.map(o=>({name:o.name,state:o.state,priority:o.priority,expectedDuration:o.expectedDuration,actualDuration:o.actualDuration,notes:o.notes})),tags:a.data.metadata.tags}));return JSON.stringify(t,null,2)}};var U=class extends P{constructor(e,t){super(e,t);this.category="meal";this.codeBlockType="meal-log"}parseBlock(e){try{let t=ye(e);return t.metadata.title||t.foods.length>0?t:null}catch(t){return console.error("Error parsing meal log:",t),null}}extractDate(e){return this.parseDateString(e.metadata.date)}async collectForAnalysis(e){var p;let t=await this.collect(e),a=new Map,o=new Map,s=new Map;for(let m of t.logs){let g=m.data,h=(p=m.date.toISOString().split("T")[0])!=null?p:"",y=g.metadata.mealType;a.set(y,(a.get(y)||0)+1),h&&s.set(h,(s.get(h)||0)+1);for(let f of g.foods){let v=f.name.toLowerCase().trim();o.set(v,(o.get(v)||0)+1)}}let i=[{type:"breakfast",count:a.get("breakfast")||0},{type:"lunch",count:a.get("lunch")||0},{type:"dinner",count:a.get("dinner")||0},{type:"snack",count:a.get("snack")||0}],l=Array.from(o.entries()).map(([m,g])=>({name:m,count:g})).sort((m,g)=>g.count-m.count).slice(0,20),d=s.size,c=0;for(let m of s.values())m>=3&&c++;let u=d>0?Math.round(c/d*100):0;return{period:e,meals:t.logs.map(m=>m.data),mealTypeStats:i,foodFrequency:l,regularityScore:u}}toJSON(e){let t=e.logs.map(a=>({date:a.date.toISOString().split("T")[0],title:a.data.metadata.title,mealType:a.data.metadata.mealType,state:a.data.metadata.state,foods:a.data.foods.map(o=>o.name),notes:a.data.metadata.notes}));return JSON.stringify(t,null,2)}};var oe=class{static createCollector(r,e,t){switch(r){case"study":return new F(e,t);case"workout":return new H(e,t);case"work":return new O(e,t);case"meal":return new U(e,t);default:throw new Error(`Unknown category: ${r}`)}}static createAllCollectors(r,e){let t=new Map;return t.set("study",new F(r,e)),t.set("workout",new H(r,e)),t.set("work",new O(r,e)),t.set("meal",new U(r,e)),t}};function Vt(n,r,e){switch(n){case"study":return r.toJSON(e);case"workout":return r.toJSON(e);case"work":return r.toJSON(e);case"meal":return r.toJSON(e);default:return JSON.stringify(e.logs.map(t=>t.data),null,2)}}var Ce=class{constructor(r,e,t){this.app=r,this.settings=e,this.logFolder=t}async analyze(r,e){try{e==null||e({stage:"collecting",message:"\uB370\uC774\uD130\uB97C \uC218\uC9D1\uD558\uB294 \uC911...",progress:10});let t=await this.collectData(r.category,r.dateRange);if(t.totalCount===0)return this.createErrorResult("\uC120\uD0DD\uD55C \uAE30\uAC04\uC5D0 \uB370\uC774\uD130\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uB978 \uAE30\uAC04\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.");e==null||e({stage:"processing",message:"\uB370\uC774\uD130\uB97C \uCC98\uB9AC\uD558\uB294 \uC911...",progress:30});let a=await this.processData(r.category,t);e==null||e({stage:"analyzing",message:"AI\uAC00 \uBD84\uC11D\uD558\uB294 \uC911...",progress:50});let o=this.createProvider(r.providerType);if(!o.isConfigured())return this.createErrorResult(`${o.name} API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C API \uD0A4\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694.`);let s=this.buildPrompt(r.template,r.category,r.dateRange,a);e==null||e({stage:"analyzing",message:"AI \uC751\uB2F5\uC744 \uAE30\uB2E4\uB9AC\uB294 \uC911...",progress:70});let i=await o.analyze(s,{systemPrompt:r.template.systemPrompt,model:r.model,temperature:.7,maxTokens:4096});return e==null||e({stage:"completed",message:"\uBD84\uC11D\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!",progress:100}),i}catch(t){return e==null||e({stage:"error",message:t instanceof Error?t.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958",progress:0}),this.createErrorResult(t instanceof Error?t.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.")}}async collectData(r,e){return await oe.createCollector(r,this.app,this.logFolder).collect(e)}async processData(r,e){let t=oe.createCollector(r,this.app,this.logFolder),a=Vt(r,t,e),o=this.generateSummary(r,e),s=await this.calculateTotalDuration(r,e);return{rawData:a,summary:o,totalDuration:s}}generateSummary(r,e){let t=e.totalCount,a=D.getCategoryName(r);switch(r){case"study":return`\uCD1D ${t}\uAC1C\uC758 \uD559\uC2B5 \uC138\uC158\uC774 \uAE30\uB85D\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`;case"workout":return`\uCD1D ${t}\uAC1C\uC758 \uC6B4\uB3D9 \uAE30\uB85D\uC774 \uC788\uC2B5\uB2C8\uB2E4.`;case"work":return`\uCD1D ${t}\uAC1C\uC758 \uC5C5\uBB34 \uAE30\uB85D\uC774 \uC788\uC2B5\uB2C8\uB2E4.`;case"meal":return`\uCD1D ${t}\uAC1C\uC758 \uC2DD\uC0AC \uAE30\uB85D\uC774 \uC788\uC2B5\uB2C8\uB2E4.`;default:return`\uCD1D ${t}\uAC1C\uC758 ${a} \uAE30\uB85D\uC774 \uC788\uC2B5\uB2C8\uB2E4.`}}async calculateTotalDuration(r,e){let t=0;switch(r){case"study":{t=(await new F(this.app,this.logFolder).collectForAnalysis({start:new Date(0),end:new Date})).totalStudyTime;break}case"workout":{t=(await new H(this.app,this.logFolder).collectForAnalysis({start:new Date(0),end:new Date})).totalDuration;break}case"work":{t=(await new O(this.app,this.logFolder).collectForAnalysis({start:new Date(0),end:new Date})).totalWorkTime;break}case"meal":return"\uD574\uB2F9 \uC5C6\uC74C"}return D.formatDuration(t)}buildPrompt(r,e,t,a){let o={period:D.formatDateRange(t),category:e,recordCount:JSON.parse(a.rawData).length,totalDuration:a.totalDuration,rawData:a.rawData,summary:a.summary,currentDate:D.getCurrentDateString()};return D.render(r.userPromptTemplate,o)}createProvider(r){return Ee.createProvider(r,this.settings)}createErrorResult(r){return{success:!1,content:"",metadata:{provider:"",model:"",generatedAt:new Date().toISOString()},error:r}}getAvailableProviders(){return[{type:"openai",name:"OpenAI",key:this.settings.openaiApiKey},{type:"gemini",name:"Google Gemini",key:this.settings.geminiApiKey},{type:"grok",name:"xAI Grok",key:this.settings.grokApiKey},{type:"openrouter",name:"OpenRouter",key:this.settings.openRouterApiKey}].map(e=>({type:e.type,name:e.name,configured:!!e.key}))}};var De=class extends E.Modal{constructor(e,t,a){super(e);this.selectedCategory="study";this.selectedTemplate=null;this.selectedDataRange="week";this.customDays=7;this.resultContainer=null;this.progressContainer=null;this.settings=t,this.logFolder=a,this.selectedProvider=t.defaultProvider,this.engine=new Ce(e,t,a),this.renderComponent=new E.Component}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ai-analysis-modal"),this.renderComponent.load(),e.createEl("h2",{text:"\u{1F916} AI \uBD84\uC11D"}),this.renderCategorySelector(e),this.renderTemplateSelector(e),this.renderDateRangeSelector(e),this.renderProviderSelector(e),this.progressContainer=e.createDiv({cls:"analysis-progress hidden"}),this.resultContainer=e.createDiv({cls:"analysis-result hidden"}),this.renderButtons(e)}renderCategorySelector(e){let t=e.createDiv({cls:"analysis-section"});t.createEl("label",{text:"\uBD84\uC11D \uB300\uC0C1",cls:"analysis-label"});let a=[{value:"study",label:"\uD559\uC2B5",icon:"\u{1F4DA}"},{value:"workout",label:"\uC6B4\uB3D9",icon:"\u{1F4AA}"},{value:"work",label:"\uC5C5\uBB34",icon:"\u{1F4BC}"},{value:"meal",label:"\uC2DD\uB2E8",icon:"\u{1F37D}\uFE0F"}],o=t.createDiv({cls:"category-btn-group"});for(let s of a){let i=o.createEl("button",{cls:`category-btn ${this.selectedCategory===s.value?"active":""}`,text:`${s.icon} ${s.label}`});i.addEventListener("click",()=>{this.selectedCategory=s.value,this.selectedTemplate=null,o.querySelectorAll(".category-btn").forEach(l=>l.removeClass("active")),i.addClass("active"),this.updateTemplateList()})}}renderTemplateSelector(e){let t=e.createDiv({cls:"analysis-section template-section"});t.createEl("label",{text:"\uBD84\uC11D \uD15C\uD50C\uB9BF",cls:"analysis-label"});let a=t.createDiv({cls:"template-list"});a.id="template-list",this.updateTemplateList()}updateTemplateList(){var o;let e=document.getElementById("template-list");if(!e)return;e.empty();let t=kt(this.selectedCategory),a=this.settings.enabledTemplates;for(let s of t){if(!a.includes(s.id))continue;let i=e.createDiv({cls:`template-item ${((o=this.selectedTemplate)==null?void 0:o.id)===s.id?"selected":""}`}),l=i.createDiv({cls:"template-title",text:s.name}),d=i.createDiv({cls:"template-desc",text:s.description});i.addEventListener("click",()=>{this.selectedTemplate=s,e.querySelectorAll(".template-item").forEach(c=>c.removeClass("selected")),i.addClass("selected")})}if(t.length>0&&!this.selectedTemplate){let s=t.find(i=>a.includes(i.id));if(s){this.selectedTemplate=s;let i=e.querySelector(".template-item");i==null||i.addClass("selected")}}}renderDateRangeSelector(e){let t=e.createDiv({cls:"analysis-section"});t.createEl("label",{text:"\uBD84\uC11D \uAE30\uAC04",cls:"analysis-label"});let a=[{value:"day",label:"\uC624\uB298"},{value:"week",label:"\uCD5C\uADFC 7\uC77C"},{value:"month",label:"\uCD5C\uADFC 30\uC77C"},{value:"quarter",label:"\uCD5C\uADFC 90\uC77C"},{value:"custom",label:"\uC9C1\uC811 \uC785\uB825"}],o=t.createEl("select",{cls:"analysis-select"});for(let l of a){let d=o.createEl("option",{text:l.label,value:l.value});l.value===this.selectedDataRange&&(d.selected=!0)}let s=t.createDiv({cls:`custom-days-container ${this.selectedDataRange!=="custom"?"hidden":""}`}),i=s.createEl("input",{type:"number",cls:"custom-days-input",value:String(this.customDays),placeholder:"\uC77C\uC218"});s.createSpan({text:"\uC77C"}),o.addEventListener("change",()=>{this.selectedDataRange=o.value,this.selectedDataRange==="custom"?s.removeClass("hidden"):s.addClass("hidden")}),i.addEventListener("change",()=>{this.customDays=parseInt(i.value)||7})}renderProviderSelector(e){let t=e.createDiv({cls:"analysis-section"});t.createEl("label",{text:"AI Provider",cls:"analysis-label"});let a=this.engine.getAvailableProviders(),o=t.createEl("select",{cls:"analysis-select"});for(let i of a){let l=i.configured?i.name:`${i.name} (API \uD0A4 \uD544\uC694)`,d=o.createEl("option",{text:l,value:i.type});d.disabled=!i.configured,i.type===this.selectedProvider&&i.configured&&(d.selected=!0)}let s=a.find(i=>i.configured);if(s){this.selectedProvider=s.type;for(let i=0;i<o.options.length;i++){let l=o.options[i];if(l&&l.value===this.selectedProvider){l.selected=!0;break}}}o.addEventListener("change",()=>{this.selectedProvider=o.value})}renderButtons(e){let t=e.createDiv({cls:"analysis-buttons"});t.createEl("button",{cls:"analysis-btn analysis-btn-secondary",text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close());let o=t.createEl("button",{cls:"analysis-btn analysis-btn-primary",text:"\u{1F680} \uBD84\uC11D \uC2DC\uC791"});o.id="analyze-btn",o.addEventListener("click",()=>this.startAnalysis())}async startAnalysis(){if(!this.selectedTemplate){new E.Notice("\uBD84\uC11D \uD15C\uD50C\uB9BF\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.");return}let t=this.engine.getAvailableProviders().find(s=>s.type===this.selectedProvider);if(!(t!=null&&t.configured)){new E.Notice(`${(t==null?void 0:t.name)||"AI"} API \uD0A4\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694.`);return}let a=document.getElementById("analyze-btn");a&&(a.disabled=!0,a.textContent="\uBD84\uC11D \uC911..."),this.showProgress();let o=D.calculateDateRange(this.selectedDataRange,this.customDays);try{let s=await this.engine.analyze({category:this.selectedCategory,template:this.selectedTemplate,dateRange:o,providerType:this.selectedProvider},i=>this.updateProgress(i));s.success?(this.showResult(s.content),new E.Notice("\uBD84\uC11D\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!")):(this.showError(s.error||"\uBD84\uC11D \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."),new E.Notice(`\uBD84\uC11D \uC2E4\uD328: ${s.error}`))}catch(s){let i=s instanceof Error?s.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958";this.showError(i),new E.Notice(`\uBD84\uC11D \uC624\uB958: ${i}`)}a&&(a.disabled=!1,a.textContent="\u{1F680} \uBD84\uC11D \uC2DC\uC791")}showProgress(){this.progressContainer&&(this.progressContainer.removeClass("hidden"),this.progressContainer.empty(),this.progressContainer.createDiv({cls:"progress-bar"}).createDiv({cls:"progress-fill"}),this.progressContainer.createDiv({cls:"progress-text",text:"\uC2DC\uC791 \uC911..."})),this.resultContainer&&this.resultContainer.addClass("hidden")}updateProgress(e){if(!this.progressContainer)return;let t=this.progressContainer.querySelector(".progress-fill"),a=this.progressContainer.querySelector(".progress-text");t&&(t.style.width=`${e.progress}%`),a&&(a.textContent=e.message)}showResult(e){if(this.progressContainer&&this.progressContainer.addClass("hidden"),this.resultContainer){this.resultContainer.removeClass("hidden"),this.resultContainer.empty();let t=this.resultContainer.createDiv({cls:"result-header"});t.createEl("h3",{text:"\u{1F4CA} \uBD84\uC11D \uACB0\uACFC"}),t.createEl("button",{cls:"result-save-btn",text:"\u{1F4DD} \uB178\uD2B8\uB85C \uC800\uC7A5"}).addEventListener("click",()=>this.saveAsNote(e));let o=this.resultContainer.createDiv({cls:"result-content"});E.MarkdownRenderer.render(this.app,e,o,"",this.renderComponent)}}showError(e){if(this.progressContainer&&this.progressContainer.addClass("hidden"),this.resultContainer){this.resultContainer.removeClass("hidden"),this.resultContainer.empty();let t=this.resultContainer.createDiv({cls:"result-error"});t.createEl("h3",{text:"\u274C \uC624\uB958 \uBC1C\uC0DD"}),t.createEl("p",{text:e})}}async saveAsNote(e){var u,p;let t=D.getCurrentDateString(),a=D.getCategoryName(this.selectedCategory),o=((u=this.selectedTemplate)==null?void 0:u.name)||"analysis",s=this.settings.reportNaming.replace("{{category}}",this.selectedCategory).replace("{{date}}",t);s=`${s}.md`;let i=this.settings.reportSavePath,l=`${i}/${s}`;this.app.vault.getAbstractFileByPath(i)||await this.app.vault.createFolder(i);let c=`---
type: ai-analysis
category: ${this.selectedCategory}
template: ${((p=this.selectedTemplate)==null?void 0:p.id)||"unknown"}
provider: ${this.selectedProvider}
date: ${t}
---

# ${a} \uBD84\uC11D \uB9AC\uD3EC\uD2B8

> \uC0DD\uC131\uC77C\uC2DC: ${new Date().toLocaleString("ko-KR")}
> \uD15C\uD50C\uB9BF: ${o}

${e}
`;try{if(this.app.vault.getAbstractFileByPath(l)){let g=Date.now(),h=s.replace(".md",`_${g}.md`);await this.app.vault.create(`${i}/${h}`,c),new E.Notice(`\uB9AC\uD3EC\uD2B8\uAC00 \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4: ${h}`)}else await this.app.vault.create(l,c),new E.Notice(`\uB9AC\uD3EC\uD2B8\uAC00 \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4: ${s}`)}catch(m){new E.Notice(`\uC800\uC7A5 \uC2E4\uD328: ${m instanceof Error?m.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}}onClose(){let{contentEl:e}=this;e.empty(),this.renderComponent.unload()}};var Zr='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/><circle cx="12" cy="12" r="3"/></svg>',Le=class extends Me.Plugin{constructor(){super(...arguments);this.timerManager=new le;this.fileUpdater=null;this.fileCreator=null;this.ribbonIconEl=null;this.settings=mt}async onload(){await this.loadSettings(),this.fileUpdater=new ce(this.app),this.fileCreator=new Q(this.app,this.settings),(0,Me.addIcon)("life-log",Zr),this.registerMarkdownCodeBlockProcessor("life-log",(e,t,a)=>{this.processWorkoutBlock(e,t,a)}),this.registerMarkdownCodeBlockProcessor("study-log",(e,t,a)=>{this.processStudyBlock(e,t,a)}),this.registerMarkdownCodeBlockProcessor("work-log",(e,t,a)=>{this.processWorkBlock(e,t,a)}),this.registerMarkdownCodeBlockProcessor("meal-log",(e,t,a)=>{this.processMealBlock(e,t,a)}),this.addCommand({id:"open-quick-log",name:"\uC0C8 \uAE30\uB85D",hotkeys:[{modifiers:["Mod","Shift"],key:"l"}],callback:()=>{this.fileCreator&&new B(this.app,this.settings,this.fileCreator).open()}}),this.addCommand({id:"open-study-log",name:"\uC0C8 \uD559\uC2B5 \uAE30\uB85D",callback:()=>{this.fileCreator&&new B(this.app,{...this.settings,defaultTab:"study"},this.fileCreator).open()}}),this.addCommand({id:"open-work-log",name:"\uC0C8 \uC5C5\uBB34 \uAE30\uB85D",callback:()=>{this.fileCreator&&new B(this.app,{...this.settings,defaultTab:"work"},this.fileCreator).open()}}),this.addCommand({id:"open-workout-log",name:"\uC0C8 \uC6B4\uB3D9 \uAE30\uB85D",callback:()=>{this.fileCreator&&new B(this.app,{...this.settings,defaultTab:"workout"},this.fileCreator).open()}}),this.addCommand({id:"open-ai-analysis",name:"AI \uBD84\uC11D",hotkeys:[{modifiers:["Mod","Shift"],key:"a"}],callback:()=>{new De(this.app,this.settings.aiAnalysis,this.settings.logFolder).open()}}),console.log("[Life Log] Registering settings tab..."),this.addSettingTab(new ke(this.app,this)),console.log("[Life Log] Settings tab registered"),this.updateRibbonIcon()}onunload(){this.timerManager.destroy()}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},mt,e),(!this.settings.subjects||this.settings.subjects.length===0)&&(this.settings.subjects=[...pt]),(!this.settings.workoutTemplates||this.settings.workoutTemplates.length===0)&&(this.settings.workoutTemplates=[...ve]),this.settings.aiAnalysis?this.settings.aiAnalysis=Object.assign({},X,this.settings.aiAnalysis):this.settings.aiAnalysis={...X}}async saveSettings(){await this.saveData(this.settings),this.fileCreator&&(this.fileCreator=new Q(this.app,this.settings))}updateRibbonIcon(){this.ribbonIconEl&&(this.ribbonIconEl.remove(),this.ribbonIconEl=null),this.settings.showRibbonIcon&&(this.ribbonIconEl=this.addRibbonIcon("life-log","Life Log: \uC0C8 \uAE30\uB85D",()=>{this.fileCreator&&new B(this.app,this.settings,this.fileCreator).open()}))}processWorkoutBlock(e,t,a){var u;let o=se(e),s=a.getSectionInfo(t),i=`${a.sourcePath}:${(u=s==null?void 0:s.lineStart)!=null?u:0}`,l=this.timerManager.isTimerRunning(i);if(l&&o.metadata.state!=="started")this.timerManager.stopWorkoutTimer(i);else if(l&&o.metadata.state==="started"){let p=o.exercises.findIndex(g=>g.state==="inProgress"),m=this.timerManager.getActiveExerciseIndex(i);p>=0&&p!==m&&this.timerManager.setActiveExerciseIndex(i,p)}let d=this.createWorkoutCallbacks(a,s,o,i),c=this.settings.usePerTypeTimerStyle?this.settings.workoutTimerStyle:this.settings.timerStyle;Mt({el:t,parsed:o,callbacks:d,workoutId:i,timerManager:this.timerManager,timerStyle:c})}processStudyBlock(e,t,a){var u;let o=de(e),s=a.getSectionInfo(t),i=`study:${a.sourcePath}:${(u=s==null?void 0:s.lineStart)!=null?u:0}`,l=this.timerManager.isTimerRunning(i);if(l&&o.metadata.state!=="started")this.timerManager.stopWorkoutTimer(i);else if(l&&o.metadata.state==="started"){let p=o.tasks.findIndex(g=>g.state==="inProgress"),m=this.timerManager.getActiveExerciseIndex(i);p>=0&&p!==m&&this.timerManager.setActiveExerciseIndex(i,p)}let d=this.createStudyCallbacks(a,s,o,i),c=this.settings.usePerTypeTimerStyle?this.settings.studyTimerStyle:this.settings.timerStyle;Wt({el:t,parsed:o,callbacks:d,studyId:i,timerManager:this.timerManager,enableTimerSound:this.settings.enableTimerSound,enableNotification:this.settings.enableNotifications,timerStyle:c})}processWorkBlock(e,t,a){var u;let o=ge(e),s=a.getSectionInfo(t),i=`work:${a.sourcePath}:${(u=s==null?void 0:s.lineStart)!=null?u:0}`,l=this.timerManager.isTimerRunning(i);if(l&&o.metadata.state!=="started")this.timerManager.stopWorkoutTimer(i);else if(l&&o.metadata.state==="started"){let p=o.tasks.findIndex(g=>g.state==="inProgress"),m=this.timerManager.getActiveExerciseIndex(i);p>=0&&p!==m&&this.timerManager.setActiveExerciseIndex(i,p)}let d=this.createWorkCallbacks(a,s,o,i),c=this.settings.usePerTypeTimerStyle?this.settings.workTimerStyle:this.settings.timerStyle;Ht({el:t,parsed:o,callbacks:d,workId:i,timerManager:this.timerManager,enableTimerSound:this.settings.enableTimerSound,enableNotification:this.settings.enableNotifications,timerStyle:c})}createWorkCallbacks(e,t,a,o){let s=a,i=!1,l=async c=>{var m;s=c,i=!1;let u=Ft(c),p=s.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(e.sourcePath,t,u,p))};return{onStartWork:async()=>{i=!1,s.metadata.state="started",s.metadata.startDate=this.formatStartDate(new Date);let c=s.tasks.findIndex(u=>u.state==="pending");c>=0&&(s=z(s,c,"inProgress")),await l(s),this.timerManager.startWorkoutTimer(o,c>=0?c:0)},onFinishWork:async()=>{let c=this.timerManager.getTimerState(o);c&&(s.metadata.totalDuration=x(c.workoutElapsed)),s.metadata.endDate=this.formatStartDate(new Date),s.metadata.state="completed";for(let u=0;u<s.tasks.length;u++){let p=s.tasks[u];if(p&&p.state==="inProgress"){let m=this.timerManager.getTimerState(o);m&&(s=fe(s,u,x(m.exerciseElapsed))),s=z(s,u,"completed")}}await l(s),this.timerManager.stopWorkoutTimer(o)},onTaskFinish:async c=>{if(i=!1,!s.tasks[c])return;let p=this.timerManager.getTimerState(o);p&&(s=fe(s,c,x(p.exerciseElapsed))),s=z(s,c,"completed");let m=s.tasks.findIndex((g,h)=>h>c&&g.state==="pending");m>=0?(s=z(s,m,"inProgress"),this.timerManager.advanceExercise(o,m),await l(s)):await l(s)},onTaskSkip:async c=>{i=!1;let u=this.timerManager.getTimerState(o);u&&u.exerciseElapsed>0&&(s=fe(s,c,x(u.exerciseElapsed))),s=z(s,c,"skipped");let p=s.tasks.findIndex((m,g)=>g>c&&m.state==="pending");p>=0?(s=z(s,p,"inProgress"),this.timerManager.advanceExercise(o,p),await l(s)):await l(s)},onPauseTask:()=>{this.timerManager.pauseExercise(o)},onResumeTask:()=>{this.timerManager.resumeExercise(o)},onFlushChanges:async()=>{i&&await l(s)}}}createWorkoutCallbacks(e,t,a,o){let s=a,i=!1,l=async c=>{var m;s=c,i=!1;let u=We(c),p=s.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(e.sourcePath,t,u,p))};return{onStartWorkout:async()=>{i=!1,s.metadata.state="started",s.metadata.startDate=this.formatStartDate(new Date);let c=s.exercises.findIndex(u=>u.state==="pending");if(c>=0){let u=s.exercises[c];u&&(u.state="inProgress")}await l(s),this.timerManager.startWorkoutTimer(o,c>=0?c:0)},onFinishWorkout:async()=>{let c=this.timerManager.getTimerState(o);c&&(s.metadata.duration=x(c.workoutElapsed)),s.metadata.state="completed",s=ne(s),await l(s),this.timerManager.stopWorkoutTimer(o)},onExerciseFinish:async c=>{if(i=!1,!s.exercises[c])return;let p=this.timerManager.getTimerState(o);p&&(s=q(s,c,x(p.exerciseElapsed))),s=R(s,c,"completed");let m=s.exercises.findIndex((g,h)=>h>c&&g.state==="pending");if(m>=0)s=R(s,m,"inProgress"),this.timerManager.advanceExercise(o,m),await l(s);else{s.metadata.state="completed";let g=this.timerManager.getTimerState(o);g&&(s.metadata.duration=x(g.workoutElapsed)),s=ne(s),await l(s),this.timerManager.stopWorkoutTimer(o)}},onExerciseAddSet:async c=>{if(i=!1,!s.exercises[c])return;let p=this.timerManager.getTimerState(o);p&&(s=q(s,c,x(p.exerciseElapsed))),s=R(s,c,"completed"),s=bt(s,c),s=R(s,c+1,"inProgress"),this.timerManager.advanceExercise(o,c+1),await l(s)},onExerciseAddRest:async c=>{i=!1;let u=s.exercises[c],p=s.metadata.restDuration;if(!u||!p)return;let m=this.timerManager.getTimerState(o);m&&(s=q(s,c,x(m.exerciseElapsed))),s=R(s,c,"completed"),s=Tt(s,c,p),s=R(s,c+1,"inProgress"),this.timerManager.advanceExercise(o,c+1),await l(s)},onExerciseSkip:async c=>{i=!1;let u=this.timerManager.getTimerState(o);u&&u.exerciseElapsed>0&&(s=q(s,c,x(u.exerciseElapsed))),s=R(s,c,"skipped");let p=s.exercises.findIndex((m,g)=>g>c&&m.state==="pending");if(p>=0)s=R(s,p,"inProgress"),this.timerManager.advanceExercise(o,p),await l(s);else{s.metadata.state="completed";let m=this.timerManager.getTimerState(o);m&&(s.metadata.duration=x(m.workoutElapsed)),s=ne(s),this.timerManager.stopWorkoutTimer(o),await l(s)}},onParamChange:(c,u,p)=>{let m=s.exercises[c],g=m==null?void 0:m.params.find(h=>h.key===u);(g==null?void 0:g.value)!==p&&(s=St(s,c,u,p),i=!0)},onFlushChanges:async()=>{i&&await l(s)},onPauseExercise:()=>{this.timerManager.pauseExercise(o)},onResumeExercise:()=>{this.timerManager.resumeExercise(o)},onAddSample:async()=>{var p;let c=xt(),u=We(c);await((p=this.fileUpdater)==null?void 0:p.updateCodeBlock(e.sourcePath,t,u,c.metadata.title))}}}createStudyCallbacks(e,t,a,o){let s=a,i=!1,l=async c=>{var m;s=c,i=!1;let u=At(c),p=s.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(e.sourcePath,t,u,p))};return{onStartStudy:async()=>{i=!1,s.metadata.state="started",s.metadata.startDate=this.formatStartDate(new Date);let c=s.tasks.findIndex(u=>u.state==="pending");c>=0&&(s=G(s,c,"inProgress")),await l(s),this.timerManager.startWorkoutTimer(o,c>=0?c:0,this.settings.enablePomodoro?{enabled:!0,workDuration:this.settings.pomodoroWork*60,breakDuration:this.settings.pomodoroBreak*60}:void 0)},onFinishStudy:async()=>{let c=this.timerManager.getTimerState(o);c&&(s.metadata.totalDuration=x(c.workoutElapsed)),s.metadata.endDate=this.formatStartDate(new Date),s.metadata.state="completed",await l(s),this.timerManager.stopWorkoutTimer(o)},onTaskFinish:async c=>{if(i=!1,!s.tasks[c])return;let p=this.timerManager.getTimerState(o);p&&(s=ue(s,c,x(p.exerciseElapsed))),s=G(s,c,"completed");let m=s.tasks.findIndex((g,h)=>h>c&&g.state==="pending");m>=0?(s=G(s,m,"inProgress"),this.timerManager.advanceExercise(o,m),await l(s)):await l(s)},onTaskSkip:async c=>{i=!1;let u=this.timerManager.getTimerState(o);u&&u.exerciseElapsed>0&&(s=ue(s,c,x(u.exerciseElapsed))),s=G(s,c,"skipped");let p=s.tasks.findIndex((m,g)=>g>c&&m.state==="pending");p>=0?(s=G(s,p,"inProgress"),this.timerManager.advanceExercise(o,p),await l(s)):await l(s)},onPauseTask:()=>{this.timerManager.pauseExercise(o)},onResumeTask:()=>{this.timerManager.resumeExercise(o)},onFlushChanges:async()=>{i&&await l(s)},onOpenSelfEval:()=>{new we(this.app,async c=>{s=It(s,c.focusScore,c.comprehensionScore);let u=this.timerManager.getTimerState(o);u&&(s.metadata.totalDuration=x(u.workoutElapsed)),s.metadata.endDate=this.formatStartDate(new Date),s.metadata.state="completed";for(let p=0;p<s.tasks.length;p++){let m=s.tasks[p];if(m&&m.state==="inProgress"){let g=this.timerManager.getTimerState(o);g&&(s=ue(s,p,x(g.exerciseElapsed))),s=G(s,p,"completed")}}await l(s),this.timerManager.stopWorkoutTimer(o)}).open()}}}formatStartDate(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0");return`${t}-${a}-${o} ${s}:${i}`}processMealBlock(e,t,a){var d;let o=ye(e),s=a.getSectionInfo(t),i=`meal:${a.sourcePath}:${(d=s==null?void 0:s.lineStart)!=null?d:0}`,l=this.createMealCallbacks(a,s,o,i);_t({el:t,parsed:o,callbacks:l,mealId:i,app:this.app})}createMealCallbacks(e,t,a,o){let s=a,i=async l=>{var u;s=l;let d=Nt(l),c=s.metadata.title;await((u=this.fileUpdater)==null?void 0:u.updateCodeBlock(e.sourcePath,t,d,c))};return{onCompleteMeal:async()=>{s.metadata.state="completed",s.metadata.date||(s.metadata.date=this.formatStartDate(new Date));for(let l=0;l<s.foods.length;l++){let d=s.foods[l];d&&d.state==="pending"&&(s=lt(s,l))}await i(s)},onFoodToggle:async l=>{s=lt(s,l),await i(s)},onAddFood:async l=>{s=jt(s,l),await i(s)},onRemoveFood:async l=>{s=Gt(s,l),await i(s)},onPhotoChange:async l=>{s=zt(s,l),await i(s)},onFlushChanges:async()=>{}}}};
