/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var tt=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var re=(a,e)=>{for(var t in e)tt(a,t,{get:e[t],enumerable:!0})},se=(a,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ee(e))!ne.call(a,r)&&r!==t&&tt(a,r,{get:()=>e[r],enumerable:!(n=te(e,r))||n.enumerable});return a};var oe=a=>se(tt({},"__esModule",{value:!0}),a);var Ke={};re(Ke,{default:()=>X});module.exports=oe(Ke);var Z=require("obsidian");var ae=/^-\s*\[(.)\]\s*(.+)$/,ie={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},ce={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function et(a,e){var p,m,h,g;let t=a.match(ae);if(!t)return null;let n=(p=t[1])!=null?p:" ",r=(m=t[2])!=null?m:"",s=(h=ie[n])!=null?h:"pending",o=r.split("|").map(k=>k.trim()),i=(g=o[0])!=null?g:"",c=o.slice(1),d=[],l,u;for(let k of c){let f=le(k);f&&(d.push(f),f.key.toLowerCase()==="duration"&&(f.editable?l=D(f.value):u=f.value+(f.unit?` ${f.unit}`:"")))}return{state:s,name:i,params:d,targetDuration:l,recordedDuration:u,lineIndex:e}}function le(a){var c,d,l;let e=a.indexOf(":");if(e===-1)return null;let t=a.substring(0,e).trim(),n=a.substring(e+1).trim(),r=n.match(/^\[([^\]]*)\](.*)$/);if(r){let u=(c=r[1])!=null?c:"",p=((d=r[2])!=null?d:"").trim();return{key:t,value:u,editable:!0,unit:p||void 0}}let s=n.split(/\s+/),o=(l=s[0])!=null?l:"",i=s.slice(1).join(" ")||void 0;return{key:t,value:o,editable:!1,unit:i}}function D(a){var o,i,c,d,l,u;let e=a.trim(),t=e.match(/^(\d+)s$/);if(t)return parseInt((o=t[1])!=null?o:"0",10);let n=e.match(/^(\d+):(\d{2})$/);if(n){let p=parseInt((i=n[1])!=null?i:"0",10),m=parseInt((c=n[2])!=null?c:"0",10);return p*60+m}let r=e.match(/^(\d+)m\s*(\d+)?s?$/);if(r){let p=parseInt((d=r[1])!=null?d:"0",10),m=parseInt((l=r[2])!=null?l:"0",10);return p*60+m}let s=e.match(/^(\d+)$/);return s?parseInt((u=s[1])!=null?u:"0",10):0}function v(a){let e=Math.floor(a/60),t=a%60;return`${e}:${t.toString().padStart(2,"0")}`}function y(a){let e=Math.floor(a/60),t=a%60;return e===0?`${t}s`:t===0?`${e}m`:`${e}m ${t}s`}function Mt(a){return ce[a]}function nt(a){let t=`- [${Mt(a.state)}] ${a.name}`;for(let n of a.params)t+=" | ",t+=`${n.key}: `,n.editable?t+=`[${n.value}]`:t+=n.value,n.unit&&(t+=` ${n.unit}`);return t}var ue=["planned","started","completed"];function rt(a){let e={state:"planned"};for(let t of a){let n=t.indexOf(":");if(n===-1)continue;let r=t.substring(0,n).trim().toLowerCase(),s=t.substring(n+1).trim();switch(r){case"title":s&&(e.title=s);break;case"state":ue.includes(s)&&(e.state=s);break;case"startdate":s&&(e.startDate=s);break;case"duration":s&&(e.duration=s);break;case"restduration":if(s){let o=D(s);o>0&&(e.restDuration=o)}break}}return e}function st(a){let e=[];return a.title!==void 0&&e.push(`title: ${a.title}`),e.push(`state: ${a.state}`),a.startDate!==void 0&&e.push(`startDate: ${a.startDate}`),a.duration!==void 0&&e.push(`duration: ${a.duration}`),a.restDuration!==void 0&&e.push(`restDuration: ${y(a.restDuration)}`),e}function Wt(a){var c;let e=a.split(`
`),t=-1;for(let d=0;d<e.length;d++)if(((c=e[d])==null?void 0:c.trim())==="---"){t=d;break}let n=t>0?e.slice(0,t):[],r=rt(n),s=t>=0?t+1:0,o=e.slice(s),i=[];for(let d=0;d<o.length;d++){let l=o[d];if(!l)continue;let u=et(l,d);u&&i.push(u)}return{metadata:r,exercises:i,rawLines:e,metadataEndIndex:t>=0?t:-1}}function ot(a){let e=[],t=st(a.metadata);e.push(...t),e.push("---");for(let n of a.exercises)e.push(nt(n));return e.join(`
`)}function $t(a,e,t,n){let r=structuredClone(a),s=r.exercises[e];if(!s)return a;let o=s.params.find(i=>i.key===t);return o&&(o.value=n),r}function C(a,e,t){let n=structuredClone(a),r=n.exercises[e];return r?(r.state=t,n):a}function R(a){let e=structuredClone(a);for(let t of e.exercises)for(let n of t.params)n.editable=!1;return e}function It(a,e,t){let n=structuredClone(a),r=n.exercises[e];if(!r)return a;let s={state:"pending",name:"Rest",params:[{key:"Duration",value:`${t}s`,editable:!0}],targetDuration:t,lineIndex:r.lineIndex+1};n.exercises.splice(e+1,0,s);for(let o=e+2;o<n.exercises.length;o++){let i=n.exercises[o];i&&i.lineIndex++}return n}function At(a,e){let t=structuredClone(a),n=t.exercises[e];if(!n)return a;let r={...structuredClone(n),state:"pending",recordedDuration:void 0,lineIndex:n.lineIndex+1};for(let s of r.params)s.key.toLowerCase()==="duration"&&!s.editable&&(s.editable=n.targetDuration!==void 0);t.exercises.splice(e+1,0,r);for(let s=e+2;s<t.exercises.length;s++){let o=t.exercises[s];o&&o.lineIndex++}return t}function A(a,e,t){let n=structuredClone(a),r=n.exercises[e];if(!r)return a;let s=r.params.find(o=>o.key.toLowerCase()==="duration");return s?(s.value=t,s.editable=!1):r.params.push({key:"Duration",value:t,editable:!1}),r.recordedDuration=t,n}function Ht(){return{metadata:{title:"Sample Workout",state:"planned",restDuration:60},exercises:[{state:"pending",name:"Squats",params:[{key:"Weight",value:"60",editable:!0,unit:"kg"},{key:"Reps",value:"12",editable:!0}],lineIndex:0},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:1},{state:"pending",name:"Push-ups",params:[{key:"Reps",value:"15",editable:!0}],lineIndex:2},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:3},{state:"pending",name:"Dumbbell Rows",params:[{key:"Weight",value:"20",editable:!0,unit:"kg"},{key:"Reps",value:"10",editable:!0,unit:"/arm"}],lineIndex:4},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:5},{state:"pending",name:"Plank Hold",params:[{key:"Duration",value:"45s",editable:!0}],targetDuration:45,lineIndex:6},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:7},{state:"pending",name:"Lunges",params:[{key:"Reps",value:"10",editable:!0,unit:"/leg"}],lineIndex:8}],rawLines:[],metadataEndIndex:-1}}function Bt(a){let e=[];a.metadata.title&&e.push(`title: ${a.metadata.title}`),e.push("state: planned"),e.push("startDate:"),e.push("duration:"),e.push("---");let t=new Set,n=[];for(let r of a.exercises)t.has(r.name)||(t.add(r.name),n.push(r));for(let r of n){let s=`- [ ] ${r.name}`;for(let o of r.params)if(s+=" | ",s+=`${o.key}: `,!(o.key.toLowerCase()==="duration"&&!r.targetDuration)){if(o.key.toLowerCase()==="duration"&&r.targetDuration){let i=Math.floor(r.targetDuration/60),c=r.targetDuration%60,d=i>0?`${i}m ${c}s`:`${c}s`;s+=`[${d}]`}else s+=`[${o.value}]`;o.unit&&(s+=` ${o.unit}`)}e.push(s)}return e.join(`
`)}function at(a,e,t,n){let r=a.createDiv({cls:"workout-header"}),s=r.createDiv({cls:"workout-title"});if(s.textContent=e.title||"Workout",e.restDuration){let c=r.createDiv({cls:"workout-rest-duration"}),d=y(e.restDuration);c.setText(`Rest: ${d}`)}let i=r.createDiv({cls:"workout-header-timer"}).createSpan({cls:"workout-timer"});return e.state==="completed"&&e.duration?(i.textContent=e.duration,i.createSpan({cls:"workout-timer-indicator recorded",text:" \u2713"})):n&&t?(i.textContent=`Total: ${v(t.workoutElapsed)}`,i.createSpan({cls:"workout-timer-indicator count-up",text:" \u25B2"})):(e.state,i.textContent="--:--"),{titleEl:s,timerEl:i}}function it(a,e){a.empty(),a.textContent=`Total: ${v(e.workoutElapsed)}`,a.createSpan({cls:"workout-timer-indicator count-up",text:" \u25B2"})}var de={pending:"\u25CB",inProgress:"\u25D0",completed:"\u2713",skipped:"\u2014"};function pe(a){let e=5381;for(let r=0;r<a.length;r++)e=(e<<5)+e^a.charCodeAt(r);let t=.618033988749895,n=Math.abs(e)%1e3/1e3;return Math.floor(n*t%1*360)}function Rt(a){return a.params.some(e=>e.key.toLowerCase()!=="duration")}function ct(a,e,t,n,r,s,o,i){let c=!Rt(e),d=a.createDiv({cls:`workout-exercise state-${e.state}${n?" active":""}${c?" simple":""}`}),l=pe(e.name);d.style.setProperty("--exercise-color",`hsl(${l}, 65%, 55%)`);let u=new Map,p=d.createDiv({cls:"workout-exercise-main"}),m=p.createSpan({cls:"workout-exercise-icon"});m.textContent=de[e.state];let h=p.createSpan({cls:"workout-exercise-name"});if(h.textContent=e.name,Rt(e)){let k=p.createSpan({cls:"workout-exercise-params"});for(let f of e.params){if(f.key.toLowerCase()==="duration")continue;let S=k.createSpan({cls:"workout-param"});if(f.unit||S.createSpan({cls:"workout-param-prefix",text:"\xD7"}),f.editable&&o!=="completed"){let x=S.createEl("input",{cls:"workout-param-input",type:"text",value:f.value});x.addEventListener("input",()=>{s.onParamChange(t,f.key,x.value)}),x.addEventListener("keydown",b=>{b.key==="Enter"&&x.blur()}),u.set(f.key,x)}else S.createSpan({cls:"workout-param-value",text:f.value});f.unit&&S.createSpan({cls:"workout-param-unit",text:` ${f.unit}`})}}let g=p.createSpan({cls:"workout-exercise-timer"});return e.state==="completed"&&e.recordedDuration?(g.textContent=e.recordedDuration,g.createSpan({cls:"timer-indicator recorded",text:" \u2713"})):n&&r?F(g,r,e.targetDuration):e.targetDuration?(g.textContent=v(e.targetDuration),g.createSpan({cls:"timer-indicator count-down",text:" \u25BC"})):e.state==="pending"&&(g.textContent="--"),n&&o==="started"&&me(d,t,s,i),{container:d,timerEl:g,inputs:u}}function me(a,e,t,n){let r=a.createDiv({cls:"workout-exercise-controls"}),s=r.createEl("button",{cls:"workout-btn",text:"Pause"});s.addEventListener("click",()=>{s.textContent==="Pause"?(t.onPauseExercise(),s.textContent="Resume"):(t.onResumeExercise(),s.textContent="Pause")}),r.createEl("button",{cls:"workout-btn",text:"Skip"}).addEventListener("click",()=>{t.onExerciseSkip(e)});let i=r.createDiv({cls:"workout-btn-group"});i.createEl("button",{cls:"workout-btn",text:"+ Set"}).addEventListener("click",()=>{t.onExerciseAddSet(e)}),n!==void 0&&i.createEl("button",{cls:"workout-btn",text:"+ Rest"}).addEventListener("click",()=>{t.onExerciseAddRest(e)}),i.createEl("button",{cls:"workout-btn",text:"Next"}).addEventListener("click",()=>{t.onExerciseFinish(e)})}function F(a,e,t){if(a.empty(),t!==void 0){let n=t-e.exerciseElapsed;n>0?(a.textContent=v(n),a.createSpan({cls:"timer-indicator count-down",text:" \u25BC"})):(a.textContent=v(Math.abs(n)),a.addClass("overtime"),a.createSpan({cls:"timer-indicator overtime",text:" \u26A0"}))}else a.textContent=v(e.exerciseElapsed),a.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}var L=null,Ft=!1;function M(){if(!Ft)try{L=new(window.AudioContext||window.webkitAudioContext),L.state==="suspended"&&L.resume(),Ft=!0,console.log("[Life Log] AudioContext initialized")}catch(a){console.warn("[Life Log] Failed to initialize AudioContext:",a)}}function H(a="complete"){if(L||M(),!L){console.warn("[Life Log] AudioContext not available");return}L.state==="suspended"&&L.resume();try{switch(a){case"complete":ge(L);break;case"break":fe(L);break;case"warning":he(L);break}}catch(e){console.warn("[Life Log] Failed to play sound:",e)}}function ge(a){let e=a.currentTime,t=a.createOscillator(),n=a.createGain();t.connect(n),n.connect(a.destination),t.frequency.value=523.25,t.type="sine",n.gain.setValueAtTime(.3,e),n.gain.exponentialRampToValueAtTime(.01,e+.3),t.start(e),t.stop(e+.3);let r=a.createOscillator(),s=a.createGain();r.connect(s),s.connect(a.destination),r.frequency.value=659.25,r.type="sine",s.gain.setValueAtTime(.3,e+.15),s.gain.exponentialRampToValueAtTime(.01,e+.45),r.start(e+.15),r.stop(e+.45);let o=a.createOscillator(),i=a.createGain();o.connect(i),i.connect(a.destination),o.frequency.value=783.99,o.type="sine",i.gain.setValueAtTime(.3,e+.3),i.gain.exponentialRampToValueAtTime(.01,e+.6),o.start(e+.3),o.stop(e+.6)}function fe(a){let e=a.currentTime,t=a.createOscillator(),n=a.createGain();t.connect(n),n.connect(a.destination),t.frequency.value=440,t.type="sine",n.gain.setValueAtTime(.2,e),n.gain.exponentialRampToValueAtTime(.01,e+.5),t.start(e),t.stop(e+.5);let r=a.createOscillator(),s=a.createGain();r.connect(s),s.connect(a.destination),r.frequency.value=349.23,r.type="sine",s.gain.setValueAtTime(.2,e+.3),s.gain.exponentialRampToValueAtTime(.01,e+.8),r.start(e+.3),r.stop(e+.8)}function he(a){let e=a.currentTime;for(let t=0;t<3;t++){let n=a.createOscillator(),r=a.createGain();n.connect(r),r.connect(a.destination),n.frequency.value=880,n.type="square",r.gain.setValueAtTime(.15,e+t*.2),r.gain.exponentialRampToValueAtTime(.01,e+t*.2+.1),n.start(e+t*.2),n.stop(e+t*.2+.1)}}function lt(a,e,t,n){let r=a.createDiv({cls:"workout-controls"});if(e==="planned"){let s=r.createEl("button",{cls:"workout-btn workout-btn-primary workout-btn-large"});s.createSpan({cls:"workout-btn-icon",text:"\u25B6"}),s.createSpan({text:"Start Workout"}),s.addEventListener("click",()=>{M(),t.onStartWorkout()})}else if(e==="completed"){let s=r.createSpan({cls:"workout-completed-label"});s.createSpan({cls:"workout-btn-icon",text:"\u2713"}),s.createSpan({text:"Completed"});let o=r.createEl("button",{cls:"workout-btn"});o.createSpan({cls:"workout-btn-icon",text:"\u{1F4CB}"}),o.createSpan({text:"Copy as Template"}),o.addEventListener("click",async()=>{let i=Bt(n);await navigator.clipboard.writeText("```workout\n"+i+"\n```");let c=o.querySelector("span:last-child");if(c){let d=c.textContent;c.textContent="Copied!",setTimeout(()=>{c.textContent=d},1500)}})}return r}function jt(a,e){let t=a.createDiv({cls:"workout-empty-state"});t.createDiv({cls:"workout-empty-message"}).createSpan({text:"This workout is empty"});let s=t.createDiv({cls:"workout-empty-action"}).createEl("button",{cls:"workout-btn workout-btn-primary workout-btn-large"});return s.createSpan({cls:"workout-btn-icon",text:"\u2728"}),s.createSpan({text:"Add Sample Workout"}),s.addEventListener("click",async()=>{await e()}),t}function Nt(a){let{el:e,parsed:t,callbacks:n,workoutId:r,timerManager:s}=a;e.empty();let o=e.createDiv({cls:`workout-container state-${t.metadata.state}`}),i=s.isTimerRunning(r),c=s.getTimerState(r),d=i?s.getActiveExerciseIndex(r):-1,{timerEl:l}=at(o,t.metadata,c,i);if(t.exercises.length===0&&t.metadata.state==="planned"){jt(o,n.onAddSample);return}let u=[],p=o.createDiv({cls:"workout-exercises"}),m=Math.max(...t.exercises.map(h=>h.name.length));p.style.setProperty("--max-name-chars",String(m));for(let h=0;h<t.exercises.length;h++){let g=t.exercises[h];if(!g)continue;let k=h===d,f=ct(p,g,h,k,k?c:null,n,t.metadata.state,t.metadata.restDuration);u.push(f)}if(lt(o,t.metadata.state,n,t),o.addEventListener("focusout",h=>{let g=h.relatedTarget;(!g||!o.contains(g))&&n.onFlushChanges()}),i){let h=d,g=!1;s.subscribe(r,k=>{it(l,k);let f=s.getActiveExerciseIndex(r);if(f!==h)return;let S=u[f],x=t.exercises[f];S!=null&&S.timerEl&&x&&(F(S.timerEl,k,x.targetDuration),!g&&x.targetDuration!==void 0&&k.exerciseElapsed>=x.targetDuration&&(g=!0,n.onExerciseFinish(f)))})}}var j=class{constructor(){this.timers=new Map;this.intervalId=null;this.onAutoAdvance=null;this.onPomodoroPhaseChange=null}setAutoAdvanceCallback(e){this.onAutoAdvance=e}setPomodoroPhaseChangeCallback(e){this.onPomodoroPhaseChange=e}startWorkoutTimer(e,t=0,n){var o,i,c;let r=Date.now(),s=this.timers.get(e);s?(s.exerciseStartTime=r,s.exercisePausedTime=0,s.isPaused=!1,s.activeExerciseIndex=t,n!=null&&n.enabled&&(s.pomodoroEnabled=!0,s.pomodoroPhase="work",s.pomodoroCycle=1,s.pomodoroWorkDuration=n.workDuration,s.pomodoroBreakDuration=n.breakDuration,s.pomodoroPhaseStartTime=r,s.pomodoroPausedTime=0)):this.timers.set(e,{workoutId:e,workoutStartTime:r,exerciseStartTime:r,exercisePausedTime:0,isPaused:!1,activeExerciseIndex:t,callbacks:new Set,pomodoroEnabled:(o=n==null?void 0:n.enabled)!=null?o:!1,pomodoroPhase:"work",pomodoroCycle:1,pomodoroWorkDuration:(i=n==null?void 0:n.workDuration)!=null?i:25*60,pomodoroBreakDuration:(c=n==null?void 0:n.breakDuration)!=null?c:5*60,pomodoroPhaseStartTime:r,pomodoroPausedTime:0}),this.ensureInterval()}advanceExercise(e,t){let n=this.timers.get(e);n&&(n.exerciseStartTime=Date.now(),n.exercisePausedTime=0,n.isPaused=!1,n.activeExerciseIndex=t)}pauseExercise(e){let t=this.timers.get(e);if(!t||t.isPaused)return;t.isPaused=!0;let n=Date.now();t.exercisePausedTime+=n-t.exerciseStartTime,t.pomodoroEnabled&&(t.pomodoroPausedTime+=n-t.pomodoroPhaseStartTime)}resumeExercise(e){let t=this.timers.get(e);if(!t||!t.isPaused)return;t.isPaused=!1;let n=Date.now();t.exerciseStartTime=n,t.pomodoroEnabled&&(t.pomodoroPhaseStartTime=n)}stopWorkoutTimer(e){this.timers.delete(e),this.timers.size===0&&this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)}subscribe(e,t){let n=this.timers.get(e);if(!n)return()=>{};n.callbacks.add(t);let r=this.getTimerState(e);return r&&t(r),()=>{n.callbacks.delete(t)}}getTimerState(e){let t=this.timers.get(e);if(!t)return null;let n=Date.now(),r=Math.floor((n-t.workoutStartTime)/1e3),s;if(t.isPaused)s=Math.floor(t.exercisePausedTime/1e3);else{let i=n-t.exerciseStartTime;s=Math.floor((t.exercisePausedTime+i)/1e3)}let o={workoutElapsed:r,exerciseElapsed:s,isOvertime:!1};if(t.pomodoroEnabled){let i=t.pomodoroPhase==="work"?t.pomodoroWorkDuration:t.pomodoroBreakDuration,c;if(t.isPaused)c=Math.floor(t.pomodoroPausedTime/1e3);else{let u=n-t.pomodoroPhaseStartTime;c=Math.floor((t.pomodoroPausedTime+u)/1e3)}let d=Math.max(0,i-c),l=Math.min(100,c/i*100);o.pomodoroEnabled=!0,o.pomodoroPhase=t.pomodoroPhase,o.pomodoroCycle=t.pomodoroCycle,o.pomodoroElapsed=c,o.pomodoroRemaining=d,o.pomodoroProgress=l}return o}getActiveExerciseIndex(e){var n;let t=this.timers.get(e);return(n=t==null?void 0:t.activeExerciseIndex)!=null?n:0}setActiveExerciseIndex(e,t){let n=this.timers.get(e);n&&n.activeExerciseIndex!==t&&(n.activeExerciseIndex=t,n.exerciseStartTime=Date.now(),n.exercisePausedTime=0,n.isPaused=!1)}isTimerRunning(e){return this.timers.has(e)}isPaused(e){var n;let t=this.timers.get(e);return(n=t==null?void 0:t.isPaused)!=null?n:!1}getPomodoroPhase(e){let t=this.timers.get(e);return!t||!t.pomodoroEnabled?null:t.pomodoroPhase}ensureInterval(){this.intervalId===null&&(this.intervalId=window.setInterval(()=>{this.tick()},1e3))}tick(){for(let[e,t]of this.timers){let n=this.getTimerState(e);if(n){t.pomodoroEnabled&&!t.isPaused&&this.checkPomodoroPhaseComplete(e,t,n);for(let r of t.callbacks)r(n)}}}checkPomodoroPhaseComplete(e,t,n){if(!n.pomodoroRemaining||n.pomodoroRemaining>0)return;let r=Date.now(),s=t.pomodoroPhase;t.pomodoroPhase==="work"?(t.pomodoroPhase="break",H("break")):(t.pomodoroPhase="work",t.pomodoroCycle++,H("complete")),t.pomodoroPhaseStartTime=r,t.pomodoroPausedTime=0,this.onPomodoroPhaseChange&&this.onPomodoroPhaseChange(e,t.pomodoroPhase,t.pomodoroCycle)}checkAutoAdvance(e,t){if(t===void 0)return;let n=this.getTimerState(e);n&&n.exerciseElapsed>=t&&this.onAutoAdvance&&this.onAutoAdvance(e)}destroy(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timers.clear()}};var ut=require("obsidian"),N=class{constructor(e){this.app=e;this.updateLocks=new Map}async withLock(e,t){let n=this.updateLocks.get(e);n&&await n;let r,s=new Promise(o=>{r=o});this.updateLocks.set(e,s);try{return await t()}finally{r(),this.updateLocks.get(e)===s&&this.updateLocks.delete(e)}}async updateCodeBlock(e,t,n,r){let s=this.app.vault.getAbstractFileByPath(e);if(!(s instanceof ut.TFile)){console.error("File not found:",e);return}if(!t){console.error("No section info available");return}await this.withLock(e,async()=>{await this.app.vault.process(s,o=>{var f;let i=o.split(`
`),c=i[t.lineStart],d=c==null?void 0:c.trim().startsWith("```life-log"),l=c==null?void 0:c.trim().startsWith("```study-log"),u=c==null?void 0:c.trim().startsWith("```work-log");if(!c||!d&&!l&&!u)return console.error("Stale sectionInfo: expected ```life-log, ```study-log, or ```work-log at line",t.lineStart),o;if(r){let x=i.slice(t.lineStart+1,t.lineEnd).join(`
`).match(/^title:\s*(.+)$/m),b=(f=x==null?void 0:x[1])==null?void 0:f.trim();if(b&&b!==r)return console.error("Title mismatch: expected",r,"but found",b),o}let p=t.lineStart,m=t.lineEnd,h=i.slice(0,p+1),g=i.slice(m);return[...h,n,...g].join(`
`)})})}async insertLineAfter(e,t,n,r){let s=this.app.vault.getAbstractFileByPath(e);if(!(s instanceof ut.TFile)){console.error("File not found:",e);return}if(!t){console.error("No section info available");return}await this.app.vault.process(s,o=>{let i=o.split(`
`),c=t.lineStart+1+n;return i.splice(c+1,0,r),i.join(`
`)})}};var W=require("obsidian"),B=class{constructor(e,t){this.app=e;this.settings=t}async createLogFile(e,t){let n=new Date,r=this.buildFolderPath(n),s=this.buildFileName(n,e),o=(0,W.normalizePath)(`${r}/${s}`);await this.ensureFolderExists(r);let i=this.app.vault.getAbstractFileByPath(o);return i instanceof W.TFile?this.appendToExistingFile(i,e,t):this.createNewFile(o,e,n,t)}buildFolderPath(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0");return(0,W.normalizePath)(`${this.settings.logFolder}/${t}/${n}`)}buildFileName(e,t){return`${this.formatDate(e)}-${t}.md`}formatDate(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");switch(this.settings.dateFormat){case"YYYY/MM/DD":return`${t}/${n}/${r}`;case"DD-MM-YYYY":return`${r}-${n}-${t}`;default:return`${t}-${n}-${r}`}}async ensureFolderExists(e){if(this.app.vault.getAbstractFileByPath(e)instanceof W.TFolder)return;let n=e.split("/"),r="";for(let s of n)r=r?`${r}/${s}`:s,this.app.vault.getAbstractFileByPath(r)||await this.app.vault.createFolder(r)}async appendToExistingFile(e,t,n){let r=this.getBlockType(t),s=this.buildNewSection(t,n,r);return await this.app.vault.process(e,o=>o+`

---

`+s),e}getBlockType(e){switch(e){case"study":return"study-log";case"work":return"work-log";case"workout":return"life-log"}}async createNewFile(e,t,n,r){let s=this.getBlockType(t),o=this.buildFrontmatter(t,n),i=this.buildHeading(t,n),c=this.buildNewSection(t,r,s),d=`${o}

${i}

${c}`;return await this.app.vault.create(e,d)}buildFrontmatter(e,t){let n=this.formatDate(t),r=t.toISOString();return["---",`type: ${e}-log`,`date: ${n}`,`created: ${r}`,"---"].join(`
`)}buildHeading(e,t){let n=this.formatDate(t),r={study:"\u{1F4DA}",work:"\u{1F4BC}",workout:"\u{1F3CB}\uFE0F"},s={study:"\uD559\uC2B5",work:"\uC5C5\uBB34",workout:"\uC6B4\uB3D9"};return`# ${r[e]} ${n} ${s[e]} \uAE30\uB85D`}buildNewSection(e,t,n){let s=new Date().getHours();return[`## ${s<12?"\uC624\uC804":s<18?"\uC624\uD6C4":"\uC800\uB141"} ${{study:"\uD559\uC2B5",work:"\uC5C5\uBB34",workout:"\uC6B4\uB3D9"}[e]} \uC138\uC158`,"",`\`\`\`${n}`,t,"```"].join(`
`)}formatDateTime(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${t}-${n}-${r} ${s}:${o}`}};var ke=["planned","started","completed"];function dt(a){let e={title:"",subject:"",state:"planned"};for(let t of a){let n=t.indexOf(":");if(n===-1)continue;let r=t.substring(0,n).trim().toLowerCase(),s=t.substring(n+1).trim();switch(r){case"title":e.title=s;break;case"subject":e.subject=s;break;case"state":ke.includes(s)&&(e.state=s);break;case"startdate":s&&(e.startDate=s);break;case"enddate":s&&(e.endDate=s);break;case"totalduration":s&&(e.totalDuration=s);break;case"focusscore":let o=parseInt(s);o>=1&&o<=5&&(e.focusScore=o);break;case"comprehensionscore":let i=parseInt(s);i>=1&&i<=5&&(e.comprehensionScore=i);break;case"tags":s&&(e.tags=s.split(",").map(c=>c.trim()).filter(c=>c));break}}return e}function pt(a){let e=[];return a.title&&e.push(`title: ${a.title}`),a.subject&&e.push(`subject: ${a.subject}`),e.push(`state: ${a.state}`),a.startDate&&e.push(`startDate: ${a.startDate}`),a.endDate&&e.push(`endDate: ${a.endDate}`),a.totalDuration&&e.push(`totalDuration: ${a.totalDuration}`),a.focusScore&&e.push(`focusScore: ${a.focusScore}`),a.comprehensionScore&&e.push(`comprehensionScore: ${a.comprehensionScore}`),a.tags&&a.tags.length>0&&e.push(`tags: ${a.tags.join(", ")}`),e}var Se=/^-\s*\[(.)\]\s*(.+)$/,xe={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},ve={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function mt(a,e){var u,p,m,h,g;let t=a.match(Se);if(!t)return null;let n=(u=t[1])!=null?u:" ",r=(p=t[2])!=null?p:"",s=(m=xe[n])!=null?m:"pending",o=r.split("|").map(k=>k.trim()),i=(h=o[0])!=null?h:"",c,d,l;for(let k=1;k<o.length;k++){let f=o[k];if(!f)continue;let S=f.indexOf(":");if(S===-1){l=f;continue}let x=f.substring(0,S).trim().toLowerCase(),b=f.substring(S+1).trim();if(x==="duration"){let T=b.match(/^\[([^\]]*)\]$/);T?c=D((g=T[1])!=null?g:"0"):d=b}else l?l+=" | "+f:l=f}return{state:s,name:i,targetDuration:c,recordedDuration:d,notes:l,lineIndex:e}}function Ot(a){return ve[a]}function gt(a){let t=`- [${Ot(a.state)}] ${a.name}`;return a.targetDuration!==void 0&&a.state==="pending"?t+=` | Duration: [${be(a.targetDuration)}]`:a.recordedDuration&&(t+=` | Duration: ${a.recordedDuration}`),a.notes&&(t+=` | ${a.notes}`),t}function be(a){let e=Math.floor(a/60),t=a%60;return e===0?`${t}s`:t===0?`${e}m`:`${e}m ${t}s`}function Yt(a){var c;let e=a.split(`
`),t=-1;for(let d=0;d<e.length;d++)if(((c=e[d])==null?void 0:c.trim())==="---"){t=d;break}let n=t>0?e.slice(0,t):[],r=dt(n),s=t>=0?t+1:0,o=e.slice(s),i=[];for(let d=0;d<o.length;d++){let l=o[d];if(!l)continue;let u=mt(l,d);u&&i.push(u)}return{metadata:r,tasks:i,rawLines:e,metadataEndIndex:t>=0?t:-1}}function qt(a){let e=[],t=pt(a.metadata);e.push(...t),e.push("---");for(let n of a.tasks)e.push(gt(n));return e.join(`
`)}function $(a,e,t){let n=structuredClone(a),r=n.tasks[e];return r?(r.state=t,n):a}function O(a,e,t){let n=structuredClone(a),r=n.tasks[e];return r?(r.recordedDuration=t,r.targetDuration=void 0,n):a}function zt(a,e,t){let n=structuredClone(a);return n.metadata.focusScore=e,n.metadata.comprehensionScore=t,n}function ft(a,e,t,n){let r=a.createDiv({cls:"study-header"}),s=r.createDiv({cls:"study-header-top"}),o=s.createDiv({cls:"study-title"}),i=Ee(e.subject);o.createSpan({cls:"study-subject-icon",text:i}),o.createSpan({cls:"study-subject-name",text:e.subject||"\uD559\uC2B5"}),e.title&&o.createSpan({cls:"study-title-text",text:` - ${e.title}`});let c=s.createDiv({cls:"study-timer"});Te(c,e,t,n);let d=r.createDiv({cls:"study-scores"});if(e.state==="completed"&&ye(d,e.focusScore,e.comprehensionScore),e.tags&&e.tags.length>0){let l=r.createDiv({cls:"study-tags"});for(let u of e.tags)l.createSpan({cls:"study-tag",text:u})}return{titleEl:o,timerEl:c,scoresEl:d}}function Te(a,e,t,n){e.state==="completed"&&e.totalDuration?(a.createSpan({cls:"study-timer-value",text:e.totalDuration}),a.createSpan({cls:"study-timer-indicator recorded",text:" \u2713"})):n&&t?(a.createSpan({cls:"study-timer-value",text:v(t.workoutElapsed)}),a.createSpan({cls:"study-timer-indicator count-up",text:" \u25B2"})):a.createSpan({cls:"study-timer-value",text:"--:--"})}function ye(a,e,t){if(e){let n=a.createDiv({cls:"study-score-item"});n.createSpan({cls:"study-score-label",text:"\uC9D1\uC911\uB3C4: "}),Vt(n,e)}if(t){let n=a.createDiv({cls:"study-score-item"});n.createSpan({cls:"study-score-label",text:"\uC774\uD574\uB3C4: "}),Vt(n,t)}}function Vt(a,e){let t=a.createSpan({cls:`study-stars score-${e}`});for(let n=1;n<=5;n++)t.createSpan({cls:`study-star ${n<=e?"filled":"empty"}`,text:n<=e?"\u2605":"\u2606"})}function Ee(a){return{\uC218\uD559:"\u{1F4D0}",\uC601\uC5B4:"\u{1F524}",\uD504\uB85C\uADF8\uB798\uBC0D:"\u{1F4BB}",\uB3C5\uC11C:"\u{1F4D6}",\uAE30\uD0C0:"\u{1F4DD}"}[a]||"\u{1F4DA}"}function ht(a,e){a.empty(),a.createSpan({cls:"study-timer-value",text:v(e.workoutElapsed)}),a.createSpan({cls:"study-timer-indicator count-up",text:" \u25B2"})}function kt(a,e,t,n,r,s,o){let i=a.createDiv({cls:`study-task state-${e.state} ${n?"active":""}`}),c=i.createDiv({cls:"study-task-main"}),d=c.createSpan({cls:"study-task-icon"});d.textContent=Le(e.state);let l=c.createSpan({cls:"study-task-name"});l.textContent=e.name;let u=null;if(e.notes){let p=c.createSpan({cls:"study-task-notes"});p.textContent=e.notes}if(u=c.createSpan({cls:"study-task-timer"}),e.state==="completed"&&e.recordedDuration)u.textContent=e.recordedDuration,u.createSpan({cls:"timer-indicator recorded",text:" \u2713"});else if(n&&r)Y(u,r,e.targetDuration);else if(e.targetDuration){let p=Math.floor(e.targetDuration/60),m=e.targetDuration%60;u.textContent=`[${p}m ${m>0?m+"s":""}]`,u.classList.add("target")}return n&&o==="started"&&we(i,t,s),{taskEl:i,timerEl:u}}function we(a,e,t){let n=a.createDiv({cls:"study-task-controls"});n.createEl("button",{cls:"study-btn",text:"\u2713 \uC644\uB8CC"}).addEventListener("click",()=>t.onTaskFinish(e)),n.createEl("button",{cls:"study-btn",text:"\u23ED \uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>t.onTaskSkip(e))}function Le(a){switch(a){case"completed":return"\u2713";case"inProgress":return"\u25B6";case"skipped":return"\u2013";default:return"\u25CB"}}function Y(a,e,t){if(a.empty(),a.classList.remove("overtime"),t!==void 0){let n=t-e.exerciseElapsed;n<0?(a.classList.add("overtime"),a.textContent=`+${v(Math.abs(n))}`,a.createSpan({cls:"timer-indicator overtime",text:" !"})):(a.textContent=v(n),a.createSpan({cls:"timer-indicator count-down",text:" \u25BC"}))}else a.textContent=v(e.exerciseElapsed),a.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}function St(a,e,t,n){let r=a.createDiv({cls:"study-controls"});if(e==="planned"){let s=r.createEl("button",{cls:"study-btn study-btn-primary study-btn-large"});s.createSpan({cls:"study-btn-icon",text:"\u25B6"}),s.createSpan({text:"\uD559\uC2B5 \uC2DC\uC791"}),s.addEventListener("click",()=>{M(),t.onStartStudy()})}else if(e==="started"){let s=r.createEl("button",{cls:"study-btn study-btn-primary"});s.createSpan({cls:"study-btn-icon",text:"\u2713"}),s.createSpan({text:"\uD559\uC2B5 \uC644\uB8CC"}),s.addEventListener("click",()=>t.onOpenSelfEval())}else if(e==="completed"){let s=r.createSpan({cls:"study-completed-label"});s.createSpan({cls:"study-btn-icon",text:"\u2713"}),s.createSpan({text:"\uC644\uB8CC\uB428"});let o=r.createEl("button",{cls:"study-btn"});o.createSpan({cls:"study-btn-icon",text:"\u{1F4CB}"}),o.createSpan({text:"\uD15C\uD50C\uB9BF \uBCF5\uC0AC"}),o.addEventListener("click",async()=>{let i=De(n);await navigator.clipboard.writeText("```study-log\n"+i+"\n```");let c=o.querySelector("span:last-child");if(c){let d=c.textContent;c.textContent="Copied!",setTimeout(()=>{c.textContent=d},1500)}})}return r}function De(a){let e=[];a.metadata.subject&&e.push(`subject: ${a.metadata.subject}`),e.push("state: planned"),e.push("---");let t=new Set;for(let n of a.tasks)if(!t.has(n.name)){t.add(n.name);let r=`- [ ] ${n.name}`;if(n.targetDuration){let s=Math.floor(n.targetDuration/60),o=n.targetDuration%60;r+=` | Duration: [${s}m${o>0?" "+o+"s":""}]`}e.push(r)}return e.join(`
`)}var _t=0,Ce=3e3;function q(a,e,t="complete"){let n=Date.now();n-_t<Ce||(_t=n,a.enableSound&&H(t),a.enableNotification&&Pe(e,t))}function Pe(a,e){if("Notification"in window)if(Notification.permission==="granted"){let t;e==="break"?t="\uD734\uC2DD \uC2DC\uAC04\uC774 \uB05D\uB0AC\uC2B5\uB2C8\uB2E4! \uB2E4\uC2DC \uC9D1\uC911\uD558\uC138\uC694.":a?t=`"${a}" \uC644\uB8CC!`:t="\uD0C0\uC774\uBA38\uAC00 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!",new Notification("Life Log",{body:t,icon:void 0,silent:!0})}else Notification.permission!=="denied"&&Notification.requestPermission()}function Ut(a){let{el:e,parsed:t,callbacks:n,studyId:r,timerManager:s,enableTimerSound:o=!0,enableNotification:i=!1}=a;e.empty();let c=e.createDiv({cls:`study-container state-${t.metadata.state}`}),d=s.isTimerRunning(r),l=s.getTimerState(r),u=d?s.getActiveExerciseIndex(r):-1,p=ft(c,t.metadata,l,d);if(t.tasks.length===0&&t.metadata.state==="planned"){Me(c);return}let m=[],h=c.createDiv({cls:"study-tasks"});for(let g=0;g<t.tasks.length;g++){let k=t.tasks[g];if(!k)continue;let f=g===u,S=kt(h,k,g,f,f?l:null,n,t.metadata.state);m.push(S)}if(St(c,t.metadata.state,n,t),c.addEventListener("focusout",g=>{let k=g.relatedTarget;(!k||!c.contains(k))&&n.onFlushChanges()}),d){let g=u,k=u>=0?t.tasks[u]:null,f=(k==null?void 0:k.targetDuration)!==void 0&&l?l.exerciseElapsed>=k.targetDuration:!1;s.subscribe(r,S=>{ht(p.timerEl,S);let x=s.getActiveExerciseIndex(r);if(x!==g){g=x;let w=t.tasks[x];f=(w==null?void 0:w.targetDuration)!==void 0?S.exerciseElapsed>=w.targetDuration:!1;return}let b=m[x],T=t.tasks[x];b!=null&&b.timerEl&&T&&(Y(b.timerEl,S,T.targetDuration),!f&&T.targetDuration!==void 0&&S.exerciseElapsed>=T.targetDuration&&(f=!0,q({enableSound:o,enableNotification:i},T.name)))})}}function Me(a){a.createDiv({cls:"study-empty-state"}).createDiv({cls:"study-empty-message",text:"\uD559\uC2B5 \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uCF54\uB4DC\uBE14\uB85D\uC5D0 \uD56D\uBAA9\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}var We=["planned","started","completed"];function xt(a){let e={title:"",state:"planned"};for(let t of a){let n=t.indexOf(":");if(n===-1)continue;let r=t.substring(0,n).trim().toLowerCase(),s=t.substring(n+1).trim();switch(r){case"title":e.title=s;break;case"state":We.includes(s)&&(e.state=s);break;case"startdate":s&&(e.startDate=s);break;case"enddate":s&&(e.endDate=s);break;case"totalduration":s&&(e.totalDuration=s);break;case"tags":s&&(e.tags=s.split(",").map(o=>o.trim()).filter(o=>o));break}}return e}function vt(a){let e=[];return a.title&&e.push(`title: ${a.title}`),e.push(`state: ${a.state}`),a.startDate&&e.push(`startDate: ${a.startDate}`),a.endDate&&e.push(`endDate: ${a.endDate}`),a.totalDuration&&e.push(`totalDuration: ${a.totalDuration}`),a.tags&&a.tags.length>0&&e.push(`tags: ${a.tags.join(", ")}`),e}var $e=/^-\s*\[(.)\]\s*(.+)$/,Ie={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},Ae={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function bt(a,e){var p,m,h,g,k;let t=a.match($e);if(!t)return null;let n=(p=t[1])!=null?p:" ",r=(m=t[2])!=null?m:"",s=(h=Ie[n])!=null?h:"pending",o=r.split("|").map(f=>f.trim()),i=(g=o[0])!=null?g:"",c="medium",d,l,u;for(let f=1;f<o.length;f++){let S=o[f];if(!S)continue;let x=S.indexOf(":");if(x===-1){u=u?u+" | "+S:S;continue}let b=S.substring(0,x).trim().toLowerCase(),T=S.substring(x+1).trim();if(b==="priority")["high","medium","low"].includes(T.toLowerCase())&&(c=T.toLowerCase());else if(b==="expected"){let w=T.match(/^\[([^\]]*)\]$/);w?d=D((k=w[1])!=null?k:"0"):d=D(T)}else b==="actual"?T&&T!==""&&(l=T):u=u?u+" | "+S:S}return{state:s,name:i,priority:c,expectedDuration:d,actualDuration:l,notes:u,lineIndex:e}}function Gt(a){return Ae[a]}function Tt(a){let t=`- [${Gt(a.state)}] ${a.name}`;return t+=` | Priority: ${a.priority}`,a.expectedDuration!==void 0&&(t+=` | Expected: [${He(a.expectedDuration)}]`),a.actualDuration&&(t+=` | Actual: ${a.actualDuration}`),a.notes&&(t+=` | ${a.notes}`),t}function He(a){let e=Math.floor(a/3600),t=Math.floor(a%3600/60),n=a%60;return e>0?t===0&&n===0?`${e}h`:n===0?`${e}h ${t}m`:`${e}h ${t}m ${n}s`:t===0?`${n}s`:n===0?`${t}m`:`${t}m ${n}s`}function Kt(a){var c;let e=a.split(`
`),t=-1;for(let d=0;d<e.length;d++)if(((c=e[d])==null?void 0:c.trim())==="---"){t=d;break}let n=t>0?e.slice(0,t):[],r=xt(n),s=t>=0?t+1:0,o=e.slice(s),i=[];for(let d=0;d<o.length;d++){let l=o[d];if(!l)continue;let u=bt(l,d);u&&i.push(u)}return{metadata:r,tasks:i,rawLines:e,metadataEndIndex:t>=0?t:-1}}function Jt(a){let e=[],t=vt(a.metadata);e.push(...t),e.push("---");for(let n of a.tasks)e.push(Tt(n));return e.join(`
`)}function I(a,e,t){let n=structuredClone(a),r=n.tasks[e];return r?(r.state=t,n):a}function z(a,e,t){let n=structuredClone(a),r=n.tasks[e];return r?(r.actualDuration=t,n):a}function yt(a,e,t,n){let r=a.createDiv({cls:"work-header"}),s=r.createDiv({cls:"work-header-top"}),o=s.createDiv({cls:"work-title"});o.createSpan({cls:"work-icon",text:"\u{1F4BC}"}),o.createSpan({cls:"work-title-text",text:e.title||"\uC5C5\uBB34"});let i=s.createDiv({cls:"work-timer"});if(Be(i,e,t,n),e.tags&&e.tags.length>0){let c=r.createDiv({cls:"work-tags"});for(let d of e.tags)c.createSpan({cls:"work-tag",text:d})}return{titleEl:o,timerEl:i}}function Be(a,e,t,n){e.state==="completed"&&e.totalDuration?(a.createSpan({cls:"work-timer-value",text:e.totalDuration}),a.createSpan({cls:"work-timer-indicator recorded",text:" \u2713"})):n&&t?(a.createSpan({cls:"work-timer-value",text:v(t.workoutElapsed)}),a.createSpan({cls:"work-timer-indicator count-up",text:" \u25B2"})):a.createSpan({cls:"work-timer-value",text:"--:--"})}function Et(a,e){a.empty(),a.createSpan({cls:"work-timer-value",text:v(e.workoutElapsed)}),a.createSpan({cls:"work-timer-indicator count-up",text:" \u25B2"})}var Re={high:"#E74C3C",medium:"#F39C12",low:"#3498DB"},Fe={high:"\uB192\uC74C",medium:"\uBCF4\uD1B5",low:"\uB0AE\uC74C"};function wt(a,e,t,n,r,s,o){let i=a.createDiv({cls:`work-task state-${e.state} priority-${e.priority} ${n?"active":""}`}),c=i.createDiv({cls:"work-task-main"}),d=c.createSpan({cls:"work-task-icon"});d.textContent=Ye(e.state);let l=c.createSpan({cls:"work-task-priority"});l.style.backgroundColor=Re[e.priority],l.setAttribute("title",Fe[e.priority]);let u=c.createSpan({cls:"work-task-name"});u.textContent=e.name;let p=null;if(e.notes){let m=c.createSpan({cls:"work-task-notes"});m.textContent=e.notes}return p=c.createDiv({cls:"work-task-timer-group"}),e.state==="completed"&&e.actualDuration?je(p,e):n&&r?V(p,r,e.expectedDuration):e.expectedDuration&&Ne(p,e.expectedDuration),n&&o==="started"&&Oe(i,t,s),{taskEl:i,timerEl:p}}function je(a,e){if(e.expectedDuration){let n=a.createSpan({cls:"work-timer-expected"});n.textContent=`\uC608\uC0C1: ${Lt(e.expectedDuration)}`}let t=a.createSpan({cls:"work-timer-actual"});t.textContent=`\uC2E4\uC81C: ${e.actualDuration}`,t.createSpan({cls:"timer-indicator recorded",text:" \u2713"})}function Ne(a,e){let t=a.createSpan({cls:"work-timer-expected target"});t.textContent=`\uC608\uC0C1: [${Lt(e)}]`}function Oe(a,e,t){let n=a.createDiv({cls:"work-task-controls"});n.createEl("button",{cls:"work-btn",text:"\u2713 \uC644\uB8CC"}).addEventListener("click",()=>t.onTaskFinish(e)),n.createEl("button",{cls:"work-btn",text:"\u23ED \uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>t.onTaskSkip(e))}function Ye(a){switch(a){case"completed":return"\u2713";case"inProgress":return"\u25B6";case"skipped":return"\u2013";default:return"\u25CB"}}function V(a,e,t){if(a.empty(),a.classList.remove("overtime"),t!==void 0){let n=a.createSpan({cls:"work-timer-expected"});n.textContent=`\uC608\uC0C1: ${Lt(t)}`;let r=a.createSpan({cls:"work-timer-actual"});e.exerciseElapsed>t?(a.classList.add("overtime"),r.textContent=`\uC2E4\uC81C: ${v(e.exerciseElapsed)}`,r.createSpan({cls:"timer-indicator overtime",text:" !"})):(r.textContent=`\uC2E4\uC81C: ${v(e.exerciseElapsed)}`,r.createSpan({cls:"timer-indicator count-up",text:" \u25B2"}))}else{let n=a.createSpan({cls:"work-timer-actual"});n.textContent=v(e.exerciseElapsed),n.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}}function Lt(a){let e=Math.floor(a/3600),t=Math.floor(a%3600/60),n=a%60;return e>0?t===0&&n===0?`${e}h`:n===0?`${e}h ${t}m`:`${e}h ${t}m`:t===0?`${n}s`:n===0?`${t}m`:`${t}m ${n}s`}function Dt(a,e,t,n){let r=a.createDiv({cls:"work-controls"});if(e==="planned"){let s=r.createEl("button",{cls:"work-btn work-btn-primary work-btn-large"});s.createSpan({cls:"work-btn-icon",text:"\u25B6"}),s.createSpan({text:"\uC5C5\uBB34 \uC2DC\uC791"}),s.addEventListener("click",async()=>{console.log("[Life Log] Work start button clicked"),M();try{await t.onStartWork(),console.log("[Life Log] onStartWork completed")}catch(o){console.error("[Life Log] onStartWork error:",o)}})}else if(e==="started"){let s=r.createEl("button",{cls:"work-btn work-btn-primary"});s.createSpan({cls:"work-btn-icon",text:"\u2713"}),s.createSpan({text:"\uC5C5\uBB34 \uC644\uB8CC"}),s.addEventListener("click",()=>t.onFinishWork())}else if(e==="completed"){let s=r.createSpan({cls:"work-completed-label"});s.createSpan({cls:"work-btn-icon",text:"\u2713"}),s.createSpan({text:"\uC644\uB8CC\uB428"}),qe(r,n);let o=r.createEl("button",{cls:"work-btn"});o.createSpan({cls:"work-btn-icon",text:"\u{1F4CB}"}),o.createSpan({text:"\uD15C\uD50C\uB9BF \uBCF5\uC0AC"}),o.addEventListener("click",async()=>{let i=ze(n);await navigator.clipboard.writeText("```work-log\n"+i+"\n```");let c=o.querySelector("span:last-child");if(c){let d=c.textContent;c.textContent="Copied!",setTimeout(()=>{c.textContent=d},1500)}})}return r}function qe(a,e){let t=a.createDiv({cls:"work-stats"}),n=e.tasks.filter(i=>i.state==="completed").length,r=e.tasks.length;t.createSpan({cls:"work-stat",text:`\uC644\uB8CC: ${n}/${r}`});let s=e.tasks.filter(i=>i.priority==="high"&&i.state==="completed").length,o=e.tasks.filter(i=>i.priority==="high").length;if(o>0){let i=t.createSpan({cls:"work-stat high-priority"});i.createSpan({cls:"priority-dot high"}),i.createSpan({text:` \uC911\uC694: ${s}/${o}`})}}function ze(a){let e=[];e.push("state: planned"),e.push("---");let t=new Set;for(let n of a.tasks)if(!t.has(n.name)){t.add(n.name);let r=`- [ ] ${n.name} | Priority: ${n.priority}`;n.expectedDuration&&(r+=` | Expected: [${Ve(n.expectedDuration)}]`),e.push(r)}return e.join(`
`)}function Ve(a){let e=Math.floor(a/3600),t=Math.floor(a%3600/60);return e>0?t===0?`${e}h`:`${e}h ${t}m`:`${t}m`}function Qt(a){let{el:e,parsed:t,callbacks:n,workId:r,timerManager:s,enableTimerSound:o=!0,enableNotification:i=!1}=a;e.empty();let c=e.createDiv({cls:`work-container state-${t.metadata.state}`}),d=s.isTimerRunning(r),l=s.getTimerState(r),u=d?s.getActiveExerciseIndex(r):-1,p=yt(c,t.metadata,l,d);if(t.tasks.length===0&&t.metadata.state==="planned"){_e(c);return}let m=[],h=c.createDiv({cls:"work-tasks"});for(let g=0;g<t.tasks.length;g++){let k=t.tasks[g];if(!k)continue;let f=g===u,S=wt(h,k,g,f,f?l:null,n,t.metadata.state);m.push(S)}if(Dt(c,t.metadata.state,n,t),c.addEventListener("focusout",g=>{let k=g.relatedTarget;(!k||!c.contains(k))&&n.onFlushChanges()}),d){let g=u,k=u>=0?t.tasks[u]:null,f=(k==null?void 0:k.expectedDuration)!==void 0&&l?l.exerciseElapsed>=k.expectedDuration:!1;s.subscribe(r,S=>{Et(p.timerEl,S);let x=s.getActiveExerciseIndex(r);if(x!==g){g=x;let w=t.tasks[x];f=(w==null?void 0:w.expectedDuration)!==void 0?S.exerciseElapsed>=w.expectedDuration:!1;return}let b=m[x],T=t.tasks[x];b!=null&&b.timerEl&&T&&(V(b.timerEl,S,T.expectedDuration),!f&&T.expectedDuration!==void 0&&S.exerciseElapsed>=T.expectedDuration&&(f=!0,q({enableSound:o,enableNotification:i},T.name)))})}}function _e(a){a.createDiv({cls:"work-empty-state"}).createDiv({cls:"work-empty-message",text:"\uC5C5\uBB34 \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uCF54\uB4DC\uBE14\uB85D\uC5D0 \uD56D\uBAA9\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}var E=require("obsidian"),Ct=[{name:"\uC218\uD559",icon:"",color:"#4A90D9"},{name:"\uC601\uC5B4",icon:"",color:"#7B68EE"},{name:"\uD504\uB85C\uADF8\uB798\uBC0D",icon:"",color:"#50C878"},{name:"\uB3C5\uC11C",icon:"",color:"#FFB347"},{name:"\uAE30\uD0C0",icon:"",color:"#A0A0A0"}],U=[{name:"\uC0C1\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uD478\uC2DC\uC5C5",params:"\uD69F\uC218: [15]"},{name:"\uB364\uBCA8 \uB85C\uC6B0",params:"\uBB34\uAC8C: [10]kg | \uD69F\uC218: [12]"},{name:"\uC204\uB354 \uD504\uB808\uC2A4",params:"\uBB34\uAC8C: [8]kg | \uD69F\uC218: [10]"}]},{name:"\uD558\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uC2A4\uCFFC\uD2B8",params:"\uBB34\uAC8C: [40]kg | \uD69F\uC218: [12]"},{name:"\uB7F0\uC9C0",params:"\uD69F\uC218: [10] /\uB2E4\uB9AC"},{name:"\uCE74\uD504\uB808\uC774\uC988",params:"\uD69F\uC218: [20]"}]},{name:"HIIT",exercises:[{name:"\uBC84\uD53C",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uC810\uD551\uC7AD",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uB9C8\uC6B4\uD2F4 \uD074\uB77C\uC774\uBA38",params:"\uC2DC\uAC04: [30\uCD08]"}]}],Pt={logFolder:"Life Logs",dateFormat:"YYYY-MM-DD",subjects:Ct,defaultStudyDuration:30,enablePomodoro:!1,pomodoroWork:25,pomodoroBreak:5,defaultRestDuration:60,workoutTemplates:U,defaultTab:"study",showRibbonIcon:!0,enableTimerSound:!0,enableNotifications:!0,timerStyle:"digital",usePerTypeTimerStyle:!1,studyTimerStyle:"pomodoro",workTimerStyle:"digital",workoutTimerStyle:"digital"},_=class extends E.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,console.log("[Life Log] LifeLogSettingTab constructed")}display(){console.log("[Life Log] LifeLogSettingTab.display() called");let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"Life Log \uC124\uC815"}),!this.plugin.settings){e.createEl("p",{text:"\uC124\uC815\uC744 \uBD88\uB7EC\uC624\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."});return}this.renderSaveSettings(e),this.renderStudySettings(e),this.renderWorkoutSettings(e),this.renderTimerStyleSettings(e),this.renderUISettings(e),this.renderNotificationSettings(e)}renderSaveSettings(e){e.createEl("h3",{text:"\u{1F4C1} \uC800\uC7A5 \uC124\uC815"}),new E.Setting(e).setName("\uAE30\uB85D \uC800\uC7A5 \uD3F4\uB354").setDesc("\uD559\uC2B5/\uC6B4\uB3D9 \uAE30\uB85D\uC774 \uC800\uC7A5\uB420 \uD3F4\uB354 \uACBD\uB85C").addText(t=>t.setPlaceholder("Life Logs").setValue(this.plugin.settings.logFolder).onChange(async n=>{this.plugin.settings.logFolder=n||"Life Logs",await this.plugin.saveSettings()})),new E.Setting(e).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uB420 \uB0A0\uC9DC \uD615\uC2DD").addDropdown(t=>t.addOption("YYYY-MM-DD","YYYY-MM-DD").addOption("YYYY/MM/DD","YYYY/MM/DD").addOption("DD-MM-YYYY","DD-MM-YYYY").setValue(this.plugin.settings.dateFormat).onChange(async n=>{this.plugin.settings.dateFormat=n,await this.plugin.saveSettings()}))}renderStudySettings(e){e.createEl("h3",{text:"\u{1F4DA} \uD559\uC2B5 \uAE30\uB85D \uC124\uC815"}),new E.Setting(e).setName("\uAE30\uBCF8 \uBAA9\uD45C \uC2DC\uAC04").setDesc("\uD559\uC2B5 \uD56D\uBAA9\uC758 \uAE30\uBCF8 \uBAA9\uD45C \uC2DC\uAC04 (\uBD84)").addText(t=>t.setPlaceholder("30").setValue(String(this.plugin.settings.defaultStudyDuration)).onChange(async n=>{let r=parseInt(n)||30;this.plugin.settings.defaultStudyDuration=Math.max(1,Math.min(480,r)),await this.plugin.saveSettings()})),new E.Setting(e).setName("\uD3EC\uBAA8\uB3C4\uB85C \uBAA8\uB4DC").setDesc("25\uBD84 \uD559\uC2B5 + 5\uBD84 \uD734\uC2DD \uC0AC\uC774\uD074 \uD65C\uC131\uD654").addToggle(t=>t.setValue(this.plugin.settings.enablePomodoro).onChange(async n=>{this.plugin.settings.enablePomodoro=n,await this.plugin.saveSettings()})),this.plugin.settings.enablePomodoro&&(new E.Setting(e).setName("\uC791\uC5C5 \uC2DC\uAC04").setDesc("\uD3EC\uBAA8\uB3C4\uB85C \uC791\uC5C5 \uC2DC\uAC04 (\uBD84)").addText(t=>t.setPlaceholder("25").setValue(String(this.plugin.settings.pomodoroWork)).onChange(async n=>{let r=parseInt(n)||25;this.plugin.settings.pomodoroWork=Math.max(1,Math.min(60,r)),await this.plugin.saveSettings()})),new E.Setting(e).setName("\uD734\uC2DD \uC2DC\uAC04").setDesc("\uD3EC\uBAA8\uB3C4\uB85C \uD734\uC2DD \uC2DC\uAC04 (\uBD84)").addText(t=>t.setPlaceholder("5").setValue(String(this.plugin.settings.pomodoroBreak)).onChange(async n=>{let r=parseInt(n)||5;this.plugin.settings.pomodoroBreak=Math.max(1,Math.min(30,r)),await this.plugin.saveSettings()}))),this.renderSubjectManager(e)}renderSubjectManager(e){let t=e.createDiv({cls:"subject-manager"});new E.Setting(t).setName("\uACFC\uBAA9 \uAD00\uB9AC").setDesc("\uC790\uC8FC \uC0AC\uC6A9\uD558\uB294 \uACFC\uBAA9\uC744 \uAD00\uB9AC\uD569\uB2C8\uB2E4").addButton(r=>r.setButtonText("+ \uACFC\uBAA9 \uCD94\uAC00").onClick(async()=>{this.plugin.settings.subjects.push({name:"\uC0C8 \uACFC\uBAA9",icon:"\u{1F4DA}",color:"#808080"}),await this.plugin.saveSettings(),this.display()}));let n=t.createDiv({cls:"subject-list"});for(let r=0;r<this.plugin.settings.subjects.length;r++){let s=this.plugin.settings.subjects[r];if(!s)continue;let o=n.createDiv({cls:"subject-row"}),i=o.createEl("input",{type:"text",value:s.icon,cls:"subject-icon-input"});i.maxLength=2,i.addEventListener("change",async()=>{s.icon=i.value||"\u{1F4DA}",await this.plugin.saveSettings()});let c=o.createEl("input",{type:"text",value:s.name,cls:"subject-name-input"});c.addEventListener("change",async()=>{s.name=c.value||"\uACFC\uBAA9",await this.plugin.saveSettings()});let d=o.createEl("input",{type:"color",value:s.color,cls:"subject-color-input"});d.addEventListener("change",async()=>{s.color=d.value,await this.plugin.saveSettings()}),o.createEl("button",{text:"\u{1F5D1}",cls:"subject-delete-btn"}).addEventListener("click",async()=>{this.plugin.settings.subjects.splice(r,1),await this.plugin.saveSettings(),this.display()})}}renderWorkoutSettings(e){e.createEl("h3",{text:"\uC6B4\uB3D9 \uAE30\uB85D \uC124\uC815"}),new E.Setting(e).setName("\uAE30\uBCF8 \uD734\uC2DD \uC2DC\uAC04").setDesc("\uC6B4\uB3D9 \uC138\uD2B8 \uC0AC\uC774 \uAE30\uBCF8 \uD734\uC2DD \uC2DC\uAC04 (\uCD08)").addText(t=>t.setPlaceholder("60").setValue(String(this.plugin.settings.defaultRestDuration)).onChange(async n=>{let r=parseInt(n)||60;this.plugin.settings.defaultRestDuration=Math.max(10,Math.min(300,r)),await this.plugin.saveSettings()})),this.renderWorkoutTemplateManager(e)}renderWorkoutTemplateManager(e){let t=e.createDiv({cls:"template-manager"});new E.Setting(t).setName("\uC6B4\uB3D9 \uD15C\uD50C\uB9BF \uAD00\uB9AC").setDesc("\uBE60\uB978 \uD15C\uD50C\uB9BF\uC5D0 \uD45C\uC2DC\uB418\uB294 \uC6B4\uB3D9 \uC138\uD2B8\uB97C \uAD00\uB9AC\uD569\uB2C8\uB2E4").addButton(r=>r.setButtonText("+ \uD15C\uD50C\uB9BF \uCD94\uAC00").onClick(async()=>{this.plugin.settings.workoutTemplates.push({name:"\uC0C8 \uD15C\uD50C\uB9BF",exercises:[{name:"\uC6B4\uB3D9\uBA85",params:"\uD69F\uC218: [10]"}]}),await this.plugin.saveSettings(),this.display()}));let n=t.createDiv({cls:"template-list"});this.plugin.settings.workoutTemplates||(this.plugin.settings.workoutTemplates=[...U]);for(let r=0;r<this.plugin.settings.workoutTemplates.length;r++){let s=this.plugin.settings.workoutTemplates[r];if(!s)continue;let o=n.createDiv({cls:"template-item"}),i=o.createDiv({cls:"template-header-row"}),c=i.createEl("input",{type:"text",value:s.name,cls:"template-name-input"});c.addEventListener("change",async()=>{s.name=c.value||"\uD15C\uD50C\uB9BF",await this.plugin.saveSettings()}),i.createEl("button",{text:"\uC0AD\uC81C",cls:"template-delete-btn"}).addEventListener("click",async()=>{this.plugin.settings.workoutTemplates.splice(r,1),await this.plugin.saveSettings(),this.display()});let l=o.createDiv({cls:"template-exercise-list"});for(let p=0;p<s.exercises.length;p++){let m=s.exercises[p];if(!m)continue;let h=l.createDiv({cls:"template-exercise-row"}),g=h.createEl("input",{type:"text",value:m.name,placeholder:"\uC6B4\uB3D9\uBA85",cls:"template-exercise-name"});g.addEventListener("change",async()=>{m.name=g.value||"\uC6B4\uB3D9",await this.plugin.saveSettings()});let k=h.createEl("input",{type:"text",value:m.params,placeholder:"\uBB34\uAC8C: [60]kg | \uD69F\uC218: [10]",cls:"template-exercise-params"});k.addEventListener("change",async()=>{m.params=k.value||"",await this.plugin.saveSettings()}),h.createEl("button",{text:"\xD7",cls:"template-exercise-delete"}).addEventListener("click",async()=>{s.exercises.splice(p,1),await this.plugin.saveSettings(),this.display()})}o.createEl("button",{text:"+ \uC6B4\uB3D9 \uCD94\uAC00",cls:"template-add-exercise"}).addEventListener("click",async()=>{s.exercises.push({name:"\uC6B4\uB3D9\uBA85",params:"\uD69F\uC218: [10]"}),await this.plugin.saveSettings(),this.display()})}}renderTimerStyleSettings(e){e.createEl("h3",{text:"\uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C"});let t=[{value:"digital",label:"\uB514\uC9C0\uD138 (00:00:00)"},{value:"pomodoro",label:"\uBF40\uBAA8\uB3C4\uB85C (25/5 \uC0AC\uC774\uD074)"},{value:"analog",label:"\uC544\uB0A0\uB85C\uADF8 (\uC6D0\uD615 \uC2DC\uACC4)"}];new E.Setting(e).setName("\uACF5\uD1B5 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").setDesc("\uBAA8\uB4E0 \uAE30\uB85D \uC720\uD615\uC5D0 \uC801\uC6A9\uB418\uB294 \uAE30\uBCF8 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(n=>{for(let r of t)n.addOption(r.value,r.label);n.setValue(this.plugin.settings.timerStyle).onChange(async r=>{this.plugin.settings.timerStyle=r,await this.plugin.saveSettings()})}),new E.Setting(e).setName("\uC720\uD615\uBCC4 \uAC1C\uBCC4 \uC124\uC815").setDesc("\uD559\uC2B5/\uC5C5\uBB34/\uC6B4\uB3D9 \uAE30\uB85D\uB9C8\uB2E4 \uB2E4\uB978 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C \uC0AC\uC6A9").addToggle(n=>n.setValue(this.plugin.settings.usePerTypeTimerStyle).onChange(async r=>{this.plugin.settings.usePerTypeTimerStyle=r,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.usePerTypeTimerStyle&&(new E.Setting(e).setName("\uD559\uC2B5 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uD559\uC2B5 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(n=>{for(let r of t)n.addOption(r.value,r.label);n.setValue(this.plugin.settings.studyTimerStyle).onChange(async r=>{this.plugin.settings.studyTimerStyle=r,await this.plugin.saveSettings()})}),new E.Setting(e).setName("\uC5C5\uBB34 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uC5C5\uBB34 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(n=>{for(let r of t)n.addOption(r.value,r.label);n.setValue(this.plugin.settings.workTimerStyle).onChange(async r=>{this.plugin.settings.workTimerStyle=r,await this.plugin.saveSettings()})}),new E.Setting(e).setName("\uC6B4\uB3D9 \uAE30\uB85D \uD0C0\uC774\uBA38").setDesc("\uC6B4\uB3D9 \uAE30\uB85D\uC5D0 \uC0AC\uC6A9\uD560 \uD0C0\uC774\uBA38 \uC2A4\uD0C0\uC77C").addDropdown(n=>{for(let r of t)n.addOption(r.value,r.label);n.setValue(this.plugin.settings.workoutTimerStyle).onChange(async r=>{this.plugin.settings.workoutTimerStyle=r,await this.plugin.saveSettings()})}))}renderUISettings(e){e.createEl("h3",{text:"UI \uC124\uC815"}),new E.Setting(e).setName("\uAE30\uBCF8 \uD0ED").setDesc("\uC0C8 \uAE30\uB85D \uBAA8\uB2EC\uC744 \uC5F4 \uB54C \uAE30\uBCF8\uC73C\uB85C \uC120\uD0DD\uB418\uB294 \uD0ED").addDropdown(t=>t.addOption("study","\uD559\uC2B5 \uAE30\uB85D").addOption("workout","\uC6B4\uB3D9 \uAE30\uB85D").setValue(this.plugin.settings.defaultTab).onChange(async n=>{this.plugin.settings.defaultTab=n,await this.plugin.saveSettings()})),new E.Setting(e).setName("\uB9AC\uBCF8 \uC544\uC774\uCF58").setDesc("\uC67C\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uBE60\uB978 \uC811\uADFC \uC544\uC774\uCF58 \uD45C\uC2DC").addToggle(t=>t.setValue(this.plugin.settings.showRibbonIcon).onChange(async n=>{this.plugin.settings.showRibbonIcon=n,await this.plugin.saveSettings(),this.plugin.updateRibbonIcon()}))}renderNotificationSettings(e){e.createEl("h3",{text:"\u{1F514} \uC54C\uB9BC \uC124\uC815"}),new E.Setting(e).setName("\uD0C0\uC774\uBA38 \uC644\uB8CC\uC74C").setDesc("\uCE74\uC6B4\uD2B8\uB2E4\uC6B4 \uC644\uB8CC \uC2DC \uC54C\uB9BC\uC74C \uC7AC\uC0DD").addToggle(t=>t.setValue(this.plugin.settings.enableTimerSound).onChange(async n=>{this.plugin.settings.enableTimerSound=n,await this.plugin.saveSettings()})),new E.Setting(e).setName("\uC2DC\uC2A4\uD15C \uC54C\uB9BC").setDesc("\uD0C0\uC774\uBA38 \uC644\uB8CC \uC2DC \uC2DC\uC2A4\uD15C \uC54C\uB9BC \uD45C\uC2DC").addToggle(t=>t.setValue(this.plugin.settings.enableNotifications).onChange(async n=>{this.plugin.settings.enableNotifications=n,await this.plugin.saveSettings()}))}};var Xt=require("obsidian");var G=class{constructor(e,t){this.selectedSubject=null;this.taskInputs=[];this.container=e,this.ctx=t}render(){this.container.empty(),this.container.addClass("study-log-tab"),this.renderSubjectSelector(),this.renderTaskInput(),this.renderCreateButton()}renderSubjectSelector(){var r;let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uACFC\uBAA9 \uC120\uD0DD",cls:"tab-label"});let t=e.createDiv({cls:"subject-grid"});for(let s of this.ctx.settings.subjects){let o=t.createEl("button",{cls:`subject-btn ${((r=this.selectedSubject)==null?void 0:r.name)===s.name?"selected":""}`});o.style.setProperty("--subject-color",s.color),o.createSpan({text:s.name,cls:"subject-name"}),o.addEventListener("click",()=>{this.selectedSubject=s,t.querySelectorAll(".subject-btn").forEach(i=>{i.classList.remove("selected")}),o.classList.add("selected")})}let n=t.createEl("button",{cls:"subject-btn subject-btn-add"});n.createSpan({text:"+"}),n.createSpan({text:"\uC9C1\uC811 \uC785\uB825"}),n.addEventListener("click",()=>{this.showCustomSubjectInput(e)})}showCustomSubjectInput(e){if(e.querySelector(".custom-subject-input"))return;let n=e.createDiv({cls:"custom-subject-input"}),r=n.createEl("input",{type:"text",placeholder:"\uACFC\uBAA9\uBA85 \uC785\uB825..."});r.focus(),r.addEventListener("keydown",s=>{s.key==="Enter"&&r.value.trim()?(this.selectedSubject={name:r.value.trim(),icon:"",color:"#808080"},n.remove(),this.render()):s.key==="Escape"&&n.remove()})}renderTaskInput(){let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uD559\uC2B5 \uD56D\uBAA9",cls:"tab-label"});let t=e.createDiv({cls:"task-input-list"});this.addTaskInputRow(t),e.createEl("button",{cls:"add-task-btn",text:"+ \uD56D\uBAA9 \uCD94\uAC00"}).addEventListener("click",()=>{this.addTaskInputRow(t)})}addTaskInputRow(e){let t=e.createDiv({cls:"task-input-row"}),n=t.createEl("input",{type:"text",placeholder:"\uD559\uC2B5 \uD56D\uBAA9 (\uC608: Chapter 3 \uBCF5\uC2B5)",cls:"task-name-input"});this.taskInputs.push(n);let r=t.createEl("input",{type:"text",placeholder:"\uBAA9\uD45C \uC2DC\uAC04 (\uC608: 30m)",cls:"task-duration-input"});r.value=`${this.ctx.settings.defaultStudyDuration}m`,t.createEl("button",{cls:"task-remove-btn",text:"\xD7"}).addEventListener("click",()=>{let o=this.taskInputs.indexOf(n);o>-1&&this.taskInputs.splice(o,1),t.remove()}),n.focus()}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uD559\uC2B5 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createStudyLog())}async createStudyLog(){if(!this.selectedSubject)return;let e=this.collectTasks();if(e.length===0)return;let t=this.buildCodeBlockContent(e),n=await this.ctx.fileCreator.createLogFile("study",t);this.ctx.onCreated(n)}collectTasks(){let e=[];return this.container.querySelectorAll(".task-input-row").forEach(n=>{let r=n.querySelector(".task-name-input"),s=n.querySelector(".task-duration-input");r!=null&&r.value.trim()&&e.push({name:r.value.trim(),duration:(s==null?void 0:s.value.trim())||`${this.ctx.settings.defaultStudyDuration}m`})}),e}buildCodeBlockContent(e){var o;let t=[],r=new Date().getHours(),s=r<12?"\uC624\uC804":r<18?"\uC624\uD6C4":"\uC800\uB141";t.push(`title: ${s} \uD559\uC2B5`),t.push(`subject: ${((o=this.selectedSubject)==null?void 0:o.name)||"\uAE30\uD0C0"}`),t.push("state: planned"),t.push("---");for(let i of e)t.push(`- [ ] ${i.name} | Duration: [${i.duration}]`);return t.join(`
`)}};var Ue={high:"#E74C3C",medium:"#F39C12",low:"#3498DB"},K=class{constructor(e,t){this.container=e,this.ctx=t}render(){this.container.empty(),this.container.addClass("work-log-tab"),this.renderTitleInput(),this.renderTaskInput(),this.renderCreateButton()}renderTitleInput(){let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uC5C5\uBB34 \uC81C\uBAA9",cls:"tab-label"});let t=e.createEl("input",{type:"text",placeholder:"\uC608: \uC624\uC804 \uC5C5\uBB34, \uD504\uB85C\uC81D\uD2B8 A",cls:"work-title-input"}),r=new Date().getHours(),s=r<12?"\uC624\uC804":r<18?"\uC624\uD6C4":"\uC800\uB141";t.value=`${s} \uC5C5\uBB34`}renderTaskInput(){let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uC5C5\uBB34 \uD56D\uBAA9",cls:"tab-label"});let t=e.createDiv({cls:"work-task-input-list"});this.addTaskInputRow(t),e.createEl("button",{cls:"add-task-btn",text:"+ \uC5C5\uBB34 \uCD94\uAC00"}).addEventListener("click",()=>{this.addTaskInputRow(t)})}addTaskInputRow(e){let t=e.createDiv({cls:"work-task-input-row"}),n=t.createEl("input",{type:"text",placeholder:"\uC5C5\uBB34 \uB0B4\uC6A9 (\uC608: \uAE30\uD68D\uC11C \uC791\uC131)",cls:"work-task-name-input"}),r=t.createEl("select",{cls:"work-task-priority-select"}),s=[{value:"high",label:"\uB192\uC74C"},{value:"medium",label:"\uBCF4\uD1B5"},{value:"low",label:"\uB0AE\uC74C"}];for(let c of s){let d=r.createEl("option",{value:c.value,text:c.label});c.value==="medium"&&(d.selected=!0)}r.addEventListener("change",()=>{let c=Ue[r.value];r.style.borderColor=c});let o=t.createEl("input",{type:"text",placeholder:"\uC608\uC0C1 \uC2DC\uAC04 (\uC608: 2h)",cls:"work-task-duration-input"});o.value="1h",t.createEl("button",{cls:"work-task-remove-btn",text:"\xD7"}).addEventListener("click",()=>{t.remove()}),n.focus()}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uC5C5\uBB34 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createWorkLog())}async createWorkLog(){let e=this.collectTasks();if(e.length===0)return;let t=this.container.querySelector(".work-title-input"),n=(t==null?void 0:t.value.trim())||"\uC5C5\uBB34",r=this.buildCodeBlockContent(n,e),s=await this.ctx.fileCreator.createLogFile("work",r);this.ctx.onCreated(s)}collectTasks(){let e=[];return this.container.querySelectorAll(".work-task-input-row").forEach(n=>{let r=n.querySelector(".work-task-name-input"),s=n.querySelector(".work-task-priority-select"),o=n.querySelector(".work-task-duration-input");r!=null&&r.value.trim()&&e.push({name:r.value.trim(),priority:(s==null?void 0:s.value)||"medium",expectedDuration:(o==null?void 0:o.value.trim())||"1h"})}),e}buildCodeBlockContent(e,t){let n=[];n.push(`title: ${e}`),n.push("state: planned"),n.push("---");for(let r of t)n.push(`- [ ] ${r.name} | Priority: ${r.priority} | Expected: [${r.expectedDuration}]`);return n.join(`
`)}};var J=class{constructor(e,t){this.exerciseInputs=[];this.container=e,this.ctx=t}render(){this.container.empty(),this.container.addClass("workout-log-tab"),this.renderTitleInput(),this.renderExerciseInput(),this.renderQuickTemplates(),this.renderCreateButton()}renderTitleInput(){let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uC6B4\uB3D9 \uC774\uB984",cls:"tab-label"});let t=e.createEl("input",{type:"text",placeholder:"\uC608: \uC544\uCE68 \uC6B4\uB3D9, \uC0C1\uCCB4 \uC6B4\uB3D9",cls:"workout-title-input"}),r=new Date().getHours(),s=r<12?"\uC544\uCE68":r<18?"\uC624\uD6C4":"\uC800\uB141";t.value=`${s} \uC6B4\uB3D9`}renderExerciseInput(){let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uC6B4\uB3D9 \uD56D\uBAA9",cls:"tab-label"});let t=e.createDiv({cls:"exercise-input-list"});this.addExerciseInputRow(t),e.createEl("button",{cls:"add-exercise-btn",text:"+ \uC6B4\uB3D9 \uCD94\uAC00"}).addEventListener("click",()=>{this.addExerciseInputRow(t)})}addExerciseInputRow(e){let t=e.createDiv({cls:"exercise-input-row"}),n=t.createEl("input",{type:"text",placeholder:"\uC6B4\uB3D9\uBA85 (\uC608: \uC2A4\uCFFC\uD2B8)",cls:"exercise-name-input"}),r=t.createEl("input",{type:"text",placeholder:"\uBB34\uAC8C: [60]kg | \uD69F\uC218: [10]",cls:"exercise-params-input"});t.createEl("button",{cls:"exercise-remove-btn",text:"\xD7"}).addEventListener("click",()=>{t.remove()}),n.focus()}renderQuickTemplates(){var s;let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uBE60\uB978 \uD15C\uD50C\uB9BF",cls:"tab-label"});let t=e.createDiv({cls:"template-grid"}),n=[{name:"\uC0C1\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uD478\uC2DC\uC5C5",params:"\uD69F\uC218: [15]"},{name:"\uB364\uBCA8 \uB85C\uC6B0",params:"\uBB34\uAC8C: [10]kg | \uD69F\uC218: [12]"},{name:"\uC204\uB354 \uD504\uB808\uC2A4",params:"\uBB34\uAC8C: [8]kg | \uD69F\uC218: [10]"}]},{name:"\uD558\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uC2A4\uCFFC\uD2B8",params:"\uBB34\uAC8C: [40]kg | \uD69F\uC218: [12]"},{name:"\uB7F0\uC9C0",params:"\uD69F\uC218: [10] /\uB2E4\uB9AC"},{name:"\uCE74\uD504\uB808\uC774\uC988",params:"\uD69F\uC218: [20]"}]},{name:"HIIT",exercises:[{name:"\uBC84\uD53C",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uC810\uD551\uC7AD",params:"\uC2DC\uAC04: [30\uCD08]"},{name:"\uB9C8\uC6B4\uD2F4 \uD074\uB77C\uC774\uBA38",params:"\uC2DC\uAC04: [30\uCD08]"}]}],r=((s=this.ctx.settings.workoutTemplates)==null?void 0:s.length)>0?this.ctx.settings.workoutTemplates:n;for(let o of r){let i=t.createEl("button",{cls:"template-btn"});i.createSpan({text:o.name}),i.addEventListener("click",()=>{this.applyTemplate(o)})}}applyTemplate(e){let t=this.container.querySelector(".workout-title-input");t&&(t.value=e.name);let n=this.container.querySelector(".exercise-input-list");if(n){n.empty();for(let r of e.exercises)this.addExerciseInputRowWithData(n,r)}}addExerciseInputRowWithData(e,t){let n=e.createDiv({cls:"exercise-input-row"}),r=n.createEl("input",{type:"text",placeholder:"\uC6B4\uB3D9\uBA85",cls:"exercise-name-input"});r.value=t.name;let s=n.createEl("input",{type:"text",placeholder:"\uD30C\uB77C\uBBF8\uD130",cls:"exercise-params-input"});s.value=t.params,n.createEl("button",{cls:"exercise-remove-btn",text:"\xD7"}).addEventListener("click",()=>{n.remove()})}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uC6B4\uB3D9 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createWorkoutLog())}async createWorkoutLog(){let e=this.collectExercises();if(e.length===0)return;let t=this.container.querySelector(".workout-title-input"),n=(t==null?void 0:t.value.trim())||"\uC6B4\uB3D9",r=this.buildCodeBlockContent(n,e),s=await this.ctx.fileCreator.createLogFile("workout",r);this.ctx.onCreated(s)}collectExercises(){let e=[];return this.container.querySelectorAll(".exercise-input-row").forEach(n=>{let r=n.querySelector(".exercise-name-input"),s=n.querySelector(".exercise-params-input");r!=null&&r.value.trim()&&e.push({name:r.value.trim(),params:(s==null?void 0:s.value.trim())||""})}),e}buildCodeBlockContent(e,t){let n=[];n.push(`title: ${e}`),n.push("state: planned"),n.push("startDate:"),n.push("duration:"),n.push(`restDuration: ${this.ctx.settings.defaultRestDuration}s`),n.push("---");for(let r of t)r.params?n.push(`- [ ] ${r.name} | ${r.params}`):n.push(`- [ ] ${r.name}`);return n.join(`
`)}};var P=class extends Xt.Modal{constructor(t,n,r){super(t);this.tabContentEl=null;this.settings=n,this.fileCreator=r,this.activeTab=n.defaultTab}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("quick-log-modal"),this.renderHeader(t),this.renderTabs(t),this.renderTabContent(t)}renderHeader(t){t.createDiv({cls:"modal-header"}).createEl("h2",{text:"Life Log"})}renderTabs(t){let n=t.createDiv({cls:"modal-tabs"});n.createEl("button",{cls:`modal-tab ${this.activeTab==="study"?"active":""}`,text:"\uD559\uC2B5 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="study",this.updateActiveTab(n),this.renderTabContent(t)}),n.createEl("button",{cls:`modal-tab ${this.activeTab==="work"?"active":""}`,text:"\uC5C5\uBB34 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="work",this.updateActiveTab(n),this.renderTabContent(t)}),n.createEl("button",{cls:`modal-tab ${this.activeTab==="workout"?"active":""}`,text:"\uC6B4\uB3D9 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="workout",this.updateActiveTab(n),this.renderTabContent(t)})}updateActiveTab(t){let n=["study","work","workout"];t.querySelectorAll(".modal-tab").forEach((r,s)=>{n[s]===this.activeTab?r.classList.add("active"):r.classList.remove("active")})}renderTabContent(t){this.tabContentEl&&this.tabContentEl.remove(),this.tabContentEl=t.createDiv({cls:"modal-tab-content"});let n=r=>{this.close(),this.app.workspace.getLeaf().openFile(r)};this.activeTab==="study"?new G(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:n}).render():this.activeTab==="work"?new K(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:n}).render():new J(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:n}).render()}onClose(){let{contentEl:t}=this;t.empty()}};var Zt=require("obsidian"),Q=class extends Zt.Modal{constructor(t,n){super(t);this.focusScore=4;this.comprehensionScore=4;this.notes="";this.onSubmit=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("self-eval-modal"),t.createEl("h2",{text:"\u{1F389} \uD559\uC2B5 \uC644\uB8CC! \uC790\uAC00\uD3C9\uAC00\uB97C \uD574\uC8FC\uC138\uC694"}),this.renderFocusScore(t),this.renderComprehensionScore(t),this.renderNotesInput(t),this.renderButtons(t)}renderFocusScore(t){let n=t.createDiv({cls:"eval-section"});n.createEl("label",{text:"\uC9D1\uC911\uB3C4",cls:"eval-label"});let r=n.createDiv({cls:"eval-stars"});this.renderStarPicker(r,this.focusScore,s=>{this.focusScore=s})}renderComprehensionScore(t){let n=t.createDiv({cls:"eval-section"});n.createEl("label",{text:"\uC774\uD574\uB3C4",cls:"eval-label"});let r=n.createDiv({cls:"eval-stars"});this.renderStarPicker(r,this.comprehensionScore,s=>{this.comprehensionScore=s})}renderStarPicker(t,n,r){for(let s=1;s<=5;s++){let o=t.createSpan({cls:`eval-star ${s<=n?"filled":""}`,text:s<=n?"\u2605":"\u2606"});o.addEventListener("click",()=>{r(s),t.querySelectorAll(".eval-star").forEach((i,c)=>{let d=i;c<s?(d.textContent="\u2605",d.classList.add("filled")):(d.textContent="\u2606",d.classList.remove("filled"))})}),o.addEventListener("mouseenter",()=>{t.querySelectorAll(".eval-star").forEach((i,c)=>{let d=i;c<s&&d.classList.add("hover")})}),o.addEventListener("mouseleave",()=>{t.querySelectorAll(".eval-star").forEach(i=>{i.classList.remove("hover")})})}}renderNotesInput(t){let n=t.createDiv({cls:"eval-section"});n.createEl("label",{text:"\uBA54\uBAA8 (\uC120\uD0DD)",cls:"eval-label"});let r=n.createEl("textarea",{cls:"eval-notes-input",placeholder:"\uC624\uB298 \uD559\uC2B5\uC5D0 \uB300\uD55C \uC9E7\uC740 \uBA54\uBAA8..."});r.rows=3,r.addEventListener("input",()=>{this.notes=r.value})}renderButtons(t){let n=t.createDiv({cls:"eval-buttons"});n.createEl("button",{cls:"eval-btn eval-btn-secondary",text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{cls:"eval-btn eval-btn-primary",text:"\uC800\uC7A5\uD558\uACE0 \uC885\uB8CC"}).addEventListener("click",()=>{this.onSubmit({focusScore:this.focusScore,comprehensionScore:this.comprehensionScore,notes:this.notes||void 0}),this.close()})}onClose(){let{contentEl:t}=this;t.empty()}};var Ge='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/><circle cx="12" cy="12" r="3"/></svg>',X=class extends Z.Plugin{constructor(){super(...arguments);this.timerManager=new j;this.fileUpdater=null;this.fileCreator=null;this.ribbonIconEl=null;this.settings=Pt}async onload(){await this.loadSettings(),this.fileUpdater=new N(this.app),this.fileCreator=new B(this.app,this.settings),(0,Z.addIcon)("life-log",Ge),this.registerMarkdownCodeBlockProcessor("life-log",(t,n,r)=>{this.processWorkoutBlock(t,n,r)}),this.registerMarkdownCodeBlockProcessor("study-log",(t,n,r)=>{this.processStudyBlock(t,n,r)}),this.registerMarkdownCodeBlockProcessor("work-log",(t,n,r)=>{this.processWorkBlock(t,n,r)}),this.addCommand({id:"open-quick-log",name:"\uC0C8 \uAE30\uB85D",hotkeys:[{modifiers:["Mod","Shift"],key:"l"}],callback:()=>{this.fileCreator&&new P(this.app,this.settings,this.fileCreator).open()}}),this.addCommand({id:"open-study-log",name:"\uC0C8 \uD559\uC2B5 \uAE30\uB85D",callback:()=>{this.fileCreator&&new P(this.app,{...this.settings,defaultTab:"study"},this.fileCreator).open()}}),this.addCommand({id:"open-work-log",name:"\uC0C8 \uC5C5\uBB34 \uAE30\uB85D",callback:()=>{this.fileCreator&&new P(this.app,{...this.settings,defaultTab:"work"},this.fileCreator).open()}}),this.addCommand({id:"open-workout-log",name:"\uC0C8 \uC6B4\uB3D9 \uAE30\uB85D",callback:()=>{this.fileCreator&&new P(this.app,{...this.settings,defaultTab:"workout"},this.fileCreator).open()}}),console.log("[Life Log] Registering settings tab..."),this.addSettingTab(new _(this.app,this)),console.log("[Life Log] Settings tab registered"),this.updateRibbonIcon()}onunload(){this.timerManager.destroy()}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},Pt,t),(!this.settings.subjects||this.settings.subjects.length===0)&&(this.settings.subjects=[...Ct]),(!this.settings.workoutTemplates||this.settings.workoutTemplates.length===0)&&(this.settings.workoutTemplates=[...U])}async saveSettings(){await this.saveData(this.settings),this.fileCreator&&(this.fileCreator=new B(this.app,this.settings))}updateRibbonIcon(){this.ribbonIconEl&&(this.ribbonIconEl.remove(),this.ribbonIconEl=null),this.settings.showRibbonIcon&&(this.ribbonIconEl=this.addRibbonIcon("life-log","Life Log: \uC0C8 \uAE30\uB85D",()=>{this.fileCreator&&new P(this.app,this.settings,this.fileCreator).open()}))}processWorkoutBlock(t,n,r){var l;let s=Wt(t),o=r.getSectionInfo(n),i=`${r.sourcePath}:${(l=o==null?void 0:o.lineStart)!=null?l:0}`,c=this.timerManager.isTimerRunning(i);if(c&&s.metadata.state!=="started")this.timerManager.stopWorkoutTimer(i);else if(c&&s.metadata.state==="started"){let u=s.exercises.findIndex(m=>m.state==="inProgress"),p=this.timerManager.getActiveExerciseIndex(i);u>=0&&u!==p&&this.timerManager.setActiveExerciseIndex(i,u)}let d=this.createWorkoutCallbacks(r,o,s,i);Nt({el:n,parsed:s,callbacks:d,workoutId:i,timerManager:this.timerManager})}processStudyBlock(t,n,r){var l;let s=Yt(t),o=r.getSectionInfo(n),i=`study:${r.sourcePath}:${(l=o==null?void 0:o.lineStart)!=null?l:0}`,c=this.timerManager.isTimerRunning(i);if(c&&s.metadata.state!=="started")this.timerManager.stopWorkoutTimer(i);else if(c&&s.metadata.state==="started"){let u=s.tasks.findIndex(m=>m.state==="inProgress"),p=this.timerManager.getActiveExerciseIndex(i);u>=0&&u!==p&&this.timerManager.setActiveExerciseIndex(i,u)}let d=this.createStudyCallbacks(r,o,s,i);Ut({el:n,parsed:s,callbacks:d,studyId:i,timerManager:this.timerManager,enableTimerSound:this.settings.enableTimerSound,enableNotification:this.settings.enableNotifications})}processWorkBlock(t,n,r){var l;let s=Kt(t),o=r.getSectionInfo(n),i=`work:${r.sourcePath}:${(l=o==null?void 0:o.lineStart)!=null?l:0}`,c=this.timerManager.isTimerRunning(i);if(c&&s.metadata.state!=="started")this.timerManager.stopWorkoutTimer(i);else if(c&&s.metadata.state==="started"){let u=s.tasks.findIndex(m=>m.state==="inProgress"),p=this.timerManager.getActiveExerciseIndex(i);u>=0&&u!==p&&this.timerManager.setActiveExerciseIndex(i,u)}let d=this.createWorkCallbacks(r,o,s,i);Qt({el:n,parsed:s,callbacks:d,workId:i,timerManager:this.timerManager,enableTimerSound:this.settings.enableTimerSound,enableNotification:this.settings.enableNotifications})}createWorkCallbacks(t,n,r,s){let o=r,i=!1,c=async l=>{var m;o=l,i=!1;let u=Jt(l),p=o.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(t.sourcePath,n,u,p))};return{onStartWork:async()=>{i=!1,o.metadata.state="started",o.metadata.startDate=this.formatStartDate(new Date);let l=o.tasks.findIndex(u=>u.state==="pending");l>=0&&(o=I(o,l,"inProgress")),await c(o),this.timerManager.startWorkoutTimer(s,l>=0?l:0)},onFinishWork:async()=>{let l=this.timerManager.getTimerState(s);l&&(o.metadata.totalDuration=y(l.workoutElapsed)),o.metadata.endDate=this.formatStartDate(new Date),o.metadata.state="completed";for(let u=0;u<o.tasks.length;u++){let p=o.tasks[u];if(p&&p.state==="inProgress"){let m=this.timerManager.getTimerState(s);m&&(o=z(o,u,y(m.exerciseElapsed))),o=I(o,u,"completed")}}await c(o),this.timerManager.stopWorkoutTimer(s)},onTaskFinish:async l=>{if(i=!1,!o.tasks[l])return;let p=this.timerManager.getTimerState(s);p&&(o=z(o,l,y(p.exerciseElapsed))),o=I(o,l,"completed");let m=o.tasks.findIndex((h,g)=>g>l&&h.state==="pending");m>=0?(o=I(o,m,"inProgress"),this.timerManager.advanceExercise(s,m),await c(o)):await c(o)},onTaskSkip:async l=>{i=!1;let u=this.timerManager.getTimerState(s);u&&u.exerciseElapsed>0&&(o=z(o,l,y(u.exerciseElapsed))),o=I(o,l,"skipped");let p=o.tasks.findIndex((m,h)=>h>l&&m.state==="pending");p>=0?(o=I(o,p,"inProgress"),this.timerManager.advanceExercise(s,p),await c(o)):await c(o)},onPauseTask:()=>{this.timerManager.pauseExercise(s)},onResumeTask:()=>{this.timerManager.resumeExercise(s)},onFlushChanges:async()=>{i&&await c(o)}}}createWorkoutCallbacks(t,n,r,s){let o=r,i=!1,c=async l=>{var m;o=l,i=!1;let u=ot(l),p=o.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(t.sourcePath,n,u,p))};return{onStartWorkout:async()=>{i=!1,o.metadata.state="started",o.metadata.startDate=this.formatStartDate(new Date);let l=o.exercises.findIndex(u=>u.state==="pending");if(l>=0){let u=o.exercises[l];u&&(u.state="inProgress")}await c(o),this.timerManager.startWorkoutTimer(s,l>=0?l:0)},onFinishWorkout:async()=>{let l=this.timerManager.getTimerState(s);l&&(o.metadata.duration=y(l.workoutElapsed)),o.metadata.state="completed",o=R(o),await c(o),this.timerManager.stopWorkoutTimer(s)},onExerciseFinish:async l=>{if(i=!1,!o.exercises[l])return;let p=this.timerManager.getTimerState(s);p&&(o=A(o,l,y(p.exerciseElapsed))),o=C(o,l,"completed");let m=o.exercises.findIndex((h,g)=>g>l&&h.state==="pending");if(m>=0)o=C(o,m,"inProgress"),this.timerManager.advanceExercise(s,m),await c(o);else{o.metadata.state="completed";let h=this.timerManager.getTimerState(s);h&&(o.metadata.duration=y(h.workoutElapsed)),o=R(o),await c(o),this.timerManager.stopWorkoutTimer(s)}},onExerciseAddSet:async l=>{if(i=!1,!o.exercises[l])return;let p=this.timerManager.getTimerState(s);p&&(o=A(o,l,y(p.exerciseElapsed))),o=C(o,l,"completed"),o=At(o,l),o=C(o,l+1,"inProgress"),this.timerManager.advanceExercise(s,l+1),await c(o)},onExerciseAddRest:async l=>{i=!1;let u=o.exercises[l],p=o.metadata.restDuration;if(!u||!p)return;let m=this.timerManager.getTimerState(s);m&&(o=A(o,l,y(m.exerciseElapsed))),o=C(o,l,"completed"),o=It(o,l,p),o=C(o,l+1,"inProgress"),this.timerManager.advanceExercise(s,l+1),await c(o)},onExerciseSkip:async l=>{i=!1;let u=this.timerManager.getTimerState(s);u&&u.exerciseElapsed>0&&(o=A(o,l,y(u.exerciseElapsed))),o=C(o,l,"skipped");let p=o.exercises.findIndex((m,h)=>h>l&&m.state==="pending");if(p>=0)o=C(o,p,"inProgress"),this.timerManager.advanceExercise(s,p),await c(o);else{o.metadata.state="completed";let m=this.timerManager.getTimerState(s);m&&(o.metadata.duration=y(m.workoutElapsed)),o=R(o),this.timerManager.stopWorkoutTimer(s),await c(o)}},onParamChange:(l,u,p)=>{let m=o.exercises[l],h=m==null?void 0:m.params.find(g=>g.key===u);(h==null?void 0:h.value)!==p&&(o=$t(o,l,u,p),i=!0)},onFlushChanges:async()=>{i&&await c(o)},onPauseExercise:()=>{this.timerManager.pauseExercise(s)},onResumeExercise:()=>{this.timerManager.resumeExercise(s)},onAddSample:async()=>{var p;let l=Ht(),u=ot(l);await((p=this.fileUpdater)==null?void 0:p.updateCodeBlock(t.sourcePath,n,u,l.metadata.title))}}}createStudyCallbacks(t,n,r,s){let o=r,i=!1,c=async l=>{var m;o=l,i=!1;let u=qt(l),p=o.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(t.sourcePath,n,u,p))};return{onStartStudy:async()=>{i=!1,o.metadata.state="started",o.metadata.startDate=this.formatStartDate(new Date);let l=o.tasks.findIndex(u=>u.state==="pending");l>=0&&(o=$(o,l,"inProgress")),await c(o),this.timerManager.startWorkoutTimer(s,l>=0?l:0,this.settings.enablePomodoro?{enabled:!0,workDuration:this.settings.pomodoroWork*60,breakDuration:this.settings.pomodoroBreak*60}:void 0)},onFinishStudy:async()=>{let l=this.timerManager.getTimerState(s);l&&(o.metadata.totalDuration=y(l.workoutElapsed)),o.metadata.endDate=this.formatStartDate(new Date),o.metadata.state="completed",await c(o),this.timerManager.stopWorkoutTimer(s)},onTaskFinish:async l=>{if(i=!1,!o.tasks[l])return;let p=this.timerManager.getTimerState(s);p&&(o=O(o,l,y(p.exerciseElapsed))),o=$(o,l,"completed");let m=o.tasks.findIndex((h,g)=>g>l&&h.state==="pending");m>=0?(o=$(o,m,"inProgress"),this.timerManager.advanceExercise(s,m),await c(o)):await c(o)},onTaskSkip:async l=>{i=!1;let u=this.timerManager.getTimerState(s);u&&u.exerciseElapsed>0&&(o=O(o,l,y(u.exerciseElapsed))),o=$(o,l,"skipped");let p=o.tasks.findIndex((m,h)=>h>l&&m.state==="pending");p>=0?(o=$(o,p,"inProgress"),this.timerManager.advanceExercise(s,p),await c(o)):await c(o)},onPauseTask:()=>{this.timerManager.pauseExercise(s)},onResumeTask:()=>{this.timerManager.resumeExercise(s)},onFlushChanges:async()=>{i&&await c(o)},onOpenSelfEval:()=>{new Q(this.app,async l=>{o=zt(o,l.focusScore,l.comprehensionScore);let u=this.timerManager.getTimerState(s);u&&(o.metadata.totalDuration=y(u.workoutElapsed)),o.metadata.endDate=this.formatStartDate(new Date),o.metadata.state="completed";for(let p=0;p<o.tasks.length;p++){let m=o.tasks[p];if(m&&m.state==="inProgress"){let h=this.timerManager.getTimerState(s);h&&(o=O(o,p,y(h.exerciseElapsed))),o=$(o,p,"completed")}}await c(o),this.timerManager.stopWorkoutTimer(s)}).open()}}}formatStartDate(t){let n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`${n}-${r}-${s} ${o}:${i}`}};
