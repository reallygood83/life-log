/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var q=Object.defineProperty;var $t=Object.getOwnPropertyDescriptor;var It=Object.getOwnPropertyNames;var At=Object.prototype.hasOwnProperty;var Ht=(a,e)=>{for(var t in e)q(a,t,{get:e[t],enumerable:!0})},Wt=(a,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of It(e))!At.call(a,s)&&s!==t&&q(a,s,{get:()=>e[s],enumerable:!(n=$t(e,s))||n.enumerable});return a};var Ft=a=>Wt(q({},"__esModule",{value:!0}),a);var oe={};Ht(oe,{default:()=>Y});module.exports=Ft(oe);var O=require("obsidian");var Rt=/^-\s*\[(.)\]\s*(.+)$/,jt={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},Bt={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function z(a,e){var p,m,g,h;let t=a.match(Rt);if(!t)return null;let n=(p=t[1])!=null?p:" ",s=(m=t[2])!=null?m:"",i=(g=jt[n])!=null?g:"pending",r=s.split("|").map(S=>S.trim()),o=(h=r[0])!=null?h:"",l=r.slice(1),u=[],c,d;for(let S of l){let f=Nt(S);f&&(u.push(f),f.key.toLowerCase()==="duration"&&(f.editable?c=C(f.value):d=f.value+(f.unit?` ${f.unit}`:"")))}return{state:i,name:o,params:u,targetDuration:c,recordedDuration:d,lineIndex:e}}function Nt(a){var l,u,c;let e=a.indexOf(":");if(e===-1)return null;let t=a.substring(0,e).trim(),n=a.substring(e+1).trim(),s=n.match(/^\[([^\]]*)\](.*)$/);if(s){let d=(l=s[1])!=null?l:"",p=((u=s[2])!=null?u:"").trim();return{key:t,value:d,editable:!0,unit:p||void 0}}let i=n.split(/\s+/),r=(c=i[0])!=null?c:"",o=i.slice(1).join(" ")||void 0;return{key:t,value:r,editable:!1,unit:o}}function C(a){var r,o,l,u,c,d;let e=a.trim(),t=e.match(/^(\d+)s$/);if(t)return parseInt((r=t[1])!=null?r:"0",10);let n=e.match(/^(\d+):(\d{2})$/);if(n){let p=parseInt((o=n[1])!=null?o:"0",10),m=parseInt((l=n[2])!=null?l:"0",10);return p*60+m}let s=e.match(/^(\d+)m\s*(\d+)?s?$/);if(s){let p=parseInt((u=s[1])!=null?u:"0",10),m=parseInt((c=s[2])!=null?c:"0",10);return p*60+m}let i=e.match(/^(\d+)$/);return i?parseInt((d=i[1])!=null?d:"0",10):0}function k(a){let e=Math.floor(a/60),t=a%60;return`${e}:${t.toString().padStart(2,"0")}`}function b(a){let e=Math.floor(a/60),t=a%60;return e===0?`${t}s`:t===0?`${e}m`:`${e}m ${t}s`}function dt(a){return Bt[a]}function _(a){let t=`- [${dt(a.state)}] ${a.name}`;for(let n of a.params)t+=" | ",t+=`${n.key}: `,n.editable?t+=`[${n.value}]`:t+=n.value,n.unit&&(t+=` ${n.unit}`);return t}var Yt=["planned","started","completed"];function V(a){let e={state:"planned"};for(let t of a){let n=t.indexOf(":");if(n===-1)continue;let s=t.substring(0,n).trim().toLowerCase(),i=t.substring(n+1).trim();switch(s){case"title":i&&(e.title=i);break;case"state":Yt.includes(i)&&(e.state=i);break;case"startdate":i&&(e.startDate=i);break;case"duration":i&&(e.duration=i);break;case"restduration":if(i){let r=C(i);r>0&&(e.restDuration=r)}break}}return e}function U(a){let e=[];return a.title!==void 0&&e.push(`title: ${a.title}`),e.push(`state: ${a.state}`),a.startDate!==void 0&&e.push(`startDate: ${a.startDate}`),a.duration!==void 0&&e.push(`duration: ${a.duration}`),a.restDuration!==void 0&&e.push(`restDuration: ${b(a.restDuration)}`),e}function pt(a){var l;let e=a.split(`
`),t=-1;for(let u=0;u<e.length;u++)if(((l=e[u])==null?void 0:l.trim())==="---"){t=u;break}let n=t>0?e.slice(0,t):[],s=V(n),i=t>=0?t+1:0,r=e.slice(i),o=[];for(let u=0;u<r.length;u++){let c=r[u];if(!c)continue;let d=z(c,u);d&&o.push(d)}return{metadata:s,exercises:o,rawLines:e,metadataEndIndex:t>=0?t:-1}}function G(a){let e=[],t=U(a.metadata);e.push(...t),e.push("---");for(let n of a.exercises)e.push(_(n));return e.join(`
`)}function mt(a,e,t,n){let s=structuredClone(a),i=s.exercises[e];if(!i)return a;let r=i.params.find(o=>o.key===t);return r&&(r.value=n),s}function T(a,e,t){let n=structuredClone(a),s=n.exercises[e];return s?(s.state=t,n):a}function $(a){let e=structuredClone(a);for(let t of e.exercises)for(let n of t.params)n.editable=!1;return e}function gt(a,e,t){let n=structuredClone(a),s=n.exercises[e];if(!s)return a;let i={state:"pending",name:"Rest",params:[{key:"Duration",value:`${t}s`,editable:!0}],targetDuration:t,lineIndex:s.lineIndex+1};n.exercises.splice(e+1,0,i);for(let r=e+2;r<n.exercises.length;r++){let o=n.exercises[r];o&&o.lineIndex++}return n}function ft(a,e){let t=structuredClone(a),n=t.exercises[e];if(!n)return a;let s={...structuredClone(n),state:"pending",recordedDuration:void 0,lineIndex:n.lineIndex+1};for(let i of s.params)i.key.toLowerCase()==="duration"&&!i.editable&&(i.editable=n.targetDuration!==void 0);t.exercises.splice(e+1,0,s);for(let i=e+2;i<t.exercises.length;i++){let r=t.exercises[i];r&&r.lineIndex++}return t}function M(a,e,t){let n=structuredClone(a),s=n.exercises[e];if(!s)return a;let i=s.params.find(r=>r.key.toLowerCase()==="duration");return i?(i.value=t,i.editable=!1):s.params.push({key:"Duration",value:t,editable:!1}),s.recordedDuration=t,n}function ht(){return{metadata:{title:"Sample Workout",state:"planned",restDuration:60},exercises:[{state:"pending",name:"Squats",params:[{key:"Weight",value:"60",editable:!0,unit:"kg"},{key:"Reps",value:"12",editable:!0}],lineIndex:0},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:1},{state:"pending",name:"Push-ups",params:[{key:"Reps",value:"15",editable:!0}],lineIndex:2},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:3},{state:"pending",name:"Dumbbell Rows",params:[{key:"Weight",value:"20",editable:!0,unit:"kg"},{key:"Reps",value:"10",editable:!0,unit:"/arm"}],lineIndex:4},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:5},{state:"pending",name:"Plank Hold",params:[{key:"Duration",value:"45s",editable:!0}],targetDuration:45,lineIndex:6},{state:"pending",name:"Rest",params:[{key:"Duration",value:"60s",editable:!0}],targetDuration:60,lineIndex:7},{state:"pending",name:"Lunges",params:[{key:"Reps",value:"10",editable:!0,unit:"/leg"}],lineIndex:8}],rawLines:[],metadataEndIndex:-1}}function St(a){let e=[];a.metadata.title&&e.push(`title: ${a.metadata.title}`),e.push("state: planned"),e.push("startDate:"),e.push("duration:"),e.push("---");let t=new Set,n=[];for(let s of a.exercises)t.has(s.name)||(t.add(s.name),n.push(s));for(let s of n){let i=`- [ ] ${s.name}`;for(let r of s.params)if(i+=" | ",i+=`${r.key}: `,!(r.key.toLowerCase()==="duration"&&!s.targetDuration)){if(r.key.toLowerCase()==="duration"&&s.targetDuration){let o=Math.floor(s.targetDuration/60),l=s.targetDuration%60,u=o>0?`${o}m ${l}s`:`${l}s`;i+=`[${u}]`}else i+=`[${r.value}]`;r.unit&&(i+=` ${r.unit}`)}e.push(i)}return e.join(`
`)}function J(a,e,t,n){let s=a.createDiv({cls:"workout-header"}),i=s.createDiv({cls:"workout-title"});if(i.textContent=e.title||"Workout",e.restDuration){let l=s.createDiv({cls:"workout-rest-duration"}),u=b(e.restDuration);l.setText(`Rest: ${u}`)}let o=s.createDiv({cls:"workout-header-timer"}).createSpan({cls:"workout-timer"});return e.state==="completed"&&e.duration?(o.textContent=e.duration,o.createSpan({cls:"workout-timer-indicator recorded",text:" \u2713"})):n&&t?(o.textContent=`Total: ${k(t.workoutElapsed)}`,o.createSpan({cls:"workout-timer-indicator count-up",text:" \u25B2"})):(e.state,o.textContent="--:--"),{titleEl:i,timerEl:o}}function K(a,e){a.empty(),a.textContent=`Total: ${k(e.workoutElapsed)}`,a.createSpan({cls:"workout-timer-indicator count-up",text:" \u25B2"})}var Ot={pending:"\u25CB",inProgress:"\u25D0",completed:"\u2713",skipped:"\u2014"};function qt(a){let e=5381;for(let s=0;s<a.length;s++)e=(e<<5)+e^a.charCodeAt(s);let t=.618033988749895,n=Math.abs(e)%1e3/1e3;return Math.floor(n*t%1*360)}function xt(a){return a.params.some(e=>e.key.toLowerCase()!=="duration")}function Q(a,e,t,n,s,i,r,o){let l=!xt(e),u=a.createDiv({cls:`workout-exercise state-${e.state}${n?" active":""}${l?" simple":""}`}),c=qt(e.name);u.style.setProperty("--exercise-color",`hsl(${c}, 65%, 55%)`);let d=new Map,p=u.createDiv({cls:"workout-exercise-main"}),m=p.createSpan({cls:"workout-exercise-icon"});m.textContent=Ot[e.state];let g=p.createSpan({cls:"workout-exercise-name"});if(g.textContent=e.name,xt(e)){let S=p.createSpan({cls:"workout-exercise-params"});for(let f of e.params){if(f.key.toLowerCase()==="duration")continue;let x=S.createSpan({cls:"workout-param"});if(f.unit||x.createSpan({cls:"workout-param-prefix",text:"\xD7"}),f.editable&&r!=="completed"){let v=x.createEl("input",{cls:"workout-param-input",type:"text",value:f.value});v.addEventListener("input",()=>{i.onParamChange(t,f.key,v.value)}),v.addEventListener("keydown",E=>{E.key==="Enter"&&v.blur()}),d.set(f.key,v)}else x.createSpan({cls:"workout-param-value",text:f.value});f.unit&&x.createSpan({cls:"workout-param-unit",text:` ${f.unit}`})}}let h=p.createSpan({cls:"workout-exercise-timer"});return e.state==="completed"&&e.recordedDuration?(h.textContent=e.recordedDuration,h.createSpan({cls:"timer-indicator recorded",text:" \u2713"})):n&&s?I(h,s,e.targetDuration):e.targetDuration?(h.textContent=k(e.targetDuration),h.createSpan({cls:"timer-indicator count-down",text:" \u25BC"})):e.state==="pending"&&(h.textContent="--"),n&&r==="started"&&zt(u,t,i,o),{container:u,timerEl:h,inputs:d}}function zt(a,e,t,n){let s=a.createDiv({cls:"workout-exercise-controls"}),i=s.createEl("button",{cls:"workout-btn",text:"Pause"});i.addEventListener("click",()=>{i.textContent==="Pause"?(t.onPauseExercise(),i.textContent="Resume"):(t.onResumeExercise(),i.textContent="Pause")}),s.createEl("button",{cls:"workout-btn",text:"Skip"}).addEventListener("click",()=>{t.onExerciseSkip(e)});let o=s.createDiv({cls:"workout-btn-group"});o.createEl("button",{cls:"workout-btn",text:"+ Set"}).addEventListener("click",()=>{t.onExerciseAddSet(e)}),n!==void 0&&o.createEl("button",{cls:"workout-btn",text:"+ Rest"}).addEventListener("click",()=>{t.onExerciseAddRest(e)}),o.createEl("button",{cls:"workout-btn",text:"Next"}).addEventListener("click",()=>{t.onExerciseFinish(e)})}function I(a,e,t){if(a.empty(),t!==void 0){let n=t-e.exerciseElapsed;n>0?(a.textContent=k(n),a.createSpan({cls:"timer-indicator count-down",text:" \u25BC"})):(a.textContent=k(Math.abs(n)),a.addClass("overtime"),a.createSpan({cls:"timer-indicator overtime",text:" \u26A0"}))}else a.textContent=k(e.exerciseElapsed),a.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}function X(a,e,t,n){let s=a.createDiv({cls:"workout-controls"});if(e==="planned"){let i=s.createEl("button",{cls:"workout-btn workout-btn-primary workout-btn-large"});i.createSpan({cls:"workout-btn-icon",text:"\u25B6"}),i.createSpan({text:"Start Workout"}),i.addEventListener("click",()=>{t.onStartWorkout()})}else if(e==="completed"){let i=s.createSpan({cls:"workout-completed-label"});i.createSpan({cls:"workout-btn-icon",text:"\u2713"}),i.createSpan({text:"Completed"});let r=s.createEl("button",{cls:"workout-btn"});r.createSpan({cls:"workout-btn-icon",text:"\u{1F4CB}"}),r.createSpan({text:"Copy as Template"}),r.addEventListener("click",async()=>{let o=St(n);await navigator.clipboard.writeText("```workout\n"+o+"\n```");let l=r.querySelector("span:last-child");if(l){let u=l.textContent;l.textContent="Copied!",setTimeout(()=>{l.textContent=u},1500)}})}return s}function vt(a,e){let t=a.createDiv({cls:"workout-empty-state"});t.createDiv({cls:"workout-empty-message"}).createSpan({text:"This workout is empty"});let i=t.createDiv({cls:"workout-empty-action"}).createEl("button",{cls:"workout-btn workout-btn-primary workout-btn-large"});return i.createSpan({cls:"workout-btn-icon",text:"\u2728"}),i.createSpan({text:"Add Sample Workout"}),i.addEventListener("click",async()=>{await e()}),t}function bt(a){let{el:e,parsed:t,callbacks:n,workoutId:s,timerManager:i}=a;e.empty();let r=e.createDiv({cls:`workout-container state-${t.metadata.state}`}),o=i.isTimerRunning(s),l=i.getTimerState(s),u=o?i.getActiveExerciseIndex(s):-1,{timerEl:c}=J(r,t.metadata,l,o);if(t.exercises.length===0&&t.metadata.state==="planned"){vt(r,n.onAddSample);return}let d=[],p=r.createDiv({cls:"workout-exercises"}),m=Math.max(...t.exercises.map(g=>g.name.length));p.style.setProperty("--max-name-chars",String(m));for(let g=0;g<t.exercises.length;g++){let h=t.exercises[g];if(!h)continue;let S=g===u,f=Q(p,h,g,S,S?l:null,n,t.metadata.state,t.metadata.restDuration);d.push(f)}if(X(r,t.metadata.state,n,t),r.addEventListener("focusout",g=>{let h=g.relatedTarget;(!h||!r.contains(h))&&n.onFlushChanges()}),o){let g=u,h=!1;i.subscribe(s,S=>{K(c,S);let f=i.getActiveExerciseIndex(s);if(f!==g)return;let x=d[f],v=t.exercises[f];x!=null&&x.timerEl&&v&&(I(x.timerEl,S,v.targetDuration),!h&&v.targetDuration!==void 0&&S.exerciseElapsed>=v.targetDuration&&(h=!0,n.onExerciseFinish(f)))})}}var A=class{constructor(){this.timers=new Map;this.intervalId=null;this.onAutoAdvance=null}setAutoAdvanceCallback(e){this.onAutoAdvance=e}startWorkoutTimer(e,t=0){let n=Date.now(),s=this.timers.get(e);s?(s.exerciseStartTime=n,s.exercisePausedTime=0,s.isPaused=!1,s.activeExerciseIndex=t):this.timers.set(e,{workoutId:e,workoutStartTime:n,exerciseStartTime:n,exercisePausedTime:0,isPaused:!1,activeExerciseIndex:t,callbacks:new Set}),this.ensureInterval()}advanceExercise(e,t){let n=this.timers.get(e);n&&(n.exerciseStartTime=Date.now(),n.exercisePausedTime=0,n.isPaused=!1,n.activeExerciseIndex=t)}pauseExercise(e){let t=this.timers.get(e);if(!t||t.isPaused)return;t.isPaused=!0;let n=Date.now();t.exercisePausedTime+=n-t.exerciseStartTime}resumeExercise(e){let t=this.timers.get(e);!t||!t.isPaused||(t.isPaused=!1,t.exerciseStartTime=Date.now())}stopWorkoutTimer(e){this.timers.delete(e),this.timers.size===0&&this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)}subscribe(e,t){let n=this.timers.get(e);if(!n)return()=>{};n.callbacks.add(t);let s=this.getTimerState(e);return s&&t(s),()=>{n.callbacks.delete(t)}}getTimerState(e){let t=this.timers.get(e);if(!t)return null;let n=Date.now(),s=Math.floor((n-t.workoutStartTime)/1e3),i;if(t.isPaused)i=Math.floor(t.exercisePausedTime/1e3);else{let r=n-t.exerciseStartTime;i=Math.floor((t.exercisePausedTime+r)/1e3)}return{workoutElapsed:s,exerciseElapsed:i,isOvertime:!1}}getActiveExerciseIndex(e){var n;let t=this.timers.get(e);return(n=t==null?void 0:t.activeExerciseIndex)!=null?n:0}setActiveExerciseIndex(e,t){let n=this.timers.get(e);n&&n.activeExerciseIndex!==t&&(n.activeExerciseIndex=t,n.exerciseStartTime=Date.now(),n.exercisePausedTime=0,n.isPaused=!1)}isTimerRunning(e){return this.timers.has(e)}isPaused(e){var n;let t=this.timers.get(e);return(n=t==null?void 0:t.isPaused)!=null?n:!1}ensureInterval(){this.intervalId===null&&(this.intervalId=window.setInterval(()=>{this.tick()},1e3))}tick(){for(let[e,t]of this.timers){let n=this.getTimerState(e);if(n)for(let s of t.callbacks)s(n)}}checkAutoAdvance(e,t){if(t===void 0)return;let n=this.getTimerState(e);n&&n.exerciseElapsed>=t&&this.onAutoAdvance&&this.onAutoAdvance(e)}destroy(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timers.clear()}};var Z=require("obsidian"),H=class{constructor(e){this.app=e;this.updateLocks=new Map}async withLock(e,t){let n=this.updateLocks.get(e);n&&await n;let s,i=new Promise(r=>{s=r});this.updateLocks.set(e,i);try{return await t()}finally{s(),this.updateLocks.get(e)===i&&this.updateLocks.delete(e)}}async updateCodeBlock(e,t,n,s){let i=this.app.vault.getAbstractFileByPath(e);if(!(i instanceof Z.TFile)){console.error("File not found:",e);return}if(!t){console.error("No section info available");return}await this.withLock(e,async()=>{await this.app.vault.process(i,r=>{var S;let o=r.split(`
`),l=o[t.lineStart],u=l==null?void 0:l.trim().startsWith("```life-log"),c=l==null?void 0:l.trim().startsWith("```study-log");if(!l||!u&&!c)return console.error("Stale sectionInfo: expected ```life-log or ```study-log at line",t.lineStart),r;if(s){let x=o.slice(t.lineStart+1,t.lineEnd).join(`
`).match(/^title:\s*(.+)$/m),v=(S=x==null?void 0:x[1])==null?void 0:S.trim();if(v&&v!==s)return console.error("Title mismatch: expected",s,"but found",v),r}let d=t.lineStart,p=t.lineEnd,m=o.slice(0,d+1),g=o.slice(p);return[...m,n,...g].join(`
`)})})}async insertLineAfter(e,t,n,s){let i=this.app.vault.getAbstractFileByPath(e);if(!(i instanceof Z.TFile)){console.error("File not found:",e);return}if(!t){console.error("No section info available");return}await this.app.vault.process(i,r=>{let o=r.split(`
`),l=t.lineStart+1+n;return o.splice(l+1,0,s),o.join(`
`)})}};var L=require("obsidian"),P=class{constructor(e,t){this.app=e;this.settings=t}async createLogFile(e,t){let n=new Date,s=this.buildFolderPath(n),i=this.buildFileName(n,e),r=(0,L.normalizePath)(`${s}/${i}`);await this.ensureFolderExists(s);let o=this.app.vault.getAbstractFileByPath(r);return o instanceof L.TFile?this.appendToExistingFile(o,e,t):this.createNewFile(r,e,n,t)}buildFolderPath(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0");return(0,L.normalizePath)(`${this.settings.logFolder}/${t}/${n}`)}buildFileName(e,t){return`${this.formatDate(e)}-${t}.md`}formatDate(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");switch(this.settings.dateFormat){case"YYYY/MM/DD":return`${t}/${n}/${s}`;case"DD-MM-YYYY":return`${s}-${n}-${t}`;default:return`${t}-${n}-${s}`}}async ensureFolderExists(e){if(this.app.vault.getAbstractFileByPath(e)instanceof L.TFolder)return;let n=e.split("/"),s="";for(let i of n)s=s?`${s}/${i}`:i,this.app.vault.getAbstractFileByPath(s)||await this.app.vault.createFolder(s)}async appendToExistingFile(e,t,n){let s=t==="study"?"study-log":"life-log",i=this.buildNewSection(t,n,s);return await this.app.vault.process(e,r=>r+`

---

`+i),e}async createNewFile(e,t,n,s){let i=t==="study"?"study-log":"life-log",r=this.buildFrontmatter(t,n),o=this.buildHeading(t,n),l=this.buildNewSection(t,s,i),u=`${r}

${o}

${l}`;return await this.app.vault.create(e,u)}buildFrontmatter(e,t){let n=this.formatDate(t),s=t.toISOString();return["---",`type: ${e}-log`,`date: ${n}`,`created: ${s}`,"---"].join(`
`)}buildHeading(e,t){let n=this.formatDate(t);return`# ${e==="study"?"\u{1F4DA}":"\u{1F3CB}\uFE0F"} ${n} ${e==="study"?"\uD559\uC2B5":"\uC6B4\uB3D9"} \uAE30\uB85D`}buildNewSection(e,t,n){let i=new Date().getHours();return[`## ${i<12?"\uC624\uC804":i<18?"\uC624\uD6C4":"\uC800\uB141"} ${e==="study"?"\uD559\uC2B5":"\uC6B4\uB3D9"} \uC138\uC158`,"",`\`\`\`${n}`,t,"```"].join(`
`)}formatDateTime(e){let t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0");return`${t}-${n}-${s} ${i}:${r}`}};var _t=["planned","started","completed"];function tt(a){let e={title:"",subject:"",state:"planned"};for(let t of a){let n=t.indexOf(":");if(n===-1)continue;let s=t.substring(0,n).trim().toLowerCase(),i=t.substring(n+1).trim();switch(s){case"title":e.title=i;break;case"subject":e.subject=i;break;case"state":_t.includes(i)&&(e.state=i);break;case"startdate":i&&(e.startDate=i);break;case"enddate":i&&(e.endDate=i);break;case"totalduration":i&&(e.totalDuration=i);break;case"focusscore":let r=parseInt(i);r>=1&&r<=5&&(e.focusScore=r);break;case"comprehensionscore":let o=parseInt(i);o>=1&&o<=5&&(e.comprehensionScore=o);break;case"tags":i&&(e.tags=i.split(",").map(l=>l.trim()).filter(l=>l));break}}return e}function et(a){let e=[];return a.title&&e.push(`title: ${a.title}`),a.subject&&e.push(`subject: ${a.subject}`),e.push(`state: ${a.state}`),a.startDate&&e.push(`startDate: ${a.startDate}`),a.endDate&&e.push(`endDate: ${a.endDate}`),a.totalDuration&&e.push(`totalDuration: ${a.totalDuration}`),a.focusScore&&e.push(`focusScore: ${a.focusScore}`),a.comprehensionScore&&e.push(`comprehensionScore: ${a.comprehensionScore}`),a.tags&&a.tags.length>0&&e.push(`tags: ${a.tags.join(", ")}`),e}var Vt=/^-\s*\[(.)\]\s*(.+)$/,Ut={" ":"pending","\\":"inProgress",x:"completed","-":"skipped"},Gt={pending:" ",inProgress:"\\",completed:"x",skipped:"-"};function nt(a,e){var d,p,m,g,h;let t=a.match(Vt);if(!t)return null;let n=(d=t[1])!=null?d:" ",s=(p=t[2])!=null?p:"",i=(m=Ut[n])!=null?m:"pending",r=s.split("|").map(S=>S.trim()),o=(g=r[0])!=null?g:"",l,u,c;for(let S=1;S<r.length;S++){let f=r[S];if(!f)continue;let x=f.indexOf(":");if(x===-1){c=f;continue}let v=f.substring(0,x).trim().toLowerCase(),E=f.substring(x+1).trim();if(v==="duration"){let ut=E.match(/^\[([^\]]*)\]$/);ut?l=C((h=ut[1])!=null?h:"0"):u=E}else c?c+=" | "+f:c=f}return{state:i,name:o,targetDuration:l,recordedDuration:u,notes:c,lineIndex:e}}function kt(a){return Gt[a]}function st(a){let t=`- [${kt(a.state)}] ${a.name}`;return a.targetDuration!==void 0&&a.state==="pending"?t+=` | Duration: [${Jt(a.targetDuration)}]`:a.recordedDuration&&(t+=` | Duration: ${a.recordedDuration}`),a.notes&&(t+=` | ${a.notes}`),t}function Jt(a){let e=Math.floor(a/60),t=a%60;return e===0?`${t}s`:t===0?`${e}m`:`${e}m ${t}s`}function yt(a){var l;let e=a.split(`
`),t=-1;for(let u=0;u<e.length;u++)if(((l=e[u])==null?void 0:l.trim())==="---"){t=u;break}let n=t>0?e.slice(0,t):[],s=tt(n),i=t>=0?t+1:0,r=e.slice(i),o=[];for(let u=0;u<r.length;u++){let c=r[u];if(!c)continue;let d=nt(c,u);d&&o.push(d)}return{metadata:s,tasks:o,rawLines:e,metadataEndIndex:t>=0?t:-1}}function Et(a){let e=[],t=et(a.metadata);e.push(...t),e.push("---");for(let n of a.tasks)e.push(st(n));return e.join(`
`)}function w(a,e,t){let n=structuredClone(a),s=n.tasks[e];return s?(s.state=t,n):a}function W(a,e,t){let n=structuredClone(a),s=n.tasks[e];return s?(s.recordedDuration=t,s.targetDuration=void 0,n):a}function Tt(a,e,t){let n=structuredClone(a);return n.metadata.focusScore=e,n.metadata.comprehensionScore=t,n}function rt(a,e,t,n){let s=a.createDiv({cls:"study-header"}),i=s.createDiv({cls:"study-header-top"}),r=i.createDiv({cls:"study-title"}),o=Xt(e.subject);r.createSpan({cls:"study-subject-icon",text:o}),r.createSpan({cls:"study-subject-name",text:e.subject||"\uD559\uC2B5"}),e.title&&r.createSpan({cls:"study-title-text",text:` - ${e.title}`});let l=i.createDiv({cls:"study-timer"});Kt(l,e,t,n);let u=s.createDiv({cls:"study-scores"});if(e.state==="completed"&&Qt(u,e.focusScore,e.comprehensionScore),e.tags&&e.tags.length>0){let c=s.createDiv({cls:"study-tags"});for(let d of e.tags)c.createSpan({cls:"study-tag",text:d})}return{titleEl:r,timerEl:l,scoresEl:u}}function Kt(a,e,t,n){e.state==="completed"&&e.totalDuration?(a.createSpan({cls:"study-timer-value",text:e.totalDuration}),a.createSpan({cls:"study-timer-indicator recorded",text:" \u2713"})):n&&t?(a.createSpan({cls:"study-timer-value",text:k(t.workoutElapsed)}),a.createSpan({cls:"study-timer-indicator count-up",text:" \u25B2"})):a.createSpan({cls:"study-timer-value",text:"--:--"})}function Qt(a,e,t){if(e){let n=a.createDiv({cls:"study-score-item"});n.createSpan({cls:"study-score-label",text:"\uC9D1\uC911\uB3C4: "}),Lt(n,e)}if(t){let n=a.createDiv({cls:"study-score-item"});n.createSpan({cls:"study-score-label",text:"\uC774\uD574\uB3C4: "}),Lt(n,t)}}function Lt(a,e){let t=a.createSpan({cls:`study-stars score-${e}`});for(let n=1;n<=5;n++)t.createSpan({cls:`study-star ${n<=e?"filled":"empty"}`,text:n<=e?"\u2605":"\u2606"})}function Xt(a){return{\uC218\uD559:"\u{1F4D0}",\uC601\uC5B4:"\u{1F524}",\uD504\uB85C\uADF8\uB798\uBC0D:"\u{1F4BB}",\uB3C5\uC11C:"\u{1F4D6}",\uAE30\uD0C0:"\u{1F4DD}"}[a]||"\u{1F4DA}"}function it(a,e){a.empty(),a.createSpan({cls:"study-timer-value",text:k(e.workoutElapsed)}),a.createSpan({cls:"study-timer-indicator count-up",text:" \u25B2"})}function at(a,e,t,n,s,i,r){let o=a.createDiv({cls:`study-task state-${e.state} ${n?"active":""}`}),l=o.createDiv({cls:"study-task-main"}),u=l.createSpan({cls:"study-task-icon"});u.textContent=te(e.state);let c=l.createSpan({cls:"study-task-name"});c.textContent=e.name;let d=null;if(e.notes){let p=l.createSpan({cls:"study-task-notes"});p.textContent=e.notes}if(d=l.createSpan({cls:"study-task-timer"}),e.state==="completed"&&e.recordedDuration)d.textContent=e.recordedDuration,d.createSpan({cls:"timer-indicator recorded",text:" \u2713"});else if(n&&s)F(d,s,e.targetDuration);else if(e.targetDuration){let p=Math.floor(e.targetDuration/60),m=e.targetDuration%60;d.textContent=`[${p}m ${m>0?m+"s":""}]`,d.classList.add("target")}return n&&r==="started"&&Zt(o,t,i),{taskEl:o,timerEl:d}}function Zt(a,e,t){let n=a.createDiv({cls:"study-task-controls"});n.createEl("button",{cls:"study-btn",text:"\u2713 \uC644\uB8CC"}).addEventListener("click",()=>t.onTaskFinish(e)),n.createEl("button",{cls:"study-btn",text:"\u23ED \uAC74\uB108\uB6F0\uAE30"}).addEventListener("click",()=>t.onTaskSkip(e))}function te(a){switch(a){case"completed":return"\u2713";case"inProgress":return"\u25B6";case"skipped":return"\u2013";default:return"\u25CB"}}function F(a,e,t){if(a.empty(),a.classList.remove("overtime"),t!==void 0){let n=t-e.exerciseElapsed;n<0?(a.classList.add("overtime"),a.textContent=`+${k(Math.abs(n))}`,a.createSpan({cls:"timer-indicator overtime",text:" !"})):(a.textContent=k(n),a.createSpan({cls:"timer-indicator count-down",text:" \u25BC"}))}else a.textContent=k(e.exerciseElapsed),a.createSpan({cls:"timer-indicator count-up",text:" \u25B2"})}function ot(a,e,t,n){let s=a.createDiv({cls:"study-controls"});if(e==="planned"){let i=s.createEl("button",{cls:"study-btn study-btn-primary study-btn-large"});i.createSpan({cls:"study-btn-icon",text:"\u25B6"}),i.createSpan({text:"\uD559\uC2B5 \uC2DC\uC791"}),i.addEventListener("click",()=>t.onStartStudy())}else if(e==="started"){let i=s.createEl("button",{cls:"study-btn study-btn-primary"});i.createSpan({cls:"study-btn-icon",text:"\u2713"}),i.createSpan({text:"\uD559\uC2B5 \uC644\uB8CC"}),i.addEventListener("click",()=>t.onOpenSelfEval())}else if(e==="completed"){let i=s.createSpan({cls:"study-completed-label"});i.createSpan({cls:"study-btn-icon",text:"\u2713"}),i.createSpan({text:"\uC644\uB8CC\uB428"});let r=s.createEl("button",{cls:"study-btn"});r.createSpan({cls:"study-btn-icon",text:"\u{1F4CB}"}),r.createSpan({text:"\uD15C\uD50C\uB9BF \uBCF5\uC0AC"}),r.addEventListener("click",async()=>{let o=ee(n);await navigator.clipboard.writeText("```study-log\n"+o+"\n```");let l=r.querySelector("span:last-child");if(l){let u=l.textContent;l.textContent="Copied!",setTimeout(()=>{l.textContent=u},1500)}})}return s}function ee(a){let e=[];a.metadata.subject&&e.push(`subject: ${a.metadata.subject}`),e.push("state: planned"),e.push("---");let t=new Set;for(let n of a.tasks)if(!t.has(n.name)){t.add(n.name);let s=`- [ ] ${n.name}`;if(n.targetDuration){let i=Math.floor(n.targetDuration/60),r=n.targetDuration%60;s+=` | Duration: [${i}m${r>0?" "+r+"s":""}]`}e.push(s)}return e.join(`
`)}var wt=0,ne=3e3;function Dt(a,e){let t=Date.now();t-wt<ne||(wt=t,a.enableSound&&se(),a.enableNotification&&re(e))}function se(){try{let a=new(window.AudioContext||window.webkitAudioContext),e=a.createOscillator(),t=a.createGain();e.connect(t),t.connect(a.destination),e.frequency.value=800,e.type="sine",t.gain.setValueAtTime(.3,a.currentTime),t.gain.exponentialRampToValueAtTime(.01,a.currentTime+.5),e.start(a.currentTime),e.stop(a.currentTime+.5),setTimeout(()=>{let n=a.createOscillator(),s=a.createGain();n.connect(s),s.connect(a.destination),n.frequency.value=1e3,n.type="sine",s.gain.setValueAtTime(.3,a.currentTime),s.gain.exponentialRampToValueAtTime(.01,a.currentTime+.5),n.start(a.currentTime),n.stop(a.currentTime+.5)},200)}catch(a){console.warn("[Life Log] Could not play notification sound:",a)}}function re(a){"Notification"in window&&(Notification.permission==="granted"?new Notification("Life Log",{body:a?`"${a}" \uC2DC\uAC04\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!`:"\uD0C0\uC774\uBA38\uAC00 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!",icon:void 0,silent:!0}):Notification.permission!=="denied"&&Notification.requestPermission())}function Ct(a){let{el:e,parsed:t,callbacks:n,studyId:s,timerManager:i,enableTimerSound:r=!0,enableNotification:o=!1}=a;e.empty();let l=e.createDiv({cls:`study-container state-${t.metadata.state}`}),u=i.isTimerRunning(s),c=i.getTimerState(s),d=u?i.getActiveExerciseIndex(s):-1,p=rt(l,t.metadata,c,u);if(t.tasks.length===0&&t.metadata.state==="planned"){ie(l);return}let m=[],g=l.createDiv({cls:"study-tasks"});for(let h=0;h<t.tasks.length;h++){let S=t.tasks[h];if(!S)continue;let f=h===d,x=at(g,S,h,f,f?c:null,n,t.metadata.state);m.push(x)}if(ot(l,t.metadata.state,n,t),l.addEventListener("focusout",h=>{let S=h.relatedTarget;(!S||!l.contains(S))&&n.onFlushChanges()}),u){let h=d,S=!1;i.subscribe(s,f=>{it(p.timerEl,f);let x=i.getActiveExerciseIndex(s);if(x!==h)return;let v=m[x],E=t.tasks[x];v!=null&&v.timerEl&&E&&(F(v.timerEl,f,E.targetDuration),!S&&E.targetDuration!==void 0&&f.exerciseElapsed>=E.targetDuration&&(S=!0,Dt({enableSound:r,enableNotification:o},E.name),n.onTaskFinish(x)))})}}function ie(a){a.createDiv({cls:"study-empty-state"}).createDiv({cls:"study-empty-message",text:"\uD559\uC2B5 \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uCF54\uB4DC\uBE14\uB85D\uC5D0 \uD56D\uBAA9\uC744 \uCD94\uAC00\uD574\uC8FC\uC138\uC694."})}var y=require("obsidian"),ct=[{name:"\uC218\uD559",icon:"",color:"#4A90D9"},{name:"\uC601\uC5B4",icon:"",color:"#7B68EE"},{name:"\uD504\uB85C\uADF8\uB798\uBC0D",icon:"",color:"#50C878"},{name:"\uB3C5\uC11C",icon:"",color:"#FFB347"},{name:"\uAE30\uD0C0",icon:"",color:"#A0A0A0"}],lt={logFolder:"Life Logs",dateFormat:"YYYY-MM-DD",subjects:ct,defaultStudyDuration:30,enablePomodoro:!1,pomodoroWork:25,pomodoroBreak:5,defaultRestDuration:60,defaultTab:"study",showRibbonIcon:!0,enableTimerSound:!0,enableNotifications:!1},R=class extends y.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,console.log("[Life Log] LifeLogSettingTab constructed")}display(){console.log("[Life Log] LifeLogSettingTab.display() called");let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"Life Log \uC124\uC815"}),!this.plugin.settings){e.createEl("p",{text:"\uC124\uC815\uC744 \uBD88\uB7EC\uC624\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."});return}this.renderSaveSettings(e),this.renderStudySettings(e),this.renderWorkoutSettings(e),this.renderUISettings(e),this.renderNotificationSettings(e)}renderSaveSettings(e){e.createEl("h3",{text:"\u{1F4C1} \uC800\uC7A5 \uC124\uC815"}),new y.Setting(e).setName("\uAE30\uB85D \uC800\uC7A5 \uD3F4\uB354").setDesc("\uD559\uC2B5/\uC6B4\uB3D9 \uAE30\uB85D\uC774 \uC800\uC7A5\uB420 \uD3F4\uB354 \uACBD\uB85C").addText(t=>t.setPlaceholder("Life Logs").setValue(this.plugin.settings.logFolder).onChange(async n=>{this.plugin.settings.logFolder=n||"Life Logs",await this.plugin.saveSettings()})),new y.Setting(e).setName("\uB0A0\uC9DC \uD615\uC2DD").setDesc("\uD30C\uC77C\uBA85\uC5D0 \uC0AC\uC6A9\uB420 \uB0A0\uC9DC \uD615\uC2DD").addDropdown(t=>t.addOption("YYYY-MM-DD","YYYY-MM-DD").addOption("YYYY/MM/DD","YYYY/MM/DD").addOption("DD-MM-YYYY","DD-MM-YYYY").setValue(this.plugin.settings.dateFormat).onChange(async n=>{this.plugin.settings.dateFormat=n,await this.plugin.saveSettings()}))}renderStudySettings(e){e.createEl("h3",{text:"\u{1F4DA} \uD559\uC2B5 \uAE30\uB85D \uC124\uC815"}),new y.Setting(e).setName("\uAE30\uBCF8 \uBAA9\uD45C \uC2DC\uAC04").setDesc("\uD559\uC2B5 \uD56D\uBAA9\uC758 \uAE30\uBCF8 \uBAA9\uD45C \uC2DC\uAC04 (\uBD84)").addText(t=>t.setPlaceholder("30").setValue(String(this.plugin.settings.defaultStudyDuration)).onChange(async n=>{let s=parseInt(n)||30;this.plugin.settings.defaultStudyDuration=Math.max(1,Math.min(480,s)),await this.plugin.saveSettings()})),new y.Setting(e).setName("\uD3EC\uBAA8\uB3C4\uB85C \uBAA8\uB4DC").setDesc("25\uBD84 \uD559\uC2B5 + 5\uBD84 \uD734\uC2DD \uC0AC\uC774\uD074 \uD65C\uC131\uD654").addToggle(t=>t.setValue(this.plugin.settings.enablePomodoro).onChange(async n=>{this.plugin.settings.enablePomodoro=n,await this.plugin.saveSettings()})),this.plugin.settings.enablePomodoro&&(new y.Setting(e).setName("\uC791\uC5C5 \uC2DC\uAC04").setDesc("\uD3EC\uBAA8\uB3C4\uB85C \uC791\uC5C5 \uC2DC\uAC04 (\uBD84)").addText(t=>t.setPlaceholder("25").setValue(String(this.plugin.settings.pomodoroWork)).onChange(async n=>{let s=parseInt(n)||25;this.plugin.settings.pomodoroWork=Math.max(1,Math.min(60,s)),await this.plugin.saveSettings()})),new y.Setting(e).setName("\uD734\uC2DD \uC2DC\uAC04").setDesc("\uD3EC\uBAA8\uB3C4\uB85C \uD734\uC2DD \uC2DC\uAC04 (\uBD84)").addText(t=>t.setPlaceholder("5").setValue(String(this.plugin.settings.pomodoroBreak)).onChange(async n=>{let s=parseInt(n)||5;this.plugin.settings.pomodoroBreak=Math.max(1,Math.min(30,s)),await this.plugin.saveSettings()}))),this.renderSubjectManager(e)}renderSubjectManager(e){let t=e.createDiv({cls:"subject-manager"});new y.Setting(t).setName("\uACFC\uBAA9 \uAD00\uB9AC").setDesc("\uC790\uC8FC \uC0AC\uC6A9\uD558\uB294 \uACFC\uBAA9\uC744 \uAD00\uB9AC\uD569\uB2C8\uB2E4").addButton(s=>s.setButtonText("+ \uACFC\uBAA9 \uCD94\uAC00").onClick(async()=>{this.plugin.settings.subjects.push({name:"\uC0C8 \uACFC\uBAA9",icon:"\u{1F4DA}",color:"#808080"}),await this.plugin.saveSettings(),this.display()}));let n=t.createDiv({cls:"subject-list"});for(let s=0;s<this.plugin.settings.subjects.length;s++){let i=this.plugin.settings.subjects[s];if(!i)continue;let r=n.createDiv({cls:"subject-row"}),o=r.createEl("input",{type:"text",value:i.icon,cls:"subject-icon-input"});o.maxLength=2,o.addEventListener("change",async()=>{i.icon=o.value||"\u{1F4DA}",await this.plugin.saveSettings()});let l=r.createEl("input",{type:"text",value:i.name,cls:"subject-name-input"});l.addEventListener("change",async()=>{i.name=l.value||"\uACFC\uBAA9",await this.plugin.saveSettings()});let u=r.createEl("input",{type:"color",value:i.color,cls:"subject-color-input"});u.addEventListener("change",async()=>{i.color=u.value,await this.plugin.saveSettings()}),r.createEl("button",{text:"\u{1F5D1}",cls:"subject-delete-btn"}).addEventListener("click",async()=>{this.plugin.settings.subjects.splice(s,1),await this.plugin.saveSettings(),this.display()})}}renderWorkoutSettings(e){e.createEl("h3",{text:"\u{1F3CB}\uFE0F \uC6B4\uB3D9 \uAE30\uB85D \uC124\uC815"}),new y.Setting(e).setName("\uAE30\uBCF8 \uD734\uC2DD \uC2DC\uAC04").setDesc("\uC6B4\uB3D9 \uC138\uD2B8 \uC0AC\uC774 \uAE30\uBCF8 \uD734\uC2DD \uC2DC\uAC04 (\uCD08)").addText(t=>t.setPlaceholder("60").setValue(String(this.plugin.settings.defaultRestDuration)).onChange(async n=>{let s=parseInt(n)||60;this.plugin.settings.defaultRestDuration=Math.max(10,Math.min(300,s)),await this.plugin.saveSettings()}))}renderUISettings(e){e.createEl("h3",{text:"\u{1F3A8} UI \uC124\uC815"}),new y.Setting(e).setName("\uAE30\uBCF8 \uD0ED").setDesc("\uC0C8 \uAE30\uB85D \uBAA8\uB2EC\uC744 \uC5F4 \uB54C \uAE30\uBCF8\uC73C\uB85C \uC120\uD0DD\uB418\uB294 \uD0ED").addDropdown(t=>t.addOption("study","\uD559\uC2B5 \uAE30\uB85D").addOption("workout","\uC6B4\uB3D9 \uAE30\uB85D").setValue(this.plugin.settings.defaultTab).onChange(async n=>{this.plugin.settings.defaultTab=n,await this.plugin.saveSettings()})),new y.Setting(e).setName("\uB9AC\uBCF8 \uC544\uC774\uCF58").setDesc("\uC67C\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uBE60\uB978 \uC811\uADFC \uC544\uC774\uCF58 \uD45C\uC2DC").addToggle(t=>t.setValue(this.plugin.settings.showRibbonIcon).onChange(async n=>{this.plugin.settings.showRibbonIcon=n,await this.plugin.saveSettings(),this.plugin.updateRibbonIcon()}))}renderNotificationSettings(e){e.createEl("h3",{text:"\u{1F514} \uC54C\uB9BC \uC124\uC815"}),new y.Setting(e).setName("\uD0C0\uC774\uBA38 \uC644\uB8CC\uC74C").setDesc("\uCE74\uC6B4\uD2B8\uB2E4\uC6B4 \uC644\uB8CC \uC2DC \uC54C\uB9BC\uC74C \uC7AC\uC0DD").addToggle(t=>t.setValue(this.plugin.settings.enableTimerSound).onChange(async n=>{this.plugin.settings.enableTimerSound=n,await this.plugin.saveSettings()})),new y.Setting(e).setName("\uC2DC\uC2A4\uD15C \uC54C\uB9BC").setDesc("\uD0C0\uC774\uBA38 \uC644\uB8CC \uC2DC \uC2DC\uC2A4\uD15C \uC54C\uB9BC \uD45C\uC2DC").addToggle(t=>t.setValue(this.plugin.settings.enableNotifications).onChange(async n=>{this.plugin.settings.enableNotifications=n,await this.plugin.saveSettings()}))}};var Mt=require("obsidian");var j=class{constructor(e,t){this.selectedSubject=null;this.taskInputs=[];this.container=e,this.ctx=t}render(){this.container.empty(),this.container.addClass("study-log-tab"),this.renderSubjectSelector(),this.renderTaskInput(),this.renderCreateButton()}renderSubjectSelector(){var s;let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uACFC\uBAA9 \uC120\uD0DD",cls:"tab-label"});let t=e.createDiv({cls:"subject-grid"});for(let i of this.ctx.settings.subjects){let r=t.createEl("button",{cls:`subject-btn ${((s=this.selectedSubject)==null?void 0:s.name)===i.name?"selected":""}`});r.style.setProperty("--subject-color",i.color),r.createSpan({text:i.name,cls:"subject-name"}),r.addEventListener("click",()=>{this.selectedSubject=i,t.querySelectorAll(".subject-btn").forEach(o=>{o.classList.remove("selected")}),r.classList.add("selected")})}let n=t.createEl("button",{cls:"subject-btn subject-btn-add"});n.createSpan({text:"+"}),n.createSpan({text:"\uC9C1\uC811 \uC785\uB825"}),n.addEventListener("click",()=>{this.showCustomSubjectInput(e)})}showCustomSubjectInput(e){if(e.querySelector(".custom-subject-input"))return;let n=e.createDiv({cls:"custom-subject-input"}),s=n.createEl("input",{type:"text",placeholder:"\uACFC\uBAA9\uBA85 \uC785\uB825..."});s.focus(),s.addEventListener("keydown",i=>{i.key==="Enter"&&s.value.trim()?(this.selectedSubject={name:s.value.trim(),icon:"",color:"#808080"},n.remove(),this.render()):i.key==="Escape"&&n.remove()})}renderTaskInput(){let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uD559\uC2B5 \uD56D\uBAA9",cls:"tab-label"});let t=e.createDiv({cls:"task-input-list"});this.addTaskInputRow(t),e.createEl("button",{cls:"add-task-btn",text:"+ \uD56D\uBAA9 \uCD94\uAC00"}).addEventListener("click",()=>{this.addTaskInputRow(t)})}addTaskInputRow(e){let t=e.createDiv({cls:"task-input-row"}),n=t.createEl("input",{type:"text",placeholder:"\uD559\uC2B5 \uD56D\uBAA9 (\uC608: Chapter 3 \uBCF5\uC2B5)",cls:"task-name-input"});this.taskInputs.push(n);let s=t.createEl("input",{type:"text",placeholder:"\uBAA9\uD45C \uC2DC\uAC04 (\uC608: 30m)",cls:"task-duration-input"});s.value=`${this.ctx.settings.defaultStudyDuration}m`,t.createEl("button",{cls:"task-remove-btn",text:"\xD7"}).addEventListener("click",()=>{let r=this.taskInputs.indexOf(n);r>-1&&this.taskInputs.splice(r,1),t.remove()}),n.focus()}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uD559\uC2B5 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createStudyLog())}async createStudyLog(){if(!this.selectedSubject)return;let e=this.collectTasks();if(e.length===0)return;let t=this.buildCodeBlockContent(e),n=await this.ctx.fileCreator.createLogFile("study",t);this.ctx.onCreated(n)}collectTasks(){let e=[];return this.container.querySelectorAll(".task-input-row").forEach(n=>{let s=n.querySelector(".task-name-input"),i=n.querySelector(".task-duration-input");s!=null&&s.value.trim()&&e.push({name:s.value.trim(),duration:(i==null?void 0:i.value.trim())||`${this.ctx.settings.defaultStudyDuration}m`})}),e}buildCodeBlockContent(e){var r;let t=[],s=new Date().getHours(),i=s<12?"\uC624\uC804":s<18?"\uC624\uD6C4":"\uC800\uB141";t.push(`title: ${i} \uD559\uC2B5`),t.push(`subject: ${((r=this.selectedSubject)==null?void 0:r.name)||"\uAE30\uD0C0"}`),t.push("state: planned"),t.push("---");for(let o of e)t.push(`- [ ] ${o.name} | Duration: [${o.duration}]`);return t.join(`
`)}};var B=class{constructor(e,t){this.exerciseInputs=[];this.container=e,this.ctx=t}render(){this.container.empty(),this.container.addClass("workout-log-tab"),this.renderTitleInput(),this.renderExerciseInput(),this.renderQuickTemplates(),this.renderCreateButton()}renderTitleInput(){let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uC6B4\uB3D9 \uC774\uB984",cls:"tab-label"});let t=e.createEl("input",{type:"text",placeholder:"\uC608: \uC544\uCE68 \uC6B4\uB3D9, \uC0C1\uCCB4 \uC6B4\uB3D9",cls:"workout-title-input"}),s=new Date().getHours(),i=s<12?"\uC544\uCE68":s<18?"\uC624\uD6C4":"\uC800\uB141";t.value=`${i} \uC6B4\uB3D9`}renderExerciseInput(){let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uC6B4\uB3D9 \uD56D\uBAA9",cls:"tab-label"});let t=e.createDiv({cls:"exercise-input-list"});this.addExerciseInputRow(t),e.createEl("button",{cls:"add-exercise-btn",text:"+ \uC6B4\uB3D9 \uCD94\uAC00"}).addEventListener("click",()=>{this.addExerciseInputRow(t)})}addExerciseInputRow(e){let t=e.createDiv({cls:"exercise-input-row"}),n=t.createEl("input",{type:"text",placeholder:"\uC6B4\uB3D9\uBA85 (\uC608: \uC2A4\uCFFC\uD2B8)",cls:"exercise-name-input"}),s=t.createEl("input",{type:"text",placeholder:"\uD30C\uB77C\uBBF8\uD130 (\uC608: Weight: [60] kg | Reps: [10])",cls:"exercise-params-input"});t.createEl("button",{cls:"exercise-remove-btn",text:"\xD7"}).addEventListener("click",()=>{t.remove()}),n.focus()}renderQuickTemplates(){let e=this.container.createDiv({cls:"tab-section"});e.createEl("label",{text:"\uBE60\uB978 \uD15C\uD50C\uB9BF",cls:"tab-label"});let t=e.createDiv({cls:"template-grid"}),n=[{name:"\uC0C1\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uD478\uC2DC\uC5C5",params:"Reps: [15]"},{name:"\uB364\uBCA8 \uB85C\uC6B0",params:"Weight: [10] kg | Reps: [12]"},{name:"\uC204\uB354 \uD504\uB808\uC2A4",params:"Weight: [8] kg | Reps: [10]"}]},{name:"\uD558\uCCB4 \uC6B4\uB3D9",exercises:[{name:"\uC2A4\uCFFC\uD2B8",params:"Weight: [40] kg | Reps: [12]"},{name:"\uB7F0\uC9C0",params:"Reps: [10] /leg"},{name:"\uCE74\uD504\uB808\uC774\uC988",params:"Reps: [20]"}]},{name:"HIIT",exercises:[{name:"\uBC84\uD53C",params:"Duration: [30s]"},{name:"\uC810\uD551\uC7AD",params:"Duration: [30s]"},{name:"\uB9C8\uC6B4\uD2F4 \uD074\uB77C\uC774\uBA38",params:"Duration: [30s]"}]}];for(let s of n){let i=t.createEl("button",{cls:"template-btn"});i.createSpan({text:s.name}),i.addEventListener("click",()=>{this.applyTemplate(s)})}}applyTemplate(e){let t=this.container.querySelector(".workout-title-input");t&&(t.value=e.name);let n=this.container.querySelector(".exercise-input-list");if(n){n.empty();for(let s of e.exercises)this.addExerciseInputRowWithData(n,s)}}addExerciseInputRowWithData(e,t){let n=e.createDiv({cls:"exercise-input-row"}),s=n.createEl("input",{type:"text",placeholder:"\uC6B4\uB3D9\uBA85",cls:"exercise-name-input"});s.value=t.name;let i=n.createEl("input",{type:"text",placeholder:"\uD30C\uB77C\uBBF8\uD130",cls:"exercise-params-input"});i.value=t.params,n.createEl("button",{cls:"exercise-remove-btn",text:"\xD7"}).addEventListener("click",()=>{n.remove()})}renderCreateButton(){this.container.createDiv({cls:"tab-section tab-actions"}).createEl("button",{cls:"create-btn primary",text:"\uC6B4\uB3D9 \uAE30\uB85D \uC0DD\uC131"}).addEventListener("click",()=>this.createWorkoutLog())}async createWorkoutLog(){let e=this.collectExercises();if(e.length===0)return;let t=this.container.querySelector(".workout-title-input"),n=(t==null?void 0:t.value.trim())||"\uC6B4\uB3D9",s=this.buildCodeBlockContent(n,e),i=await this.ctx.fileCreator.createLogFile("workout",s);this.ctx.onCreated(i)}collectExercises(){let e=[];return this.container.querySelectorAll(".exercise-input-row").forEach(n=>{let s=n.querySelector(".exercise-name-input"),i=n.querySelector(".exercise-params-input");s!=null&&s.value.trim()&&e.push({name:s.value.trim(),params:(i==null?void 0:i.value.trim())||""})}),e}buildCodeBlockContent(e,t){let n=[];n.push(`title: ${e}`),n.push("state: planned"),n.push("startDate:"),n.push("duration:"),n.push(`restDuration: ${this.ctx.settings.defaultRestDuration}s`),n.push("---");for(let s of t)s.params?n.push(`- [ ] ${s.name} | ${s.params}`):n.push(`- [ ] ${s.name}`);return n.join(`
`)}};var D=class extends Mt.Modal{constructor(t,n,s){super(t);this.tabContentEl=null;this.settings=n,this.fileCreator=s,this.activeTab=n.defaultTab}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("quick-log-modal"),this.renderHeader(t),this.renderTabs(t),this.renderTabContent(t)}renderHeader(t){t.createDiv({cls:"modal-header"}).createEl("h2",{text:"Life Log"})}renderTabs(t){let n=t.createDiv({cls:"modal-tabs"});n.createEl("button",{cls:`modal-tab ${this.activeTab==="study"?"active":""}`,text:"\uD559\uC2B5 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="study",this.updateActiveTab(n),this.renderTabContent(t)}),n.createEl("button",{cls:`modal-tab ${this.activeTab==="workout"?"active":""}`,text:"\uC6B4\uB3D9 \uAE30\uB85D"}).addEventListener("click",()=>{this.activeTab="workout",this.updateActiveTab(n),this.renderTabContent(t)})}updateActiveTab(t){t.querySelectorAll(".modal-tab").forEach((n,s)=>{s===0&&this.activeTab==="study"||s===1&&this.activeTab==="workout"?n.classList.add("active"):n.classList.remove("active")})}renderTabContent(t){this.tabContentEl&&this.tabContentEl.remove(),this.tabContentEl=t.createDiv({cls:"modal-tab-content"});let n=s=>{this.close(),this.app.workspace.getLeaf().openFile(s)};this.activeTab==="study"?new j(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:n}).render():new B(this.tabContentEl,{app:this.app,settings:this.settings,fileCreator:this.fileCreator,onCreated:n}).render()}onClose(){let{contentEl:t}=this;t.empty()}};var Pt=require("obsidian"),N=class extends Pt.Modal{constructor(t,n){super(t);this.focusScore=4;this.comprehensionScore=4;this.notes="";this.onSubmit=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("self-eval-modal"),t.createEl("h2",{text:"\u{1F389} \uD559\uC2B5 \uC644\uB8CC! \uC790\uAC00\uD3C9\uAC00\uB97C \uD574\uC8FC\uC138\uC694"}),this.renderFocusScore(t),this.renderComprehensionScore(t),this.renderNotesInput(t),this.renderButtons(t)}renderFocusScore(t){let n=t.createDiv({cls:"eval-section"});n.createEl("label",{text:"\uC9D1\uC911\uB3C4",cls:"eval-label"});let s=n.createDiv({cls:"eval-stars"});this.renderStarPicker(s,this.focusScore,i=>{this.focusScore=i})}renderComprehensionScore(t){let n=t.createDiv({cls:"eval-section"});n.createEl("label",{text:"\uC774\uD574\uB3C4",cls:"eval-label"});let s=n.createDiv({cls:"eval-stars"});this.renderStarPicker(s,this.comprehensionScore,i=>{this.comprehensionScore=i})}renderStarPicker(t,n,s){for(let i=1;i<=5;i++){let r=t.createSpan({cls:`eval-star ${i<=n?"filled":""}`,text:i<=n?"\u2605":"\u2606"});r.addEventListener("click",()=>{s(i),t.querySelectorAll(".eval-star").forEach((o,l)=>{let u=o;l<i?(u.textContent="\u2605",u.classList.add("filled")):(u.textContent="\u2606",u.classList.remove("filled"))})}),r.addEventListener("mouseenter",()=>{t.querySelectorAll(".eval-star").forEach((o,l)=>{let u=o;l<i&&u.classList.add("hover")})}),r.addEventListener("mouseleave",()=>{t.querySelectorAll(".eval-star").forEach(o=>{o.classList.remove("hover")})})}}renderNotesInput(t){let n=t.createDiv({cls:"eval-section"});n.createEl("label",{text:"\uBA54\uBAA8 (\uC120\uD0DD)",cls:"eval-label"});let s=n.createEl("textarea",{cls:"eval-notes-input",placeholder:"\uC624\uB298 \uD559\uC2B5\uC5D0 \uB300\uD55C \uC9E7\uC740 \uBA54\uBAA8..."});s.rows=3,s.addEventListener("input",()=>{this.notes=s.value})}renderButtons(t){let n=t.createDiv({cls:"eval-buttons"});n.createEl("button",{cls:"eval-btn eval-btn-secondary",text:"\uCDE8\uC18C"}).addEventListener("click",()=>this.close()),n.createEl("button",{cls:"eval-btn eval-btn-primary",text:"\uC800\uC7A5\uD558\uACE0 \uC885\uB8CC"}).addEventListener("click",()=>{this.onSubmit({focusScore:this.focusScore,comprehensionScore:this.comprehensionScore,notes:this.notes||void 0}),this.close()})}onClose(){let{contentEl:t}=this;t.empty()}};var ae='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/><circle cx="12" cy="12" r="3"/></svg>',Y=class extends O.Plugin{constructor(){super(...arguments);this.timerManager=new A;this.fileUpdater=null;this.fileCreator=null;this.ribbonIconEl=null;this.settings=lt}async onload(){await this.loadSettings(),this.fileUpdater=new H(this.app),this.fileCreator=new P(this.app,this.settings),(0,O.addIcon)("life-log",ae),this.registerMarkdownCodeBlockProcessor("life-log",(t,n,s)=>{this.processWorkoutBlock(t,n,s)}),this.registerMarkdownCodeBlockProcessor("study-log",(t,n,s)=>{this.processStudyBlock(t,n,s)}),this.addCommand({id:"open-quick-log",name:"\uC0C8 \uAE30\uB85D",hotkeys:[{modifiers:["Mod","Shift"],key:"l"}],callback:()=>{this.fileCreator&&new D(this.app,this.settings,this.fileCreator).open()}}),this.addCommand({id:"open-study-log",name:"\uC0C8 \uD559\uC2B5 \uAE30\uB85D",callback:()=>{this.fileCreator&&new D(this.app,{...this.settings,defaultTab:"study"},this.fileCreator).open()}}),this.addCommand({id:"open-workout-log",name:"\uC0C8 \uC6B4\uB3D9 \uAE30\uB85D",callback:()=>{this.fileCreator&&new D(this.app,{...this.settings,defaultTab:"workout"},this.fileCreator).open()}}),console.log("[Life Log] Registering settings tab..."),this.addSettingTab(new R(this.app,this)),console.log("[Life Log] Settings tab registered"),this.updateRibbonIcon()}onunload(){this.timerManager.destroy()}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},lt,t),(!this.settings.subjects||this.settings.subjects.length===0)&&(this.settings.subjects=[...ct])}async saveSettings(){await this.saveData(this.settings),this.fileCreator&&(this.fileCreator=new P(this.app,this.settings))}updateRibbonIcon(){this.ribbonIconEl&&(this.ribbonIconEl.remove(),this.ribbonIconEl=null),this.settings.showRibbonIcon&&(this.ribbonIconEl=this.addRibbonIcon("life-log","Life Log: \uC0C8 \uAE30\uB85D",()=>{this.fileCreator&&new D(this.app,this.settings,this.fileCreator).open()}))}processWorkoutBlock(t,n,s){var c;let i=pt(t),r=s.getSectionInfo(n),o=`${s.sourcePath}:${(c=r==null?void 0:r.lineStart)!=null?c:0}`,l=this.timerManager.isTimerRunning(o);if(l&&i.metadata.state!=="started")this.timerManager.stopWorkoutTimer(o);else if(l&&i.metadata.state==="started"){let d=i.exercises.findIndex(m=>m.state==="inProgress"),p=this.timerManager.getActiveExerciseIndex(o);d>=0&&d!==p&&this.timerManager.setActiveExerciseIndex(o,d)}let u=this.createWorkoutCallbacks(s,r,i,o);bt({el:n,parsed:i,callbacks:u,workoutId:o,timerManager:this.timerManager})}processStudyBlock(t,n,s){var c;let i=yt(t),r=s.getSectionInfo(n),o=`study:${s.sourcePath}:${(c=r==null?void 0:r.lineStart)!=null?c:0}`,l=this.timerManager.isTimerRunning(o);if(l&&i.metadata.state!=="started")this.timerManager.stopWorkoutTimer(o);else if(l&&i.metadata.state==="started"){let d=i.tasks.findIndex(m=>m.state==="inProgress"),p=this.timerManager.getActiveExerciseIndex(o);d>=0&&d!==p&&this.timerManager.setActiveExerciseIndex(o,d)}let u=this.createStudyCallbacks(s,r,i,o);Ct({el:n,parsed:i,callbacks:u,studyId:o,timerManager:this.timerManager,enableTimerSound:this.settings.enableTimerSound,enableNotification:this.settings.enableNotifications})}createWorkoutCallbacks(t,n,s,i){let r=s,o=!1,l=async c=>{var m;r=c,o=!1;let d=G(c),p=r.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(t.sourcePath,n,d,p))};return{onStartWorkout:async()=>{o=!1,r.metadata.state="started",r.metadata.startDate=this.formatStartDate(new Date);let c=r.exercises.findIndex(d=>d.state==="pending");if(c>=0){let d=r.exercises[c];d&&(d.state="inProgress")}await l(r),this.timerManager.startWorkoutTimer(i,c>=0?c:0)},onFinishWorkout:async()=>{let c=this.timerManager.getTimerState(i);c&&(r.metadata.duration=b(c.workoutElapsed)),r.metadata.state="completed",r=$(r),await l(r),this.timerManager.stopWorkoutTimer(i)},onExerciseFinish:async c=>{if(o=!1,!r.exercises[c])return;let p=this.timerManager.getTimerState(i);p&&(r=M(r,c,b(p.exerciseElapsed))),r=T(r,c,"completed");let m=r.exercises.findIndex((g,h)=>h>c&&g.state==="pending");if(m>=0)r=T(r,m,"inProgress"),this.timerManager.advanceExercise(i,m),await l(r);else{r.metadata.state="completed";let g=this.timerManager.getTimerState(i);g&&(r.metadata.duration=b(g.workoutElapsed)),r=$(r),await l(r),this.timerManager.stopWorkoutTimer(i)}},onExerciseAddSet:async c=>{if(o=!1,!r.exercises[c])return;let p=this.timerManager.getTimerState(i);p&&(r=M(r,c,b(p.exerciseElapsed))),r=T(r,c,"completed"),r=ft(r,c),r=T(r,c+1,"inProgress"),this.timerManager.advanceExercise(i,c+1),await l(r)},onExerciseAddRest:async c=>{o=!1;let d=r.exercises[c],p=r.metadata.restDuration;if(!d||!p)return;let m=this.timerManager.getTimerState(i);m&&(r=M(r,c,b(m.exerciseElapsed))),r=T(r,c,"completed"),r=gt(r,c,p),r=T(r,c+1,"inProgress"),this.timerManager.advanceExercise(i,c+1),await l(r)},onExerciseSkip:async c=>{o=!1;let d=this.timerManager.getTimerState(i);d&&d.exerciseElapsed>0&&(r=M(r,c,b(d.exerciseElapsed))),r=T(r,c,"skipped");let p=r.exercises.findIndex((m,g)=>g>c&&m.state==="pending");if(p>=0)r=T(r,p,"inProgress"),this.timerManager.advanceExercise(i,p),await l(r);else{r.metadata.state="completed";let m=this.timerManager.getTimerState(i);m&&(r.metadata.duration=b(m.workoutElapsed)),r=$(r),this.timerManager.stopWorkoutTimer(i),await l(r)}},onParamChange:(c,d,p)=>{let m=r.exercises[c],g=m==null?void 0:m.params.find(h=>h.key===d);(g==null?void 0:g.value)!==p&&(r=mt(r,c,d,p),o=!0)},onFlushChanges:async()=>{o&&await l(r)},onPauseExercise:()=>{this.timerManager.pauseExercise(i)},onResumeExercise:()=>{this.timerManager.resumeExercise(i)},onAddSample:async()=>{var p;let c=ht(),d=G(c);await((p=this.fileUpdater)==null?void 0:p.updateCodeBlock(t.sourcePath,n,d,c.metadata.title))}}}createStudyCallbacks(t,n,s,i){let r=s,o=!1,l=async c=>{var m;r=c,o=!1;let d=Et(c),p=r.metadata.title;await((m=this.fileUpdater)==null?void 0:m.updateCodeBlock(t.sourcePath,n,d,p))};return{onStartStudy:async()=>{o=!1,r.metadata.state="started",r.metadata.startDate=this.formatStartDate(new Date);let c=r.tasks.findIndex(d=>d.state==="pending");c>=0&&(r=w(r,c,"inProgress")),await l(r),this.timerManager.startWorkoutTimer(i,c>=0?c:0)},onFinishStudy:async()=>{let c=this.timerManager.getTimerState(i);c&&(r.metadata.totalDuration=b(c.workoutElapsed)),r.metadata.endDate=this.formatStartDate(new Date),r.metadata.state="completed",await l(r),this.timerManager.stopWorkoutTimer(i)},onTaskFinish:async c=>{if(o=!1,!r.tasks[c])return;let p=this.timerManager.getTimerState(i);p&&(r=W(r,c,b(p.exerciseElapsed))),r=w(r,c,"completed");let m=r.tasks.findIndex((g,h)=>h>c&&g.state==="pending");m>=0?(r=w(r,m,"inProgress"),this.timerManager.advanceExercise(i,m),await l(r)):await l(r)},onTaskSkip:async c=>{o=!1;let d=this.timerManager.getTimerState(i);d&&d.exerciseElapsed>0&&(r=W(r,c,b(d.exerciseElapsed))),r=w(r,c,"skipped");let p=r.tasks.findIndex((m,g)=>g>c&&m.state==="pending");p>=0?(r=w(r,p,"inProgress"),this.timerManager.advanceExercise(i,p),await l(r)):await l(r)},onPauseTask:()=>{this.timerManager.pauseExercise(i)},onResumeTask:()=>{this.timerManager.resumeExercise(i)},onFlushChanges:async()=>{o&&await l(r)},onOpenSelfEval:()=>{new N(this.app,async c=>{r=Tt(r,c.focusScore,c.comprehensionScore);let d=this.timerManager.getTimerState(i);d&&(r.metadata.totalDuration=b(d.workoutElapsed)),r.metadata.endDate=this.formatStartDate(new Date),r.metadata.state="completed";for(let p=0;p<r.tasks.length;p++){let m=r.tasks[p];if(m&&m.state==="inProgress"){let g=this.timerManager.getTimerState(i);g&&(r=W(r,p,b(g.exerciseElapsed))),r=w(r,p,"completed")}}await l(r),this.timerManager.stopWorkoutTimer(i)}).open()}}}formatStartDate(t){let n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),r=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return`${n}-${s}-${i} ${r}:${o}`}};
